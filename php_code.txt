<?php
header('location:sistem/index.php');
?>
1.5.0
<?php

/* ------------------------------------------------------------------------------
input-harga-beli-kosong.php
	version: 1.2.5

Kasus : di sebuah database AhadPOS, ada banyak barang tanpa hargaBeli / hargaBeli = 0

Solusi : tampilkan interface untuk input hargaBeli yang kosong ini, per Rak


	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

// Connecting, selecting database
include "../config/config.php";


if ($_GET["rak"]) {

	$sql	= "SELECT b.namaBarang, d.barcode, b.hargaJual, d.hargaBeli 
			FROM detail_beli AS d, barang AS b 
			WHERE b.barcode = d.barcode AND b.idRak = ".$_GET["rak"]." AND d.hargaBeli = 0 AND isSold = 'N' 
			ORDER BY b.namaBarang ASC LIMIT 10";
	$hasil	= mysql_query($sql);

	echo "
		<h2>Daftar Barang HPP = 0 (nol)</h2>

		<form action=$_SERVER[PHP_SELF] method=POST>

		<table border=1>
		<tr>
			<td>Barcode
			</td>
			<td>Nama Barang
			</td>
			<td>Harga Jual
			</td>
			<td>Harga Beli
			</td>
			<td>Hapus ?
			</td>
		</tr>
		";

	$n = 1;
	while ($x = mysql_fetch_array($hasil)) {

		echo "
		<tr>
		<td>".$x["barcode"]." 	<input type=hidden name=barcode$n value=".$x["barcode"].">
		</td>
		<td>".$x["namaBarang"]."
		</td>
		<td>".$x["hargaJual"]."
		</td>
		<td><input type=text name=hpp$n value=0 size=5>
		</td>
		<td><input type=checkbox name=hapus$n>
		</td>
		</tr>
		";
		$n++;

	}; // 	while ($x = mysql_fetch_array($hasil)) {

	echo "
	</table>

	<input type=hidden name=count value=$n>
	<input type=submit name=simpan value=Simpan>
	</form>
	";

}; // if ($_GET["rak"]) {


if ($_POST["simpan"]) {


	for ($i; $i < $_POST["count"]; $i++) {

		$barcode	= $_POST["barcode".$i];
		$hpp		= $_POST["hpp".$i];
		$hapus		= $_POST["hapus".$i];


		if (($hpp > 0) OR ($hapus == "on")) {

		// tampilkan informasi proses
		echo " <br />
		Sedang memproses data barcode ".$barcode.": HPP = ".$hpp;

		// simpan perubahan HPP
		$sql 	= "UPDATE detail_beli SET hargaBeli = ".$hpp." 
				WHERE barcode = '".$barcode."'";
		$hasil	= mysql_query($sql);
	
		// proses record yang ingin dihapus
		if ($hapus == "on") {
			echo " - DIHAPUS";
			$sql 	= "DELETE FROM barang WHERE barcode = '".$barcode."'";
			$hasil	= mysql_query($sql) or die(mysql_error());

			$sql 	= "UPDATE detail_beli SET isSold = 'Y'  
					WHERE barcode = '".$barcode."'";
			$hasil	= mysql_query($sql) or die(mysql_error());
		};

		}; // if (($hpp > 0) OR ($hapus == "on")) {

	}; // for ($i; $i < $_GET["count"]; $i++) {

}; // if ($_GET["simpan"]) {


// ==================================================================================
// tampilkan daftar Rak

$sql	= "SELECT idRak, namaRak FROM rak ORDER BY namaRak";
$hasil	= mysql_query($sql) or die(mysql_error());

echo "
	<br /><br />
	<hr />
	<form action=$_SERVER[PHP_SELF] method=GET>

	Pilih Rak : 
	<select name=rak>
	";

while ($x = mysql_fetch_array($hasil)) {

	echo "
	<option value=".$x["idRak"].">".$x["namaRak"]."</option> \n";
}; // while ($x = mysql_fetch_array($hasil)) {

echo "
	</select>

	<br /><br />
	<input type=submit value=Pilih>
	</form>
	";

?>

<?php
        
        include "../config/config.php";

	// GLOBAL VARIABLES
	$temporary_barcode = 2323232323;		// barcode prefix for items with non-unique barcode
	$sdb = 'ahadmart'; 			// source database
	$tdb = 'ahadpos_pdkkacang'; 		// target database

// ====START CODE==================================================================================================================

	// konek ke source & target database
	$sourcedb = mysql_connect($server,$username,$password, true) or die("Koneksi gagal");
	mysql_select_db($sdb, $sourcedb);

	// 65536 = bisa multiple SQL statement di satu mysql_query() !
	$targetdb = mysql_connect('192.168.10.14',$username,'root', true) or die("Koneksi gagal");
	mysql_select_db($tdb, $targetdb);


	$sql = "SELECT barcode FROM barang ORDER BY barcode ASC";
	$hasil = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
	$ctr=0;		
	while($x = mysql_fetch_array($hasil)) {

		$sql = "SELECT id_supplier FROM stock WHERE kd_barang = '$x[barcode]'";
		$hasil1 = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());


		if (mysql_num_rows($hasil1) > 0) {
			$y = mysql_fetch_array($hasil1);
			$sql = "UPDATE barang SET idSupplier = $y[id_supplier] WHERE barcode = '$x[barcode]'";
			$hasil2 = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
			$ctr++;
		} else {
			$sql = "UPDATE barang SET idSupplier = 0 WHERE barcode = '$x[barcode]'";
			$hasil2 = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
		};
	
	};

	echo "SELESAI - $ctr record di update";

?>
<?php


// DO NOT USE ! unless absolutely necessary
// this tool doesn't create the link from transaksibeli to detail_beli
//
// All records migrated to detail_beli by this tool is assigned to idTransaksiBeli of 0 (zero)


include "../config/config.php";


    $dataBarang = mysql_query("SELECT * from tmp_detail_beli") or die(mysql_error());

    while($simpan = mysql_fetch_array($dataBarang)){

	$sql_simpan = "INSERT INTO detail_beli(idTransaksiBeli,barcode,
                        tglExpire,jumBarang,hargaBeli,username,idBarang)
                    VALUES('0','$simpan[barcode]',
                    '$simpan[tglExpire]','$simpan[jumBarang]','$simpan[hargaBeli]','admin','$simpan[idBarang]')";
	echo $sql_simpan."\n";
	mysql_query($sql_simpan) or die(mysql_error());


        $jumlahAkhir = 0;
        $jumBarang = mysql_query("select jumBarang from barang where barcode = '$simpan[barcode]'") or die(mysql_error());
        $jumlah = mysql_fetch_array($jumBarang);
        $jumlahAkhir = $jumlah[jumBarang] + $simpan[jumBarang];

        mysql_query("UPDATE barang SET jumBarang = '$jumlahAkhir' 
                      WHERE barcode = '$simpan[barcode]'") or die(mysql_error());
    }
    //fixme: waktu delete sebaiknya juga menggunakan username sehingga jika ada user lain yang memasukkan tidak terjadi error
    mysql_query("DELETE FROM tmp_detail_beli ") or die(mysql_error());
?>
<?php
        
        include "../config/config.php";

	// GLOBAL VARIABLES
	$temporary_barcode = 2323232323;		// barcode prefix for items with non-unique barcode
	$sdb 		= 'delme'; 		// source database
	$tdb 		= 'insan'; 		// target database
	$idSupplier	= 368;


// ====START CODE==================================================================================================================

	// konek ke source & target database
	$sourcedb = mysql_connect($server,$username,$password, true) or die("Koneksi gagal");
	mysql_select_db($sdb, $sourcedb);

	// 65536 = bisa multiple SQL statement di satu mysql_query() !
	$targetdb = mysql_connect($server,$username,$password, true, 65536) or die("Koneksi gagal");
	mysql_select_db($tdb, $targetdb);


	// OPTIMIZATIONS
	$sql = "ALTER TABLE `barang` ADD INDEX ( `namaBarang` ) ";
	$x1 = mysql_query($sql, $targetdb);



	echo "<h1>Sedang memproses : data ATK .....";	

	$ctr= 0;
	$errorctr=0;
	$sql = "SELECT * FROM barang WHERE idKategoriBarang = 5  
		LIMIT $ctr, ".($ctr+10000);
	//echo $sql;
	$hasil = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());
	while (mysql_num_rows($hasil) > 0) {	
		echo "<br> data: ".($ctr+1)." s/d ".($ctr+10000)." ....";
		
	while(($x = mysql_fetch_array($hasil)) !== false) {


		// cari apakah Nama barang ATAU barcode ini sudah ada di $targetdb
		$sql = "SELECT * FROM barang WHERE barcode = '$x[barcode]' OR namaBarang = '$x[namaBarang]'";
		$x1  = mysql_query($sql, $targetdb);

		// jika belum ada, INSERT
		if (mysql_num_rows($x1) == 0) {

			$sql = "INSERT INTO barang (namaBarang,idKategoriBarang,idSatuanBarang,jumBarang,
					hargaJual,last_update,idSupplier,barcode,username,idRak) 
				VALUES ('$x[namaBarang]',14,3,0,$x[hargaJual],'".date("Y-m-d")."',$idSupplier,'$x[barcode]','susan',0);";
			$x2  = mysql_query($sql, $targetdb);

		
		};
	}; // while(($x = mysql_fetch_array($hasil)) !== false) 


		// siap-siap untuk looping berikutnya
		$ctr = $ctr + 10000;
		$sql = "SELECT * FROM barang WHERE idKategoriBarang = 5  
			LIMIT $ctr, ".($ctr+10000);
		$hasil = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());
	}; // end while (mysql_num_rows($hasil) > 0) 


	
	echo " SELESAI !</h1> \n\n Error : $errorctr \n\n";
	exit;



?>



<?php
/* fix-numeric-barcode.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://rimbalinux.com/projects/ahadpos/
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


/* ---------------------------------
This script will fix old barcode fields in detail_beli table, 
which are still of bigint type. It should be varchar(25)

It can't be bigint, because there are barcode prefixed by 0 (zeros), so it will be stored without those zero prefix.

Example:
barcode: 089686592016
Stored by varchar(25) field	: 089686592016
Stored by bigint field		: 89686592016

For those using old version of AhadPOS, thus still have some of its data stored incorrectly as above, 
this script will fix it, using following logic :

1. SELECT * FROM barang, then start looping
2. Find the corresponding idBarang in detail_beli
3. See if the barcode is different. If yes:
	3a. copy the barcode from barang
		UPDATE detail_beli SET barcode=barang.barcode WHERE idBarang=barang.barcode;
	3b. find similar wrong barcodes in detail_beli, and change them as well
		UPDATE detail_beli SET barcode=barang.barcode WHERE barcode=$wrong_barcode;
4. End loop


==== BEFORE ==== running this script, execute the following SQL commands frist,
to fix the detail_beli table :

ALTER TABLE `detail_beli` CHANGE `barcode` `barcode` VARCHAR( 25 ) NULL DEFAULT NULL ;
ALTER TABLE `tmp_detail_beli` CHANGE `barcode` `barcode` VARCHAR( 25 ) NULL DEFAULT NULL ,
CHANGE `username` `username` VARCHAR( 30 ) CHARACTER SET latin1 COLLATE latin1_general_ci NULL DEFAULT NULL ;
ALTER TABLE `tmp_detail_beli` CHANGE `barcode` `barcode` VARCHAR( 25 ) CHARACTER SET latin1 COLLATE latin1_general_ci NULL DEFAULT NULL ;

------------------------------------ */

include "../config/config.php";



$sql = "SELECT * FROM barang";
$hasil1 = mysql_query($sql) or die(mysql_error());
$ctr=0;
while ($x = mysql_fetch_array($hasil1)) {

	// cari idBarang ybs di detail_beli
	$sql = "SELECT * FROM detail_beli WHERE idBarang=$x[idBarang]";
	$hasil2 = mysql_query($sql) or die(mysql_error());
	$y = mysql_fetch_array($hasil2);

	// cek apakah barcode-nya sama
	if ($y[barcode] !== $x[barcode]) {
		// jika tidak - copy barcode dari table barang
		$sql = "UPDATE detail_beli SET barcode='$x[barcode]' WHERE barcode='$y[barcode]'";
		$hasil3 = mysql_query($sql) or die(mysql_error());
		if ($x[idBarang] == 21097) { echo $sql;};
	};

	$ctr++;
	if ($ctr % 100 == 0) {
		echo "Sedang proses record : $ctr \n<br>";
	};
}


?>
<?php 

$server = "localhost";
$username = "root";
$password = "";
$database = "test2";

// Koneksi dan memilih database di server
mysql_connect($server,$username,$password) or die("Koneksi gagal");
mysql_select_db($database) or die("Database tidak bisa dibuka");


echo_dbf('/home/sufehmi/Documents/_workshop/devel/old-Ahad-POS/GDG_12.DBF');
exit;

function echo_dbf($dbfname) { 
    $fdbf = fopen($dbfname,'r'); 
    $fields = array(); 
    $buf = fread($fdbf,32); 
    $header=unpack( "VRecordCount/vFirstRecord/vRecordLength", substr($buf,4,8)); 
    ////echo 'Header: '.json_encode($header).'<br/>'; 
    $goon = true; 
    $unpackString=''; 

    echo "Total record: ".$header['RecordCount']." \n";
    while ($goon && !feof($fdbf)) { // read fields: 
        $buf = fread($fdbf,32); 
        if (substr($buf,0,1)==chr(13)) {$goon=false;} // end of field list 
        else { 
            $field=unpack( "a11fieldname/A1fieldtype/Voffset/Cfieldlen/Cfielddec", substr($buf,0,18)); 
            ////echo 'Field: '.json_encode($field).'<br/>'; 
            $unpackString.="A$field[fieldlen]$field[fieldname]/"; 
            array_push($fields, $field);}} 
    fseek($fdbf, $header['FirstRecord']+1); // move back to the start of the first record (after the field definitions) 
    for ($i=1; $i<=$header['RecordCount']; $i++) { 
        $buf = fread($fdbf,$header['RecordLength']); 
        $record=unpack($unpackString,$buf); 
        //// output format JSON :: 
	//echo 'record: '.json_encode($record).'<br/>'; 
        //// output format Array
	//echo 'record: '.var_dump($record).'<br/>'; 
        //// output format RAW
	// echo $i.$buf.'<br/>'; 
	// cari apakah barcode ini sudah ada di database ?
	$sql1 = "SELECT * FROM barang WHERE barcode = '".$record["KODE"]."'";
	//echo "Mencari: ".$sql1."<br>";
	$hasil1 = mysql_query($sql1) or die("Error : ".mysql_error()." SQL: ".$sql1);
	// jika belum ada, maka simpan :
	if (mysql_num_rows($hasil1) < 1) {
	

		// kalau SUPL_KD kosong, ganti menjadi "umum"
		if (($record["SUPL_KD"] == '') || (empty($record["SUPL_KD"]))) {
			$record["SUPL_KD"] = "umum";
		};

		// cari supplier
		$sql2 = "SELECT * FROM supplier WHERE namaSupplier='".$record["SUPL_KD"]."'";
		$hasil2 = mysql_query($sql2);
		// jika belum ada, maka simpan kode supplier ybs ke database supplier
		if (mysql_num_rows($hasil2) < 1) {
			mysql_query("INSERT INTO supplier(namaSupplier) VALUES ('".$record["SUPL_KD"]."')");
			$kode_supplier = mysql_insert_id();
		} else { // catat nomor suppliernya
			$data=mysql_fetch_array($hasil2);
			$kode_supplier = $data["idSupplier"];
		};
		//echo "<br>kode supplier : ".$kode_supplier."\n"; 

		// apakah ada karakter ' (single quote) di nama barangnya ? 
		// jika ya, ganti menjadi "
		while (strpos($record["NAMA"], "'") !== false) {
			$record["NAMA"] = str_replace("'", '"', $record["NAMA"]);
			echo "Ada single quote : ".$record["KODE"]." ".$record["NAMA"]."\n";
		};

		// simpan di tabel barang
		$sql3 = "INSERT INTO barang(idBarang,namaBarang, idSupplier, idKategoriBarang, idSatuanBarang, last_update, barcode, hargaJual)
                    VALUES($i, '$record[NAMA]', '$kode_supplier', '9999','3', '2010-02-01', '$record[KODE]', $record[HRG_JUAL])";
		//echo $sql3." <br>";
	    	mysql_query($sql3);

		// simpan di tabel detail_beli
		$sql3 = "INSERT INTO detail_beli (idTransaksiBeli, idBarang, jumBarang, hargaBeli, barcode, username, jumBarangAsli)
                    VALUES(1, $i, 1, $record[HRG_BELI], '$record[KODE]', 'admin', 0)";
		//echo $sql3." <br>";
	    	//mysql_query($sql3);

	};

	} 
    fclose($fdbf); } 
?>
<?php
	
	include "../config/config.php";

	$tampil=mysql_query("SELECT DISTINCT *   
                        FROM tmp_detail_beli");


	while ($r=mysql_fetch_array($tampil)) {

	if ($r[hargaJual] > 0) {

		$sql = "UPDATE barang SET hargaJual=$r[hargaJual] WHERE barcode=$r[barcode]";
		$hasil = mysql_query($sql);
		echo $sql."<br />";

	}

	}	

?>
<?php
        
        include "../config/config.php";

	// GLOBAL VARIABLES
	$temporary_barcode = 2323232323;		// barcode prefix for items with non-unique barcode
	$sdb = 'ahadmart'; 			// source database
	$tdb = 'ahadpos_pdkkacang'; 		// target database

// ====START CODE==================================================================================================================

	// konek ke source & target database
	$sourcedb = mysql_connect($server,$username,$password, true) or die("Koneksi gagal");
	mysql_select_db($sdb, $sourcedb);

	// 65536 = bisa multiple SQL statement di satu mysql_query() !
	$targetdb = mysql_connect($server,$username,$password, true, 65536) or die("Koneksi gagal");
	mysql_select_db($tdb, $targetdb);


	// OPTIMIZATIONS
	$sql ="ALTER TABLE `pembelian_detail` ADD INDEX ( `kd_produk` ) ";
	mysql_query($sql, $sourcedb);


	// ### supplier : dari supplier
	echo " selesai</h1><h1> Sedang memproses: data SUPPLIER .....";
	
	$hasil = mysql_query("select * from supplier", $sourcedb) or die("Error : ".mysql_error());
	while($x = mysql_fetch_array($hasil)) {
		$sql = "INSERT INTO supplier (last_update,idSupplier,namaSupplier,alamatSupplier,telpSupplier,Keterangan) 
				VALUES ('2010-06-17', $x[id_supplier], '$x[nama]', '$x[alamat] :: $x[kd_pos]', 
				'Telp: $x[telp], Fax: $x[fax], TelpCP: $x[telp_cp], MobileCP: $x[mobile_cp],', 'CP: $x[cp], Ket: $x[ket],')
			";
		mysql_query($sql,$targetdb);
	};
/*
last_update='2010-06-17'
get:
# idSupplier		(num)	id_supplier
# namaSupplier 		(text) nama
# alamatSupplier 	(text) alamat + kd_pos
# telpSupplier 		(text) telp 	fax 	telp_cp  mobile_cp 	
# Keterangan 		(text) cp + ket
*/


	//### satuan_barang : dari satuan_ukuran
	echo "selesai</h1><h1>Sedang memproses : data SATUAN .....";	
	
	$hasil = mysql_query("select * from satuan_ukuran", $sourcedb) or die("Error : ".mysql_error());
	while($x = mysql_fetch_array($hasil)) {
		$sql = "INSERT INTO satuan_barang (idSatuanBarang,namaSatuanBarang) 
				VALUES ($x[id_satuan_ukuran], '$x[satuan_ukuran]')
			";
		mysql_query($sql,$targetdb);
	};
/*
get:
# idSatuanBarang	(num)	id_satuan_ukuran
# namaSatuanBarang	(text)	satuan_ukuran
*/


	// ### rak : dari rak
	echo "selesai</h1><h1>Sedang memproses : data RAK .....";	
	
	$hasil = mysql_query("select * from rak", $sourcedb) or die("Error : ".mysql_error());
	while($x = mysql_fetch_array($hasil)) {
		$sql = "INSERT INTO rak (idRak,namaRak) 
				VALUES ($x[id_rak],'$x[no_rak]')
			";
		mysql_query($sql,$targetdb);
	};
/*
get: 
# idRak			(num) id_rak
# namaRak		(text) no_rak
*/


	// ### kategori : dari kategori
	echo "selesai</h1><h1>Sedang memproses : data KATEGORI .....";	
	// hapus dulu isi table kategori_barang di $targetdb
	mysql_query("delete from kategori_barang;",$targetdb);
	// mulai copy data kategori
	$hasil = mysql_query("SELECT * FROM kategori", $sourcedb) or die("Error : ".mysql_error());
	while($x = mysql_fetch_array($hasil)) {
		$sql = "INSERT INTO kategori_barang (idKategoriBarang,namaKategoriBarang) 
				VALUES ($x[id_kategori],'$x[kategori]')
			";
		mysql_query($sql,$targetdb) or die("Error : ".mysql_error());
	};
/* 
get:
# idKategoriBarang	(num) 	id_kategori
# namaKategoriBarang	(text) kategori
*/


	echo "selesai</h1><h1>Sedang memproses : data BARANG .....";	

	$ctr= 0;
	$errorctr=0;
	$sql = "SELECT s.id_supplier,s.jumlah_gudang,s.jumlah,s.harga_jual,s.kd_barang, s.nama_barang,s.id_kategori,s.id_satuan_ukuran,
			s.id_rak, 
			b.harga
		FROM stock as s, (SELECT bb.harga FROM pembelian_detail as bb, stock as ss 
					WHERE ss.kd_barang=bb.kd_produk ORDER BY bb.trx_time DESC LIMIT 1) as b  
		LIMIT $ctr, ".($ctr+10000);

	$hasil = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());
	while (mysql_num_rows($hasil) > 0) {	
		echo "<br> data: ".($ctr+1)." s/d ".($ctr+10000)." ....";
		
	while(($x = mysql_fetch_array($hasil)) !== false) {

		// cari HargaBeli
		//$hasil2 = mysql_query("SELECT harga FROM pembelian_detail WHERE kd_produk='$x[kd_barang]'", $sourcedb) or die("Error : ".mysql_error()." sql: ".$sql);
		//$y = mysql_fetch_array($hasil2);
		$HargaBeli = $x[harga];		
		if (empty($HargaBeli)) { $HargaBeli = 0;};
		
		// ### tmp_detail_beli :: dari stock
		// perlu simpan ke tmp_detail_beli dulu, untuk mendapatkan idBarang yang unique (di generate oleh MySQL)
		$sql = "INSERT INTO tmp_detail_beli (username,tglExpire,tglTransaksi,idSupplier,jumBarang, 
					hargaBeli,hargaJual,barcode) 
				VALUES ('admin','0000-00-00','2010-06-17',$x[id_supplier],".($x[jumlah_gudang]+$x[jumlah]).",
					$HargaBeli,$x[harga_jual],'$x[kd_barang]')
			";
		mysql_query($sql,$targetdb) or die("Error : ".mysql_error()." sql: ".$sql." -- HargaBeli: ".$HargaBeli);
		/*
		username='admin'
		tglExpire='0000-00-00'
		tglTransaksi='2010-06-17'
		get:
		# idSupplier 		(num) id_supplier
		# jumBarang 		(num) jumlah_gudang + jumlah
		# hargaBeli 		(num) select b.harga from pembelian_detail as b where b.kd_produk='barcode' ('barcode' = stock.kd_barang)
		# hargaJual 		(num) harga_jual
		# barcode 		(text) kd_barang
		*/


		// cari Idbarang
		//$Idbarang = mysql_insert_id($targetdb) or die("Error : ".mysql_error());
		$z = mysql_query("SELECT LAST_INSERT_ID() FROM tmp_detail_beli",$targetdb) or die("Error : ".mysql_error());
		$zz = mysql_fetch_array($z);
		$IdBarang = $zz["LAST_INSERT_ID()"];
	
		// ganti ' menjadi `, agar tidak error saat INSERT
		$x[nama_barang] = str_replace("'","`",$x[nama_barang]);

		// ### barang	:: untuk setiap record di tabel tmp_detail_beli, buat juga record di tabel barang
		$sql = "INSERT INTO barang (idSupplier,username,last_update,idBarang,namaBarang,idKategoriBarang,idSatuanBarang,jumBarang,
				hargaJual,barcode,idRak) 
			VALUES ($x[id_supplier],'admin','2010-06-17',$IdBarang,'$x[nama_barang]',$x[id_kategori],$x[id_satuan_ukuran],
				".($x[jumlah_gudang]+$x[jumlah]).",
				$x[harga_jual],'$x[kd_barang]', $x[id_rak])
			";
		$hasil3 = mysql_query($sql,$targetdb); 

		if (!$hasil3) {
			$errorctr++;
			echo "Error : ".mysql_error()." sql: ".$sql;

			$temporary_barcode++;
		};
		/*
		username='admin'
		lastupdate='2010-06-17'
		get: 
		# idBarang 		: dari tmp_detail_beli.idBarang
		# namaBarang		(text) 	stock.nama_barang
		# idKategoriBarang	(num) 	stock.id_kategori
		# idSatuanBarang	(num)	stock.id_satuan_ukuran
		# jumBarang		: dari tmp_detail_beli.jumBarang
		# hargaJual		: dari tmp_detail_beli.hargaJual
		# barcode		: dari tmp_detail_beli.barcode
		# idRak			(num)	id_rak
		*/
	}; // end while(($x = mysql_fetch_array($hasil)) !== false) 
	

		// siap-siap untuk looping berikutnya
		$ctr = $ctr + 10000;
		//$sql = "SELECT * FROM stock LIMIT $ctr, ".($ctr+10000);
		//$sql = "SELECT s.id_supplier,s.jumlah_gudang,s.jumlah,s.harga_jual,s.kd_barang, s.nama_barang,s.id_kategori,s.id_satuan_ukuran,
		//	s.id_rak, 
		//	b.harga
		//FROM stock as s, pembelian_detail as b 
		//WHERE b.kd_produk = s.kd_barang 
		//LIMIT $ctr, ".($ctr+10000);
		$sql = "SELECT s.id_supplier,s.jumlah_gudang,s.jumlah,s.harga_jual,s.kd_barang, s.nama_barang,s.id_kategori,s.id_satuan_ukuran,
			s.id_rak, 
			b.harga
		FROM stock as s, (SELECT bb.harga FROM pembelian_detail as bb, stock as ss 
					WHERE ss.kd_barang=bb.kd_produk ORDER BY bb.trx_time DESC  LIMIT 1) as b  
		LIMIT $ctr, ".($ctr+10000);
		$hasil = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());
	}; // end while (mysql_num_rows($hasil) > 0) 


// selesai input data ke tmp_detail_beli,
// mulai pindahkan ke transaksi_beli


	// ### transaksi_beli :: baca dari tmp_detail_beli, grouped per supplier
	echo "selesai</h1><h1>Sedang memproses : data TRANSAKSI BELI ..... </h1>";	
	
	$hasil = mysql_query("SELECT DISTINCT idSupplier FROM tmp_detail_beli", $targetdb) or die("Error : ".mysql_error());
	while($x = mysql_fetch_array($hasil)) {

		echo "<br> Supplier: $x[idSupplier]";
		
		// simpan transaksi beli nya
		$sql = "INSERT INTO transaksibeli (username,idUser,last_update,idTipePembayaran,tglTransaksibeli,
					NomorInvoice,nominal,idSupplier) 
			VALUES ('admin',1,'2010-06-17',1,'2010-06-17',0,0,$x[idSupplier])
			";
		mysql_query($sql,$targetdb) or die("Error : ".mysql_error());
		/*
		username='admin'
		idUser=1
		last_update='2010-06-17'
		idTipePembayaran=1
		tglTransaksiBeli='2010-06-17'
		NomorInvoice=0
		nominal=0
		get:
		# idSupplier 		: dari tmp_detail_beli.idSupplier
		*/

		// cari IdTransaksiBeli
		//$IdTransaksiBeli = mysql_insert_id($targetdb) or die("Error : ".mysql_error());
		$z = mysql_query("SELECT LAST_INSERT_ID() FROM transaksibeli",$targetdb) or die("Error : ".mysql_error());
		$zz = mysql_fetch_array($z);
		$IdTransaksiBeli = $zz["LAST_INSERT_ID()"];

		// kumpulkan semua Detail transaksi beli supplier ybs
		$hasil2 = mysql_query("SELECT * FROM tmp_detail_beli WHERE idSupplier = $x[idSupplier]", $targetdb) or die("Error : ".mysql_error());
		while($y = mysql_fetch_array($hasil2)) {

			$sql = "INSERT INTO detail_beli (username,isSold,IdTransaksiBeli,tglExpire,idBarang,jumBarang,jumBarangAsli,hargaBeli,barcode) 
					VALUES ('admin','N', $IdTransaksiBeli,'0000-00-00',$y[idBarang],$y[jumBarang],$y[jumBarang],$y[hargaBeli],
						'$y[barcode]')
				";
			
			mysql_query($sql,$targetdb) or die("Error : ".mysql_error()." sql: ".$sql);
			/*
			username='admin'
			isSold='N'
			tglExpire='0000-00-00'
			get :
			# idTransaksiBeli 	: dari transaksi_beli.idTransaksiBeli
			# idBarang 		: dari tmp_detail_beli.idBarang
			# jumBarang		: dari tmp_detail_beli.jumBarang 	
			# jumBarangAsli 	: dari tmp_detail_beli.jumBarang
			# hargaBeli 	 	: dari tmp_detail_beli.hargaBeli
			# barcode 		: dari tmp_detail_beli.barcode
			*/
		}; // while($y = mysql_fetch_array($hasil2))

	}; // while($x = mysql_fetch_array($hasil))



/*
users:
admin
awan
hamdani
harry
aie
ayu
lela
*/


	// ### finish : hapus semua isi tmp_detail_beli

	echo "s<h1>Sedang memproses : hapus data sementara .....";	
	
	mysql_query("DELETE FROM tmp_detail_beli", $targetdb) or die("Error : ".mysql_error());	
	

	// hapus duplikasi di detail_beli
	$sql = "CREATE TABLE sementara AS SELECT * FROM detail_beli WHERE 1 GROUP BY barcode";
	mysql_query($sql,$targetdb);
	$sql = "DROP TABLE detail_beli";
	mysql_query($sql,$targetdb);
	$sql = "RENAME TABLE sementara TO detail_beli";
	mysql_query($sql,$targetdb);

	
	echo " SELESAI !</h1> \n\n Error : $errorctr \n\n";
	exit;




function PopulateDatabase($targetdb) {

	mysql_query("drop database ahadpos_pdkkacang; create database ahadpos_pdkkacang; commit;", $targetdb) or die("Error : ".mysql_error());
	mysql_select_db('ahadpos_pdkkacang', $targetdb);

	$sql = "
SET NAMES utf8;

SET SQL_MODE='';
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO';

/*Table structure for table `bank` */

DROP TABLE IF EXISTS `bank`;

CREATE TABLE `bank` (
  `idBank` int(3) NOT NULL,
  `namaBank` varchar(20) default NULL,
  `noRekening` varchar(30) default NULL,
  PRIMARY KEY  (`idBank`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `bank` */

/*Table structure for table `barang` */

DROP TABLE IF EXISTS `barang`;

CREATE TABLE `barang` (
  `idBarang` bigint(20) NOT NULL default '0',
  `namaBarang` varchar(30) default ' ',
  `idKategoriBarang` int(5) default '0',
  `idSatuanBarang` int(5) default '0',
  `jumBarang` int(10) default '0',
  `hargaJual` bigint(20) default '0',
  `last_update` date default '2000-01-01',
  `idSupplier` bigint(20) default '0',
  `barcode` varchar(25) default NULL,
  `username` varchar(30) default NULL,
  `idRak` bigint(5) default NULL,
  UNIQUE KEY `barcode` (`barcode`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `barang` */

insert into `barang` (`idBarang`,`namaBarang`,`idKategoriBarang`,`idSatuanBarang`,`jumBarang`,`hargaJual`,`last_update`,`idSupplier`,`barcode`,`username`,`idRak`) values (1,'Mie Sedap Goreng Kari Spesial',4,3,160,1250,'2010-03-26',5,'80808080',NULL,NULL);
insert into `barang` (`idBarang`,`namaBarang`,`idKategoriBarang`,`idSatuanBarang`,`jumBarang`,`hargaJual`,`last_update`,`idSupplier`,`barcode`,`username`,`idRak`) values (2,'Mie Sedap Rebus Kari Ayam',4,3,160,1094,'2010-03-26',5,'82828282',NULL,NULL);
insert into `barang` (`idBarang`,`namaBarang`,`idKategoriBarang`,`idSatuanBarang`,`jumBarang`,`hargaJual`,`last_update`,`idSupplier`,`barcode`,`username`,`idRak`) values (3,'Sirup ABC Lemon',3,3,20,9375,'2010-03-26',3,'90909090',NULL,NULL);
insert into `barang` (`idBarang`,`namaBarang`,`idKategoriBarang`,`idSatuanBarang`,`jumBarang`,`hargaJual`,`last_update`,`idSupplier`,`barcode`,`username`,`idRak`) values (4,'Sirup ABC Strawberry',3,3,20,10000,'2010-03-26',3,'91919191',NULL,NULL);

/*Table structure for table `config` */

DROP TABLE IF EXISTS `config`;

CREATE TABLE `config` (
  `idConfig` bigint(20) NOT NULL auto_increment,
  `option` varchar(30) NOT NULL,
  `value` varchar(50) NOT NULL,
  `description` varchar(50) default NULL,
  PRIMARY KEY  (`idConfig`),
  KEY `option` (`option`)
) ENGINE=MyISAM AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;

/*Data for the table `config` */

insert into `config` (`idConfig`,`option`,`value`,`description`) values (1,'store_name','Ahad mart Parungserab','name of the shop');
insert into `config` (`idConfig`,`option`,`value`,`description`) values (2,'receipt_footer1','Terimakasih telah berbelanja di Ahad mart',NULL);
insert into `config` (`idConfig`,`option`,`value`,`description`) values (3,'receipt_footer2','Murah, Lengkap, dan Islami',NULL);
insert into `config` (`idConfig`,`option`,`value`,`description`) values (4,'receipt_header1','---------------------',NULL);
insert into `config` (`idConfig`,`option`,`value`,`description`) values (5,'temporary_space','/tmp/',NULL);

/*Table structure for table `customer` */

DROP TABLE IF EXISTS `customer`;

CREATE TABLE `customer` (
  `idCustomer` varchar(10) NOT NULL,
  `namaCustomer` varchar(30) default NULL,
  `alamatCustomer` varchar(50) default NULL,
  `telpCustomer` varchar(15) default NULL,
  `keterangan` text,
  `uname` varchar(8) default NULL,
  `pwd` varchar(35) default NULL,
  `last_update` date default NULL,
  PRIMARY KEY  (`idCustomer`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `customer` */

insert into `customer` (`idCustomer`,`namaCustomer`,`alamatCustomer`,`telpCustomer`,`keterangan`,`uname`,`pwd`,`last_update`) values ('1','Umum','Customer Umum / Non Member','','Customer Umum / Non Member',NULL,NULL,'2009-12-01');
insert into `customer` (`idCustomer`,`namaCustomer`,`alamatCustomer`,`telpCustomer`,`keterangan`,`uname`,`pwd`,`last_update`) values ('2','Rosari Prima','JL. GelarSena 1','0272325540','rosa',NULL,NULL,'2009-11-21');
insert into `customer` (`idCustomer`,`namaCustomer`,`alamatCustomer`,`telpCustomer`,`keterangan`,`uname`,`pwd`,`last_update`) values ('3','Priska','STM Pembangunan','08562969601','kantin',NULL,NULL,'2009-12-06');

/*Table structure for table `detail_beli` */

DROP TABLE IF EXISTS `detail_beli`;

CREATE TABLE `detail_beli` (
  `idDetailBeli` bigint(20) NOT NULL auto_increment,
  `idTransaksiBeli` bigint(20) NOT NULL,
  `idBarang` bigint(20) NOT NULL,
  `tglExpire` date NOT NULL,
  `jumBarang` int(10) NOT NULL,
  `hargaBeli` bigint(20) NOT NULL,
  `isSold` varchar(1) character set latin1 default 'N',
  `barcode` bigint(15) default NULL,
  `username` varchar(30) character set latin1 default NULL,
  `jumBarangAsli` int(11) default NULL COMMENT 'Jumlah Barang pada saat Pembelian',
  PRIMARY KEY  (`idDetailBeli`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci COMMENT='latin1_general_ci';

/*Data for the table `detail_beli` */

insert into `detail_beli` (`idDetailBeli`,`idTransaksiBeli`,`idBarang`,`tglExpire`,`jumBarang`,`hargaBeli`,`isSold`,`barcode`,`username`,`jumBarangAsli`) values (1,1,1,'0000-00-00',160,1000,'N',80808080,'ariefadmin',160);
insert into `detail_beli` (`idDetailBeli`,`idTransaksiBeli`,`idBarang`,`tglExpire`,`jumBarang`,`hargaBeli`,`isSold`,`barcode`,`username`,`jumBarangAsli`) values (2,1,2,'0000-00-00',160,875,'N',82828282,'ariefadmin',160);
insert into `detail_beli` (`idDetailBeli`,`idTransaksiBeli`,`idBarang`,`tglExpire`,`jumBarang`,`hargaBeli`,`isSold`,`barcode`,`username`,`jumBarangAsli`) values (3,2,4,'0000-00-00',20,8000,'N',91919191,'ariefadmin',20);
insert into `detail_beli` (`idDetailBeli`,`idTransaksiBeli`,`idBarang`,`tglExpire`,`jumBarang`,`hargaBeli`,`isSold`,`barcode`,`username`,`jumBarangAsli`) values (4,2,3,'0000-00-00',20,7500,'N',90909090,'ariefadmin',20);

/*Table structure for table `detail_jual` */

DROP TABLE IF EXISTS `detail_jual`;

CREATE TABLE `detail_jual` (
  `idTransaksiJual` bigint(20) NOT NULL,
  `idBarang` bigint(20) NOT NULL,
  `jumBarang` int(10) NOT NULL,
  `hargaBeli` bigint(20) default NULL,
  `hargaJual` bigint(20) NOT NULL,
  `username` varchar(30) character set latin1 default NULL,
  `diskon` bigint(20) NOT NULL,
  `barcode` varchar(25) character set latin1 default NULL,
  `nomorStruk` bigint(20) default NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `detail_jual` */

insert into `detail_jual` (`idTransaksiJual`,`idBarang`,`jumBarang`,`hargaBeli`,`hargaJual`,`username`,`diskon`,`barcode`,`nomorStruk`) values (1,2,2,875,1094,'ariefadmin',0,'82828282',1);
insert into `detail_jual` (`idTransaksiJual`,`idBarang`,`jumBarang`,`hargaBeli`,`hargaJual`,`username`,`diskon`,`barcode`,`nomorStruk`) values (1,1,2,1000,1250,'ariefadmin',0,'80808080',1);
insert into `detail_jual` (`idTransaksiJual`,`idBarang`,`jumBarang`,`hargaBeli`,`hargaJual`,`username`,`diskon`,`barcode`,`nomorStruk`) values (2,4,1,8000,10000,'kasir1',0,'91919191',2);
insert into `detail_jual` (`idTransaksiJual`,`idBarang`,`jumBarang`,`hargaBeli`,`hargaJual`,`username`,`diskon`,`barcode`,`nomorStruk`) values (2,3,1,7500,9375,'kasir1',0,'90909090',2);

/*Table structure for table `hutang` */

DROP TABLE IF EXISTS `hutang`;

CREATE TABLE `hutang` (
  `idTransaksiBeli` bigint(20) NOT NULL,
  `nominal` bigint(20) NOT NULL,
  `tglBayar` date NOT NULL,
  `last_update` date NOT NULL,
  `username` varchar(30) default NULL,
  PRIMARY KEY  (`idTransaksiBeli`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `hutang` */

insert into `hutang` (`idTransaksiBeli`,`nominal`,`tglBayar`,`last_update`,`username`) values (1,300000,'2010-04-19','2010-03-26','ariefadmin');

/*Table structure for table `kasir` */

DROP TABLE IF EXISTS `kasir`;

CREATE TABLE `kasir` (
  `idTransKasir` int(15) NOT NULL auto_increment,
  `tglBukaKasir` datetime default NULL,
  `idUser` int(3) default NULL,
  `kasAwal` float default NULL,
  `kasSeharusnya` float default NULL,
  `kasTutup` float default NULL,
  `currentWorkstation` bigint(20) default NULL,
  `tglTutupKasir` datetime default NULL,
  `totalTransaksi` bigint(20) default NULL,
  `totalProfit` bigint(20) default NULL,
  `totalRetur` bigint(20) default NULL,
  `totalTransaksiKas` bigint(20) default NULL,
  `totalTransaksiKartu` bigint(20) default NULL,
  PRIMARY KEY  (`idTransKasir`)
) ENGINE=MyISAM AUTO_INCREMENT=2 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `kasir` */

insert into `kasir` (`idTransKasir`,`tglBukaKasir`,`idUser`,`kasAwal`,`kasSeharusnya`,`kasTutup`,`currentWorkstation`,`tglTutupKasir`,`totalTransaksi`,`totalProfit`,`totalRetur`,`totalTransaksiKas`,`totalTransaksiKartu`) values (1,'2010-03-26 20:37:52',10,100000,NULL,NULL,1,NULL,NULL,NULL,NULL,NULL,NULL);

/*Table structure for table `kategori_barang` */

DROP TABLE IF EXISTS `kategori_barang`;

CREATE TABLE `kategori_barang` (
  `idKategoriBarang` int(5) NOT NULL,
  `namaKategoriBarang` varchar(30) default NULL,
  PRIMARY KEY  (`idKategoriBarang`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `kategori_barang` */

insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (1,'wafer');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (2,'biskuit');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (3,'sirup');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (4,'mie');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (5,'kopi');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (6,'isotonik drink');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (7,'makanan');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (8,'Gulaku');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (9,'kosmetik');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (10,'Perlengkapan');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (11,'sabun cuci');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (12,'minuman');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (13,'Susu');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (14,'ATK');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (15,'Elektronik');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (16,'Bayi');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (17,'Detergent/Obat Nyamuk');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (18,'Pecah Belah');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (19,'Muslim');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (20,'Sabun/Shampo');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (21,'Mainan');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (22,'Pakaian');
insert into `kategori_barang` (`idKategoriBarang`,`namaKategoriBarang`) values (23,'Obat');

/*Table structure for table `leveluser` */

DROP TABLE IF EXISTS `leveluser`;

CREATE TABLE `leveluser` (
  `idLevelUser` int(2) NOT NULL,
  `levelUser` varchar(20) collate latin1_general_ci default NULL,
  PRIMARY KEY  (`idLevelUser`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `leveluser` */

insert into `leveluser` (`idLevelUser`,`levelUser`) values (1,'semua');
insert into `leveluser` (`idLevelUser`,`levelUser`) values (2,'admin');
insert into `leveluser` (`idLevelUser`,`levelUser`) values (3,'gudang');
insert into `leveluser` (`idLevelUser`,`levelUser`) values (4,'kasir');

/*Table structure for table `modul` */

DROP TABLE IF EXISTS `modul`;

CREATE TABLE `modul` (
  `idModul` int(3) NOT NULL,
  `namaModul` varchar(50) collate latin1_general_ci default NULL,
  `link` varchar(50) collate latin1_general_ci default NULL,
  `publish` enum('Y','N') collate latin1_general_ci default NULL,
  `idLevelUser` int(2) default NULL,
  `urutan` int(3) default NULL,
  `last_update` date default NULL,
  PRIMARY KEY  (`idModul`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `modul` */

insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (1,'Manajemen User','?module=user','N',2,101,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (2,'Supplier','?module=supplier','Y',3,5,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (3,'Customer','?module=customer','Y',4,6,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (4,'Barang','?module=barang','Y',3,3,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (5,'Rak','?module=rak','Y',3,4,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (6,'Satuan Barang','?module=satuan_barang','Y',3,1,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (7,'Kategori Barang','?module=kategori_barang','Y',3,2,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (8,'Pembelian','?module=pembelian_barang','Y',3,7,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (9,'Penjualan','?module=penjualan_barang','Y',4,8,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (10,'Ganti Password','?module=ganti_password','N',1,100,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (11,'Hutang','?module=hutang','Y',3,9,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (12,'Piutang','?module=piutang','Y',4,10,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (13,'Manajemen Modul','?module=modul','N',2,102,'2009-10-19');
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (14,'Kasir','?module=kasir','Y',2,11,NULL);
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (15,'Laporan Manajemen','?module=laporan','Y',2,12,NULL);
insert into `modul` (`idModul`,`namaModul`,`link`,`publish`,`idLevelUser`,`urutan`,`last_update`) values (16,'Manajemen Workstation','?module=workstation','Y',2,13,NULL);

/*Table structure for table `pembayaran` */

DROP TABLE IF EXISTS `pembayaran`;

CREATE TABLE `pembayaran` (
  `idTipePembayaran` int(3) NOT NULL auto_increment,
  `tipePembayaran` varchar(30) default NULL,
  PRIMARY KEY  (`idTipePembayaran`)
) ENGINE=MyISAM AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;

/*Data for the table `pembayaran` */

insert into `pembayaran` (`idTipePembayaran`,`tipePembayaran`) values (1,'CASH');
insert into `pembayaran` (`idTipePembayaran`,`tipePembayaran`) values (2,'Tempo');
insert into `pembayaran` (`idTipePembayaran`,`tipePembayaran`) values (3,'Voucher');
insert into `pembayaran` (`idTipePembayaran`,`tipePembayaran`) values (4,'Debit');
insert into `pembayaran` (`idTipePembayaran`,`tipePembayaran`) values (5,'Kredit');

/*Table structure for table `piutang` */

DROP TABLE IF EXISTS `piutang`;

CREATE TABLE `piutang` (
  `idTransaksiJual` bigint(20) NOT NULL,
  `nominal` bigint(20) unsigned default NULL,
  `tglDiBayar` date default NULL,
  `idUser` int(3) default NULL,
  `last_update` date default NULL,
  PRIMARY KEY  (`idTransaksiJual`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `piutang` */

/*Table structure for table `rak` */

DROP TABLE IF EXISTS `rak`;

CREATE TABLE `rak` (
  `idRak` bigint(5) NOT NULL auto_increment,
  `namaRak` varchar(30) default NULL,
  PRIMARY KEY  (`idRak`)
) ENGINE=MyISAM AUTO_INCREMENT=101 DEFAULT CHARSET=latin1;

/*Data for the table `rak` */

insert into `rak` (`idRak`,`namaRak`) values (1,'Rak Depan Kasir');
insert into `rak` (`idRak`,`namaRak`) values (2,'Susu 1');
insert into `rak` (`idRak`,`namaRak`) values (3,'Susu 2');
insert into `rak` (`idRak`,`namaRak`) values (4,'Susu 3');
insert into `rak` (`idRak`,`namaRak`) values (5,'Susu 4');
insert into `rak` (`idRak`,`namaRak`) values (6,'Susu 5');
insert into `rak` (`idRak`,`namaRak`) values (7,'Susu 6');
insert into `rak` (`idRak`,`namaRak`) values (8,'Rak 8');
insert into `rak` (`idRak`,`namaRak`) values (9,'Rak 9');
insert into `rak` (`idRak`,`namaRak`) values (10,'Rak 10');
insert into `rak` (`idRak`,`namaRak`) values (11,'Rak 11');
insert into `rak` (`idRak`,`namaRak`) values (12,'Rak 12');
insert into `rak` (`idRak`,`namaRak`) values (13,'Rak 13');
insert into `rak` (`idRak`,`namaRak`) values (14,'Rak 14');
insert into `rak` (`idRak`,`namaRak`) values (15,'Rak 15');
insert into `rak` (`idRak`,`namaRak`) values (16,'Rak 16');
insert into `rak` (`idRak`,`namaRak`) values (17,'Rak 17');
insert into `rak` (`idRak`,`namaRak`) values (18,'Rak 18');
insert into `rak` (`idRak`,`namaRak`) values (19,'Rak 19');
insert into `rak` (`idRak`,`namaRak`) values (20,'Rak 20');

/*Table structure for table `retur` */

DROP TABLE IF EXISTS `retur`;

CREATE TABLE `retur` (
  `idRetur` int(10) NOT NULL auto_increment,
  `idCustomer` varchar(10) collate latin1_general_ci default NULL,
  `idJenisRetur` int(2) default NULL,
  `idTransaksi` bigint(20) default NULL,
  `idAksiRetur` int(2) default NULL,
  PRIMARY KEY  (`idRetur`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `retur` */

/*Table structure for table `satuan_barang` */

DROP TABLE IF EXISTS `satuan_barang`;

CREATE TABLE `satuan_barang` (
  `idSatuanBarang` int(5) NOT NULL,
  `namaSatuanBarang` varchar(30) default NULL,
  PRIMARY KEY  (`idSatuanBarang`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `satuan_barang` */

insert into `satuan_barang` (`idSatuanBarang`,`namaSatuanBarang`) values (1,'Kg');
insert into `satuan_barang` (`idSatuanBarang`,`namaSatuanBarang`) values (2,'Ons');
insert into `satuan_barang` (`idSatuanBarang`,`namaSatuanBarang`) values (3,'Pcs');
insert into `satuan_barang` (`idSatuanBarang`,`namaSatuanBarang`) values (4,'Kardus');

/*Table structure for table `supplier` */

DROP TABLE IF EXISTS `supplier`;

CREATE TABLE `supplier` (
  `idSupplier` bigint(20) NOT NULL auto_increment,
  `namaSupplier` varchar(30) default NULL,
  `alamatSupplier` varchar(100) default NULL,
  `telpSupplier` varchar(15) default NULL,
  `Keterangan` text,
  `last_update` date default NULL,
  PRIMARY KEY  (`idSupplier`)
) ENGINE=MyISAM AUTO_INCREMENT=368 DEFAULT CHARSET=latin1;

/*Data for the table `supplier` */

insert into `supplier` (`idSupplier`,`namaSupplier`,`alamatSupplier`,`telpSupplier`,`Keterangan`,`last_update`) values (1,'Catur Edi','Jl. Wuluh 5, Papringan, Sleman','0274567876','Thanx','2009-11-30');
insert into `supplier` (`idSupplier`,`namaSupplier`,`alamatSupplier`,`telpSupplier`,`Keterangan`,`last_update`) values (2,'Albertus Supriyadi','Jl. Jonggrangan 1 No.3, Jonggrangan Baru\r\nKlaten','0282435009','Tenda LUV','2009-10-22');
insert into `supplier` (`idSupplier`,`namaSupplier`,`alamatSupplier`,`telpSupplier`,`Keterangan`,`last_update`) values (3,'MAKRO','Ciputat','','sembako','2010-02-05');
insert into `supplier` (`idSupplier`,`namaSupplier`,`alamatSupplier`,`telpSupplier`,`Keterangan`,`last_update`) values (4,'Jepara','Jembatan Lima','','','2010-02-06');

/*Table structure for table `tmp_detail_beli` */

DROP TABLE IF EXISTS `tmp_detail_beli`;

CREATE TABLE `tmp_detail_beli` (
  `idSupplier` int(10) NOT NULL,
  `tglTransaksi` date NOT NULL,
  `idBarang` bigint(20) NOT NULL auto_increment,
  `tglExpire` date NOT NULL,
  `jumBarang` int(10) NOT NULL,
  `hargaBeli` float NOT NULL,
  `hargaJual` float NOT NULL,
  `barcode` bigint(15) default NULL,
  `username` varchar(30) default NULL,
  KEY `idBarang` (`idBarang`)
) ENGINE=MyISAM AUTO_INCREMENT=5 DEFAULT CHARSET=latin1;

/*Data for the table `tmp_detail_beli` */

/*Table structure for table `tmp_detail_jual` */

DROP TABLE IF EXISTS `tmp_detail_jual`;

CREATE TABLE `tmp_detail_jual` (
  `idCustomer` bigint(20) NOT NULL,
  `tglTransaksi` datetime NOT NULL,
  `barcode` varchar(25) character set latin1 NOT NULL,
  `jumBarang` int(10) NOT NULL,
  `hargaBeli` float NOT NULL,
  `hargaJual` float NOT NULL,
  `username` varchar(30) character set latin1 default NULL,
  `uid` bigint(20) NOT NULL auto_increment,
  `idBarang` bigint(20) default NULL,
  PRIMARY KEY  (`uid`),
  KEY `barcode` (`barcode`),
  KEY `username` (`username`),
  KEY `idCustomer` (`idCustomer`)
) ENGINE=MyISAM AUTO_INCREMENT=65 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `tmp_detail_jual` */

/*Table structure for table `tmp_edit_detail_beli` */

DROP TABLE IF EXISTS `tmp_edit_detail_beli`;

CREATE TABLE `tmp_edit_detail_beli` (
  `idDetailBeli` bigint(20) NOT NULL auto_increment,
  `idTransaksiBeli` bigint(20) NOT NULL,
  `idBarang` bigint(20) NOT NULL,
  `tglExpire` date NOT NULL,
  `jumBarang` int(10) NOT NULL,
  `hargaBeli` bigint(20) NOT NULL,
  PRIMARY KEY  (`idDetailBeli`)
) ENGINE=MyISAM AUTO_INCREMENT=112276 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `tmp_edit_detail_beli` */

/*Table structure for table `tmp_pesan_barang` */

DROP TABLE IF EXISTS `tmp_pesan_barang`;

CREATE TABLE `tmp_pesan_barang` (
  `username` varchar(30) collate latin1_general_ci NOT NULL,
  `idSupplier` int(3) NOT NULL,
  `idBarang` bigint(20) NOT NULL,
  `barcode` varchar(25) collate latin1_general_ci NOT NULL,
  `jumBarang` int(10) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `tmp_pesan_barang` */

/*Table structure for table `transaksibeli` */

DROP TABLE IF EXISTS `transaksibeli`;

CREATE TABLE `transaksibeli` (
  `idTransaksiBeli` bigint(20) NOT NULL auto_increment,
  `tglTransaksiBeli` date default NULL,
  `idSupplier` varchar(10) default NULL,
  `nominal` bigint(20) default '0',
  `idTipePembayaran` int(3) default NULL,
  `idUser` int(3) default NULL,
  `last_update` date default NULL,
  `NomorInvoice` varchar(15) NOT NULL default '0',
  `username` varchar(30) default NULL,
  PRIMARY KEY  (`idTransaksiBeli`)
) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1 COMMENT='latin1_swedish_ci';

/*Data for the table `transaksibeli` */

insert into `transaksibeli` (`idTransaksiBeli`,`tglTransaksiBeli`,`idSupplier`,`nominal`,`idTipePembayaran`,`idUser`,`last_update`,`NomorInvoice`,`username`) values (1,'2010-03-26','5',300000,2,NULL,'2010-03-26','001','ariefadmin');
insert into `transaksibeli` (`idTransaksiBeli`,`tglTransaksiBeli`,`idSupplier`,`nominal`,`idTipePembayaran`,`idUser`,`last_update`,`NomorInvoice`,`username`) values (2,'2010-03-26','3',310000,1,NULL,'2010-03-26','0','ariefadmin');

/*Table structure for table `transaksijual` */

DROP TABLE IF EXISTS `transaksijual`;

CREATE TABLE `transaksijual` (
  `idTransaksiJual` bigint(20) NOT NULL auto_increment,
  `tglTransaksiJual` datetime default NULL,
  `idCustomer` varchar(10) default NULL,
  `tglKirimBarang` date default NULL,
  `idTipePembayaran` int(3) default NULL,
  `nominal` bigint(20) default '0',
  `idUser` int(3) default NULL,
  `last_update` date default NULL,
  `uangDibayar` bigint(20) default NULL,
  PRIMARY KEY  (`idTransaksiJual`)
) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

/*Data for the table `transaksijual` */

insert into `transaksijual` (`idTransaksiJual`,`tglTransaksiJual`,`idCustomer`,`tglKirimBarang`,`idTipePembayaran`,`nominal`,`idUser`,`last_update`,`uangDibayar`) values (1,'2010-03-26 20:32:45','1',NULL,1,4688,1,'2010-03-26',5000);
insert into `transaksijual` (`idTransaksiJual`,`tglTransaksiJual`,`idCustomer`,`tglKirimBarang`,`idTipePembayaran`,`nominal`,`idUser`,`last_update`,`uangDibayar`) values (2,'2010-03-26 20:36:14','1',NULL,1,19375,10,'2010-03-26',20000);

/*Table structure for table `transaksikas` */

DROP TABLE IF EXISTS `transaksikas`;

CREATE TABLE `transaksikas` (
  `idTransaksiKas` bigint(20) NOT NULL auto_increment,
  `tglTransaksiKas` date default NULL,
  `idUser` int(3) default NULL,
  `kasAwal` bigint(20) default NULL,
  `kasAkhir` bigint(20) default '0',
  `kasSeharusnya` bigint(20) default '0',
  PRIMARY KEY  (`idTransaksiKas`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `transaksikas` */

/*Table structure for table `transaksikasir` */

DROP TABLE IF EXISTS `transaksikasir`;

CREATE TABLE `transaksikasir` (
  `idTransKasir` bigint(20) NOT NULL auto_increment,
  `idUser` int(11) NOT NULL COMMENT 'idUser of the Cashier',
  `jumlahTransaksi` bigint(20) NOT NULL,
  `description` varchar(100) default NULL,
  `approvedBy` int(11) NOT NULL COMMENT 'idUser of the Approver',
  `tglTransaksi` datetime NOT NULL,
  PRIMARY KEY  (`idTransKasir`),
  KEY `idUser` (`idUser`,`tglTransaksi`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

/*Data for the table `transaksikasir` */

/*Table structure for table `user` */

DROP TABLE IF EXISTS `user`;

CREATE TABLE `user` (
  `idUser` int(3) NOT NULL,
  `namaUser` varchar(30) collate latin1_general_ci default NULL,
  `idLevelUser` int(2) default NULL,
  `uname` varchar(30) collate latin1_general_ci default NULL,
  `pass` varchar(35) collate latin1_general_ci default NULL,
  `currentWorkstation` bigint(20) default NULL,
  PRIMARY KEY  (`idUser`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci;

/*Data for the table `user` */

insert into `user` (`idUser`,`namaUser`,`idLevelUser`,`uname`,`pass`,`currentWorkstation`) values (7,'admin',2,'admin','21232f297a57a5a743894a0e4a801fc3',NULL);
insert into `user` (`idUser`,`namaUser`,`idLevelUser`,`uname`,`pass`,`currentWorkstation`) values (8,'input',3,'input','a43c1b0aa53a0c908810c06ab1ff3967',NULL);
insert into `user` (`idUser`,`namaUser`,`idLevelUser`,`uname`,`pass`,`currentWorkstation`) values (10,'kasir1',4,'kasir1','29c748d4d8f4bd5cbc0f3f60cb7ed3d0',NULL);

/*Table structure for table `workstation` */

DROP TABLE IF EXISTS `workstation`;

CREATE TABLE `workstation` (
  `idWorkstation` bigint(20) NOT NULL auto_increment,
  `namaWorkstation` varchar(30) NOT NULL,
  `workstation_address` varchar(30) NOT NULL,
  `keterangan` varchar(50) default NULL,
  PRIMARY KEY  (`idWorkstation`)
) ENGINE=MyISAM AUTO_INCREMENT=3 DEFAULT CHARSET=latin1;

/*Data for the table `workstation` */

insert into `workstation` (`idWorkstation`,`namaWorkstation`,`workstation_address`,`keterangan`) values (1,'kasir1','192.168.1.1',NULL);
insert into `workstation` (`idWorkstation`,`namaWorkstation`,`workstation_address`,`keterangan`) values (2,'server','192.168.1.250',NULL);

SET SQL_MODE=@OLD_SQL_MODE;
		";

	$hasil = mysql_query($sql, $targetdb) or die("Error: ".mysql_error());

};

?>



<?php 

include("../config/config.php");

$fp = fopen('/tmp/ahadpos-'.date("Ymd").'.csv', 'w');
fwrite($fp, '"Product Name", "Price", "SKU", "weight unit", "stock quantity"'."\n");

$sql = "SELECT * FROM barang LIMIT 100";
$hasil = mysql_query($sql);

while ($r=mysql_fetch_array($hasil)) {

	$tulis = '"'.$r[namaBarang].'","'.$r[hargaJual].'","'.$r[barcode].'","gram","1000000"'."\n";

	fwrite($fp, $tulis);
}

fclose($fp);


?>
<?php
        
        include "../config/config.php";

	// GLOBAL VARIABLES
	$temporary_barcode = 2323232323;		// barcode prefix for items with non-unique barcode
	$sdb = 'ahadmart'; 			// source database
	$tdb = 'ahadpos_pdkkacang'; 		// target database

// ====START CODE==================================================================================================================

	// konek ke source & target database
	$sourcedb = mysql_connect($server,$username,$password, true) or die("Koneksi gagal");
	mysql_select_db($sdb, $sourcedb);

	// 65536 = bisa multiple SQL statement di satu mysql_query() !
	$targetdb = mysql_connect($server,$username,$password, true, 65536) or die("Koneksi gagal");
	mysql_select_db($tdb, $targetdb);


	$sql = "SELECT barcode FROM detail_beli  ORDER BY barcode ASC";
	$hasil = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
	$ctr=0;		
	while($x = mysql_fetch_array($hasil)) {

		$sql = "SELECT harga FROM pembelian_detail WHERE kd_produk = '$x[barcode]'";
		$hasil1 = mysql_query($sql, $sourcedb) or die("Error : ".mysql_error());


		if (mysql_num_rows($hasil1) > 0) {
			$y = mysql_fetch_array($hasil1);
			$sql = "UPDATE detail_beli SET hargaBeli = $y[harga] WHERE barcode = '$x[barcode]'";
			$hasil2 = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
			$ctr++;
		} else {
			$sql = "UPDATE detail_beli SET hargaBeli = 0 WHERE barcode = '$x[barcode]'";
			$hasil2 = mysql_query($sql, $targetdb) or die("Error : ".mysql_error());
		};
	
	};

	echo "SELESAI - $ctr record di update";

?>
<?php

/* ------------------------------------------------------------------------------
copy-harga-beli.php

Kasus : di sebuah database AhadPOS, ada banyak barang tanpa hargaBeli / hargaBeli = 0

Solusi : copy isi hargaBeli dari database AhadPOS dari toko lainnya

------------------------------------------------------------------------------ */

$server   = "localhost";
$username = "root";
$password = "";

$db_sumber = "test2";
$db_target = "test3";

// Koneksi dan memilih database di server
mysql_connect($server,$username,$password) or die("Koneksi gagal");
mysql_select_db($db_target) or die("Database tidak bisa dibuka");

$sql	= "SELECT * FROM detail_beli WHERE hargaBeli = 0 GROUP BY barcode";
$hasil1	= mysql_query($sql);
echo "Saat ini ada ".mysql_num_rows($hasil1)." barang yang hargaBeli nya nol.";

$current_barcode = "";
while ($x = mysql_fetch_array($hasil1)) {

	if ($current_barcode <> $x["barcode"]) {

		$current_barcode 	= $x["barcode"];
		// cari hargaBeli nya dari $db_sumber
		mysql_select_db($db_sumber);
		//$sql	= "SELECT hargaBeli FROM detail_beli WHERE barcode = '".$x["barcode"]."'";
		$sql	= "SELECT namaBarang, hargaJual FROM barang WHERE barcode = '".$x["barcode"]."'";
		$hasil2	= mysql_query($sql) or die("Error: ".mysql_error());
		//echo "sql: $sql \n";

		// cari average hargaBeli nya
		//$n = 0; $total = 0; $avgHargaBeli = 0;
		//while ($z = mysql_fetch_array($hasil2)) { 
		//	$n++;
		//	$total	= $total + $z["hargaBeli"];
		//};
		//if ($n > 0) {	$avgHargaBeli	= $total / $n;	};

		//if ($avgHargaBeli == 0) { //  jika tidak ada datanya dari $db_sumber -- cari dari record lainnya di $db_target
		//	mysql_select_db($db_target);
		//	$sql	= " SELECT hargaBeli FROM detail_beli WHERE barcode = '".$x["barcode"]."' AND hargaBeli > 0";
		//	$hasil3	= mysql_query($sql);
		//	if ($z = mysql_fetch_array($hasil3)) {
		//		$avgHargaBeli = $z["hargaBeli"];
		//	};
		//};

		//echo "avgHargaBeli ".$x["barcode"]." : 	$avgHargaBeli \n";

		// apakah ada ditemukan ?
		$avgHargaBeli = 0;
		if ($z = mysql_fetch_array($hasil2)) {
			$avgHargaBeli = $z["hargaJual"];
		};

		// simpan hargaBeli ke $db_target
		if ($avgHargaBeli > 0) {
			mysql_select_db($db_target);
			$sql	= "UPDATE detail_beli SET hargaBeli = $avgHargaBeli WHERE barcode = '".$x["barcode"]."'";
			$hasil3	= mysql_query($sql);
			echo "Update hargaBeli untuk ".$x["barcode"]." / ".$z["namaBarang"].": $avgHargaBeli \n\n";
		}; // if ($avgHargaBeli > 0) {


	} else {
		// skip jika masih barcode yang sama

	};// if ($current_barcode <> $x[barcode]) {

}; // while ($x = mysql_fetch_array($hasil)) {

// SELESAI

?>
<?php 

include("../config/config.php");


echo_dbf('/home/ubuntu/Documents/_workshop/devel/indopos/tools/SUPLIER.DBF');
exit;

function echo_dbf($dbfname) { 
    $fdbf = fopen($dbfname,'r'); 
    $fields = array(); 
    $buf = fread($fdbf,32); 
    $header=unpack( "VRecordCount/vFirstRecord/vRecordLength", substr($buf,4,8)); 
    ////echo 'Header: '.json_encode($header).'<br/>'; 
    $goon = true; 
    $unpackString=''; 
    while ($goon && !feof($fdbf)) { // read fields: 
        $buf = fread($fdbf,32); 
        if (substr($buf,0,1)==chr(13)) {$goon=false;} // end of field list 
        else { 
            $field=unpack( "a11fieldname/A1fieldtype/Voffset/Cfieldlen/Cfielddec", substr($buf,0,18)); 
            ////echo 'Field: '.json_encode($field).'<br/>'; 
            $unpackString.="A$field[fieldlen]$field[fieldname]/"; 
            array_push($fields, $field);}} 
    fseek($fdbf, $header['FirstRecord']+1); // move back to the start of the first record (after the field definitions) 
    for ($i=1; $i<=$header['RecordCount']; $i++) { 
        $buf = fread($fdbf,$header['RecordLength']); 
        $record=unpack($unpackString,$buf); 
        //// output format JSON :: 
	//echo 'record: '.json_encode($record).'<br/>'; 
        //// output format Array
	//echo 'record: '.var_dump($record).'<br/>'; 
        //// output format RAW
	// echo $i.$buf.'<br/>'; 
	// cari apakah barcode ini sudah ada di database ?
	$sql1 = "SELECT * FROM supplier WHERE namaSupplier = '".$record[KODE]."'";
	echo "Mencari: ".$sql1."<br>";
	$hasil1 = mysql_query($sql1);
	// jika ketemu, maka ubah ke nama lengkap supplier ybs :
	if (mysql_num_rows($hasil1) < 1) {
	
		// cari supplier
		$sql2 = "UPDATE supplier SET namaSupplier='".$record[NAMA]."' WHERE namaSupplier='".$record[KODE]."'";
		echo "<br>Eksekusi : ".$sql2;
		$hasil2 = mysql_query($sql2);
		
	};

	} 
    fclose($fdbf); } 
?>
<?php
/* argon-cetak-barcode.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../../config/config.php";


if($_GET[file]==""){
	echo "nama file belum didefinisikan";
}elseif($_GET[kode]==""){
	echo "field kode belum didefinisikan";
}elseif($_GET[nama]==""){
	echo "field nama belum didefinisikan";
}elseif($_GET[harga]==""){
	echo "field harga belum didefinisikan/diisi";
}elseif($_GET[jml]==""){
	echo "field jumlah belum didefinisikan/diisi";
}elseif(strlen($_GET[nama])>30) {
echo "field nama \"$_GET[nama]\" lebih dari 30 karakter";
}elseif(strlen($_GET[jml])!=4) {
echo "field jumlah \"$_GET[jml]\" harus 4 karakter";


}else{

//$handle = fopen("tmp\\output.prn", "w");
$handle = fopen("/dev/lp0", "w");

fwrite($handle, "n\nM0500\nO0220\nV0\nSE\nD\nL\nD11\nPE\nA2\n1e2101900210003C");
fwrite($handle,$_GET[kode]."\n1911A0600090002".$_GET[kode]."\n1911A0600490004".$_GET[nama]."\n1911A1000240079Rp ".$_GET[harga]."\n1e4202500210184C");
fwrite($handle,$_GET[kode]."\n1911A0800060196".$_GET[kode]."\n1911A0600650185".$_GET[nama]."\n1911A1200460185Rp ".$_GET[harga]."\n1911A1000640004Ahad Mart"."\nQ".$_GET[jml]."\nE");
fclose($handle);
echo "Silahkan jalankan file <font color=red><b>pb.bat</b></font> di Command Prompt";
}
//".$_GET[file].". 


/* CHANGELOG -----------------------------------------------------------

 1.0.1	: Harry Sufehmi		: initial release

------------------------------------------------------------------------ */
?> 
<?php
/* argon-pilih-rak.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

// Connecting, selecting database
include "../../config/config.php";


// let's print the international format for the en_US locale
$query = 'SELECT idTransaksiBeli FROM transaksibeli ORDER BY idTransaksiBeli DESC';
$result = mysql_query($query) or die('Query failed: ' . mysql_error());

echo "<form action=$_SERVER[PHP_SELF] method=GET> pilih Nota/Invoice:<select name=rak>";
while ($line = mysql_fetch_array($result)) {
echo"<option value=$line[idTransaksiBeli]>$line[idTransaksiBeli]</option>";
}
echo "</select><input type=submit></form>";

if($_GET[rak]!=""){
// Performing SQL query

$po = $_GET[rak];

$queryharga = mysql_query("SELECT b.barcode,b.namaBarang,b.hargaJual  FROM barang AS b, detail_beli AS d WHERE  d.barcode=b.barcode AND d.idTransaksiBeli = '$po'") or DIE ("auoo ".mysql_error());

// Printing results in HTML
echo "<table border=1>\n";
while ($baris = mysql_fetch_array($queryharga)) {


	$kd_barang 	= $baris[barcode];
	$nama_barang	= $baris[namaBarang];
	$harga_jual	= $baris[hargaJual];
	$jml		= "0002";

        echo "
		<tr>
			<form action=argon-cetak-barcode.php method=GET target=Content>
			<td ROWSPAN=2><input type=hidden name=file value=$kd_barang >
				<input type=hidden name=kode value=$kd_barang >$kd_barang</td>
			<td>$nama_barang</td>
			<td><input type=hidden name=harga value=".number_format($harga_jual, 0, '', '.')." 
				>".number_format($harga_jual, 0, '', '.')."</td>
		</tr>
			<td><textarea name=nama rows=1 cols=30 >$nama_barang</textarea> 
			jumlah :<input  type=text size=3 name=jml maxlength=4 value=$jml></td>
			<td><input type=submit></td></form>";

}
echo "</table>\n";

// Free resultset
mysql_free_result($result);

}


/* CHANGELOG -----------------------------------------------------------

 1.0.1	: Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?> 
<?php
$in_index = false;
$root_path = '/ahadmart/mobile/';
require_once("../lib/common.php");

?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<title>Update Stok - Ahad Mart : Pdk Kacang</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
<!--

document.defaultAction = true;

function init() {
	var x = document.getElementById('testForm').getElementsByTagName('input');
	for (var i=0;i<x.length;i++) {
		x[i].onclick = setEvents;
		if (x[i].checked)
			x[i].onclick();
	}

/*	writeroot = document.getElementById('writeroot');

	document.getElementById('emptyWriteroot').onclick = function () {
		writeroot.innerHTML = '';
		return false;
	}
*/

	// set focus ke textbox
	document.getElementById("bacadisini").focus()

}

function setEvents() {
	if (this.id == 'default') {
		document.defaultAction = !this.checked;
		return;
	}
	var eventHandler = (this.checked) ? detectEvent : empty;
	document['on'+this.id] = eventHandler;
}

function detectEvent(e) {
	var evt = e || window.event;
	//writeData(evt.type);
	
/* ----------- 	*/

	// jika # maka submit form
	if (evt.keyCode == '35') { document.getElementById("testForm").submit(); }

	inputan = document.getElementById("tulisdisini").value

	if (evt.keyCode == '46')  { document.getElementById("tulisdisini").value = inputan + '1'; }
	if (evt.keyCode == '97')  { document.getElementById("tulisdisini").value = inputan + '2'; }
	if (evt.keyCode == '100') { document.getElementById("tulisdisini").value = inputan + '3'; }
	if (evt.keyCode == '103') { document.getElementById("tulisdisini").value = inputan + '4'; }
	if (evt.keyCode == '106') { document.getElementById("tulisdisini").value = inputan + '5'; }
	if (evt.keyCode == '109') { document.getElementById("tulisdisini").value = inputan + '6'; }
	if (evt.keyCode == '112') { document.getElementById("tulisdisini").value = inputan + '7'; }
	if (evt.keyCode == '116') { document.getElementById("tulisdisini").value = inputan + '8'; }
	if (evt.keyCode == '119') { document.getElementById("tulisdisini").value = inputan + '9'; }
	if (evt.keyCode == '32')  { document.getElementById("tulisdisini").value = inputan + '0'; }

	
/*----------- */
	
/* ----------- 
	writeData('keyCode is ' + evt.keyCode);
	writeData('charCode is ' + evt.charCode);
	writeData('');
 ----------- */	
	
	return document.defaultAction;
}

function empty() {
	// nothing
}

var writeroot;

function writeData(msg) {
	//writeroot.innerHTML += msg + '<br />';
	
	//document.getElementById("tulisdisini").value = msg
}




window.onunload = function () {

	if (self.exit)
		exit();
}

window.onload = function () {
	
	if (self.init)
		init();

}

// -->
</script>

</head>

<body>

<form id="testForm" method="get" action="<?php echo $_SERVER["PHP_SELF"]; ?>">
<input type="checkbox" checked id="keypress" /> <label for="keypress">silakan input</label><br />


<?php

//phpinfo();

if ($_GET["jmlbarang"]) { // ------------------------------------------------------------------------

	if (empty($_GET["jumlahtercatat"])) { $_GET["jumlahtercatat"] = 0; }

	//$sql = "UPDATE STOCK SET id_rak=".$_GET["nomorrak"].",jumlah=".$_GET["jmlbarang"]." WHERE kd_barang='".$_GET["barcode1"]."'";
	$sql = "INSERT INTO stock_opname (kd_barang, id_rak, jumlah_tercatat, jumlah_ditemukan, tanggal) VALUES ('".$_GET["barcode1"]."',".$_GET["nomorrak"].",".$_GET["jumlahtercatat"].",".$_GET["jmlbarang"].",'".date("Y-m-d")."')";
	$db->sql_query($sql) or message_die(DB_ERROR, 'SQL Error', __LINE__ , __FILE__ , $sql);
	$rows = $db->sql_fetchrowset();

	echo "<h3> Terimakasih, jumlah stok sudah dicatat di komputer</h3>";

}

if ($_GET["barcode"]) {

	$sql = "SELECT * FROM stock WHERE kd_barang='".$_GET["barcode"]."'";
	$db->sql_query($sql) or message_die(DB_ERROR, 'SQL Error', __LINE__ , __FILE__ , $sql);
	$rows = $db->sql_fetchrowset();
	//var_dump($rows);
	if(is_array($rows)) { $jumlah_barang = $rows[0]['jumlah']; //echo "<h1>jumlah barang ".$rows[0]['jumlah']."</h1>";
	} 

//<input type="text" id="bacadisini"	name="inputan" />

?>

<br /><br />

<h2> Masukkan jumlah barang saat ini </h2>

<input type="text" id="bacadisini"	name="jmlbarang" /><br />
<input type="submit" name=submit />


<input type="hidden" name="barcode1" value="<?php echo $_GET["barcode"]; ?>" />
<input type="hidden" name="nomorrak" value="<?php echo $_GET["nomorrak"]; ?>" />
<input type="hidden" name="jumlahtercatat" value="<?php echo $rows[0]['jumlah']; ?>" />


<?php 

} elseif ($_GET["nomorrak"]) {  // ---------------------------------------------------------------

?>


<br /><br />

<h2> Masukkan barcode barang </h2>

<input type="text" id="bacadisini" name="barcode"/><br />
<input type="submit" name=submit />

<input type="hidden" name="nomorrak" value="<?php echo $_GET["nomorrak"]; ?>" />


<?php

} else { //  --------------------------------------------------------------------------------------

?>

<br /><br />

<h2> Masukkan nomor Rak </h2>

<input type="text" id="bacadisini" name="nomorrak" /> <br />
<input type="submit" name=submit />


<?php

}

?>


</form>

<p id="writeroot"></p>

</body></html>
<?php

/* fast-SO.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/
	
include "../../config/config.php";

$username = 'test';


?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<title>Fast Stock Opname - Ahad Mart</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
<!--

document.defaultAction = true;

function init() {
	var x = document.getElementById('testForm').getElementsByTagName('input');
	for (var i=0;i<x.length;i++) {
		x[i].onclick = setEvents;
		if (x[i].checked)
			x[i].onclick();
	}

/*	writeroot = document.getElementById('writeroot');

	document.getElementById('emptyWriteroot').onclick = function () {
		writeroot.innerHTML = '';
		return false;
	}
*/

	// set focus ke textbox
	document.getElementById("bacadisini").focus()

}

function setEvents() {
	if (this.id == 'default') {
		document.defaultAction = !this.checked;
		return;
	}
	var eventHandler = (this.checked) ? detectEvent : empty;
	document['on'+this.id] = eventHandler;
}

function detectEvent(e) {
	var evt = e || window.event;
	//writeData(evt.type);
	
/* ----------- 	*/

	// jika # maka submit form
	if (evt.keyCode == '35') { document.getElementById("testForm").submit(); }

	inputan = document.getElementById("tulisdisini").value

	if (evt.keyCode == '46')  { document.getElementById("tulisdisini").value = inputan + '1'; }
	if (evt.keyCode == '97')  { document.getElementById("tulisdisini").value = inputan + '2'; }
	if (evt.keyCode == '100') { document.getElementById("tulisdisini").value = inputan + '3'; }
	if (evt.keyCode == '103') { document.getElementById("tulisdisini").value = inputan + '4'; }
	if (evt.keyCode == '106') { document.getElementById("tulisdisini").value = inputan + '5'; }
	if (evt.keyCode == '109') { document.getElementById("tulisdisini").value = inputan + '6'; }
	if (evt.keyCode == '112') { document.getElementById("tulisdisini").value = inputan + '7'; }
	if (evt.keyCode == '116') { document.getElementById("tulisdisini").value = inputan + '8'; }
	if (evt.keyCode == '119') { document.getElementById("tulisdisini").value = inputan + '9'; }
	if (evt.keyCode == '32')  { document.getElementById("tulisdisini").value = inputan + '0'; }

	
/*----------- */
	
/* ----------- 
	writeData('keyCode is ' + evt.keyCode);
	writeData('charCode is ' + evt.charCode);
	writeData('');
 ----------- */	
	
	return document.defaultAction;
}

function empty() {
	// nothing
}

var writeroot;

function writeData(msg) {
	//writeroot.innerHTML += msg + '<br />';
	
	//document.getElementById("tulisdisini").value = msg
}




window.onunload = function () {

	if (self.exit)
		exit();
}

window.onload = function () {
	
	if (self.init)
		init();

}

// -->
</script>

</head>

<body>

<form id="testForm" method="get" action="<?php echo $_SERVER["PHP_SELF"]; ?>">
<input type="checkbox" checked id="keypress" /> <label for="keypress">silakan input</label><br />


<?php

// simpan data Fast SO
if ($_GET["jmlbarang"]) { // ================================================================================

	if (empty($_GET["jumlahtercatat"])) { $_GET["jumlahtercatat"] = 0; }

	// komplain jika salah input angka barcode ke jumlahTercatat
	if ($_GET["jmlbarang"] > 2000) {
		echo "Salah : Input Barcode sebagai Jumlah Barang. <br />
			<a href='".$_SERVER["PHP_SELF"]."?nomorrak=".$_GET["nomorrak"]."&username=".$_GET["username"]."'>
			Klik disini untuk mengulang kembali</a>";
		exit;
	};
	
	$selisih 	= ($_GET["jmlbarang"] - $_GET["jumlahtercatat"]);

	// apakah sudah ada barcode yang sama di tanggal yang sama ? 
	// jika ya, berarti ini adalah barang di gudang
	// hitung selisihnya, dg memperhitungkan selisih yg sebelumnya
	$sql 	= "SELECT f.uid, b.jumBarang, f.jmlTercatat, f.selisih FROM fast_stock_opname AS f, barang AS b 
			WHERE f.barcode='".$_GET["barcode1"]."' AND f.tanggalSO='".date("Y-m-d")."' AND f.barcode=b.barcode 
			ORDER BY f.uid DESC LIMIT 1";
	//echo $sql;
	$hasil 	= mysql_query($sql);
	if (mysql_num_rows($hasil) > 0) { 
		$x	= mysql_fetch_array($hasil);
		//var_dump($x);
		$jumBarangLama 	= $x[jumBarang] + $x[selisih]; 
		$selisih =  $_GET["jmlbarang"];
		$_GET["jumlahtercatat"] = $jumBarangLama;
		//echo "selisih: $selisih";
	};
	


	// cari nama barang ybs
	// simpan di database
	$sql = "INSERT INTO fast_stock_opname (barcode, idRak, jmlTercatat, selisih, tanggalSO, username, namaBarang) 
		VALUES ('".$_GET["barcode1"]."',".$_GET["nomorrak"].",".$_GET["jumlahtercatat"].",
			".$selisih.",'".date("Y-m-d")."', '".$_GET["username"]."',
			'".$_GET["namaBarang"]."')";
	$hasil	= mysql_query($sql);

	echo "<h3> Terimakasih, jumlah stok sudah dicatat di komputer</h3>";

}

// minta jumlah barang
if ($_GET["barcode"]) { // ===================================================================================

	$sql 	= "SELECT jumBarang, namaBarang FROM barang WHERE barcode='".$_GET["barcode"]."'";
	$hasil 	= mysql_query($sql);
	$x	= mysql_fetch_array($hasil);

	if(is_array($x)) { 
		$jumlahtercatat = $x[jumBarang];
		$namaBarang	= $x[namaBarang]; 
	} 

?>

<br /><br />
<?php echo "<b>".$namaBarang."</b> ( <a href='".$_SERVER["PHP_SELF"]."?nomorrak=".$_GET["nomorrak"]."&username=".$_GET["username"]."'>
			klik disini untuk membatalkan</a> karena beda barang)"; ?> 
<br /><br />

<h2> Masukkan jumlah barang saat ini </h2>

<input type="text" id="bacadisini"	name="jmlbarang" /><br />
<input type="submit" name=submit />


<input type="hidden" name="barcode1" value="<?php echo $_GET["barcode"]; ?>" />
<input type="hidden" name="nomorrak" value="<?php echo $_GET["nomorrak"]; ?>" />
<input type="hidden" name="username" value="<?php echo $_GET["username"]; ?>" />

<input type="hidden" name="jumlahtercatat" 	value="<?php echo $jumlahtercatat; ?>" />
<input type="hidden" name="namaBarang" 		value="<?php echo $namaBarang; ?>" />


<?php 

// minta barcode barang
} elseif ($_GET["nomorrak"]) {  // ===================================================================

?>


<br /><br />

<h2> Masukkan barcode barang </h2>

<input type="text" id="bacadisini" name="barcode"/><br />
<input type="submit" name=submit />

<input type="hidden" name="nomorrak" value="<?php echo $_GET["nomorrak"]; ?>" />
<input type="hidden" name="username" value="<?php echo $_GET["username"]; ?>" />

<?php

} else { //  --------------------------------------------------------------------------------------

?>

<br /><br />

<h2> Masukkan nomor Rak </h2>

<input type="text" id="bacadisini" name="nomorrak" /> <br />
<input type="submit" name=submit />

<input type="hidden" name="username" value="<?php echo $username; ?>" />


<?php

}

?>


</form>

<p id="writeroot"></p>

</body></html><?php







/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2011-01-06 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */


?>
<?php
function combotgl($awal, $akhir, $var, $terpilih){
  echo "<select name=$var>";
  for ($i=$awal; $i<=$akhir; $i++){
	$p=strlen($i);
	if($p==1)
		$i="0".$i;
	else
		$i=$i;
	$t=strlen($terpilih);
	if($t==1)
		$terpilih="0".$terpilih;   
	else
		$terpilih=$terpilih;
	if ($i==$terpilih)
    {
      	
	    echo "<option value=$i selected>$i</option>";
	}
    else
      echo "<option value=$i>$i</option>";
  }
  echo "</select> ";
}

function combobln($awal, $akhir, $var, $terpilih){
  $nama_bln=array(1=> "Januari", "Februari", "Maret", "April", "Mei", 
                      "Juni", "Juli", "Agustus", "September", 
                      "Oktober", "November", "Desember");
  echo "<select name=$var>";
  for ($bln=$awal; $bln<=$akhir; $bln++){
	$bln2=$bln;
	$b=strlen($bln);
	if($b==1)
		$bln="0".$bln;
	else
		$bln=$bln;
	$b2=strlen($terpilih);
	if($b2==1)
		$terpilih="0".$terpilih;
	else
		$terpilih=$terpilih;

      if ($bln==$terpilih)
         echo "<option value=$bln selected>$nama_bln[$bln2]</option>";
      else
        echo "<option value=$bln >$nama_bln[$bln2]</option>";
  }
  echo "</select> ";
}

function agama($var,$terpilih){
	$nama_agama=array(1=> "Islam","Katolik","Kristen","Hindu","Budha");
	echo "<select name=$var>";
	for($i=1;$i<=5;$i++){
		if($nama_agama[$i]==$terpilih)
			echo "<option value=$terpilih selected>$terpilih</option>";
		else
			echo "<option value=$nama_agama[$i]>$nama_agama[$i]</option>";
	}
	echo "</select>";
}
?><?php
$server = "localhost";
$username = "root";
$password = "";
$database = "ahadpos";

// disable error message level E_NOTICE
//error_reporting(E_ALL);
error_reporting(E_ALL ^ E_NOTICE);


// Koneksi dan memilih database di server
mysql_connect($server,$username,$password) or die("Koneksi gagal");
mysql_select_db($database) or die("Database tidak bisa dibuka");







// ================= STOP KONFIGURASI ==========================



?>
<?
$polaemail = "^.+@.+\..+$";
$polaangka = "^[0-9]+$";
$polapassword = "^.{5,}$";
$polahuruf = "^[A-Za-z]+$";
$polahurufangka = "^[A-Za-z0-9]+$";
$kodepos = "^[1-9][0-9]{4}$";
?><?php
/* fungsi_indotgl.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://rimbalinux.com/projects/ahadpos/
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

	function tgl_indo($tgl){
			$tanggal = substr($tgl,8,2);
			$bulan = getBulan2(substr($tgl,5,2));
			$tahun = substr($tgl,0,4);
			return $tanggal.' '.$bulan.' '.$tahun;		 
	}

        function getTahun($tgl){
            $tahun = substr($tgl,0,4);

            return $tahun;
        }

	function getBulan($bln){
				switch ($bln){
					case 1: 
						return "Januari";
						break;
					case 2:
						return "Februari";
						break;
					case 3:
						return "Maret";
						break;
					case 4:
						return "April";
						break;
					case 5:
						return "Mei";
						break;
					case 6:
						return "Juni";
						break;
					case 7:
						return "Juli";
						break;
					case 8:
						return "Agustus";
						break;
					case 9:
						return "September";
						break;
					case 10:
						return "Oktober";
						break;
					case 11:
						return "November";
						break;
					case 12:
						return "Desember";
						break;
				}
			}

       function getBulan2($bln){
				switch ($bln){
					case 1:
						return "Jan";
						break;
					case 2:
						return "Feb";
						break;
					case 3:
						return "Mar";
						break;
					case 4:
						return "Apr";
						break;
					case 5:
						return "Mei";
						break;
					case 6:
						return "Juni";
						break;
					case 7:
						return "Juli";
						break;
					case 8:
						return "Agus";
						break;
					case 9:
						return "Sept";
						break;
					case 10:
						return "Okt";
						break;
					case 11:
						return "Nov";
						break;
					case 12:
						return "Des";
						break;
				}
			}
     function getMonth($table="", $date_column=""){
		
	if ($table=="") {
		$table = "transaksibeli";	$date_column = "tglTransaksiBeli";
	};
         $query = mysql_query("select distinct(month($date_column)) as bulan from $table 
                group by bulan
                order by bulan desc") or die(mysql_error());
         return $query;
     }

     function getYear(){
         $query = mysql_query("select distinct(year(tglTransaksiBeli)) as tahun from transaksibeli
                group by tahun
                order by tahun desc") or die(mysql_error());
         return $query;
     }

     function getBulanku($bln){
        switch ($bln){
            case 1:
                return "Jan";
		break;
            case 2:
		return "Feb";
		break;
            case 3:
		return "Mar";
		break;
            case 4:
		return "Apr";
		break;
            case 5:
		return "Mei";
		break;
            case 6:
		return "Juni";
		break;
            case 7:
		return "Juli";
		break;
            case 8:
		return "Agus";
		break;
            case 9:
		return "Sept";
		break;
            case 10:
		return "Okt";
		break;
            case 11:
		return "Nov";
		break;
            case 12:
		return "Des";
                break;
        }
    }


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-07-11 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.1		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */
?>

<?php
class Paging
{
// Fungsi untuk mencek halaman dan posisi data
function cariPosisi($batas)
{
if(empty($_GET[halaman])){
	$posisi=0;
	$_GET[halaman]=1;
}
else{
	$posisi = ($_GET[halaman]-1) * $batas;
}
return $posisi;
}

// Fungsi untuk menghitung total halaman
function jumlahHalaman($jmldata, $batas)
{
$jmlhalaman = ceil($jmldata/$batas);
return $jmlhalaman;
}

// Fungsi untuk link halaman 1,2,3 ... Next, Prev, First, Last
function navHalaman($halaman_aktif, $jmlhalaman)
{
$link_halaman = "";

// Link First dan Previous
if ($halaman_aktif > 1)
{
$link_halaman .= " <a href=$_SERVER[PHP_SELF]?module=$_GET[module]&halaman=1><< First</a> | ";
}

if (($halaman_aktif-1) > 0)
{
$previous = $halaman_aktif-1;
$link_halaman .= "<a href=$_SERVER[PHP_SELF]?module=$_GET[module]&halaman=$previous>< Previous</a> | ";
}

// Link halaman 1,2,3, ...
for ($i=1; $i<=$jmlhalaman; $i++)
{
if ($i == $halaman_aktif)
{
$link_halaman .= "<b>$i</b> | ";
}
else
{
$link_halaman .= "<a href=$_SERVER[PHP_SELF]?module=$_GET[module]&halaman=$i>$i</a> | ";
}
$link_halaman .= " ";
}

// Link Next dan Last
if ($halaman_aktif < $jmlhalaman)
{
$next=$halaman_aktif+1;
$link_halaman .= " <a href=$_SERVER[PHP_SELF]?module=$_GET[module]&halaman=$next>Next ></a> ";
}

if (($halaman_aktif != $jmlhalaman) && ($jmlhalaman != 0))
{
$link_halaman .= " | <a href=$_SERVER[PHP_SELF]?module=$_GET[module]&halaman=$jmlhalaman>Last >></a> ";
}
return $link_halaman;
}
}
?>
<?php
$seminggu = array("Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu");
$hari = date("w");
$hari_ini = $seminggu[$hari];

$tgl_sekarang = date("Ymd");
$thn_sekarang = date("Y");
$jam_sekarang = date("H:i:s");

$nama_bln=array(1=> "Januari", "Februari", "Maret", "April", "Mei", 
                    "Juni", "Juli", "Agustus", "September", 
                    "Oktober", "November", "Desember");
?>
<?php
/* aksi.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

session_start();
include "../config/config.php";
include "../config/library.php";
include "modul/function.php";

$module=$_GET[module];
$act=$_GET[act];


// Input Kas Awal
if ($module=='transaksi_kas' AND $act=='input'){
  $tglHariIni = date("Y-m-d");
//  echo "$_POST[idUser]";
  mysql_query("INSERT INTO transaksikas(tglTransaksiKas,idUser,kasAwal)
        VALUES('$tglHariIni','$_POST[idUser]','$_POST[kasAwal]')");
  header('location:media.php?module=home');
}

// Input user
elseif ($module=='user' AND $act=='input'){
  $pass=md5($_POST[pass]);
  $ambilID = mysql_query("select max(idUser)+1 from user");
	$ID = mysql_fetch_array($ambilID);
	$id_user;
	if($ID[0]=='')
		$id_user = '1';
	else
		$id_user = $ID[0];
  mysql_query("INSERT INTO user(idUser,
                                namaUser,
                                idLevelUser,
                                uname,
                                pass)
	                       VALUES('$id_user',
                                '$_POST[namaUser]',
                                '$_POST[levelUser]',
                                '$_POST[uname]',
                                '$pass')");
  header('location:media.php?module='.$module);
}//end input user

// Update user
elseif ($module=='user' AND $act=='update'){
  // Apabila password tidak diubah
  if (empty($_POST[pass])) {
    mysql_query("UPDATE user SET namaUser       = '$_POST[namaUser]',
                                 idLevelUser    = '$_POST[levelUser]',
                                 uname          = '$_POST[uname]'
                           WHERE idUser         = '$_POST[idUser]'");
  }
  // Apabila password diubah
  else{
    $pass=md5($_POST[pass]);
    mysql_query("UPDATE user SET namaUser       = '$_POST[namaUser]',
                                 idLevelUser    = '$_POST[levelUser]',
                                 uname          = '$_POST[uname]',
                                 pass           = '$pass'
                           WHERE idUser         = '$_POST[idUser]'");
  }

  if ($_GET[home]) {
		header('location:media.php?module=home');
	} else {
		header('location:media.php?module='.$module);
	};

}// end update user

// Hapus User
elseif ($module=='user' AND $act=='hapus'){
  mysql_query("DELETE FROM user WHERE idUser = '$_GET[id]'");
  header('location:media.php?module='.$module);
} // end hapus user



// Input modul ==========================================================
elseif ($module=='modul' AND $act=='input'){
    $ambilID = mysql_query("select max(idModul)+1 from modul");
	$ID = mysql_fetch_array($ambilID);
	$id_modul;
	if($ID[0]=='')
		$id_modul = '1';
	else
		$id_modul = $ID[0];
    $ambilUrut = mysql_query("select max(urutan)+1 from modul where urutan < 100");
	$u = mysql_fetch_array($ambilUrut);
	$urut;
	if($u[0]=='')
		$urut = '1';
	else
		$urut = $u[0];
  mysql_query("INSERT INTO modul(idModul,
                                 namaModul,
                                 link,
                                 publish,
                                 idLevelUser,
                                 urutan)
	                       VALUES('$id_modul',
                                '$_POST[namaModul]',
                                '$_POST[link]',
                                '$_POST[publish]',
                                '$_POST[levelUser]',
                                '$urut')");
  header('location:media.php?module='.$module);
}// end input modul

// Update modul
elseif ($module=='modul' AND $act=='update'){
  mysql_query("UPDATE modul SET namaModul = '$_POST[namaModul]',
                                link       = '$_POST[link]',
                                publish    = '$_POST[publish]',
                                idLevelUser= '$_POST[levelUser]'
                          WHERE idModul   = '$_POST[idModul]'");
  header('location:media.php?module='.$module);
}// end update modul

// Hapus Modul
elseif ($module=='modul' AND $act=='hapus'){
  mysql_query("DELETE FROM modul WHERE idModul = '$_GET[id]'");
  header('location:media.php?module='.$module);
} // end hapus modul



// Workstation Management ============================================================================================================

elseif ($module=='workstation' AND $act=='input'){
 mysql_query("INSERT INTO workstation (namaWorkstation, keterangan, workstation_address, printer_type, printer_commands) 
		VALUES ('$_POST[namaWorkstation]', '$_POST[keterangan]','$_POST[workstation_address]','$_POST[printer_type]','$_POST[printer_commands]') 
	");

  header('location:media.php?module='.$module);
}

elseif ($module=='workstation' AND $act=='update'){
  mysql_query("UPDATE workstation SET namaWorkstation 		= '$_POST[namaWorkstation]',
					keterangan		= '$_POST[keterangan]',
					workstation_address 	= '$_POST[workstation_address]',
					printer_type		= '$_POST[printer_type]',
					printer_commands	= '$_POST[printer_commands]' 
		WHERE idWorkstation = '$_POST[idWorkstation]' 	
	");
  header('location:media.php?module='.$module);
}

elseif ($module=='workstation' AND $act=='hapus'){
  mysql_query("DELETE FROM workstation 	WHERE idWorkstation = '$_POST[idWorkstation]'");
  header('location:media.php?module='.$module);
}




// Input Satuan Barang
elseif ($module=='satuan_barang' AND $act=='input'){ // ==============================================================================
    $ambilID = mysql_query("select max(idSatuanBarang)+1 from satuan_barang");
	$ID = mysql_fetch_array($ambilID);
	$id_satuan;
	if($ID[0]=='')
		$id_satuan = '1';
	else
		$id_satuan = $ID[0];
    mysql_query("INSERT INTO satuan_barang(idSatuanBarang,namaSatuanBarang)
                    VALUES('$id_satuan','$_POST[namaSatuanBarang]')");
    header('location:media.php?module='.$module);
}// end Input Satuan Barang

// Update Satuan Barang
elseif ($module=='satuan_barang' AND $act=='update'){
    mysql_query("UPDATE satuan_barang SET namaSatuanBarang = '$_POST[namaSatuanBarang]'
                    WHERE idSatuanBarang = '$_POST[idSatuanBarang]'");
    header('location:media.php?module='.$module);
}// end Update Satuan Barang

// Hapus Satuan Barang
elseif ($module=='satuan_barang' AND $act=='hapus'){
	$sql = "DELETE FROM satuan_barang WHERE idSatuanBarang = '$_GET[id]'";
	mysql_query($sql) or die(mysql_error());
    	header('location:media.php?module='.$module);
}// end Hapus Satuan Barang



// Input Kategori Barang ==============================================================================================
elseif ($module=='kategori_barang' AND $act=='input'){
    $ambilID = mysql_query("SELECT max(idKategoriBarang)+1 FROM kategori_barang");
	$ID = mysql_fetch_array($ambilID);
	$id_rak;
	if($ID[0]=='')
		$id_rak = '1';
	else
		$id_rak = $ID[0];
    mysql_query("INSERT INTO kategori_barang(idKategoriBarang,namaKategoriBarang)
                    VALUES('$id_rak','$_POST[namaKategoriBarang]')");
    header('location:media.php?module='.$module);
}// end Input Kategori Barang

// Update Kategori Barang, bugfix credit to: Yono Nox <weyouknow@yahoo.com> 
elseif ($module=='kategori_barang' AND $act=='update'){
    mysql_query("UPDATE kategori_barang SET namaKategoriBarang = '$_POST[namaKategoriBarang]'
                    WHERE idKategoriBarang = '$_POST[idKategoriBarang]'");
    header('location:media.php?module='.$module);
}// end Update Kategori Barang

// Hapus Kategori Barang, credit: mianova.net@gmail.com
elseif ($module=='kategori_barang' AND $act=='hapus'){
    mysql_query("DELETE FROM kategori_barang  
                    WHERE idKategoriBarang = '$_GET[id]'");
    header('location:media.php?module='.$module);
}// end Hapus Kategori Barang



// Input Rak =============================================================
elseif ($module=='rak' AND $act=='input'){
    $ambilID = mysql_query("select max(idRak)+1 from rak");
	$ID = mysql_fetch_array($ambilID);
	$id_rak;
	if($ID[0]=='')
		$id_rak = '1';
	else
		$id_rak = $ID[0];
    mysql_query("INSERT INTO rak(idRak,namaRak)
                    VALUES('$id_rak','$_POST[namaRak]')");
    header('location:media.php?module='.$module);
}// end Input Rak

// Update Rak
elseif ($module=='rak' AND $act=='update'){
    mysql_query("UPDATE rak SET namaRak = '$_POST[namaRak]'
                    WHERE idRak = '$_POST[idRak]'");
    header('location:media.php?module='.$module);
}// end Update Rak

// Hapus Rak
elseif ($module=='rak' AND $act=='hapus'){
  mysql_query("DELETE FROM rak WHERE idRak = '$_GET[id]'");
  header('location:media.php?module='.$module);
} // end hapus rak



// Input Barang     =============================================================================================================================
elseif ($module=='barang' AND $act=='input'){

	//fixme: bagaimana dengan idBarangnya ? generate dulu di tmp_detail_beli ?
    $tgl = date("Y-m-d");
    mysql_query("INSERT INTO barang(namaBarang,
                    idKategoriBarang,idSatuanBarang,last_update, barcode, username)
                    VALUES('$_POST[namaBarang]',
                    '$_POST[kategori_barang]','$_POST[satuan_barang]',
                    '$tgl', '$_POST[barcode]', '$_SESSION[uname]')");
    header('location:media.php?module='.$module);
}// end Input Barang


// Hapus Barang
elseif ($module=='barang' AND $act=='hapus'){
	// copy data barang ke table arsip_barang
	$sql	= "INSERT INTO arsip_barang (idBarang, namaBarang, idKategoriBarang, idSatuanBarang, jumBarang, 
			hargaJual, last_update, idSupplier, barcode, username, idRak)
				SELECT idBarang, namaBarang, idKategoriBarang, idSatuanBarang, jumBarang, 
					hargaJual, '".date("Y-m-d")."', idSupplier, barcode, '".$_SESSION[uname]."', idRak 
				FROM barang WHERE idBarang = ".$_GET['id'];
	$hasil	= mysql_query($sql) or die("Error : ".mysql_error()." :: $sql");

	// hapus data barang dari table barang
	$sql	= "DELETE FROM barang WHERE idBarang = ".$_GET['id'];
	$hasil	= mysql_query($sql) or die("Error : ".mysql_error()." :: $sql");

    header('location:media.php?module='.$module);

}// end Hapus Barang


// Update Barang
elseif ($module=='barang' AND $act=='update'){
    $tgl = date("Y-m-d");

	// jika barcode diubah, maka ubah juga semua di :
	// 	detail_beli
	// 	detail_jual
	// 	detail_retur_beli
	//	detail_retur_barang
	//	detail_stock_opname
	// 	fast_stock_opname
	if ($_POST[barcode] <> $_POST[oldbarcode]) {

		// check apakah barcode baru ini sudah ada di database
		// jika sudah ada, batalkan semua tindakan
		$hasil = mysql_query("SELECT * FROM barang WHERE barcode='$_POST[barcode]'");
		if(mysql_num_rows($hasil) > 0) {
			echo "<h2>Barcode $_POST[barcode] sudah ada di database ! Tidak ada perubahan yang dilakukan.</h2><br />
				[<a href='media.php?module=barang'> Kembali ke Menu </a>]";
			exit;
		};		
		
		$hasil	= mysql_query("UPDATE detail_beli 		SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
		$hasil	= mysql_query("UPDATE detail_jual 		SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
		$hasil	= mysql_query("UPDATE detail_retur_beli 	SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
		$hasil	= mysql_query("UPDATE detail_retur_barang 	SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
		$hasil	= mysql_query("UPDATE detail_stock_opname 	SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
		$hasil	= mysql_query("UPDATE fast_stock_opname 	SET barcode='$_POST[barcode]' WHERE barcode='$_POST[oldbarcode]'");
	}

    $sql = "UPDATE barang SET namaBarang = '$_POST[namaBarang]',
			barcode = '$_POST[barcode]',
			idSupplier = $_POST[supplier],
                    	idKategoriBarang = $_POST[kategori_barang],
                    	idSatuanBarang = $_POST[satuan_barang],
                    	hargaJual = $_POST[hargaJual],
                    	last_update = '$tgl',
		    	username = '$_SESSION[uname]', 
		    	idRak = $_POST[rak]  
                    WHERE barcode = '$_POST[barcode]'";
    mysql_query($sql);
    header('location:media.php?module='.$module);
}// end Update Barang



// Input Supplier     =============================================================================================================================
elseif ($module=='supplier' AND $act=='input'){
    //HS idSupplier sekarang auto-increment oleh MySQL, untuk menghindari dobel
    /* 	$ambilID = mysql_query("select max(idSupplier)+1 from supplier");
	$ID = mysql_fetch_array($ambilID);
	$id_supplier;
	if($ID[0]=='')
		$id_supplier = '1';
	else
		$id_supplier = $ID[0];   */

    $tgl = date("Y-m-d");
    mysql_query("INSERT INTO supplier(namaSupplier,
                    alamatSupplier,telpSupplier,Keterangan,last_update)
                    VALUES('$_POST[namaSupplier]',
                    '$_POST[alamatSupplier]','$_POST[telpSupplier]',
                    '$_POST[Keterangan]','$tgl')");
    header('location:media.php?module='.$module);
}// end Input Supplier

// Update Supplier
elseif ($module=='supplier' AND $act=='update'){
    $tgl = date("Y-m-d");
    mysql_query("UPDATE supplier SET namaSupplier = '$_POST[namaSupplier]',
                    alamatSupplier = '$_POST[alamatSupplier]',
                    telpSupplier = '$_POST[telpSupplier]',
                    Keterangan = '$_POST[Keterangan]',
                    last_update = '$tgl'
                    WHERE idSupplier = '$_POST[idSupplier]'");
    header('location:media.php?module='.$module);
}// end Update Supplier

// Hapus Supplier
elseif ($module=='supplier' AND $act=='hapus'){
  mysql_query("DELETE FROM supplier WHERE idSupplier = '$_GET[id]'");
  header('location:media.php?module='.$module);
} // end hapus user



// Input Customer =====================================================================================================
elseif ($module=='customer' AND $act=='input'){
    $ambilID = mysql_query("select max(idCustomer)+1 from customer");
	$ID = mysql_fetch_array($ambilID);
	$id_customer;
	if($ID[0]=='')
		$id_customer = '1';
	else
		$id_customer = $ID[0];
    $tgl = date("Y-m-d");
    mysql_query("INSERT INTO customer(idCustomer,namaCustomer,
                    alamatCustomer,telpCustomer,keterangan,last_update)
                    VALUES('$id_customer','$_POST[namaCustomer]',
                    '$_POST[alamatCustomer]','$_POST[telpCustomer]',
                    '$_POST[keterangan]','$tgl')");
    header('location:media.php?module='.$module);
}// end Input Customer

// Update Customer
elseif ($module=='customer' AND $act=='update'){
    $tgl = date("Y-m-d");
    mysql_query("UPDATE customer SET namaCustomer = '$_POST[namaCustomer]',
                    alamatCustomer = '$_POST[alamatCustomer]',
                    telpCustomer = '$_POST[telpCustomer]',
                    keterangan = '$_POST[keterangan]',
                    last_update = '$tgl'
                    WHERE idCustomer = '$_POST[idCustomer]'");
    header('location:media.php?module='.$module);
}// end Update Customer

// Hapus Customer
elseif ($module=='customer' AND $act=='hapus'){
  mysql_query("DELETE FROM customer WHERE idCustomer = '$_GET[id]'");
  header('location:media.php?module='.$module);
} // end hapus customer



// Input Transaksi Beli =================================================================================================================
elseif ($module=='pembelian_barang' AND $act=='input'){
    $tgl = $_POST[TanggalInvoice];

    //HS - idTransaksi sekarang di generate MySQL, untuk menghindari duplikat / dobel
    /* $ambilID = mysql_query("select max(idTransaksiBeli)+1 from transaksibeli");
	$ID = mysql_fetch_array($ambilID);
	$id_transaksi;
	if($ID[0]=='')
		$id_transaksi = '1';
	else
		$id_transaksi = $ID[0];*/

	//HS jika keliru input tipe pembayaran, default ke 1 = CASH
	if ($_POST[tipePembayaran] == 0) { $_POST[tipePembayaran] = 1;};

	$sql_trans = "INSERT INTO transaksibeli(tglTransaksiBeli,
                    idSupplier,nominal,idTipePembayaran,username,last_update,NomorInvoice)
                    VALUES('$tgl','$_SESSION[idSupplier]',
                           '$_POST[tot_pembayaran]','$_POST[tipePembayaran]',
                            '$_SESSION[uname]','$tgl','$_POST[NomorInvoice]')";
//	echo $sql_trans;

    mysql_query($sql_trans) or die(mysql_error());
	$idTransaksiBeli = mysql_insert_id();

    if($_POST[tipePembayaran]=='2'){

          mysql_query("INSERT INTO hutang(idTransaksiBeli,nominal,tglBayar,
                        username,last_update)
                        VALUES('$idTransaksiBeli','$_POST[tot_pembayaran]',
                        '$_POST[tglBayar]','$_SESSION[uname]','$tgl')") or die(mysql_error());

    }

	$dataBarang = mysql_query("SELECT * from tmp_detail_beli
            where idSupplier = '$_SESSION[idSupplier]' and username = '$_SESSION[uname]' and idBarang != 0") or die(mysql_error());

    while($simpan = mysql_fetch_array($dataBarang)){

	$sql_simpan = "INSERT INTO detail_beli(idTransaksiBeli,barcode,
                        tglExpire,jumBarang,jumBarangAsli,hargaBeli,username,idBarang)
                    VALUES('$idTransaksiBeli','$simpan[barcode]',
                    '$simpan[tglExpire]',$simpan[jumBarang],$simpan[jumBarang],'$simpan[hargaBeli]','$_SESSION[uname]','$simpan[idBarang]')";
//	echo $sql_simpan;
	mysql_query($sql_simpan) or die(mysql_error());

        $jumlahAkhir = 0;
        $jumBarang = mysql_query("select jumBarang from barang where barcode = '$simpan[barcode]'") or die(mysql_error());
        $jumlah = mysql_fetch_array($jumBarang);
        $jumlahAkhir = $jumlah[jumBarang] + $simpan[jumBarang];

        mysql_query("UPDATE barang SET jumBarang = '$jumlahAkhir',
                     hargaJual = '$simpan[hargaJual]' WHERE barcode = '$simpan[barcode]'") or die(mysql_error());
    }
    mysql_query("DELETE FROM tmp_detail_beli where idSupplier = '$_SESSION[idSupplier]' and username = '$_SESSION[uname]'") or die(mysql_error());

    releaseSupplier();
    header('location:media.php?module=pembelian_barang');
}


//Batal sebuah item di Nota Beli
elseif ($module=='pembelian_barang' AND $act=='hapus_detil'){
    mysql_query("DELETE FROM tmp_detail_beli where idSupplier = '$_SESSION[idSupplier]' and idBarang = '$_GET[id]'");
    header('location:media.php?module=pembelian_barang&act=carisupplier');
}


//Batal Seluruh Invoice / Transaksi Beli
elseif ($module=='pembelian_barang' AND $act=='batal'){
    mysql_query("DELETE FROM tmp_detail_beli where idSupplier = '$_SESSION[idSupplier]' and tglTransaksi = '$tgl'");
    releaseSupplier();
    header('location:media.php?module='.$module);
}


// Input Transaksi Jual ======================================================================================================================
elseif ($module=='penjualan_barang' AND $act=='input'){

        //$ambilID = mysql_query("select max(idTransaksiJual)+1 from transaksijual");
	//$ID = mysql_fetch_array($ambilID);
	//$id_transaksi;
	//if($ID[0]=='')
	//	$id_transaksi = '1';
	//else
	//	$id_transaksi = $ID[0];

	// simpan transaksi ke database
	$tgl = date("Y-m-d H:i:s");

	$sql = "INSERT INTO transaksijual(tglTransaksiJual,
                    idCustomer,idTipePembayaran,nominal,idUser,last_update,uangDibayar)
                    VALUES('$tgl','$_SESSION[idCustomer]',
                           '$_POST[tipePembayaran]','$_POST[tot_pembayaran]',
                            '$_SESSION[iduser]','$tgl', $_POST[uangDibayar])";
	$hasil 	= mysql_query($sql) or die(mysql_error());
	//echo $sql;

	$NomorStruk = mysql_insert_id();


	// cetak struk -------------

	// ambil footer & header struk
	$sql   	= "SELECT `option`,`value` FROM config"; 
	$hasil 	= mysql_query($sql) or die(mysql_error());
	while ($x = mysql_fetch_array($hasil)) {
		if ($x[option]=='store_name') { $store_name=$x[value];};
		if ($x[option]=='receipt_header1') { $header1=$x[value];};
		if ($x[option]=='receipt_footer1') { $footer1=$x[value];};
		if ($x[option]=='receipt_footer2') { $footer2=$x[value];};
	};

	// ambil alamat printer
	$sql 	= "SELECT w.printer_commands, w.printer_type FROM kasir AS k, workstation AS w 
		WHERE k.tglTutupKasir IS NULL AND k.idUser = $_SESSION[iduser] AND k.currentWorkstation = w.idWorkstation";
	$hasil 	= mysql_query($sql) or die(mysql_error());
	$x	= mysql_fetch_array($hasil);
	$perintah_printer = $x[printer_commands];
	$jenis_printer = $x[printer_type];

	// ambil transaksi yang akan dicetak
	$sql = "SELECT t.jumBarang,t.hargaJual,b.namaBarang FROM barang AS b, tmp_detail_jual AS t
		WHERE t.username='$_SESSION[uname]' AND t.barcode=b.barcode";
	//echo $sql;
	$hasil 	= mysql_query($sql);
	
	// siapkan string yang akan dicetak
	$struk  = str_pad($store_name, 40, " ", STR_PAD_BOTH) . "\n" . str_pad($header1, 40, " ", STR_PAD_BOTH) . "\n" . str_pad($_SESSION[uname] ." : ". date("d-m-Y H:i") ." #$NomorStruk", 40, " ", STR_PAD_BOTH) ." \n";

	$struk .= "-------------------------------------\n";
	while ($x = mysql_fetch_array($hasil)) {	
		$temp = $x[jumBarang] . "x ". $x[namaBarang]. " @".number_format($x[hargaJual],0,',','.').
				": ".number_format(($x[hargaJual] * $x[jumBarang]),0,',','.')."\n";
		// jika panjang baris > 40 huruf, pecah jadi 2 baris		
		if (strlen($temp) > 40) {
			$tmp = substr($temp, 0, 40) . "- \n -" . substr($temp, 40);
			$temp = $tmp;
		};
		$struk .= $temp;
	}
	$struk .= "-------------------------------------\n";
	$struk .= " TOTAL   : ".number_format($_POST[tot_pembayaran],0,',','.')." \n";
	$struk .= " Dibayar : ".number_format($_POST[uangDibayar],0,',','.')." \n";
	$struk .= " Kembali : ".number_format(($_POST[uangDibayar]-$_POST[tot_pembayaran]),0,',','.')." \n";
	$struk .= "-------------------------------------\n";
	$struk .= str_pad($footer1, 40, " ", STR_PAD_BOTH) . "\n" . str_pad($footer2, 40, " ", STR_PAD_BOTH) . "\n\n\n\n\n\n\n\n\n\n\n\n\n";

	if ($jenis_printer == 'pdf') {
		require('classes/fpdf.php');
		$pdf=new FPDF();
		$pdf->AddPage();
		$pdf->SetFont('Arial','',9);
		$struk_pdf = explode("\n", $struk);
		foreach ($struk_pdf as $baris)
		{
			$width 	= 40;
			$length	= 1;
			$pdf->Cell($width,$length,$baris);
			$pdf->Ln(3);
		}
		$pdf->Output();

	} elseif ($jenis_printer == 'rlpr') {
		include "classes/PrintSend.php";
		include "classes/PrintSendLPR.php";
		$perintah = "echo \"$struk\" |lpr $perintah_printer -l";
		//echo $perintah; exit;
		exec($perintah, $output);
	};


    if($_POST[tipePembayaran]=='2'){
        mysql_query("INSERT INTO piutang(idTransaksiJual,nominal,tglDiBayar,
                        idUser,last_update)
                        VALUES('$id_transaksi','$_POST[tot_pembayaran]',
                        '$_POST[tglBayar]','$_SESSION[iduser]','$tgl')") or die(mysql_error());
    }


    $dataBarang = mysql_query("SELECT * from tmp_detail_jual
            			WHERE idCustomer = '$_SESSION[idCustomer]' AND username = '$_SESSION[uname]'");
    while($simpan = mysql_fetch_array($dataBarang)){
        $jumlahAkhir = 0;
        $jumBarang = mysql_query("SELECT jumBarang FROM barang WHERE barcode = '$simpan[barcode]'");
        $jumlah = mysql_fetch_array($jumBarang);
        $jumlahAkhir = $jumlah[jumBarang] - $simpan[jumBarang];
	if ($jumlahAkhir < 0) { $jumlahAkhir = 0;};

	//fixme: kurangi quantity pembelian dengan benar :
	//	(1) cari barang di tabel detail_beli, yang stoknya masih ada, lalu
	//	(2) catat quantity nya, lalu
	$sql = "SELECT * FROM detail_beli 
		WHERE isSold='N' AND barcode='$simpan[barcode]' ORDER BY idDetailBeli ASC";
	$hasil = mysql_query($sql);
	$x = mysql_fetch_array($hasil);

	// 	(3) update dengan jumlah yang terjual
	// 		(4) jika stok habis : tandai
	//		(5) jika stok kurang : cari lagi stok lainnya
	//			(6) jika tidak ada lagi - laporkan ke user, bahwa stok kurang 
	$Sold = $simpan[jumBarang];
	$StockAvailable = $x[jumBarang];
	$SoldOut = false; $Finish = false;
	do { // looping mengurangi jumlah terjual (Sold) dengan stok yg ada (StockAvailable)

		// kurangi stok di record tsb dengan $Sold
		if ($Sold >= $StockAvailable) {
			$newStock = 0;
			$Sold = $Sold - $StockAvailable;
			// catat bahwa record ini sudah habis stok nya
			$sql = "UPDATE detail_beli SET isSold='Y' WHERE idDetailBeli=$x[idDetailBeli]";
                	mysql_query($sql);
		} else {
			$newStock = $StockAvailable - $Sold;
			$Finish   = true; $Sold = 0;
		}
		// catat jumlah stok yang baru / sudah dikurangi penjualan
		$sql = "UPDATE detail_beli SET jumBarang=$newStock WHERE idDetailBeli=$x[idDetailBeli]";
		mysql_query($sql);		

		// ambil record berikutnya dari database
		$records = $records - 1;
		if (!($x = mysql_fetch_array($hasil))) { $SoldOut = true;};
		$StockAvailable = $x[jumBarang];
	} while (!$SoldOut && !$Finish);

	if (!$SoldOut) { // kurangi sisa item terjual yang masih ada dengan stok yang ada di database
		// kurangi stok di record tsb dengan $Sold
		if ($Sold > $StockAvailable) {
			$newStock = 0;
		} else {
			$newStock = $StockAvailable - $Sold;
		}
		$sql="UPDATE detail_beli SET jumBarang=$newStock WHERE idDetailBeli=$x[idDetailBeli]";
		mysql_query($sql);
	}

	// 	(7) cari barang di tabel barang, lalu
	//	(8) catat quantity nya, lalu
	// 	(9) update dengan jumlah yang terjual
	//
	$sql = "UPDATE barang SET jumBarang = '$jumlahAkhir' WHERE barcode = '$simpan[barcode]'";        
	$hasil = mysql_query($sql);


	$sql = "INSERT INTO detail_jual(idBarang, barcode, 
                        jumBarang,hargaJual,username, nomorStruk, hargaBeli)
                    VALUES('$simpan[idBarang]', '$simpan[barcode]', 
                    '$simpan[jumBarang]','$simpan[hargaJual]','$_SESSION[uname]', $NomorStruk, $simpan[hargaBeli])";
	//echo $sql;
        mysql_query($sql) or die(mysql_error());
	}

    mysql_query("DELETE FROM tmp_detail_jual WHERE idCustomer = '$_SESSION[idCustomer]' AND username = '$_SESSION[uname]'");
    
    $_SESSION[tot_pembelian] = 0;	
    releaseCustomer();
    //header('location:media.php?module='.$module);
	echo "<script>window.close();</script>";
}

//Batal Transaksi Jual
elseif ($module=='penjualan_barang' AND $act=='batal'){

    mysql_query("DELETE FROM tmp_detail_jual where idCustomer = '$_SESSION[idCustomer]'  AND username = '$_SESSION[uname]'");
    releaseCustomer();

    header('location:media.php?module='.$module);
}

// BUKA KASIR  // -----------------------------------------------------------------------------------------------------------------------------------
elseif ($module=='buka_kasir' AND $act=='input'){

	// cari apakah kasir ini sedang aktif - jika ya, maka tolak
	$sql = "SELECT * FROM kasir WHERE idUser=$_POST[idKasir] AND tglTutupKasir IS NULL";
	$hasil = mysql_query($sql);

	if (mysql_num_rows($hasil) > 0) {
		echo "Kasir ini sedang Aktif ! Silakan ditutup dulu.
			<p>&nbsp;</p>
			    <a href=javascript:history.go(-1)><< Kembali</a>";
	} else {
		$sql = "INSERT INTO kasir(tglBukaKasir,idUser,kasAwal,currentWorkstation) 
			VALUES ('$_POST[tglBukaKasir]',$_POST[idKasir],$_POST[kasAwal],$_POST[idWorkstation])";
		mysql_query($sql);
		header('location:media.php?module=kasir');
	};

}

//TUTUP KASIR
elseif ($module=='tutup_kasir' AND $act=='input'){

	if (empty($_POST[kasAkhir])) {$_POST[kasAkhir] = 0;};
	if (empty($_POST[totalTransaksi])) {$_POST[totalTransaksi] = 0;};
	if (empty($_POST[totalProfit])) {$_POST[totalProfit] = 0;};

	$sql = "UPDATE kasir SET kasTutup 	= $_POST[kasAkhir],
         		kasSeharusnya 		= $_POST[kasSeharusnya],
			tglTutupKasir 		= '$_POST[tglTutupKasir]',
			totalTransaksi 		= $_POST[totalTransaksi], 
			totalProfit 		= $_POST[totalProfit], 
			totalRetur 		= $_POST[totalRetur], 
			totalTransaksiKas 	= $_POST[totalTransaksiKas], 
			totalTransaksiKartu 	= $_POST[totalTransaksiKartu] 
        WHERE idUser = $_POST[idKasir] AND tglTutupKasir IS NULL";
	//echo $sql;

	mysql_query($sql);
	header('location:media.php?module=kasir');
}




elseif($module=='retur_barang' AND $act=='input'){ // ====================================================================================

	$tgl = date("Y-m-d H:i:s");

/*	fixme : simpan ke table 'retur', dan dapatkan nomor nota retur nya

	mysql_query("INSERT INTO transaksijual(tglTransaksiJual,
                    idCustomer,idTipePembayaran,nominal,idUser,last_update,uangDibayar)
                    VALUES('$tgl','$_SESSION[idCustomer]',
                           '$_POST[tipePembayaran]','$_POST[tot_pembayaran]',
                            '$_SESSION[iduser]','$tgl', $_POST[uangDibayar])") or die(mysql_error());
	$NomorStruk = mysql_insert_id();
*/


	// cetak struk -------------
	// ambil transaksi yang akan dicetak
	$sql = "SELECT t.jumBarang,t.hargaJual,t.hargaBeli,b.namaBarang,t.barcode FROM barang AS b, tmp_detail_retur_barang AS t
		WHERE t.username='$_SESSION[uname]' AND t.barcode=b.barcode";
	//echo $sql;
	$hasil 	= mysql_query($sql);

	echo "namaPrinter : ".$_POST[namaPrinter];


		// cetak struk
		//cetakStruk ("$_POST[namaPrinter]", 1, "$_SESSION[uname]", $_POST[tot_retur], 0, $hasil, true);


    // mulai simpan data ke detail_retur_barang
    $dataBarang = mysql_query("SELECT * from tmp_detail_retur_barang 
            			WHERE username = '$_SESSION[uname]'");

    while($simpan = mysql_fetch_array($dataBarang)){

echo "1 <br>";

        $jumlahAkhir = 0;
        $jumBarang = mysql_query("SELECT jumBarang FROM barang WHERE barcode = '$simpan[barcode]'");
        $jumlah = mysql_fetch_array($jumBarang);
        $jumlahAkhir = $jumlah[jumBarang] + $simpan[jumBarang];

	//fixme: kurangi quantity pembelian dengan benar :
	//	(1) cari barang di tabel detail_beli, yang stoknya masih ada, lalu
	//	(2) catat quantity nya, lalu
	$sql = "SELECT * FROM detail_beli 
		WHERE isSold='N' AND barcode='$simpan[barcode]' ORDER BY idDetailBeli ASC";
	$hasil = mysql_query($sql);
	$x = mysql_fetch_array($hasil);

	// 	(3) update dengan jumlah yang di retur
	$retur = $simpan[jumBarang];
	$StockAvailable = $x[jumBarang];

	$newStock = $StockAvailable + $retur;

	mysql_query("UPDATE detail_beli SET jumBarang=$newStock WHERE idDetailBeli=$x[idDetailBeli]");		


	// 	(4) cari barang di tabel barang, lalu
	//	(5) catat quantity nya, lalu
	// 	(6) update dengan jumlah yang di retur
	//
	$sql = "UPDATE barang SET jumBarang = '$jumlahAkhir' WHERE barcode = '$simpan[barcode]'";        
	$hasil = mysql_query($sql);


	$sql = "INSERT INTO detail_retur_barang (tglTransaksi, idBarang, barcode, 	
                        jumBarang,hargaJual,username, hargaBeli)
                    VALUES('$tgl', '$simpan[idBarang]', '$simpan[barcode]', 
                    '$simpan[jumBarang]',$simpan[hargaJual],'$_SESSION[uname]', $simpan[hargaBeli])";
	echo $sql;
        mysql_query($sql) or die(mysql_error());
	}

    mysql_query("DELETE FROM tmp_detail_retur_barang WHERE username = '$_SESSION[uname]'");
    
    $_SESSION[tot_retur] = 0;		
    //header('location:media.php?module='.$module);
	echo "<script>window.close();</script>";
}



//Batal Transaksi Retur Barang
elseif ($module=='retur_barang' AND $act=='batal'){

    mysql_query("DELETE FROM tmp_detail_retur_barang WHERE username = '$_SESSION[uname]'");
    $_SESSION[tot_retur] = 0;	

    header('location:media.php?module=barang');




}

elseif($module=='inputreturbeli' AND $act=='inputtemp'){ // ====================================================================================
	$sql = "INSERT INTO tmp_edit_detail_retur_beli (idDetailBeli,idTransaksiBeli,idBarang,tglExpire,jumBarang,hargaBeli,barcode)
                    SELECT d.idDetailBeli,d.idTransaksiBeli,d.idBarang,d.tglExpire,d.jumBarang,d.hargaBeli,d.barcode 
			FROM detail_beli AS d, barang AS b 
			WHERE b.barcode = d.barcode AND d.idTransaksiBeli = '$_POST[idNota]' AND d.idTransaksiBeli != 0";    
	mysql_query($sql) or die(mysql_error());
	//echo $sql; exit;
    header('location:media.php?module=pembelian_barang&act=inputreturbeli&idnota='.$_POST[idNota]);
}

elseif($module=='inputreturbeli' AND $act=='simpanretur'){ // -----------------------------------------------------------------------------------

	// baca detail nota ybs dari transaksibeli
	$sql = "SELECT * FROM transaksibeli WHERE idTransaksiBeli = $_POST[idNota]" or die(mysql_error());
	$hasil = mysql_query($sql);
	$x = mysql_fetch_array($hasil);
		$idSupplier 		= $x[idSupplier];
		$idTipePembayaran	= $x[idTipePembayaran];
		$NomorInvoice		= $x[NomorInvoice];

	// hitung nominal retur
	$sql = "SELECT SUM(jumRetur * hargaBeli) AS totalRetur, SUM(jumBarang * hargaBeli) AS totalCurrent FROM tmp_edit_detail_retur_beli WHERE idTransaksiBeli = '$_POST[idNota]'";
	$hasil = mysql_query($sql) or die(mysql_error());
	$x = mysql_fetch_array($hasil);
		$nominal 		= $x[totalCurrent] - $x[totalRetur];
		$totalRetur		= $x[totalRetur];
		$username 		= $_SESSION[uname];
		$last_update		= date("Y-m-d");

	// mulai baca data perubahan dari tmp_edit_detail_retur_beli
    	$query = mysql_query("SELECT idTransaksiBeli, idBarang,tglExpire,jumBarang,hargaBeli,barcode,jumRetur, idDetailBeli  
			FROM tmp_edit_detail_retur_beli WHERE idTransaksiBeli = '$_POST[idNota]'") or die(mysql_error());

    while($tmpEdit = mysql_fetch_array($query)){
        $jumBarang = getJumBarangDiBarang($tmpEdit[idDetailBeli], $tmpEdit[barcode]);
        $jumBarangDetail = getJumBarangDetailPembelian($tmpEdit[idDetailBeli]);
        $jumBarangBaru 		= $jumBarang - $tmpEdit[jumRetur];
        $jumBarangDetailBaru 	= $jumBarangDetail - $tmpEdit[jumRetur];

	// update nota pembelian
	if ($jumBarangDetail > 0) { // jika stok sudah nol, jangan dikurangi (jadi minus)
	        mysql_query("UPDATE detail_beli SET jumBarang = '$jumBarangDetailBaru' 
	            WHERE idDetailBeli = '$tmpEdit[idDetailBeli]'") or die(mysql_error());
	}

	// update stok barang
	if ($jumBarang > 0) {  // jika stok sudah nol, jangan dikurangi (jadi minus) 
	        mysql_query("UPDATE barang SET jumBarang = $jumBarangBaru
	                WHERE barcode = '$tmpEdit[barcode]'") or die(mysql_error());
	}

	// input transaksi retur ke database
	if ($tmpEdit[jumRetur] > 0) { // yang jumRetur 0 (nol) tidak usah dicatat
		$z = $tmpEdit;
		$sql = "INSERT INTO detail_retur_beli (idTransaksiBeli,idBarang,tglExpire,jumRetur,hargaBeli,barcode, 
				username,idSupplier,nominal,idTipePembayaran,NomorInvoice,tglRetur) 
			VALUES ($z[idTransaksiBeli],$z[idBarang],'$z[tglExpire]',$z[jumRetur],$z[hargaBeli],'$z[barcode]', 
				'$username','$idSupplier', $totalRetur, $idTipePembayaran, '$NomorInvoice','$last_update')";
		mysql_query($sql) or die(mysql_error());
	}
    }

	// update transaksibeli
	mysql_query("UPDATE transaksibeli SET last_update = '$last_update', nominal = $nominal 
                WHERE idTransaksiBeli = '$_POST[idNota]'") or die(mysql_error());

	// hapus data temporary
	mysql_query("DELETE FROM tmp_edit_detail_retur_beli WHERE idTransaksiBeli = '$_POST[idNota]'") or die(mysql_error());
	header('location:media.php?module=pembelian_barang');
}





elseif($module=='editlaporanpembelian' AND $act=='inputtemp'){ // ====================================================================================
    mysql_query("INSERT INTO tmp_edit_detail_beli(idDetailBeli,idTransaksiBeli,idBarang,tglExpire,jumBarang,hargaBeli)
                    SELECT detail_beli.idDetailBeli,detail_beli.idTransaksiBeli,detail_beli.idBarang,detail_beli.tglExpire,
                            detail_beli.jumBarang,detail_beli.hargaBeli
                            from detail_beli,barang where barang.idBarang = detail_beli.idBarang AND detail_beli.idTransaksiBeli = '$_POST[idNota]' AND detail_beli.idTransaksiBeli != 0") or die(mysql_error());
    header('location:media.php?module=pembelian_barang&act=editlaporan&idnota='.$_POST[idNota]);
}

elseif($module=='editlaporanpembelian' AND $act=='simpanedit'){ // -----------------------------------------------------------------------------------
//    echo "Edit nota $_POST[idNota]";
    $query = mysql_query("SELECT idDetailBeli, idBarang,tglExpire,jumBarang,hargaBeli FROM tmp_edit_detail_beli WHERE idTransaksiBeli = '$_POST[idNota]'") or die(mysql_error());
    while($tmpEdit = mysql_fetch_array($query)){
        $jumBarang = getJumBarangDiBarang($tmpEdit[idDetailBeli]);
        $jumBarangDetail = getJumBarangDetailPembelian($tmpEdit[idDetailBeli]);
        $jumBarangEdit = $jumBarangDetail - $tmpEdit[jumBarang];
        $jumBarangBaru = $jumBarang + $jumBarangEdit;

        mysql_query("UPDATE detail_beli SET tglExpire = '$tmpEdit[tglExpire]', jumBarang = '$tmpEdit[jumBarang]', hargaBeli = '$tmpEdit[hargaBeli]'
            WHERE idDetailBeli = '$tmpEdit[idDetailBeli]'") or die(mysql_error());
        mysql_query("UPDATE barang SET jumBarang = '$jumBarangBaru'
                WHERE idBarang = '$tmpEdit[idBarang]'") or die(mysql_error());
    }
    mysql_query("DELETE FROM tmp_edit_detail_beli WHERE idTransaksiBeli = '$_POST[idNota]'") or die(mysql_error());
    header('location:media.php?module=pembelian_barang&act=detaillaporan&idnota='.$_POST[idNota]);
}

elseif($module=='laporanpenjualan' AND $act=='hapuslaporan'){
//    echo "Kasir : $_POST[kasir], No Nota : $_POST[idNota]";
    $query = mysql_query("SELECT idBarang, jumBarang FROM detail_jual WHERE idTransaksiJual = '$_POST[idNota]'") or die(mysql_error());

    while($penjualan = mysql_fetch_array($query)){
        $queryBarang = mysql_query("SELECT jumBarang FROM barang WHERE idBarang = '$penjualan[idBarang]'") or die(mysql_error());
        $jum = mysql_fetch_array($queryBarang);
        $jumBarangBaru = $jum[jumBarang] + $penjualan[jumBarang];
        mysql_query("UPDATE barang SET jumBarang = $jumBarangBaru WHERE idBarang = '$penjualan[idBarang]'") or die(mysql_error());
    }
    mysql_query("DELETE FROM detail_jual WHERE idTransaksiJual = '$_POST[idNota]'") or die(mysql_error());
    mysql_query("DELETE FROM transaksijual WHERE idTransaksiJual = '$_POST[idNota]'") or die(mysql_error());
}               



else{ // =======================================================================================================================================
    echo "Tidak Ada Aksi untuk modul ini";
}


/* CHANGELOG -----------------------------------------------------------

 1.6.0 / 2013-02-07 : Harry Sufehmi	: bugfix: hapus barang kini sudah bisa
 1.2.5 / 2012-04-17 : Harry Sufehmi 	: bugfix: hapus satuan barang tidak berfungsi
 1.2.5 / 2012-03-16 : Harry Sufehmi 	: bugfix: kini perubahan barang (dari Barang - Cari Barang - Ubah) disimpan dengan benar
						(branch "($module=='barang' AND $act=='update')")
 1.2.5 / 2012-02-14 : Harry Sufehmi	: bugfix: kini Retur Pembelian ($act=='simpanretur') akan mengurangi jumlah stok (jumBarang) di table barang dengan benar
 1.0.3 / 2011-07-14 : Harry Sufehmi	: jika ganti / edit barcode, maka otomatis barcode ybs di table-table lainnya juga di update
 1.0.2 / 2011-03-04 : Harry Sufehmi	: jika user biasa ganti password, kembali ke Home
 1.0.1 / 2010-06-03 : Harry Sufehmi	: penambahan fasilitas workstation management, print ke PDF

 0.9.1		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* media.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

session_start();
include "../config/config.php";
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{
?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Halaman AhadPOS</title>
<link href="../config/adminstyle.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="../js/jquery.js"></script>
	<script type="text/javascript" src="../js/interface.js"></script>
	<script type="text/javascript" src="../js/jquery.form.js"></script>
</head>

<body>
<table width="850" align="center" class=body>
  <tr>
    <td colspan="2">
      <div id="header">      
      </div>
    </td>
  </tr>
  <tr>
    <td width="200" height="400" valign=top class=bckgrndmenu>
      
    	<div id="menu">
	      <ul>
	        <li><a href=?module=home>&#187; Home</a></li>
	        <?php include "menu.php"; ?>
	        <li><a href=logout.php>&#187; Logout</a></li>
	      </ul>
		    
 		</div>
 	  
    </td>
    <td width="650" valign=top>
      <div id="content">
		<?php include "content.php"; ?>
      </div>
    </td>
  </tr>
  <tr>
    <td colspan="2" align=right>
    	<div id="footer">
			<a href="http://ahadpos.com/"><font color=white>AhadPOS</a></a> Copyright &copy; 2011 by Rimbalinux.com ::Tim Support IT:: 
		</div>
	</td>
  </tr>
</table>
</body>
</html>

<?php
}



/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */


?>
<?php  
/* upgrade_check.php ------------------------------------------------------
   	version: 1.5.0

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

/* -------------------------------------------------------------
This script will automatically upgrade the database 
as required by the current version of AhadPOS  

NO DESTRUCTIVE QUERY ALLOWED HERE
----------------------------------------------------------------*/

include "../config/config.php";


// Software Version : 1.5.0
// probably a good idea to move these next 3 lines into config.php instead
$major 		= 1;
$minor		= 6;
$revision	= 0;

// serialize this
$current_version	= array($major, $minor, $revision);

// ===============================================================

// get version number from database
$sql	= "SELECT value FROM config WHERE `option` = 'version'";
$hasil	= mysql_query($sql);
$x	= mysql_fetch_array($hasil);

// if no version, means current database structure is from version < 1.5.0
if (mysql_num_rows($hasil) < 1) {

	$dbmajor	= 1;
	$dbminor	= 2;
	$dbrevision	= 0;

} else { // ======= get the major, minor, and revision number 

	$dbversion	= unserialize($x[value]);
	$dbmajor	= $dbversion[0];
	$dbminor	= $dbversion[1];
	$dbrevision	= $dbversion[2];
};


// if up to date, don't do anything at all
if ($major == $dbmajor && $minor == $dbminor && $revision == $dbrevision) { 

	header('location:media.php?module=home');
}


// ---------------------- start upgrading if database version < software version

echo "Current database version : $dbmajor.$dbminor.$dbrevision <br />";
echo "Current software version : $major.$minor.$revision <br /><br />";

if ($major >= 1 && $dbmajor <= $major) { 	// ------- upgrade semua patch versi 1.x
	echo "Checking database version 1.x.x \n <br />";
        check_minor_major1($dbminor, $minor, $dbrevision, $revision);
} else { selesai(); };

if ($major >= 2 && $dbmajor <= $major) { 	// ------- upgrade semua patch versi 2.x
        echo "Checking database version 2.x.x \n <br />";
        check_minor_major2($dbminor, $minor, $dbrevision, $revision);
} else { selesai(); }

if ($major >= 3 && $dbmajor <= $major) { 	// ------- upgrade semua patch versi 3.x
        echo "Checking database version 3.x.x \n <br />";
	check_minor_major3($dbminor, $minor, $dbrevision, $revision);
} else { selesai(); }



exit;

	

// =================================== PATCH VERSI 1.x.x ==========================================
function check_minor_major1($dbminor, $minor, $dbrevision, $revision) {

	if ($minor >= 2 && $dbminor < $minor) {	// ------- upgrade semua patch versi 1.2.x 
	        echo "Upgrading database to version 1.2.x \n <br />";
		check_revision_minor2_major1($dbminor, $minor, $dbrevision, $revision);
	}

	if ($minor >= 5 && $dbminor < $minor) { 	// ------- upgrade semua patch versi 1.5.x
                echo "Upgrading database to version 1.5.x \n <br />";
		check_revision_minor5_major1($dbminor, $minor, $dbrevision, $revision);
	}

	if ($minor >= 6 && $dbminor < $minor) { 	// ------- upgrade semua patch versi 1.6.x
                echo "Upgrading database to version 1.6.x \n <br />";
		check_revision_minor6_major1($dbminor, $minor, $dbrevision, $revision);
	}

}


function check_revision_minor2_major1($dbminor, $minor, $dbrevision, $revision) {

        echo "Upgrading database to version 1.2.0 \n <br />";
	upgrade_old_to_120();

        echo "Upgrading database from 1.2.0 to version 1.2.5 \n <br />";
	upgrade_120_to_125();
}


function check_revision_minor5_major1($dbminor, $minor, $dbrevision, $revision) {

        echo "Upgrading database from 1.2.5 to version 1.5.0 \n <br />";
	upgrade_125_to_150();
}

function check_revision_minor6_major1($dbminor, $minor, $dbrevision, $revision) {

        echo "Upgrading database from 1.5.0 to version 1.6.0 \n <br />";
	upgrade_150_to_160();
}


// ------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------

function upgrade_old_to_120() {

	// nothing to do here
}


function upgrade_120_to_125() {


        // database structure upgrade -------------------------------------------------
	$sql = "ALTER TABLE  `kategori_barang` CHANGE  `idKategoriBarang`  `idKategoriBarang` INT( 5 ) NOT NULL AUTO_INCREMENT";
	$hasil	= exec_query($sql);

        // optimizations --------------------------------------------------------------
        $sql = "ALTER TABLE  `barang` ADD INDEX (`idKategoriBarang`);
		ALTER TABLE  `barang` ADD INDEX (`idSupplier`);
		ALTER TABLE  `barang` ADD FULLTEXT (`namaBarang`);

		ALTER TABLE  `detail_beli` ADD INDEX (`isSold`);
		ALTER TABLE  `detail_beli` ADD INDEX (`jumBarang`);
		ALTER TABLE  `detail_beli` ADD INDEX (`idBarang`);
		ALTER TABLE  `detail_beli` ADD INDEX (`barcode`);

		ALTER TABLE  `detail_jual` ADD INDEX (`username`);
		ALTER TABLE  `detail_jual` ADD INDEX (`nomorStruk`);
		ALTER TABLE  `detail_jual` ADD INDEX (`barcode`);

		ALTER TABLE  `tmp_detail_beli` ADD INDEX (`idSupplier`);
		ALTER TABLE  `tmp_detail_beli` ADD INDEX (`username`);

		ALTER TABLE  `transaksijual` ADD INDEX (`idUser`);
		ALTER TABLE  `transaksijual` ADD INDEX (`tglTransaksiJual`);
		ALTER TABLE  `transaksijual` ADD INDEX (`nominal`);
		";
        $hasil  = exec_query($sql);
	echo mysql_error();

        // update version number ------------------------------------------------------
	$sql 	= "SELECT * FROM config WHERE `option` = 'version'";
	$hasil	= mysql_query($sql);

	if (mysql_num_rows($hasil) > 0) {
	        $sql = "UPDATE config SET value = '".serialize(array(1,2,5))."' WHERE `option` = 'version'";
	} else {
		$sql  = "INSERT INTO config (`option`, value, description) VALUES ('version', '".serialize(array(1,2,5))."', '')";
	};
        $hasil  = mysql_query($sql);

}


function upgrade_125_to_150() {

        // database structure upgrade -------------------------------------------------
        $sql = "
		ALTER TABLE `modul` ADD `script_name` VARCHAR( 50 ) NOT NULL;
		ALTER TABLE `modul` ADD INDEX (`script_name`);

                UPDATE `modul` SET `script_name` = 'mod_user.php' WHERE `modul`.`link` = '?module=user' ;
                UPDATE `modul` SET `script_name` = 'mod_supplier.php' WHERE `modul`.`link` = '?module=supplier' ;
                UPDATE `modul` SET `script_name` = 'mod_customer.php' WHERE `modul`.`link` = '?module=customer' ;
                UPDATE `modul` SET `script_name` = 'mod_barang.php' WHERE `modul`.`link` = '?module=barang' ;
                UPDATE `modul` SET `script_name` = 'mod_rak.php' WHERE `modul`.`link` = '?module=rak' ;
                UPDATE `modul` SET `script_name` = 'mod_satuan_barang.php' WHERE `modul`.`link` = '?module=satuan_barang' ;
                UPDATE `modul` SET `script_name` = 'mod_kategori_barang.php' WHERE `modul`.`link` = '?module=kategori_barang' ;
                UPDATE `modul` SET `script_name` = 'mod_beli_barang.php' WHERE `modul`.`link` = '?module=pembelian_barang' ;
                UPDATE `modul` SET `script_name` = 'mod_jual_barang.php' WHERE `modul`.`link` = '?module=penjualan_barang' ;
                UPDATE `modul` SET `script_name` = 'mod_hutang.php' WHERE `modul`.`link` = '?module=hutang' ;
                UPDATE `modul` SET `script_name` = 'mod_piutang.php' WHERE `modul`.`link` = '?module=piutang' ;
                UPDATE `modul` SET `script_name` = 'mod_modul.php' WHERE `modul`.`link` = '?module=modul' ;
                UPDATE `modul` SET `script_name` = 'mod_kasir.php' WHERE `modul`.`link` = '?module=kasir' ;
                UPDATE `modul` SET `script_name` = 'mod_laporan.php' WHERE `modul`.`link` = '?module=laporan' ;
                UPDATE `modul` SET `script_name` = 'mod_manage_workstation.php' WHERE `modul`.`link` = '?module=workstation' ;

		";
        $hasil  = exec_query($sql);
	echo mysql_error();

        // optimizations --------------------------------------------------------------
        // no optimizations for 1.2.5 --> 1.5.0
	//$sql = "";
        //$hasil  = exec_query($sql);

        // update version number ------------------------------------------------------
        $sql    = "SELECT * FROM config WHERE `option` = 'version'";
        $hasil  = mysql_query($sql);

        if (mysql_num_rows($hasil) > 0) {
                $sql = "UPDATE config SET value = '".serialize(array(1,5,0))."' WHERE `option` = 'version'";
        } else {
                $sql  = "INSERT INTO config (`option`, value, description) VALUES ('version', '".serialize(array(1,5,0))."', '')";
        };
        $hasil  = mysql_query($sql);

}


function upgrade_150_to_160() {

	$sql 	= "CREATE TABLE IF NOT EXISTS `arsip_barang` (
			`idBarang` bigint(20) NOT NULL DEFAULT '0',
			`namaBarang` varchar(30) DEFAULT ' ',
			`idKategoriBarang` int(5) DEFAULT '0',
  			`idSatuanBarang` int(5) DEFAULT '0',
			`jumBarang` int(10) DEFAULT '0',
			`hargaJual` bigint(20) DEFAULT '0',
			`last_update` date DEFAULT '2000-01-01',
			`idSupplier` bigint(20) DEFAULT '0',
			`barcode` varchar(25) DEFAULT NULL,
			`username` varchar(30) DEFAULT NULL,
			`idRak` bigint(5) DEFAULT NULL,
			  UNIQUE KEY `barcode` (`barcode`),
			  KEY `idKategoriBarang` (`idKategoriBarang`),
			  KEY `namaBarang` (`namaBarang`),
			  KEY `idSupplier` (`idSupplier`),
			  KEY `idKategoriBarang_2` (`idKategoriBarang`),
			  KEY `idSupplier_2` (`idSupplier`)
			) ENGINE=MyISAM DEFAULT CHARSET=latin1;
		";
        $hasil  = exec_query($sql);
	echo mysql_error();

        // update version number ------------------------------------------------------
        $sql    = "SELECT * FROM config WHERE `option` = 'version'";
        $hasil  = mysql_query($sql);

        if (mysql_num_rows($hasil) > 0) {
                $sql = "UPDATE config SET value = '".serialize(array(1,6,0))."' WHERE `option` = 'version'";
        } else {
                $sql  = "INSERT INTO config (`option`, value, description) VALUES ('version', '".serialize(array(1,6,0))."', '')";
        };
        $hasil  = mysql_query($sql);

}


// =================================== PATCH VERSI 2.x.x ==========================================
function check_minor_major2($dbminor, $minor, $dbrevision, $revision) {

	// nothing here yet
}



// =================================== PATCH VERSI 3.x.x ==========================================
function check_minor_major3($dbminor, $minor, $dbrevision, $revision) {

        // nothing here yet
}

// ==================== general functions ==============================

function exec_query($sql) {
// able to loop through & execute MULTIPLE query lines

	$queries = preg_split("/;+(?=([^'|^\\\']*['|\\\'][^'|^\\\']*['|\\\'])*[^'|^\\\']*[^'|^\\\']$)/", $sql); 
	foreach ($queries as $query){ 
		if (strlen(trim($query)) > 0) mysql_query($query); 
	} 
}



function selesai() {

	echo "Database upgrade finished, thank you. <br /> Silakan <a href=index.php> <b>LOGIN</b> </a> lagi.";
	exit;
}




/* CHANGELOG -----------------------------------------------------------

 1.6.0 / 2013-02-07  : Harry Sufehmi	: table arsip_barang

 1.5.0 / 2012-11-25  : Harry Sufehmi	: initial release

------------------------------------------------------------------------ */

?>
<?php

/* index.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

?><html>
<head>
<title>Halaman Login AhadPOS</title>
<link href="../config/adminstyle.css" rel="stylesheet" type="text/css" />
</head>
<body>

  <div id="login">
		<h2>Login</h2>
    <img src="../image/login-welcome.gif" width="97" height="105" hspace="10" align="left">

<form method="POST" action="cek_login.php">
<table>
<tr><td>Username</td><td> : <input type="text" name="username"></td></tr>
<tr><td>Password</td><td> : <input type="password" name="password"></td></tr>
<tr><td colspan="2">&nbsp;</td></tr>
<tr><td colspan="2" align="center"><input type="submit" value="Login"></td></tr>
</table>
</form>

<p>&nbsp;</p>
  </div>
	

</body>
</html><?php



/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* content.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
include "../config/library.php";
include "../config/fungsi_indotgl.php";
include "../config/fungsi_combobox.php";
include "../config/class_paging.php";

// Bagian Home
if ($_GET[module]=='home'){
  $kas = getKasAwal($_SESSION[iduser]);
  $uang = getUangKasir($_SESSION[iduser]);
  echo "<h2>Selamat Datang</h2>
          <p>Hai <b>$_SESSION[namauser]</b>, id Anda = <b>$_SESSION[iduser]</b>. 
          Anda menjabat sebagai <b>$_SESSION[leveluser]</b>
          di sistem ini. Pergunakanlah dengan bijak jabatan Anda.</p>
          <p>Kas Awal Anda adalah : <b>Rp.$kas</b></p>
          <p>Uang Transaksi : <b>Rp.$uang</b></p>
          <p>&nbsp;</p>
	";


        //$handle = fopen("http://www.rimbalinux.com/projects/ahadpos/news.html", "r");
        $handle = false;
	if ($handle === false) {

		echo "<p>(Berita terbaru seputar AhadPOS bisa didapatkan dari : <br /><a href=http://www.rimbalinux.com/projects/ahadpos/news.html>http://www.rimbalinux.com/projects/ahadpos/news.html</a> dan <a href=http://ahadpos.com>AhadPOS.com</a>)</p>";

	} else {

		echo "
		<center>
		<p><IFRAME SRC=http://www.rimbalinux.com/projects/ahadpos/news.html WIDTH=450 HEIGHT=150>
		<p>(Berita terbaru seputar AhadPOS bisa didapatkan dari : <br /><a href=http://www.rimbalinux.com/projects/ahadpos/news.html>http://www.rimbalinux.com/projects/ahadpos/news.html</a> dan <a href=http://ahadpos.com>AhadPOS.com</a>)</p>
		</IFRAME></p>
		</center>
		";

	}

	
  echo "          <p>&nbsp;</p>          
          <p align=right>Waktu Login Saat ini: ";
  echo tgl_indo(date("Y m d")); 
  echo " | "; 
  echo date("H:i");
  echo "</p>";
}

// Bagian User
elseif ($_GET[module]=='user'){
  include "modul/mod_user.php";
}

// Bagian Modul
elseif ($_GET[module]=='modul'){
  include "modul/mod_modul.php";
}

// Bagian Satuan Barang
elseif ($_GET[module]=='satuan_barang'){
  include "modul/mod_satuan_barang.php";
}

// Bagian Kategori Barang
elseif ($_GET[module]=='kategori_barang'){
  include "modul/mod_kategori_barang.php";
}

// Bagian Rak
elseif ($_GET[module]=='rak'){
  include "modul/mod_rak.php";
}

// Bagian Barang
elseif ($_GET[module]=='barang'){
  include "modul/mod_barang.php";
}

// Bagian Supplier
elseif ($_GET[module]=='supplier'){
  include "modul/mod_supplier.php";
}

// Bagian Customer
elseif ($_GET[module]=='customer'){
  include "modul/mod_customer.php";
}

// Bagian Beli Barang
elseif ($_GET[module]=='pembelian_barang'){
  include "modul/mod_beli_barang.php";
}

// Bagian Jual Barang
elseif ($_GET[module]=='penjualan_barang'){
  include "modul/mod_jual_barang.php";
}

// Bagian Tampil Hutang
elseif ($_GET[module]=='hutang'){
  include "modul/mod_hutang.php";
}

// Bagian Tampil Piutang
elseif ($_GET[module]=='piutang'){
  include "modul/mod_piutang.php";
}

//KASIR
elseif ($_GET[module]=='kasir'){
  include "modul/mod_kasir.php";
}

// Laporan Manajemen
elseif ($_GET[module]=='laporan'){
  include "modul/mod_laporan.php";
}

// Manajemen Workstation
elseif ($_GET[module]=='workstation'){
  include "modul/mod_manage_workstation.php";
}

// Ganti Password
elseif ($_GET[module]=='ganti_password'){
  include "modul/mod_user.php";
}



/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */


?>
<?php
/* menu.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
include "modul/function.php";

if ($_SESSION[leveluser]=='admin'){
  $sql="select namaModul,link from modul order by urutan ";
}
elseif ($_SESSION[leveluser]=='gudang'){
  $sql="select * from modul m, leveluser lu where m.idLevelUser = lu.idLevelUser and levelUser='gudang' and publish='Y' order by urutan";
}
elseif ($_SESSION[leveluser]=='kasir'){    
  $sql="select * from modul m, leveluser lu where m.idLevelUser = lu.idLevelUser and levelUser='kasir' and publish='Y' order by urutan";
}
else{
  $sql="select * from modul m, leveluser lu where m.idLevelUser = lu.idLevelUser and levelUser='semua' and publish='Y' order by urutan";
} 

//debug 
//echo $_SESSION[leveluser]."-".$sql;
$hasil = mysql_query($sql);

while ($data=mysql_fetch_array($hasil)){  
  echo "<li><a href='$data[link]'>&#187; $data[namaModul]</a></li>";
}

$semua = mysql_query("select * from modul where idLevelUser = 1");
while ($dataSemua=mysql_fetch_array($semua)){
  echo "<li><a href='$dataSemua[link]'>&#187; $dataSemua[namaModul]</a></li>";
}


/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php  
/* logout.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

  session_start();
  session_destroy();
  header('location:index.php');



/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* buka_kasir.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{
?>

<html>
<head>
<title>Halaman Login AhadPOS</title>
<link href="../config/adminstyle.css" rel="stylesheet" type="text/css" />
</head>
<?php
    $tglHariIni = date("Y-m-d");

?>
<body>

  <div id="login">
		<h2>Menu Buka Kasir</h2>


<form method="POST" action="aksi.php?module=transaksi_kas&act=input">
<input type="hidden" name="idUser" value=<?php echo"$_SESSION[iduser]"; ?>>
<table>
<tr><td>User</td><td> : <?php echo "$_SESSION[namauser]"; ?></td></tr>
<tr><td>Tanggal</td><td> : <?php echo"$tglHariIni"; ?></td></tr>
<tr><td>Uang Kas Awal</td><td> : <input type="text" name="kasAwal"></td></tr>
<tr><td colspan="2">&nbsp;</td></tr>
<tr><td colspan="2" align="center"><a href="logout.php">BATAL</a>&nbsp;&nbsp;&nbsp;<input type="submit" value="Masuk"></td></tr>
</table>
</form>

<p>&nbsp;</p>
  </div>


</body>
</html>

<?php
}



/* CHANGELOG -----------------------------------------------------------

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php 

echo __FILE__;
echo basename($_SERVER['SCRIPT_NAME']);


phpinfo(); ?>
<?php
/* cek_login.php ------------------------------------------------------
   	version: 1.0.2

	Part of AhadPOS : http://AhadPOS.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
$pass=md5($_POST[password]);

$user = str_replace("'", "0", $_POST[username]);
$user = str_replace("'", "0", $user);
$sql = "SELECT idUser,namaUser,levelUser,uname FROM user u, leveluser lu WHERE u.idLevelUser = lu.idLevelUser and uname='$user' AND pass='$pass'";
$login =mysql_query($sql);

$ketemu=mysql_num_rows($login);
//$ketemu = 1;
$r=mysql_fetch_array($login);

// Apabila username dan password ditemukan
if ($ketemu > 0){
  session_start();
  #session_register("idUser");
  #session_register("namauser");
  #session_register("passuser");
  #session_register("leveluser");
  #session_register("uname");

  $_SESSION[namauser] = $r[namaUser];
  $_SESSION[iduser] = $r[idUser];
  $_SESSION[leveluser]= $r[levelUser];
  $_SESSION[uname]	= $r[uname];
  

        // cek jika ada upgrade database yang perlu dilakukan
        include "upgrade_check.php";
	



}
else{
  echo "<link href=../config/adminstyle.css rel=stylesheet type=text/css>";
  echo "<center>Login gagal! username & password tidak benar<br>";
  echo "<a href=index.php><b>ULANGI LAGI</b></a></center>";
}



/* CHANGELOG -----------------------------------------------------------

 1.5.0 / 2012-11-25 : Harry Sufehmi  	: clean up + upgrade_check.php

 1.0.2  : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* js_cetak_PO.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../../config/config.php";
include "function.php";


session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../../../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{

  echo "<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css'>";

        echo "<h2>Purchase Order</h2>";
        $supplier = getDetailSupplier($_POST[idSupplier]);
        $detailSupplier = mysql_fetch_array($supplier);
        echo "Nama Supplier : $detailSupplier[namaSupplier]
            <br/>Tanggal PO : ".date("d-m-Y")."<br/><br/>";
        $cek = $_POST[cek];
        $jumlah = count($cek);
        $no = 1;
        echo "<table width=500><tr><th>No</th><th>Barcode</th><th>Nama Barang</th><th>Stok<br />Saat Ini</th><th>Pesan</th></tr>";
        for($i=0;$i<$jumlah;$i++){
            $data = getBarangPesan($cek[$i]);
            $barangPesan = mysql_fetch_array($data);
            echo "<tr><td class=td>$no</td>
                <td class=td>$barangPesan[barcode]</td>
                <td class=td>$barangPesan[namaBarang]</td>
                <td class=td><center>$barangPesan[jumBarang]</center></td>
		<td class=td>_____</td></tr>";
            $no++;
        }
        echo "</table>";
};


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.3 / 2010-04-16 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_user.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


$ambilLevelUser = mysql_query("select * from leveluser");


if ($_GET[module] == 'ganti_password') {

	$edit=mysql_query("SELECT * FROM user WHERE idUser='$_SESSION[iduser]'");
	$data=mysql_fetch_array($edit);

	echo "
          <form method=POST action=./aksi.php?module=user&act=update&home=1 name='edituser'>
          <input type=hidden name='idUser' value='$data[idUser]'>
          <table>
          <tr><td>Nama User</td><td> : <input type=text name='namaUser' size=30 value='$data[namaUser]'></td></tr>
          <tr><td>Jabatan User</td>
                <td> : <select name='levelUser'>
                            ";
                            while($level = mysql_fetch_array($ambilLevelUser)){
                                if($level[idLevelUser] == $data[idLevelUser]){
                                    echo "<option value='$level[idLevelUser]' selected>$level[levelUser]</option>";
                                }
                                else{
                                    echo "<option value='$level[idLevelUser]'>$level[levelUser]</option>";
                                }
                            }
            echo "</select></td></tr>
          <tr><td>Username</td><td> : <input type=text name='uname' size=15 value='$data[uname]'></td></tr>
          <tr><td>Password</td><td> : <input type=password name='pass' size=15></td></tr>
          <!-- <tr><td>Re-Password</td><td> : <input type=password name='repass' size=15></td></tr> -->
          <tr><td colspan=2>*) Apabila password tidak diubah, dikosongkan saja.</td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";

} else {

switch($_GET[act]){
  // Tampil User -> menampilkan semua daftar user tanpa paging
  default:
    echo "<h2>Data User</h2>            
          <form method=POST action='?module=user&act=tambahuser'>
          <input type=submit value='Tambah User'></form>
          <br/>
          <table class=tableku>
          <tr><th>no</th><th>Id User</th><th>Nama User</th><th>Jabatan User</th><th>aksi</th></tr>";
    $tampil=mysql_query("SELECT idUser,namaUser,levelUser FROM user u, leveluser lu
                        where u.idLevelUser = lu.idLevelUser ORDER BY namaUser");
    $no=1;
    while ($r=mysql_fetch_array($tampil)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=center class=td>$no</td>
             <td align=center class=td>$r[idUser]</td>
             <td class=td>$r[namaUser]</td>
             <td align=center class=td>$r[levelUser]</td>
             <td class=td><a href=?module=user&act=edituser&id=$r[idUser]>Edit</a> |
	               <a href=./aksi.php?module=user&act=hapus&id=$r[idUser]>Hapus</a>
             </td></tr>";
      $no++;
    }
    echo "</table>
    <p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;

  case "tambahuser":
    echo "<h2>Tambah User</h2>
          <form method=POST action='./aksi.php?module=user&act=input' name='tambahuser'>
          <table>
          <tr><td>Nama User</td><td> : <input type=text name='namaUser' size=30></td></tr>
          <tr><td>Jabatan User</td>
                <td> : <select name='levelUser'>
                            <option value='0'>- Jabatan User-</option>";
                            while($level = mysql_fetch_array($ambilLevelUser)){
                                echo "<option value='$level[idLevelUser]'>$level[levelUser]</option>";
                            }
            echo "</select></td></tr>
          <tr><td>Username</td><td> : <input type=text name='uname' size=15></td></tr>
          <tr><td>Password</td><td> : <input type=password name='pass' size=15></td></tr>
          <!-- <tr><td>Re-Password</td><td> : <input type=password name='repass' size=15></td></tr> -->
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
     break;

  case "edituser":
    $edit=mysql_query("SELECT * FROM user WHERE idUser='$_GET[id]'");
    $data=mysql_fetch_array($edit);

    echo "<h2>Edit User</h2>
          <form method=POST action=./aksi.php?module=user&act=update name='edituser'>
          <input type=hidden name='idUser' value='$data[idUser]'>
          <table>
          <tr><td>Nama User</td><td> : <input type=text name='namaUser' size=30 value='$data[namaUser]'></td></tr>
          <tr><td>Jabatan User</td>
                <td> : <select name='levelUser'>
                            ";
                            while($level = mysql_fetch_array($ambilLevelUser)){
                                if($level[idLevelUser] == $data[idLevelUser]){
                                    echo "<option value='$level[idLevelUser]' selected>$level[levelUser]</option>";
                                }
                                else{
                                    echo "<option value='$level[idLevelUser]'>$level[levelUser]</option>";
                                }
                            }
            echo "</select></td></tr>
          <tr><td>Username</td><td> : <input type=text name='uname' size=15 value='$data[uname]'></td></tr>
          <tr><td>Password</td><td> : <input type=password name='pass' size=15></td></tr>
          <!-- <tr><td>Re-Password</td><td> : <input type=password name='repass' size=15></td></tr> -->
          <tr><td colspan=2>*) Apabila password tidak diubah, dikosongkan saja.</td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
    break;



};
}; //if ($_GET[module] == 'ganti_password') {


/* CHANGELOG -----------------------------------------------------------

 1.0.2 / 2011-03-04 : Harry Sufehmi		: ganti password untuk semua user
 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* tutup_kas.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

 $kas = getKasAwal($_SESSION[iduser]);
 $uang = getUangKasir($_SESSION[iduser]);
 $jum = $kas+$uang;

 echo "<form method=POST action='./aksi.php?module=tutup_kas&act=input'>
    <input type=hidden name=kasSeharusnya value=$jum>
    <table>
        <tr><td>Kas Awal</td><td> : $kas</td><tr>
        <tr><td>Uang Transaksi</td><td> : $uang</td><tr>
        <tr><td>Uang Seharusnya</td><td> : $jum</td><tr>
        <tr><td>Uang Kasir</td><td> : <input type=text name=kasAkhir></td><tr>
        <tr><td colspan=2>&nbsp;</td></tr>
        <tr><td colspan=2><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
    </table>
 </form>
";


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php   
/* js_cari_barang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../../config/config.php";


?>

<SCRIPT TYPE="text/javascript">
<!--
function targetopener(mylink, closeme, closeonly)
{
if (! (window.focus && window.opener))return true;
window.opener.focus();
if (! closeonly)window.opener.location.href=mylink.href;
if (closeme)window.close();
return false;
}
//-->
</SCRIPT>


<?php

	$caller = $_GET[caller];

	echo "

		<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css' />

			<form method=post action='$caller.php?act=caricustomer&action=tambah'>

                    <table>
                        <tr>
		";

	//echo "<td>Barcode</td><td>: <select name='barcode' id='barcode1'>";

	// ambil daftar barang
	//$sql="SELECT namaBarang,barcode,hargaJual   
	//	FROM barang FORCE INDEX (barcode) ORDER BY barcode ASC";
	//$namaBarang=mysql_query($sql);
	//while($brg = mysql_fetch_array($namaBarang)){
	//	echo "<option value='$brg[barcode]'>$brg[barcode] - $brg[namaBarang] - Rp ".number_format($brg[hargaJual],0,',','.')."</option>\n";
	//}	
	//echo "</select> </td> <td><input type=submit name=PilihBarcode value='Pilih Barcode' onClick=\"return targetopener(this,true)\">";

	echo "
		</td></tr>
                </table>
	";

	//$sql = "SELECT * FROM barang WHERE namaBarang LIKE '%".$_POST[namabarang]."%' ORDER BY namaBarang ASC";
	//$sql = "SELECT * FROM barang WHERE match(namaBarang) against ('+\"".$_POST[namabarang]."\"' in boolean mode) ORDER BY namaBarang ASC ";
	$sql = "SELECT * FROM barang WHERE match(namaBarang) against ('".$_POST[namabarang]."' in boolean mode) ORDER BY namaBarang ASC ";
	//echo $sql;
        $query = mysql_query($sql);

	echo "<table>
		<tr><th>Barcode</th><th>Nama Barang</th><th>Harga</th><th>Pilih</th></tr>
	";
                while ($data=mysql_fetch_array($query)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                    echo "<td>&nbsp; $data[barcode] &nbsp;</td><td>&nbsp; $data[namaBarang] &nbsp;</td>
                        <td align=right>&nbsp; ".number_format($data[hargaJual],0,',','.')." &nbsp;</td>
			<td>&nbsp; [<a href='$caller.php?act=caricustomer&action=tambah&barcode=$data[barcode]' onClick=\"return targetopener(this,true)\"> Pilih </a>] 
			</td>
                        </tr>";
                    $tot_pembelian += $total;
                    $no++;
                }
	echo "</table>";



?>

			</form>


<?php

/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-11.22 : Harry Sufehmi		: $_GET[caller] enable this script to be called from various module 
							and return the result back properly
 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.7.5		    : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */
?>
<?php
/* mod_kategori_barang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
    // Tampil Kategori Barang
    default:
        echo "<h2>Tambah Kategori Barang</h2>
              <form method=POST action='./aksi.php?module=kategori_barang&act=input'>
              <table>
                <tr><td>Tambah Kategori</td><td> : <input type=text name='namaKategoriBarang' size=30></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
              </table>
               </form>
              <br/>
              <h2>Data Kategori Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>Kategori</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from kategori_barang");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaKategoriBarang]</td>
                         <td class=td><a href=?module=kategori_barang&act=editkategori&id=$r[idKategoriBarang]>Edit</a> |
                                   <a href=./aksi.php?module=kategori_barang&act=hapus&id=$r[idKategoriBarang]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>
                <p>&nbsp;</p>
                <a href=javascript:history.go(-1)><< Kembali</a>";
        break;

    case "editkategori":
        $edit = mysql_query("select * from kategori_barang where idKategoriBarang = '$_GET[id]'");
        $data = mysql_fetch_array($edit);
        echo "<h2>Edit Kategori Barang</h2>
            <form method=POST action='./aksi.php?module=kategori_barang&act=update' name='editkategori'>
              <input type=hidden name='idKategoriBarang' value='$data[idKategoriBarang]'>
              <table>
                <tr><td>Edit Kategori</td><td> : <input type=text name='namaKategoriBarang' size=30 value='$data[namaKategoriBarang]'></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=button value=Batal onclick=self.history.back()></td></tr>
              </table>
               </form>
            <br/>
              <h2>Data Kategori Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>kategori</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from kategori_barang");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaKategoriBarang]</td>
                         <td class=td><a href=?module=kategori_barang&act=editkategori&id=$r[idKategoriBarang]>Edit</a> |
                                   <a href=./aksi.php?module=kategori_barang&act=hapus&id=$r[idKategoriBarang]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>";
        break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_manage_workstation.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/



include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));

session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}

else{

        if(!isset($_SESSION[idCustomer])){
           findCustomer($_POST[idCustomer]);
        }


	//HS javascript untuk menampilkan popup
?>	
	<head>

	<SCRIPT TYPE="text/javascript">


	function CalculatePrinterCommands() {
		var ip_address 		= document.getElementById("workstation_address").value;
		var printer_type 	= document.getElementById("printer_type").value;

		if (printer_type == 'rlpr') {

			printer_commands = '-H '+ip_address+' -P printer'+ip_address;
			document.getElementById("printer_commands").value = printer_commands;
		}
	}

	-->
	</SCRIPT>

	
 	<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css' />

	</head>


<?php

switch($_GET[act]){	

  default:
    echo "<h2>Data Workstation</h2>            
          <form method=POST action='?module=workstation&act=tambahworkstation'>
          <input type=submit value='Tambah Workstation'></form>
          <br/>
          <table class=tableku>
          <tr><th>no</th><th>ID Wks</th><th>Nama Workstation</th><th>Keterangan</th><th>aksi</th></tr>";
    $tampil=mysql_query("SELECT idWorkstation,namaWorkstation,keterangan FROM workstation ORDER BY namaWorkstation");

    $no=1;
    while ($r=mysql_fetch_array($tampil)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=center class=td>$no</td>
             <td align=center class=td>$r[idWorkstation]</td>
             <td class=td>$r[namaWorkstation]</td>
             <td align=center class=td>$r[keterangan]</td>
             <td class=td><a href=?module=workstation&act=editworkstation&id=$r[idWorkstation]>Edit</a> |
	               Ha<a href=./aksi.php?module=workstation&act=hapus&id=$r[idWorkstation]>pus</a>
             </td></tr>";
      $no++;
    }
    echo "</table>
    <p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;



  case "tambahworkstation": // =============================================================================================================
    echo "<h2>Tambah Workstation</h2>
          <form method=POST action='./aksi.php?module=workstation&act=input' name='tambahwks'>
          <table>
          <tr><td>Nama Workstation</td><td> : <input type=text name='namaWorkstation' size=30></td></tr>
          <tr><td>Keterangan</td><td> : <input type=text name='keterangan' size=30></td></tr>
          <tr><td>IP address</td><td> : <input type=text name='workstation_address' id='workstation_address' size=30 value='10.1.1.1'></td></tr>

	<tr><td>Jenis Printer</td><td> : <select name='printer_type' id='printer_type' onBlur='CalculatePrinterCommands()'>
		<option value='pdf' selected>PDF : paling kompatibel</option>
		<option value='rlpr'>Remote LPR : khusus untuk komputer Unix / Linux</option>
		</select>
	</td></tr>

          <tr><td>Printer Commands<br />(auto-generated)</td><td> : <input type=text name='printer_commands' id='printer_commands' size=30 readonly></td></tr>
	";

            echo "
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>
		";
     break;



  case "editworkstation": // ======================================================================================================================
    $edit=mysql_query("SELECT * FROM workstation WHERE idWorkstation='$_GET[id]'");
    $data=mysql_fetch_array($edit);

    echo "<h2>Edit Workstation</h2>
          <form method=POST action=./aksi.php?module=workstation&act=update name='editworkstation'>
          <input type=hidden name='idWorkstation' value='$data[idWorkstation]'>

          <table>
          <tr><td>Nama Workstation</td><td> : <input type=text name='namaWorkstation' value='$data[namaWorkstation]' size=30></td></tr>
          <tr><td>Keterangan</td><td> : <input type=text name='keterangan' value='$data[keterangan]' size=30></td></tr>
          <tr><td>IP address</td><td> : <input type=text name='workstation_address' id='workstation_address' value='$data[workstation_address]'size=30 value='10.1.1.1'></td></tr>

	<tr><td>Jenis Printer</td><td> : <select name='printer_type' id='printer_type' onBlur='CalculatePrinterCommands()'>
		<option value='pdf' selected>PDF : paling kompatibel</option>
		<option value='rlpr'>Remote LPR : khusus untuk komputer Unix / Linux</option>
		</select>
	</td></tr>

          <tr><td>Printer Commands<br />(auto-generated)</td><td> : <input type=text name='printer_commands' id='printer_commands' value='$data[printer_commands]' size=30 readonly></td></tr>
	";

            echo "
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
    break;
}

} // if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser]))



/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_modul.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


$ambilLevelUser = mysql_query("select * from leveluser");

switch($_GET[act]){
  // Tampil Modul
  default:
    echo "<h2>Data Modul</h2>
          <form method=POST action='?module=modul&act=tambahmodul'>
          <input type=submit value='Tambah Modul'></form>
          <br/>
          <table class=tableku>
          <tr><th>No</th><th>nama modul</th><th>link</th><th>publish</th><th>pejabat</th><th>aksi</th></tr>";
    $tampil=mysql_query("SELECT idModul,namaModul,link,publish,levelUser,urutan
                            FROM modul m, leveluser lu
                            WHERE m.idLevelUser = lu.idLevelUser
                            ORDER BY urutan");
    $no=1;
    while ($r=mysql_fetch_array($tampil)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
        echo "<tr bgcolor=$warna>";//end warna
      echo "<td class=td>$no</td>
            <td class=td>$r[namaModul]</td>
            <td class=td><a href=$r[link]>$r[link]</a></td>
            <td align=center class=td>$r[publish]</td>
            <td align=center class=td>$r[levelUser]</td>
            <td class=td><a href=?module=modul&act=editmodul&id=$r[idModul]>Edit</a> |
	              <a href=./aksi.php?module=modul&act=hapus&id=$r[idModul]>Hapus</a>
            </td></tr>";

       $no++;
    }
    echo "</table><p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;

  case "tambahmodul":
    echo "<h2>Tambah Modul</h2>
          <form method=POST action='./aksi.php?module=modul&act=input'>
          <table>
          <tr><td>Nama Modul</td> <td> : <input type=text name='namaModul' size=30></td></tr>
          <tr><td>Link</td>       <td> : <input type=text name='link' size=30 value='?module='></td></tr>
          <tr><td>Publish</td>    <td> : <input type=radio name='publish' value='Y' checked>Y
                                         <input type=radio name='publish' value='N'>N  </td></tr>
          <tr><td>Pejabat</td>
                <td> : <select name='levelUser'>
                            <option value='0'>- Jabatan User-</option>";
                            while($level = mysql_fetch_array($ambilLevelUser)){
                                echo "<option value='$level[idLevelUser]'>$level[levelUser]</option>";
                            }
            echo "</select></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align=right><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
     break;

  case "editmodul":
    $edit = mysql_query("SELECT * FROM modul WHERE idModul = '$_GET[id]'");
    $data    = mysql_fetch_array($edit);

    echo "<h2>Edit Modul</h2>
          <form method=POST action=./aksi.php?module=modul&act=update>
          <input type=hidden name='idModul' value='$data[idModul]'>
          <table>
          <tr><td>Nama Modul</td>     <td> : <input type=text name='namaModul' value='$data[namaModul]'></td></tr>
          <tr><td>Link</td>     <td> : <input type=text name='link' size=30 value='$data[link]'></td></tr>";
    if ($data[publish]=='Y'){
      echo "<tr><td>Publish</td> <td> : <input type=radio name='publish' value='Y' checked>Y
                                        <input type=radio name='publish' value='N'> N</td></tr>";
    }
    else{
      echo "<tr><td>Publish</td> <td> : <input type=radio name='publish' value='Y'>Y
                                        <input type=radio name='publish' value='N' checked>N</td></tr>";
    }
    echo "<tr><td>Jabatan User</td>
                <td> : <select name='levelUser'>
                            ";
                            while($level = mysql_fetch_array($ambilLevelUser)){
                                if($level[idLevelUser] == $data[idLevelUser]){
                                    echo "<option value='$level[idLevelUser]' selected>$level[levelUser]</option>";
                                }
                                else{
                                    echo "<option value='$level[idLevelUser]'>$level[levelUser]</option>";
                                }
                            }
            echo "</select></td></tr>
    <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2><input type=submit value=Update>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
    break;
}

/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */
?>
<?php
/* mod_kasir.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


        echo "<h2>Manajemen Kasir</h2>

		<table>
		<tr>

		<td>
			<form method=POST action='?module=kasir&act=bukakasir'>
			<input type=submit value='(b) Buka Kasir' accesskey='b'>
			</form>
		</td>

		<td>
			<form method=POST action='?module=kasir&act=tutupkasir'>
			<input type=submit value='(t) Tutup Kasir' accesskey='t'>
			</form>
		</td>

		<td>
			<form method=POST action='?module=kasir&act=tambahdana'>
			<input type=submit value='(p) Penambahan Dana' accesskey='p'>
			</form>
		</td>

		<td>
			<form method=POST action='?module=kasir&act=pettycash'>
			<input type=submit value='(c) Petty Cash' accesskey='c'>
			</form>
		</td>

		</tr>
		</table>";



switch($_GET[act]){ //------------------------------------------------------------------------

    default:

	echo "
              <br/>
              <h2>Kasir Aktif</h2>
              <table class=tableku>
              <tr><th>Nama</th><th>Workstation</th><th>Sejak</th><th>Kas Awal</th></tr>";

		$sql = "SELECT k.tglBukaKasir, k.kasAwal, w.namaWorkstation, u.namaUser FROM kasir AS k, user AS u, workstation AS w 
			WHERE k.tglTutupKasir IS NULL 
				AND k.currentWorkstation = w.idWorkstation AND k.idUser = u.idUser";

                $tampil=mysql_query($sql);
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "
			<td class=td>$r[namaUser]</td>
			<td class=td>$r[namaWorkstation]</td>
			<td class=td>".date("l, d-F-Y, H:i", strtotime($r[tglBukaKasir]))."</td>
			<td class=td>$r[kasAwal]</td>
			</tr>";
                  $no++;
                }
                echo "</table>
                <p>&nbsp;</p>
                <a href=javascript:history.go(-1)><< Kembali</a>";
        break;



    case "bukakasir":  // ===========================================================================================================


	echo "<h2>Buka Kasir</h2>";

	// ambil daftar nama kasir
	// idLevelUser : 4 = kasir
	$sql="SELECT namaUser, idUser  
		FROM user   
		WHERE idLevelUser = 4 ORDER BY namaUser ASC";
	$namaKasir=mysql_query($sql);

	// ambil daftar workstation
	$sql="SELECT idWorkstation, namaWorkstation   
		FROM workstation ORDER BY namaWorkstation ASC";
	$namaWorkstation=mysql_query($sql);

	echo "
	<form method=POST action='./aksi.php?module=buka_kasir&act=input'>
	
	<table>
        <tr>
		<td>Tanggal / Waktu </td>
		<td>: <input type=text readonly='readonly' name='tglBukaKasir' value='".date("Y-m-d H:i:s")."'></td>
	</tr>
        <tr>
		<td>(k) Pilih Kasir </td>
		<td>: <select name='idKasir' accesskey='k'>";
	while($kasir = mysql_fetch_array($namaKasir)){
		echo "<option value='$kasir[idUser]'>$kasir[namaUser]</option>\n";
	}	

	echo "
		</td>
	</tr>
        <tr>
		<td>Pilih Workstation </td>
		<td>: <select name='idWorkstation'>";
	while($wks = mysql_fetch_array($namaWorkstation)){
		echo "<option value='$wks[idWorkstation]'>$wks[namaWorkstation]</option>\n";
	}	

	echo "
		</td>
	</tr>
        <tr><td>Uang Kasir</td><td>: <input type=text name=kasAwal></td></tr>
        <tr><td colspan=2>&nbsp;</td></tr>
        <tr><td colspan=2><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
    </table>
 </form>
	";

	break;



    case "tutupkasir":  // ===========================================================================================================

	echo "<h2>Tutup Kasir</h2>";

	// ambil nama kasir
	$sql="SELECT u.namaUser, k.idUser 
		FROM kasir AS k, user AS u  
		WHERE k.tglTutupKasir IS NULL
			AND k.idUser = u.idUser ORDER BY u.namaUser ASC";
	$namaKasir=mysql_query($sql);
	
	echo "
	<form method=POST action='./media.php?module=kasir&act=tutupkasir2'>
	
	<table>
        <tr>
		<td>(k) Pilih Kasir </td>
		<td>: <select name='idKasir' accesskey='k'>";
	while($kasir = mysql_fetch_array($namaKasir)){
		echo "<option value='$kasir[idUser]'>$kasir[namaUser]</option>\n";
	}	

	echo "
		</td></tr>
        <tr><td colspan=2><input type=submit value='Pilih'></td></tr>
    </table>
 </form>
	";

	break;


    case "tutupkasir2":  // ===========================================================================================================

	echo "<h2>Tutup Kasir</h2>";

	// cari kasAwal
	$sql = "SELECT k.kasAwal,k.tglBukaKasir,u.uname FROM kasir AS k, user AS u 
			WHERE k.idUser = $_POST[idKasir] AND tglTutupKasir IS NULL AND k.idUser = u.idUser";
	$hasil = mysql_query($sql);
	$x = mysql_fetch_array($hasil);

	$kasAwal 	= $x[kasAwal];
	$tglBukaKasir 	= $x[tglBukaKasir];
	$tglTutupKasir 	= date("Y-m-d H:i:s");
	$username 	= $x[uname];

	// hitung TotalTransaksi
	$totalTransaksi = 0;
	$sql = "SELECT sum(nominal) AS tot_trans FROM transaksijual 
			WHERE idUser=$_POST[idKasir] AND tglTransaksiJual BETWEEN '$tglBukaKasir' AND '$tglTutupKasir'";
	$hasil = mysql_query($sql);
	if ($x = mysql_fetch_array($hasil)) { $totalTransaksi = $x[tot_trans]; };

	// hitung total profit
	$totalProfit = 0;
	$sql = "SELECT sum(d.hargaJual - b.hargaBeli) AS tot_profit FROM detail_jual AS d, transaksijual AS t, detail_beli AS b     
			WHERE d.username='$username' AND t.tglTransaksiJual BETWEEN '$tglBukaKasir' AND '$tglTutupKasir'
				AND d.nomorStruk = t.idTransaksiJual AND d.barcode = b.barcode";
	//echo "(".$sql.")<br />";
	$hasil = mysql_query($sql);
	if ($x = mysql_fetch_array($hasil)) { $totalProfit = $x[tot_profit]; };

	//fixme: hitung total Retur
	$totalRetur = 0; 

	//fixme: hitung total transaksi petty cash
	$totalTransaksiKas = 0;

	//fixme: hitung total transaksi debit / credit
	$totalTransaksiKartu = 0;

	// hitung kasSeharusnya 
	$kasSeharusnya = $kasAwal + $totalTransaksi + $totalTransaksiKas - $totalRetur - $totalTransaksiKartu;

	echo "
	<form method=POST action='./aksi.php?module=tutup_kasir&act=input'>
	<input type=hidden name=idKasir value='$_POST[idKasir]'>

	<table>
	<tr>	<td>Tanggal / Waktu </td>
		<td> : <input type=text readonly='readonly' name='tglTutupKasir' value='".date("Y-m-d H:i:s")."'></td></tr>
	<tr><td>Kas Awal</td><td> : <input type=text readonly='readonly' name='kasAwal' value='$kasAwal'></td><tr>
        <tr><td>Total Transaksi</td><td> : <input type=text readonly='readonly' name='totalTransaksi' value='$totalTransaksi'></td><tr>
        <tr><td>Total Profit</td><td> : <input type=text readonly='readonly' name='totalProfit' value='$totalProfit'></td><tr>
        <tr><td>Total Retur</td><td> : <input type=text readonly='readonly' name='totalRetur' value='$totalRetur'></td><tr>
        <tr><td>Total Transaksi Kas</td><td> : <input type=text readonly='readonly' name='totalTransaksiKas' value='$totalTransaksiKas'></td><tr>
        <tr><td>Total Transaksi Kartu Kredit/Debit</td><td> : <input type=text readonly='readonly' name='totalTransaksiKartu' value='$totalTransaksiKartu'></td><tr>
        <tr><td>Uang Seharusnya</td><td> : <input type=text readonly='readonly' name='kasSeharusnya' value='$kasSeharusnya'></td><tr>
        <tr><td>Uang Kasir</td><td> : <input type=text name=kasAkhir></td><tr>
        <tr><td colspan=2>&nbsp;</td></tr>
        <tr><td colspan=2><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
    </table>
 </form>
";

	break;



    case "tambahdana":  // ===========================================================================================================

	//fixme : selesaikan modul
	// transaksi disimpan di tabel transaksikasir

	echo "
		<h2>Tambah Dana Kasir</h2>

		Gunakan form ini untuk dropping dana kepada Kasir yang sedang bertugas.
		";

	break;



    case "pettycash":  // ===========================================================================================================

	//fixme : selesaikan modul
	// transaksi disimpan di tabel transaksikasir

	echo "
		<h2>Petty Cash</h2>

		Gunakan form ini jika ada pengambilan uang Kas dari Kasir yang sedang bertugas.
		";

	break;











        $edit = mysql_query("select * from rak where idRak = '$_GET[id]'");
        $data = mysql_fetch_array($edit);
        echo "<h2>Edit Rak Barang</h2>
            <form method=POST action='./aksi.php?module=rak&act=update' name='editrak'>
              <input type=hidden name='idRak' value='$data[idRak]'>
              <table>
                <tr><td>Edit Rak</td><td> : <input type=text name='namaRak' size=30 value='$data[namaRak]'></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=button value=Batal onclick=self.history.back()></td></tr>
              </table>
               </form>
            <br/>
              <h2>Data Rak Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>rak</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from rak");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaRak]</td>
                         <td class=td><a href=?module=rak&act=editrak&id=$r[idRak]>Edit</a> |
                                   <a href=./aksi.php?module=rak&act=hapus&id=$r[idRak]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>";
        break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.1 / 2010-02-27 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
 <?php
/* mod_laporan.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../../config/config.php";
// check_user_access(basename($_SERVER['SCRIPT_NAME']));

echo "
	<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css' />

        <SCRIPT TYPE='text/javascript'>
        <!--
        function popupform(myform, windowname)
        {
                if (! window.focus)return true;
                window.open('', windowname, 'type=fullWindow,fullscreen,scrollbars=yes');
                myform.target=windowname;
                return true;
        }
        //-->
        </SCRIPT>
	";




switch($_GET[act]){ //------------------------------------------------------------------------

    default:

        echo "<h2>Laporan Manajemen</h2>

		<table>
		<tr>

		<td>
			<form method=POST action='?module=laporan&act=penjualan1'>
			<input type=submit value='(j) Laporan Penjualan' accesskey='j'>
			</form>
		</td>

		<td>
			<form method=POST action='?module=laporan&act=pembelian1'>
			<input type=submit value='(b) Laporan Pembelian' accesskey='b'>
			</form>
		</td>

		<td>
			<form method=POST action='?module=laporan&act=total1'>
			<input type=submit value='(t) Total Stok' accesskey='t'>
			</form>
		</td>

		</tr>

		<tr>
	
			<td>
			<form method=POST action='?module=laporan&act=toprank1'>
			<input type=submit value='(r) Top Rank' accesskey='r'>
			</form>
			</td>

	
			<td>
			<form method=POST action='?module=laporan&act=aging1'>
			<input type=submit value='(a) Aging' accesskey='a'>
			</form>
			</td>

		</tr>
		</table>

	";

        break;



    case "penjualan1":  // ===========================================================================================================


	echo "<h2>Laporan Penjualan</h2>";

	// ambil daftar nama kasir
	// idLevelUser : 4 = kasir
	$sql="SELECT namaUser, idUser  
		FROM user   
		WHERE idLevelUser = 4 ORDER BY namaUser ASC";
	$namaKasir=mysql_query($sql);


	echo "
	<form method=GET action='?module=laporan'>

		<input type=hidden name=module value=laporan>
		<input type=hidden name=act value=penjualan2>
	
	<table>
        <tr>
		<td>(d) Dari Tanggal </td>
		<td>: <input type=text name='DariTanggal' value='".date("Y-m-d 00:00:00")."' accesskey='d'></td>
	</tr>
        <tr>
		<td>Sampai Tanggal </td>
		<td>: <input type=text name='SampaiTanggal' value='".date("Y-m-d 23:59:59")."'></td>
	</tr>
        <tr>
		<td>Pilih Kasir </td>
		<td>: <select name='idKasir'> <option value='SEMUA' selected>SEMUA</option>";
	while($kasir = mysql_fetch_array($namaKasir)){
		echo "<option value='$kasir[idUser]'>$kasir[namaUser]</option>\n";
	}	

	echo "
		</td>
	</tr>

        <tr><td colspan=2>&nbsp;</td></tr>
        <tr><td colspan=2><input type=submit value='Buat Laporan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
    </table>
 </form>


	";

	break;



    case "penjualan2":  // ===========================================================================================================


	// ambil daftar nama kasir
	if ($_GET[idKasir]=='SEMUA') {
		$x[namaUser] = 'SEMUA';
	} else {
		$sql="SELECT namaUser FROM user WHERE idUser = $_GET[idKasir]";
		$hasil=mysql_query($sql); $x = mysql_fetch_array($hasil);
	}

	echo "
              <br/>
              <h2>Laporan Penjualan</h2>

		<h3>Kasir: $x[namaUser], Dari: $_GET[DariTanggal], Sampai: $_GET[SampaiTanggal]</h3>

              <table class=tableku>
              <tr><th>No.Struk</th><th>Waktu</th><th>Total Transaksi</th><th>Aksi</th><th>Hapus?</th></tr>";

		if ($_GET[idKasir]=='SEMUA') {
			$sql = "SELECT t.idTransaksiJual, t.tglTransaksiJual, t.nominal   
				FROM transaksijual AS t
				WHERE t.tglTransaksiJual BETWEEN '$_GET[DariTanggal]' AND '$_GET[SampaiTanggal]'  
 					ORDER BY t.idTransaksiJual ASC";
		} else {
			$sql = "SELECT t.idTransaksiJual, t.tglTransaksiJual, t.nominal 
				FROM transaksijual AS t
				WHERE t.idUser = $_GET[idKasir] 
					AND t.tglTransaksiJual BETWEEN '$_GET[DariTanggal]' AND '$_GET[SampaiTanggal]' ORDER BY t.idTransaksiJual ASC";
		}
                $tampil=mysql_query($sql);

                $no=1;
		$total_transaksi = 0;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                   echo "
			<td class=td><center> 		$r[idTransaksiJual] </center></td>
			<td class=td><center> 		".date("H:i:s", strtotime($r[tglTransaksiJual]))." </center></td>

			<td class=td align=right> 	".number_format($r[nominal],0,',','.')."</td>
			<td class=td>	<a href='?module=laporan&act=aksi&action=cetakjual1&id=$r[idTransaksiJual]&kasir=$x[namaUser]'>Cetak</a> | 
					<a href='?module=laporan&act=aksi&action=lihatjual&id=$r[idTransaksiJual]&kasir=$x[namaUser]'>Lihat</a></td>
			<td class=td align=right> Ha<a href='?module=laporan&act=aksi&action=hapusjual&id=$r[idTransaksiJual]&idKasir=$_GET[idKasir]&DariTanggal=$_GET[DariTanggal]&SampaiTanggal=$_GET[SampaiTanggal]'>p</a>us</td>
			</tr>";

			//fixme: tampilkan juga profit dari setiap invoice

			$total_transaksi = $total_transaksi + $r[nominal];
			$no++;
                }


		// hitung profit
		if ($_GET[idKasir]=='SEMUA') {
			$sql = "SELECT SUM((d.hargaJual - d.hargaBeli) * jumBarang) AS profit  
				FROM transaksijual AS t, detail_jual AS d 
				WHERE t.tglTransaksiJual BETWEEN '$_GET[DariTanggal]' AND '$_GET[SampaiTanggal]' AND t.idTransaksiJual=d.nomorStruk 
 					ORDER BY t.idTransaksiJual ASC";
		} else {
			$sql = "SELECT SUM((d.hargaJual - d.hargaBeli) * jumBarang) AS profit 
				FROM transaksijual AS t, detail_jual AS d 
				WHERE t.idUser = $_GET[idKasir] AND t.idTransaksiJual=d.nomorStruk 
				AND t.tglTransaksiJual BETWEEN '$_GET[DariTanggal]' AND '$_POST[SampaiTanggal]' ORDER BY t.idTransaksiJual ASC";
		};
                $tampil=mysql_query($sql);
                $r=mysql_fetch_array($tampil);	
		$total_profit = 0;
		$total_profit = $total_profit + $r[profit];

                echo "</table>

			<h2>Total Transaksi: ".number_format($total_transaksi,0,',','.')."</h2>
			<h2>Total Profit: ".number_format($total_profit,0,',','.')."</h2>

                	<p>&nbsp;</p>	
	                <a href=javascript:history.go(-1)><< Kembali</a>

		";

        break;



    case "aksi":  // ===========================================================================================================

	
	if ($_GET[action] == 'hapusjual') { // ---------------------------------------------------------------------------------

		// cek transaksi jualnya
		$sql	= "SELECT idBarang, barcode, jumBarang, hargaJual FROM detail_jual WHERE nomorStruk = $_GET[id]";
		$hasil	= mysql_query($sql);

		$grandtotal = 0;
		while ($x = mysql_fetch_array($hasil)) {

		$grandtotal = $grandtotal + ($x[jumBarang] * $x[hargaJual]);

		// kembalikan jumlah stok sebelumnya di tabel barang
			// cari jumlah saat ini di table barang
			$sql	= "SELECT jumBarang FROM barang WHERE barcode='".$x[barcode]."'";
			$hasil1	= mysql_query($sql);
			$x1	= mysql_fetch_array($hasil1);

			$jumlahbaru	= $x1[jumBarang] + $x[jumBarang];
			// simpan jumlah yang baru
			$sql	= "UPDATE barang SET jumBarang=$jumlahbaru WHERE barcode='".$x[barcode]."'";
			$hasil1 = mysql_query($sql);

		// kembalikan jumlah stok sebelumnya di tabel detail_beli
			// cari jumlah saat ini di table barang
			$BarangHabis	= false;
			$sql	= "SELECT jumBarang FROM detail_beli WHERE barcode='".$x[barcode]."' 
					AND isSold='N' AND idBarang=".$x[idBarang]."
					ORDER BY idDetailBeli ASC";
			$hasil2	= mysql_query($sql);

			// kalau tidak ada yang ketemu, cari lagi - kali ini isSold = 'Y'
			if (mysql_num_rows($hasil2) < 1) { 
				$sql	= "SELECT jumBarang FROM detail_beli WHERE barcode='".$x[barcode]."' 
						AND isSold='Y' AND idBarang=".$x[idBarang]." 
						ORDER BY idDetailBeli DESC";
				$hasil2	= mysql_query($sql);
				$BarangHabis	= true;
			};
			$x2	= mysql_fetch_array($hasil2);

			$jumlahbaru	= $x2[jumBarang] + $x[jumBarang];
			// simpan jumlah yang baru
			if ($BarangHabis) {
				$sql	= "UPDATE detail_beli SET jumBarang=$jumlahbaru, isSold='N' WHERE idBarang='".$x[idBarang]."'";
			} else {
				$sql	= "UPDATE detail_beli SET jumBarang=$jumlahbaru WHERE idBarang='".$x[idBarang]."'";
			};
			$hasil1 = mysql_query($sql);

		}; // while ($x = mysql_fetch_array($hasil))

		// simpan audit trail nya
		$sql = "INSERT INTO audit (jenisTransaksi, username, tglTransaksi, 
				nomorStruk, nominalStruk) 
			VALUES ('returnotajual', '$_SESSION[uname]', '".date("Y-m-d H:i:s")."',
				 $_GET[id], $grandtotal)";
		$hasil 	= mysql_query($sql) or die(mysql_error());


		// hapus di transaksi_jual
		$sql = "DELETE FROM transaksijual WHERE idTransaksiJual = $_GET[id]";
		$hasil 	= mysql_query($sql) or die(mysql_error());

		// hapus juga seluruh transaksinya di detail_jual
		$sql = "DELETE FROM detail_jual WHERE nomorStruk = $_GET[id]";
		$hasil 	= mysql_query($sql) or die(mysql_error());

		// module=laporan&act=penjualan2&DariTanggal=2010-08-02+00%3A00%3A00&SampaiTanggal=2010-08-02+23%3A59%3A59&idKasir=SEMUA
		header("location:media.php?module=laporan&act=penjualan2&DariTanggal=$_GET[DariTanggal]&SampaiTanggal=$_GET[SampaiTanggal]&idKasir=$_GET[idKasir]");


	}

	if ($_GET[action] == 'cetakjual1') { // ---------------------------------------------------------------------------------

		// pilih printer
		$sql 	= "SELECT namaWorkstation,printer_commands,workstation_address FROM workstation ";
		$hasil 	= mysql_query($sql) or die(mysql_error());

		echo "
			<form method=POST action='?module=laporan&act=aksi&action=cetakjual2'>
	
		<table>
        	<tr>
			<td>Pilih Printer </td>
			<td>: <select name='namaPrinter'>";
		
		while($printer = mysql_fetch_array($hasil)){
			echo "<option value='$printer[printer_commands]'>$printer[namaWorkstation]</option>\n";
		}	

		echo "
			</td>
			</tr>

        		<tr><td colspan=2>&nbsp;</td></tr>
        		<tr><td colspan=2><input type=submit value='Pilih Printer'>&nbsp;&nbsp;&nbsp;
        	                        <input type=reset value='Batal'></td></tr>
			</table>
			
			<input type=hidden name=idTransaksi value='$_GET[id]'>
			<input type=hidden name=namaKasir value='$_GET[kasir]'>

			</form>
		";

		// tampilkan link untuk kembali
		echo "<br /><br />    <a href=javascript:history.go(-1)><< Kembali</a>";

	} // if ($_GET[action] == 'cetakjual1')



	if ($_GET[action] == 'cetakjual2') { // ---------------------------------------------------------------------------------

		// ambil info struk ybs
		$sql = "SELECT nominal,uangDibayar FROM transaksijual WHERE idTransaksiJual=$_POST[idTransaksi]";
		//echo $sql;
		$hasil 	= mysql_query($sql); $x = mysql_fetch_array($hasil);
		$totalTransaksi = $x[nominal];
		$uangDibayar	= $x[uangDibayar];

		// ambil transaksi yang akan dicetak
		$sql = "SELECT t.jumBarang,t.hargaJual,b.namaBarang FROM barang AS b, detail_jual AS t
			WHERE t.nomorStruk='$_POST[idTransaksi]' AND t.barcode=b.barcode";
		//echo $sql;
		$hasil 	= mysql_query($sql);
		
		// cetak struk
		cetakStruk ("$_POST[namaPrinter]", $_POST[idTransaksi], "$_POST[namaKasir]", $totalTransaksi, $uangDibayar, $hasil);
		
		// tampilkan link untuk kembali
		echo "<br /><br />    <a href=javascript:history.go(-1)><< Kembali</a>";
	}


	if ($_GET[action] == 'lihatjual') { // ---------------------------------------------------------------------------------

		if ($_GET[kasir]=='SEMUA') {
			$namaKasir='SEMUA';
		} else {
			$namaKasir=$_GET[kasir];
		}

	echo "
              <br/>
              <h2>Detail Penjualan</h2>

		<h3>Kasir: $namaKasir, No.Struk: $_GET[id]</h3>

              <table class=tableku>
              <tr><th>Barcode</th><th>Nama Barang</th><th>Harga Jual</th><th>Harga Beli</th><th>Jumlah</th><th>Total</th></tr>";

		$sql = "SELECT d.barcode, b.namaBarang, d.hargaJual, d.hargaBeli, d.jumBarang 
				FROM detail_jual AS d, barang AS b 
				WHERE d.nomorStruk = $_GET[id] AND d.barcode = b.barcode";
                $tampil=mysql_query($sql);

                $no=1;
		$total_transaksi= 0;
		$total_profit 	= 0;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                   echo "
			<td class=td> 		$r[barcode]	</td>
			<td class=td> 		$r[namaBarang]	</td>
			<td class=td align=right>	".number_format($r[hargaJual],0,',','.')." </td>
			<td class=td align=right>	".number_format($r[hargaBeli],0,',','.')." </td>
			<td class=td align=right>	".number_format($r[jumBarang],0,',','.')." </td>
			<td class=td align=right>	".number_format(($r[hargaJual] * $r[jumBarang]),0,',','.')." </center></td>

			</tr>";

			$total_transaksi = $total_transaksi + ($r[hargaJual] * $r[jumBarang]);
			$total_profit = $total_profit + (($r[hargaJual] - $r[hargaBeli]) * $r[jumBarang]);
			$no++;
                }

                echo "</table>

			<h3>Total Transaksi: ".number_format($total_transaksi,0,',','.')."</h3>
			<h3>Total Profit: ".number_format($total_profit,0,',','.')."</h3>

                	<p>&nbsp;</p>
	                <a href=javascript:history.go(-1)><< Kembali</a>
		";


	}

	break;


  case 'total1': { // ---------------------------------------------------------------------------------

	echo "
              <br/>
              <h2>Laporan Total Stok</h2>

		";

//	Ini salah, karena kalau ada 1 saja record barang yang sudah sold-out / isSold='Y' 
// 	-- maka seluruh barang tersebut jadi tidak dihitung lagi stoknya
//	Biarkan penentu keberadaan stok adalah field jumBarang di table barang
//		$sql	= "SELECT SUM(b.jumBarang * d.hargaBeli) AS TotalStok 
//			FROM barang AS b, (SELECT barcode, hargaBeli FROM detail_beli WHERE isSold='N' AND hargaBeli > 0 GROUP BY barcode) AS d 
//			WHERE b.jumBarang > 0 AND b.barcode = d.barcode";		

/*		// query ini mengambil hargaBeli yang paling pertama / lama
		$sql	= "SELECT SUM(b.jumBarang * d.hargaBeli) AS TotalStok 
			FROM barang AS b, (SELECT barcode, hargaBeli FROM detail_beli WHERE hargaBeli > 0 GROUP BY barcode) AS d 
			WHERE b.jumBarang > 0 AND b.barcode = d.barcode";		
*/

		// query ini mengambil hargaBeli yang terbaru
		$sql	= "SELECT SUM(b.jumBarang * d.hargaBeli) AS TotalStok 
			FROM barang AS b, 
			(SELECT barcode, hargaBeli FROM 
				(SELECT barcode, hargaBeli, idTransaksiBeli 
				 FROM detail_beli WHERE hargaBeli > 0 ORDER BY idTransaksiBeli DESC) AS d1 
			GROUP BY barcode) AS d 
			WHERE b.jumBarang > 0 AND b.barcode = d.barcode";		

		$tampil	= mysql_query($sql);
		$x 	= mysql_fetch_array($tampil);

                echo "Total Stok Saat Ini = Rp ".number_format($x[TotalStok],0,',','.')." 

                	<p>&nbsp;</p>	
	                <a href=javascript:history.go(-1)><< Kembali</a>

		";

        exit;

	}


  case 'toprank1': { // ---------------------------------------------------------------------------------

	$tanggal = date('Y-m-d');
	echo "
              <br/>
              <h2>Laporan Top Rank</h2>

			<form method=POST action='modul/mod_laporan.php?act=toprank2' onSubmit=\"popupform(this, 'top-rank')\">
	
		<table>
        	<tr>
			<td>Dari Tanggal </td>
			<td>: <input type=text name=dari value='$tanggal'>
			</td>
		</tr>

        	<tr>
			<td>Sampai Tanggal </td>
			<td>: <input type=text name=sampai value='$tanggal'>
			</td>
		</tr>

        	<tr>
			<td>Kategori </td>
			<td>: 	<select name='kategori'> 
				<option value='SEMUA' selected>SEMUA</option>";
		$hasil	= mysql_query("SELECT idKategoriBarang, namaKategoriBarang FROM kategori_barang");
		while ($x = mysql_fetch_array($hasil)) {
			echo "<option value='".$x['idKategoriBarang']."'>".$x['namaKategoriBarang']."</option>";
		};

		echo "		</select>
			</td>
		</tr>

        	<tr>
			<td>Jumlah Item </td>
			<td>: <input type=text name=jumlah value='200'>
			</td>
		</tr>

        	<tr>
			<td>Sortir berdasarkan</td>
			<td>: 	<select name='sortir'> 
				<option value='jumlah' selected>jumlah</option>
				<option value='omset' >		omset</option>
				<option value='profit'>		profit</option>
				</select>
			</td>
		</tr>


        		<tr><td colspan=2><input type=submit value='Buat Laporan'></td></tr>
		</table>
			
		</form>

		";
	exit;
	}

  case 'toprank2': { // ---------------------------------------------------------------------------------

	if ($_POST['kategori'] == 'SEMUA') {
		$kategori = 'SEMUA'; 
	} else {
		$hasil 	= mysql_query("SELECT namaKategoriBarang FROM kategori_barang WHERE idKategoriBarang=".$_POST['kategori']);
		$x	= mysql_fetch_array($hasil);
		$kategori = $x['namaKategoriBarang'];
	};

	if ($_POST['kategori'] == 'SEMUA') { 
		$idKategoriBarang = '';	
	} else {
		$idKategoriBarang = 'AND b.idKategoriBarang = '.$_POST['kategori'];	
	};

	$sortir = $_POST['sortir'];
	$sql	= "SELECT lb.barcode, lb.namaBarang, COUNT(lb.barcode) AS jumlah, SUM(lb.hargaJual) AS omset, 
			SUM(lb.hargaJual - lb.hargaBeli) AS profit
		FROM 	(SELECT dj.barcode AS barcode, b.namaBarang AS namaBarang, dj.hargaJual, dj.hargaBeli, b.idKategoriBarang  
      			FROM barang AS b, 
             			(SELECT barcode, hargaJual, hargaBeli FROM detail_jual AS j, 
                    			(SELECT idTransaksiJual AS nomorStruk FROM transaksijual 
                    			WHERE tglTransaksiJual BETWEEN '".$_POST['dari']." 00:00:01' AND '".$_POST['sampai']." 23:59:59') AS t
             			WHERE j.nomorStruk = t.nomorStruk) AS dj  
			WHERE dj.barcode = b.barcode  $idKategoriBarang ORDER BY dj.barcode) AS lb 
		GROUP BY lb.barcode 
		ORDER BY $sortir DESC
		LIMIT ".$_POST['jumlah'].";
		";
	$hasil	= mysql_query($sql) or die("Error : ".mysql_error());
	//echo $sql;

	echo "
		<br/>
		<h2>Laporan Top Rank</h2>
		Tanggal:".$_POST['dari']." s/d ".$_POST['sampai']." Kategori: $kategori

		<table>
		<tr>
			<td class=td><b><center>No.</center></b></td>
			<td class=td><b><center>Barcode</center></b></td>
			<td class=td><b><center>Nama Barang</center></b></td>
			<td class=td><b><center>Jumlah</center></b></td>
			<td class=td><b><center>Omset</center></b></td>
			<td class=td><b><center>Profit</center></b></td>
		</tr>
		";

	$no=0;
	while ($x=mysql_fetch_array($hasil)){
		//untuk mewarnai tabel menjadi selang-seling
		$no++;
		if(($no % 2) == 0){
			$warna = "#EAF0F7";
		} else {
			$warna = "#FFFFFF";
		}

		echo "<tr bgcolor=$warna>";
		echo "
			<td class=td align=center> $no </td>
			<td class=td> ".$x['barcode']." </td>
			<td class=td> ".$x['namaBarang']." </td>
			<td class=td align=right> ".number_format($x['jumlah'],0,',','.')." </td>
			<td class=td align=right> ".number_format($x['omset'],0,',','.')." </td>
			<td class=td align=right> ".number_format($x['profit'],0,',','.')." </td>
			</tr>";
	};
	echo "</table>";

	exit;
	}


  case 'aging1': { // ---------------------------------------------------------------------------------

	$tanggal = date('Y-m-d');
	echo "
              <br/>
              <h2>Laporan Aging / Barang Mati</h2>

			<form method=POST action='modul/mod_laporan.php?act=aging2' onSubmit=\"popupform(this, 'aging')\">
	
		<table>
        	<tr>
			<td>Dari Tanggal </td>
			<td>: <input type=text name=dari value='$tanggal'>
			</td>
		</tr>

        	<tr>
			<td>Sampai Tanggal </td>
			<td>: <input type=text name=sampai value='$tanggal'>
			</td>
		</tr>

        	<tr>
			<td>Kategori </td>
			<td>: 	<select name='kategori'> 
				<option value='SEMUA' selected>SEMUA</option>";
		$hasil	= mysql_query("SELECT idKategoriBarang, namaKategoriBarang FROM kategori_barang");
		while ($x = mysql_fetch_array($hasil)) {
			echo "<option value='".$x['idKategoriBarang']."'>".$x['namaKategoriBarang']."</option>";
		};

		echo "		</select>
			</td>
		</tr>

        	<tr>
			<td>Jumlah Item </td>
			<td>: <input type=text name=jumlah value='200'>
			</td>
		</tr>

        	<tr>
			<td>Sortir berdasarkan</td>
			<td>: 	<select name='sortir'> 
				<option value='sisastok' selected>	Jumlah Sisa Stok</option>
				<option value='umurstok' >		Umur Stok</option>
				<option value='nilaistok'>		Nilai Stok</option>
				</select>
			</td>
		</tr>


        		<tr><td colspan=2><input type=submit value='Buat Laporan'></td></tr>
		</table>
			
		</form>

		";
	exit;
	}

  case 'aging2': { // ---------------------------------------------------------------------------------

	if ($_POST['kategori'] == 'SEMUA') {
		$kategori = 'SEMUA'; 
	} else {
		$hasil 	= mysql_query("SELECT namaKategoriBarang FROM kategori_barang WHERE idKategoriBarang=".$_POST['kategori']);
		$x	= mysql_fetch_array($hasil);
		$kategori = $x['namaKategoriBarang'];
	};

	if ($_POST['kategori'] == 'SEMUA') { 
		$idKategoriBarang = '';	
	} else {
		$idKategoriBarang = 'AND b.idKategoriBarang = '.$_POST['kategori'];	
	};

	$sortir = $_POST['sortir'];
	$sql	= "SELECT lb.barcode, lb.namaBarang, SUM(lb.jumBarang) AS sisastok, SUM(lb.hargaBeli * lb.jumBarang) AS nilaistok, 
			(TIMESTAMPDIFF(DAY, lb.tglTransaksiBeli, NOW())) AS umurstok, lb.tglTransaksiBeli 
		FROM 	(SELECT dj.barcode AS barcode, b.namaBarang AS namaBarang, dj.jumBarang, dj.jumBarangAsli, dj.hargaBeli, 
				b.idKategoriBarang, dj.tglTransaksiBeli    
      			FROM barang AS b, 
             			(SELECT b.barcode, b.hargaBeli, b.jumBarang, b.jumBarangAsli, t.tglTransaksiBeli FROM detail_beli AS b, 
                    			(SELECT idTransaksiBeli, tglTransaksiBeli FROM transaksibeli 
                    			WHERE tglTransaksiBeli BETWEEN '".$_POST['dari']."' AND '".$_POST['sampai']."') AS t
             			WHERE isSold = 'N' AND t.idTransaksiBeli = b.idTransaksiBeli AND b.jumBarang > 0) AS dj  
			WHERE dj.barcode = b.barcode  $idKategoriBarang ORDER BY dj.barcode) AS lb 
		GROUP BY lb.barcode 
		ORDER BY $sortir DESC
		LIMIT ".$_POST['jumlah'].";
		";
	$hasil	= mysql_query($sql) or die("Error : ".mysql_error());
	//echo $sql;

	echo "
		<br/>
		<h2>Laporan Aging</h2>
		Tanggal:".$_POST['dari']." s/d ".$_POST['sampai']." Kategori: $kategori

		<table>
		<tr>
			<td class=td><b><center>No.</center></b></td>
			<td class=td><b><center>Barcode</center></b></td>
			<td class=td><b><center>Nama Barang</center></b></td>
			<td class=td><b><center>Sisa Stok</center></b></td>
			<td class=td><b><center>Nilai Stok</center></b></td>
			<td class=td><b><center>Umur Stok</center></b></td>
		</tr>
		";

	$no=0;
	while ($x=mysql_fetch_array($hasil)){
		//untuk mewarnai tabel menjadi selang-seling
		$no++;
		if(($no % 2) == 0){
			$warna = "#EAF0F7";
		} else {
			$warna = "#FFFFFF";
		}

		echo "<tr bgcolor=$warna>";
		echo "
			<td class=td align=center> $no </td>
			<td class=td> ".$x['barcode']." </td>
			<td class=td> ".$x['namaBarang']." </td>
			<td class=td align=right> ".number_format($x['sisastok'],0,',','.')." </td>
			<td class=td align=right> ".number_format($x['nilaistok'],0,',','.')." </td>
			<td class=td align=right> ".number_format($x['umurstok'],0,',','.')." </td>
			</tr>";
	};
	echo "</table>";

	exit;
	}


}


/* CHANGELOG -----------------------------------------------------------

 1.5.5 / 2013-01-22 : Harry Sufehmi	: Penambahan Laporan : Top Rank
 1.5.0 / 2013-01-04 : Harry Sufehmi	: bugfix : perbaikan rumus perhitungan Total Stok
 1.2.5 / 2012-05-14 : Harry Sufehmi	: fitur : audit trail untuk "hapusjual"
 1.2.5 / 2012-04-17 : Harry Sufehmi	: bugfix : perbaikan rumus perhitungan Total Stok
 1.2.5 / 2012-03-04 : Harry Sufehmi	: bugfix : perhitungan Total Stok / total nilai stok kini sudah dari hargaBeli 
						(tadinya dari hargaJual)
 1.2.5 / 2012-02-14 : Harry Sufehmi	: Hapus transaksi jual : kini otomatis mengembalikan jumlah stok barang ke 
						table barang & detail_beli, sejumlah banyak barang yang dibatalkan transaksinya
 1.2.5 / 2012-02-01 : Harry Sufehmi	: Laporan Total Stok
 1.0.1 / 2010-06-03 : Harry Sufehmi	: various enhancements, bugfixes
 0.9.2 / 2010-03-08 : Harry Sufehmi	: initial release

------------------------------------------------------------------------ */

?>
<?php
/* ajax-check-dup-barcode.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

	include "../../config/config.php";

$barcode = $_POST['barcode']; // get the barcode
$barcode = trim(htmlentities($barcode)); // strip some crap out of it

echo check_barcode($barcode); // call the check_barcode function and echo the results.

function check_barcode($barcode){

	$sql = "SELECT * FROM barang WHERE barcode='$barcode'";
	$hasil = mysql_query($sql);
	if (mysql_num_rows($hasil) > 0) {
		return '<span style="color:#f00">ERROR: Barcode Sudah Ada !</span>';
	};

	return '<span style="color:#0c0">Barcode baru, OK!</span>';
}

/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.7.5		    : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_beli_barang.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

check_user_access(basename($_SERVER['SCRIPT_NAME']));

	//HS javascript untuk menampilkan dialog input "tambah barang baru"
?>	<script type="text/javascript">
		$(document).ready(function()
		{
			$('#layer1').Draggable(
					{
						zIndex: 	60,
						ghosting:	false,
						opacity: 	0.7,
						handle:	'#layer1_handle'
					}
				);	
			$('#layer1_form').ajaxForm({
				target: '#frmTambahBarang',
				success: function() 
				{
					$("#layer1").hide();
				}				
			});			
			$("#layer1").hide();
						
			$('#tambahbarang').click(function()
			{
				$("#layer1").show();
			});
			
			$('#close').click(function()
			{
				$("#layer1").hide();
			});
		});

	function popupform(myform, windowname)
	{
		if (! window.focus)return true;
		window.open('', windowname, 'type=fullWindow,fullscreen,scrollbars=yes');
		myform.target=windowname;
		return true;
	}

	</script>

	<style type="text/css">

		#layer1 
		{
			position: absolute;
			left:200px;
			top:100px;
			width:450px;
			background-color:#f0f5FF;
			border: 1px solid #000;
			z-index: 50;
		}
		#layer1_handle 
		{
			background-color:#5588bb;
			padding:2px;
			text-align:center;
			font-weight:bold;
			color: #FFFFFF;
			vertical-align:middle;
		}
		#layer1_content 
		{
			padding:5px;
		}
		#close
		{
			float:right;
			text-decoration:none;
			color:#FFFFFF;
		}
	</style>

<?php





switch($_GET[act]){ // ---------------------------------------------------------------------------------------------------------------------------
    // Tampil Satuan Barang
    default:
        echo "<h2>Pembelian Barang</h2>
		<table>
		<tr>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=pembelianbarang'>
			<input type=submit value='(b) Pembelian Barang' accesskey='b'>
			</form>
                    </td>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=laporanpembeliantanggal'>
			<input type=submit value='(l) Laporan Pembelian' accesskey='l'><br /><center>(per Tanggal)</center>
			</form>
                    </td>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=laporanpembelian'>
			<input type=submit value='(s) Laporan Pembelian' accesskey='s'><br /><center>(per Supplier)</center>
			</form>
                    </td>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=pemesananbarang'>
			<input type=submit value='(p) Pemesanan Barang' accesskey='p'>
			</form>
                    </td>
	
		</tr>


		<tr>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=returpembelian'>
			<input type=submit value='(r) Retur Pembelian' accesskey='r'>
			</form>
                    </td>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=cetakretur'>
			<input type=submit value='(c) Cetak Nota Retur' accesskey='c'>
			</form>
                    </td>
		</tr>



		<tr>
                    <td>
			<form method=POST action='?module=pembelian_barang&act=inputeprocurement1'>
			<input type=submit value='Input Beli @ Gudang'>
			</form>
                    </td>
                    <td>
		</tr>

		</table>";
        break;




    case "cetakretur"; // =========================================================================================================================

	echo "<h2>Cetak Nota Retur</h2>

            <form method=POST action='?module=pembelian_barang&act=cetakretur&action=lihatlaporan'>
                <br/>Periode Laporan : Bulan :
                <select name=bulanLaporan>";
        $dataBulan = getMonth("detail_retur_beli","tglRetur");
        while($bulan = mysql_fetch_array($dataBulan)){
            echo "<option value=$bulan[bulan]>".getBulanku($bulan[bulan])."</option>";
        }
        echo "</select>, Tahun :
            <select name=tahunLaporan>";
        $dataTahun = getYear();
        while($tahun = mysql_fetch_array($dataTahun)){
            echo "<option value=$tahun[tahun]>$tahun[tahun]</option>";
        }
        echo "</select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=submit value=Lihat>
            </form>
            ";


        if ($_GET[action] == 'lihatlaporan'){

		if($_POST[bulanLaporan]<10){
			$periode = $_POST[tahunLaporan]."-0".$_POST[bulanLaporan];
		} else{
			$periode = $_POST[tahunLaporan]."-".$_POST[bulanLaporan];
		}

		echo "
			<table><tr><th>Nota<br />Beli</th><th>Tanggal</th><th>Supplier</th><th>Total</th><th>User</th><th>AKSI</th></tr>";

		$sql = "SELECT d.idTransaksiBeli, d.tglRetur, d.nominal, d.username, s.namaSupplier, d.idSupplier  
			FROM detail_retur_beli AS d, supplier AS s 
			WHERE s.idSupplier = d.idSupplier AND tglRetur LIKE '$periode%' GROUP BY tglRetur ORDER BY tglRetur DESC";
		$hasil = mysql_query($sql);


		while ($x = mysql_fetch_array($hasil)) {

			echo "
				<tr>
				<td class=td>$x[idTransaksiBeli]</td>
				<td class=td>$x[tglRetur]</td>
				<td class=td>$x[namaSupplier]</td>
				<td class=td>$x[nominal]</td>
				<td class=td>$x[username]</td>
				<td class=td>
					<form method=POST action='modul/js_cetak_retur_beli.php' onSubmit=\"popupform(this, 'Cetak Nota Retur')\">
					<input type=submit value=Cetak>
					<input type=hidden name=idSupplier value='$x[idSupplier]'>
					<input type=hidden name=tglRetur value='$x[tglRetur]'>
					<input type=hidden name=idTransaksiBeli value='$x[idTransaksiBeli]'>
					</form>
				</td>
				</tr>
			";
		} // ($x = mysql_fetch_array($hasil))
		echo "</table>";

	} // ($_GET[action] == 'lihatlaporan')

	break;


    case "returpembelian"; // =======================================================================================================================
        echo "<h2>Retur Pembelian</h2>
            <form method=POST action='?module=pembelian_barang&act=returpembelian&action=lihatlaporan'>
                Supplier : 
                <select name=supplierId>";
            $supplier = getSupplier();
            while($dataSupplier = mysql_fetch_array($supplier)){
                echo "<option value=$dataSupplier[idSupplier]>$dataSupplier[namaSupplier]::$dataSupplier[idSupplier]::$dataSupplier[alamatSupplier]</option>";
            }
        echo "  </select>
                <br/>Periode Laporan : Bulan :
                <select name=bulanLaporan>";
        $dataBulan = getMonth();
        while($bulan = mysql_fetch_array($dataBulan)){
            echo "<option value=$bulan[bulan]>".getBulanku($bulan[bulan])."</option>";
        }
        echo "</select>, Tahun :
            <select name=tahunLaporan>";
        $dataTahun = getYear();
        while($tahun = mysql_fetch_array($dataTahun)){
            echo "<option value=$tahun[tahun]>$tahun[tahun]</option>";
        }
        echo "</select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=submit value=Lihat>
            </form>
            ";


        if($_GET[action] == 'lihatlaporan'){
            $detail = getDetailSupplier($_POST[supplierId]);
            $detailSupplier = mysql_fetch_array($detail);
            echo "<hr/>
                <br/>Nama Supplier : $detailSupplier[namaSupplier]
                <br/>Alamat Supplier : $detailSupplier[alamatSupplier]
                <br/>Periode : ".getBulan($_POST[bulanLaporan])." - $_POST[tahunLaporan]";
            $pembelian = getDataPembelian($_POST[supplierId], $_POST[bulanLaporan], $_POST[tahunLaporan]);
            $jmlPembelian = mysql_num_rows($pembelian);
            if($jmlPembelian != 0){
                echo "<br/><br/><table width=500><tr><th>No</th><th>No Nota</th><th>Tgl Pembelian</th><th>Nominal</th><th>Detail</th></tr>";
                $totalPembelian = 0;
                $no = 1;
                while($dataPembelian = mysql_fetch_array($pembelian)){
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                    echo "<td class=td>$no</td>
                            <td class=td align=right>$dataPembelian[noNota]</td>
                            <td class=td align=center>".tgl_indo($dataPembelian[tglNota])."</td>
                            <td class=td align=right>".uang($dataPembelian[nominal])."</td>
                            <td class=td><a href=?module=pembelian_barang&act=detailretur&idnota=$dataPembelian[noNota]>Detail</a></td>
                        </tr>";
                    $totalPembelian += $dataPembelian[nominal];
                    $no++;
                }
                echo "<tr><td colspan=3 align=right class=td><b>Total</b></td><td class=td align=right><b>".uang($totalPembelian)."</b></td><td class=td>&nbsp;</td></tr>
                    </table>";
            }
            else{
                echo "<br/><br/>Belum ada pembelian dari supplier ini.";
            }
            
        }
        break;





    case "pemesananbarang"; // =======================================================================================================================
        echo "<h2>Pemesanan Barang</h2>
            <form method=POST action='?module=pembelian_barang&act=pemesananbarang&action=pesanbarang'>
                Supplier : 
                <select name=supplierId>";
            $supplier = getSupplier();
            while($dataSupplier = mysql_fetch_array($supplier)){
                echo "<option value=$dataSupplier[idSupplier]>$dataSupplier[idSupplier]::$dataSupplier[alamatSupplier]</option>";
            }
        echo "</select>
		<br />
		Tampilkan hanya barang dengan jumlah lebih kecil dari : <input type=text name=jumlahmin value=0 size=3>
		<br />
            &nbsp;&nbsp;&nbsp;&nbsp;
            <input type=submit value=Pilih>
            </form>";
        if($_GET[action] == 'pesanbarang'){
            
            $supplier = getDetailSupplier($_POST[supplierId]);
            $detailSupplier = mysql_fetch_array($supplier);
            echo "<h2>Pesan Barang di Supplier $detailSupplier[namaSupplier]</h2>
            <br/>Alamat Supplier : $detailSupplier[alamatSupplier]<br/><br/>
            <form method=POST action='modul/js_cetak_PO.php'   onSubmit=\"popupform(this, 'Purchase_Order')\">
            <table width=500>
                <tr><th>#</th><th>No</th><th>Barcode</th><th>Nama Barang</th><th>Stok<br />Saat Ini</th></tr>";
            $no = 0;
            $queryBarang = getDaftarBarangSupplier($_POST[supplierId], $_POST[jumlahmin]);
            while($barangSupplier = mysql_fetch_array($queryBarang)){
                if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                    echo "<td class=td align=center><input type=checkbox name=cek[] value=$barangSupplier[idBarang] id=id$no checked=true></td>";
                    $no++;
                    echo "<td class=td>$no</td>
                        <td class=td>$barangSupplier[barcode]</td>
                        <td class=td>$barangSupplier[namaBarang]</td>
                        <td class=td align=right><center>$barangSupplier[jumBarang]</center></td>
                        </tr>";
            }

                    echo "<input type=hidden name=idSupplier value=$_POST[supplierId]>";
            echo "<tr><td colspan=5 align=center class=td>
            <input type=radio name=pilih onClick='for (i=0;i<$no;i++){document.getElementById(\"id\"+i).checked=true;}'>Check All
            <input type=radio name=pilih onClick='for (i=0;i<$no;i++){document.getElementById(\"id\"+i).checked=false;}'>Uncheck All
            </td></tr>
            <tr><td colspan=5 align=right class=td><input type=submit value=Cetak></form></td></tr>";
            echo "</table>";
            
        }
        break;


    case "laporanpembelian": // ===============================================================================================================
        echo "<h2>Laporan Pembelian (per Supplier)</h2>
            <form method=POST action='?module=pembelian_barang&act=laporanpembelian&action=lihatlaporan'>
                Supplier : 
                <select name=supplierId>";
            $supplier = getSupplier();
            while($dataSupplier = mysql_fetch_array($supplier)){
                echo "<option value=$dataSupplier[idSupplier]>$dataSupplier[namaSupplier]::$dataSupplier[idSupplier]::$dataSupplier[alamatSupplier]</option>";
            }
        echo "  </select>
                <br/>Periode Laporan : Bulan :
                <select name=bulanLaporan>";
        $dataBulan = getMonth();
        while($bulan = mysql_fetch_array($dataBulan)){
            echo "<option value=$bulan[bulan]>".getBulanku($bulan[bulan])."</option>";
        }
        echo "</select>, Tahun :
            <select name=tahunLaporan>";
        $dataTahun = getYear();
        while($tahun = mysql_fetch_array($dataTahun)){
            echo "<option value=$tahun[tahun]>$tahun[tahun]</option>";
        }
        echo "</select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=submit value=Lihat>
            </form>
            ";


        if($_GET[action] == 'lihatlaporan'){  // -------------------------------------------------------------------
            $detail = getDetailSupplier($_POST[supplierId]);
            $detailSupplier = mysql_fetch_array($detail);
            echo "<hr/>
                <br/>Nama Supplier : $detailSupplier[namaSupplier]
                <br/>Alamat Supplier : $detailSupplier[alamatSupplier]
                <br/>Periode : ".getBulan($_POST[bulanLaporan])." - $_POST[tahunLaporan]";
            $pembelian = getDataPembelian($_POST[supplierId], $_POST[bulanLaporan], $_POST[tahunLaporan]);
            $jmlPembelian = mysql_num_rows($pembelian);
            if($jmlPembelian != 0){
                echo "<br/><br/><table width=500><tr><th>No</th><th>No Nota</th><th>Tgl Pembelian</th><th>Nominal</th><th>Detail</th></tr>";
                $totalPembelian = 0;
                $no = 1;
                while($dataPembelian = mysql_fetch_array($pembelian)){
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                    echo "<td class=td>$no</td>
                            <td class=td align=right>$dataPembelian[noNota]</td>
                            <td class=td align=center>".tgl_indo($dataPembelian[tglNota])."</td>
                            <td class=td align=right>".uang($dataPembelian[nominal])."</td>
                            <td class=td><a href=?module=pembelian_barang&act=detaillaporan&idnota=$dataPembelian[noNota]>Detail</a></td>
                        </tr>";
                    $totalPembelian += $dataPembelian[nominal];
                    $no++;
                }
                echo "<tr><td colspan=3 align=right class=td><b>Total</b></td><td class=td align=right><b>".uang($totalPembelian)."</b></td><td class=td>&nbsp;</td></tr>
                    </table>";
            }
            else{
                echo "<br/><br/>Belum ada pembelian dari supplier ini.";
            }
            
        }
        break;


    case "detailretur"; // ===========================================================================================================
        $data = getDataNotaPembelian($_GET[idnota]);
        $dataBeli = mysql_fetch_array($data);
        echo "<h2>Retur Nota No : $_GET[idnota]</h2>
            <table>
                <tr>
                    <td>Nama Supplier</td><td> : </td><td>$dataBeli[namaSupplier]</td><td width=20>&nbsp;</td>
                    <td>Alamat</td><td> : </td><td>$dataBeli[alamatSupplier]</td>
                </tr>
                <tr>
                    <td>Tgl Transaksi</td><td> : </td><td>".tgl_indo($dataBeli[tglNota])."</td><td width=20>&nbsp;</td>
                    <td>Nominal</td><td> : </td><td>".uang($dataBeli[nominal])."</td>
                </tr>
                <tr>
                    <td>Nomor Invoice</td><td> : </td><td>$dataBeli[NomorInvoice]</td><td width=20>&nbsp;</td>
                    <td colspan=3 align=right>
                        <form method=POST action='aksi.php?module=inputreturbeli&act=inputtemp'>
                        <input type=hidden name=idNota value=$_GET[idnota]>
			<input type=submit value='(i) Input Retur' accesskey='i'>
			</form></a>
                    </td>
                </tr>
            </table>            
            <br/>";
        
        $detail = getDetailNotaPembelian($_GET[idnota]);
        if(mysql_num_rows($detail)!=0){
            echo "<table width=620>
                <tr><th>NO</th><th>Id Barang</th><th>Barcode</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th></tr>";

                $no = 1;
                $total = 0;
                while($dataDetail = mysql_fetch_array($detail)){
                    if(($no % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
                        $subTotal = $dataDetail[jumBarang]*$dataDetail[hargaBeli];
                        $total += $subTotal;
                        echo "<tr bgcolor=$warna>";//end warna
                        echo "<td class=td>$no</td>
                            <td class=td>$dataDetail[idBarang]</td>
                            <td class=td>$dataDetail[barcode]</td>
                            <td class=td>$dataDetail[namaBarang]</td>
                            <td class=td>$dataDetail[tglExpire]</td>
                            <td class=td align=right>$dataDetail[jumBarang]</td>
                            <td class=td align=right>".uang($dataDetail[hargaBeli])."</td>
                            <td class=td align=right>".uang($subTotal)."</td>
                            </tr>";
                }
            echo "<td colspan=7 align=right class=td>TOTAL</td><td align=right class=td>".uang($total)."</td>";
            echo "</table>";

	// Jika sudah ada - tampilkan detail retur untuk Nota ini
            echo "<h2>Nota Retur Yang Sudah Ada</h2>
		
		<table width=620>
		<tr><th>NOTA</th><th>Id Barang</th><th>Barcode</th>
		<th>Jumlah<br />Retur</th><th>Harga Beli</th><th>Total</th></tr>";

	$sql = "SELECT * FROM detail_retur_beli WHERE idTransaksiBeli = $_GET[idnota]";
	$hasil = mysql_query($sql);

	$currentTotal = 0;
	$oldTotal = 0;
	$ctr = 1;
	$totalRecord = mysql_num_rows($hasil);
	while ($x = mysql_fetch_array($hasil)) {

		$currentTotal = $x[nominal];
		if (($currentTotal !== $oldTotal) && ($oldTotal > 0)) { 
			echo "<tr align=right bgcolor=#EAF0F7><td colspan=6 class=td>
				".uang($oldTotal)."<br />
				(username: $oldUser)<br />
				(tanggal : $oldTgl)
			";
		};

                    if(($no % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
		echo "<tr bgcolor=$warna>";//end warna
		echo "<td class=td>$x[idTransaksiBeli]</td>
                            <td class=td>$x[idBarang]</td>
                            <td class=td>$x[barcode]</td>
                            <td class=td>$x[jumRetur]</td>
                            <td class=td align=right>".uang($x[hargaBeli])."</td>
			<td class=td align=right>";

		echo "</td></tr>";
		$ctr++;
		$oldTotal 	= $currentTotal;
		$oldTgl		= $x[tglRetur];
		$oldUser	= $x[username];
		

	} // while ($x = mysql_fetch_array($hasil))
	echo "<tr align=right bgcolor=#EAF0F7><td colspan=6 class=td>
		".uang($oldTotal)."<br />
		(username: $oldUser)<br />
		(tanggal : $oldTgl)
		</td></tr>
		";
       echo "</table>";


        }
        else{
            echo "Tidak Ada Data Detail Barang yang dibeli";
        }
        
        break;


    case "inputreturbeli"; // ===========================================================================================================

	//fixme: 
	// 	belum disimpan ke table 'retur' (baru ke table 'detail_retur_beli')

        if(isset($_GET[idnota])){
            $idNota = $_GET[idnota];
        }	
        
        $data = getDataNotaPembelian($idNota);
        $dataBeli = mysql_fetch_array($data);
        echo "<h2>RETUR PEMBELIAN : Detail Nota No : $idNota</h2>
            <table>
                <tr>
                    <td>Nama Supplier</td><td> : </td><td>$dataBeli[namaSupplier]</td><td width=20>&nbsp;</td>
                    <td>Alamat</td><td> : </td><td>$dataBeli[alamatSupplier]</td>
                </tr>
                <tr>
                    <td>Tgl Transaksi</td><td> : </td><td>".tgl_indo($dataBeli[tglNota])."</td><td width=20>&nbsp;</td>
                    <td>Nominal</td><td> : </td><td>".uang($dataBeli[nominal])."</td>
                </tr>
                <tr>
                    <td>Nomor Invoice</td><td> : </td><td>$dataBeli[NomorInvoice]</td><td width=20>&nbsp;</td>
                    <td colspan=3 align=right>&nbsp;
                    </td>
                </tr>
            </table>
            <br/>";

        if($_GET[action] == 'ubahdata'){            
            ubahTempEditDetailReturPembelian($_POST[idDetailBeli],$_POST[tglExpire],$_POST[jumBarang],$_POST[hargaBeli],$_POST[jumRetur]);
        }


        echo "Nota no : $idNota";
        $detail = getDetailTmpEditReturPembelian($idNota);
        if(mysql_num_rows($detail)!=0){
            echo "<table width=650>
                <tr><th>NO</th><th>Id Barang</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th><th>Jumlah<br />RETUR</th><th>AKSI</th></tr>";

                $no = 1;
                $total = 0;
		$totalRetur = 0;
                while($dataDetail = mysql_fetch_array($detail)){
                    if(($no % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
                        $subTotal = $dataDetail[jumBarang] * $dataDetail[hargaBeli];
                        $total += $subTotal;
			$subTotalRetur 	= $dataDetail[jumRetur] * $dataDetail[hargaBeli];
			$totalRetur	+= $subTotalRetur;
                        echo "<tr bgcolor=$warna>";//end warna
                        echo "<td class=td>$no</td>
                            <form method=POST action='?module=pembelian_barang&act=inputreturbeli&action=ubahdata&idnota=$idNota'>
                            <td class=td>$dataDetail[idBarang]</td>
                            <td class=td>$dataDetail[namaBarang]</td>
                            <td class=td><input type=text name=tglExpire size=8	     readonly 	value=$dataDetail[tglExpire]></td>
                            <td class=td align=right><input type=text name=jumBarang size=3 readonly 	value=$dataDetail[jumBarang]></td>
                            <td class=td align=right><input type=text name=hargaBeli size=8 readonly 	value=$dataDetail[hargaBeli]></td>
                            <td class=td align=right>".uang($subTotal)."</td>
			    <td class=td align=center><input type=text name=jumRetur size=3     	value=$dataDetail[jumRetur]></td>
			<td class=td align=right>
                                <input type=hidden name=idDetailBeli value=$dataDetail[idDetailBeli]>                                
                                <input type=submit value=Ubah>
                                </form>
                            </td>
                            </tr>";
                }
            echo "<tr><td colspan=8 align=right class=td>&nbsp;</td></tr>";
            echo "<td colspan=6 align=right class=td>TOTAL</td><td align=right class=td>".uang($total)."</td>
		<td align=right class=td>".uang($totalRetur)."</td>
                <td class=td>
                    <form method=POST action='aksi.php?module=inputreturbeli&act=simpanretur'>
                        <input type=hidden name=idNota value=$idNota>
                        <input type=submit value=Simpan>
                    </form>
                </td>";
            echo "</table>";
        }
        else{
            echo "Tidak Ada Data Detail Barang yang dibeli";
        }
        break;



    case "detaillaporan"; // ===========================================================================================================
        $data = getDataNotaPembelian($_GET[idnota]);
        $dataBeli = mysql_fetch_array($data);
        echo "<h2>Detail Nota No : $_GET[idnota]</h2>
            <table>
                <tr>
                    <td>Nama Supplier</td><td> : </td><td>$dataBeli[namaSupplier]</td><td width=20>&nbsp;</td>
                    <td>Alamat</td><td> : </td><td>$dataBeli[alamatSupplier]</td>
                </tr>
                <tr>
                    <td>Tgl Transaksi</td><td> : </td><td>".tgl_indo($dataBeli[tglNota])."</td><td width=20>&nbsp;</td>
                    <td>Nominal</td><td> : </td><td>".uang($dataBeli[nominal])."</td>
                </tr>
                <tr>
                    <td>Nomor Invoice</td><td> : </td><td>$dataBeli[NomorInvoice]</td><td width=20>&nbsp;</td>
                    <td colspan=3 align=right>
                        <form method=POST action='aksi.php?module=editlaporanpembelian&act=inputtemp'>
                        <input type=hidden name=idNota value=$_GET[idnota]>
			<input type=submit value='(e) Edit Laporan Pembelian' accesskey='e'>
			</form></a>
                    </td>
                </tr>
            </table>            
            <br/>";
        
        $detail = getDetailNotaPembelian($_GET[idnota]);
        if(mysql_num_rows($detail)!=0){
            echo "<table width=620>
                <tr><th>NO</th><th>Id Barang</th><th>Barcode</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th></tr>";

                $no = 1;
                $total = 0;
                while($dataDetail = mysql_fetch_array($detail)){
                    if(($no % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
                        $subTotal = $dataDetail[jumBarang]*$dataDetail[hargaBeli];
                        $total += $subTotal;
                        echo "<tr bgcolor=$warna>";//end warna
                        echo "<td class=td>$no</td>
                            <td class=td>$dataDetail[idBarang]</td>
                            <td class=td>$dataDetail[barcode]</td>
                            <td class=td>$dataDetail[namaBarang]</td>
                            <td class=td>$dataDetail[tglExpire]</td>
                            <td class=td align=right>$dataDetail[jumBarang]</td>
                            <td class=td align=right>".uang($dataDetail[hargaBeli])."</td>
                            <td class=td align=right>".uang($subTotal)."</td>
                            </tr>";
			$no++;
                }
            echo "<td colspan=7 align=right class=td>TOTAL</td><td align=right class=td>".uang($total)."</td>";
            echo "</table>";
        }
        else{
            echo "Tidak Ada Data Detail Barang yang dibeli";
        }
        
        break;


    case "editlaporan"; // ===============================================================================================================
        if(isset($_GET[idnota])){
            $idNota = $_GET[idnota];
        }
        
        $data = getDataNotaPembelian($idNota);
        $dataBeli = mysql_fetch_array($data);
        echo "<h2>Detail Nota No : $idNota</h2>
            <table>
                <tr>
                    <td>Nama Supplier</td><td> : </td><td>$dataBeli[namaSupplier]</td><td width=20>&nbsp;</td>
                    <td>Alamat</td><td> : </td><td>$dataBeli[alamatSupplier]</td>
                </tr>
                <tr>
                    <td>Tgl Transaksi</td><td> : </td><td>".tgl_indo($dataBeli[tglNota])."</td><td width=20>&nbsp;</td>
                    <td>Nominal</td><td> : </td><td>".uang($dataBeli[nominal])."</td>
                </tr>
                <tr>
                    <td>Nomor Invoice</td><td> : </td><td>$dataBeli[NomorInvoice]</td><td width=20>&nbsp;</td>
                    <td colspan=3 align=right>&nbsp;
                    </td>
                </tr>
            </table>
            <br/>";
        if($_GET[action] == 'ubahdata'){            
            ubahTempEditDetailPembelian($_POST[idDetailBeli],$_POST[tglExpire],$_POST[jumBarang],$_POST[hargaBeli]);
        }
        echo "Nota no : $idNota";
        $detail = getDetailTmpEditPembelian($idNota);
        if(mysql_num_rows($detail)!=0){
            echo "<table width=650>
                <tr><th>NO</th><th>Id Barang</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th><th>AKSI</th></tr>";

                $no = 1;
                $total = 0;
                while($dataDetail = mysql_fetch_array($detail)){
                    if(($no % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
                        $subTotal = $dataDetail[jumBarang]*$dataDetail[hargaBeli];
                        $total += $subTotal;
                        echo "<tr bgcolor=$warna>";//end warna
                        echo "<td class=td>$no</td>
                            <form method=POST action='?module=pembelian_barang&act=editlaporan&action=ubahdata&idnota=$idNota'>
                            <td class=td>$dataDetail[idBarang]</td>
                            <td class=td>$dataDetail[namaBarang]</td>
                            <td class=td><input type=text name=tglExpire value=$dataDetail[tglExpire]></td>
                            <td class=td align=right><input type=text name=jumBarang value=$dataDetail[jumBarang]></td>
                            <td class=td align=right><input type=text name=hargaBeli value=$dataDetail[hargaBeli]></td>
                            <td class=td align=right>".uang($subTotal)."</td>
                            <td class=td align=right>
                                <input type=hidden name=idDetailBeli value=$dataDetail[idDetailBeli]>                                
                                <input type=submit value=Ubah>
                                </form>
                            </td>
                            </tr>";
                }
            echo "<tr><td colspan=8 align=right class=td>&nbsp;</td></tr>";
            echo "<td colspan=6 align=right class=td>TOTAL</td><td align=right class=td>".uang($total)."</td>
                <td class=td>
                    <form method=POST action='aksi.php?module=editlaporanpembelian&act=simpanedit'>
                        <input type=hidden name=idNota value=$idNota>
                        <input type=submit value=Simpan>
                    </form>
                </td>";
            echo "</table>";
        }
        else{
            echo "Tidak Ada Data Detail Barang yang dibeli";
        }
        break;



    case "pembelianbarang": // =================================================================================================================
        $sql1 = getSupplier();

	        echo "<h2>Pembelian Barang</h2>
	              <form method=POST action='?module=pembelian_barang&act=carisupplier'>
			<select name=idSupplier>";

                while ($data=mysql_fetch_array($sql1)){

			echo "<option value=$data[idSupplier]>$data[namaSupplier] :: $data[alamatSupplier]";
 		};

	        echo "  </select>
			<input type=submit value='(c) Cari' accesskey='c' name='cariSupplier' />
	              </form>";
        break;


    case "carisupplier": // ====================================================================================================================

		if (isset($_POST[idSupplier])) {
           		$x = findSupplier($_POST[idSupplier]);
		} else {
			$x = findSupplier($_GET[idSupplier]);   
       		};
       
        echo "<h2>Pembelian Barang</h2>Pembelian Barang dari supplier :
                    $_SESSION[namaSupplier]";
        echo "<form method=POST action='?module=pembelian_barang&act=carisupplier&action=cek&idSupplier=$_SESSION[idSupplier]'>
		
			<br /><br /> (1) Pilihan barcode : ";

                $sql1 = mysql_query("SELECT DISTINCT barcode, namaBarang   
                                FROM barang WHERE idSupplier=$_SESSION[idSupplier] ORDER BY namaBarang ASC");

	        echo "<select name=barcode accesskey='1'>";
                while ($data=mysql_fetch_array($sql1)){
			echo "<option value=$data[barcode]>$data[barcode] :: $data[namaBarang]";
 		};
		echo "</select>";

   	echo "	<input type=submit value='(2) Pilih barcode !' accesskey='2' /> 
		<input type='hidden' name='xppn' value='$_POST[xppn]'>
                </form>";


	echo "  <form method=POST action='?module=pembelian_barang&act=carisupplier&action=cek&idSupplier=$_SESSION[idSupplier]'>
	
		<br /> (3) Pilihan barang : ";

                $sql1 = mysql_query("SELECT DISTINCT barcode, namaBarang   
                                FROM barang WHERE idSupplier=$_SESSION[idSupplier] ORDER BY namaBarang ASC");

	        echo "<select name=barcode accesskey='3'>";
                while ($data=mysql_fetch_array($sql1)){
			echo "<option value=$data[barcode]>$data[namaBarang] :: $data[barcode]";
 		};
		echo "</select>";
	
   	echo "	<input type=submit value='(4) Pilih barang !' accesskey='4' /> 
		<input type='hidden' name='xppn' value='$_POST[xppn]'>
                </form>";


	//HS tombol "Tambah Barang" akan memunculkan form dialog jQuery
	echo "	<form method=POST action='?module=pembelian_barang&act=carisupplier&action=cek&idSupplier=$_SESSION[idSupplier]'>
		<center><input type=\"button\" id=\"tambahbarang\" accesskey='b' value='(b) Tambah Barang Baru' /> </center>
		<input type='hidden' name='xppn' value='$_POST[xppn]'>
		</form> <br />";	




        if($_GET[action]=='cek'){ // ===============================================================================================================
            $barang = cekBarang($_POST[barcode]);
            if(!$barang){
                echo "Data belum ada !";
                    break;
            }      
        }

			echo '
			<script>
				function RecalcHargaBarangLama() {
					var HargaBeli = 0;
					var HargaJual = 0;
					var Subtotal 	= parseInt(document.getElementById("xsubtotal").value);
					var PPN 	= parseInt(document.getElementById("xppn").value);
					var JumlahBarang = parseInt(document.getElementById("jumBarang").value);
					var PersenProfit = parseInt(document.getElementById("xPersenProfit").value);
					var DiskonPersen = parseInt(document.getElementById("xDiskonPersen").value);
					var DiskonRupiah = parseInt(document.getElementById("xDiskonRupiah").value);

					if(Subtotal){
						HargaBeli = (Subtotal / JumlahBarang) 
						// hitung diskon dulu !
						HargaBeli = HargaBeli  - ((HargaBeli / 100) * DiskonPersen) - DiskonRupiah;
						// baru kemudian hitung PPN
						HargaBeli = HargaBeli + ((HargaBeli / 100) * PPN);

						HargaJual = HargaBeli + ((HargaBeli / 100) * PersenProfit);
					}

                                        // mencegah keliru input barcode di kolom JumlahBarang
                                        if(JumlahBarang > 2000){
                                                JumlahBarang = 0;
                                        }


					document.getElementById("hargaBeliBaru").value 	= HargaBeli;
					document.getElementById("hargaJualBaru").value 	= HargaJual;
                                        document.getElementById("jumBarang").value 	= JumlahBarang;

				}

			</script>';

	// inisialisasi variabel xppn
	if (!$_POST[xppn]) { $_POST[xppn] = 0;};
        echo "<br/> 

		<div id=\"frmTambahBarang\">
            <form method=POST action='?module=pembelian_barang&act=carisupplier&action=tambah'>
                <table>
                    <tr>
                        <td>Barcode</td><td> : <input type=text name='barcode' value='$barang[barcode]' readonly='readonly' />
				<input type=hidden name='idBarang' value='$barang[idBarang]' /></td>
			<td><a name='#jumlah'>  <u>J</u>umlah yang dibeli </a></td>
			<td> : <input type=text name='jumBarang' id='jumBarang' tabindex=1 accesskey='j'/></td>
                    </tr>
                    <tr>
                        <td>Nama Barang</td><td> : <input type=text name='namaBarang' value='$barang[namaBarang]' readonly='readonly' /></td>
                        <td>Subtotal</td><td> : Rp <input type=text name='subtotal' value='0' id='xsubtotal'  tabindex=2 /></td>                        
                    </tr>
			<tr>
				<td>Diskon %</td><td> : <input type=text name='xDiskonPersen' value='0' id='xDiskonPersen' /></td>		
				<td>% PPN</td><td> : <input type=text name='xppn' value='$_POST[xppn]' id='xppn'  tabindex=3 /></td>                     		
			</tr>
			<tr>
				<td>Diskon Rp</td><td> : <input type=text name='xDiskonRupiah' value='0' id='xDiskonRupiah' /></td>
				<td>% Profit</td><td> : <input type=text name='persenprofit' value='0' id='xPersenProfit' tabindex=4 /><br />
					&nbsp;&nbsp;&nbsp;&nbsp; [<a href='#jumlah' onclick=\"RecalcHargaBarangLama();\" accesskey='6'>  (6) Hitung Harga ]
				</td>                     		
			</tr>
			<tr>
				<td>Harga Beli Sekarang</td><td> : <input type=text name='hargaBeliLama' value='$barang[hargaBeli]' readonly='readonly' /></td>
	                        <td>Harga Beli Barang</td><td> : <input type=text name='hargaBeliBaru' id='hargaBeliBaru' tabindex=5 /></td>
			</tr>
                    <tr>
                        <td>Harga Jual Sekarang</td><td> : <input type=text name='hargaJualLama' value='$barang[hargaJual]' readonly='readonly' /></td>
                        <td>Harga Jual Barang</td><td> : <input type=text name='hargaJualBaru' id='hargaJualBaru' value='$barang[hargaJual]' tabindex=6 /></td>
                    </tr>                    
                    <tr>
                        <td colspan=2>&nbsp</td>
                        <td>Tanggal Expire</td><td> : <input type=text name='tglExpire' size=10 tabindex=7 />(yyyy-mm-dd)</td>
                    </tr>
                    <tr>

                        <td align=right colspan=4><input type=submit accesskey='t' value='(t) Tambah' name=btTambah tabindex=8 ></td>
                    </tr>
                </table>
            </form>
		</div>

		<script>
			var txtBox=document.getElementById(\"jumBarang\" );
			if (txtBox!=null ) txtBox.focus();
		</script>
        ";
	
	//fixme : perlu validasi input
	//	# tidak boleh kosong jumlah barang
	//	# tidak boleh kosong harga beli	
	//	# tidak boleh kosong harga jual
	// bisa pakai fasilitas dari jQuery : http://www.position-absolute.com/articles/jquery-form-validator-because-form-validation-is-a-mess/





        if($_GET[action]=='tambah'){ // =============================================================================================================

		//fixme: item dg barcode "0" pasti selalu ikut terinput - cek dari log query MySQL
		$true = cekBarangTemp($_SESSION[idSupplier],$_POST[barcode]);
		if($_POST[barcode] <> 0) {
			if($true != 0){
				tambahBarangAda($_SESSION[idSupplier],$_POST[barcode],$_POST[jumBarang]);
			} else {
				tambahBarang($_SESSION[idSupplier],$_POST[barcode],$_POST[jumBarang],$_POST[hargaBeliBaru],$_POST[hargaJualBaru],$_POST[tglExpire]);
			}
		}
        }
        if($_GET[action]=='ubahjumlah'){
            //echo "Ubah Jumlah  :  $_POST[barcode],$_POST[jumlahBarang],$_POST[hargaBeli],$_POST[hargaJual]";

            $true = cekBarangTemp($_SESSION[idSupplier],$_POST[barcode]);
            if($true != 0){
                ubahJumlahBarangBeliTemp($_SESSION[idSupplier],$_POST[idBarang],$_POST[jumlahBarang]);
            }
        }
	$sql = "SELECT *
                                from tmp_detail_beli tdb, barang b
                                where tdb.barcode = b.barcode and tdb.idSupplier = '$_SESSION[idSupplier]' and tdb.username = '$_SESSION[uname]'";
	//echo $sql;
	$query = mysql_query($sql);
	
        $r = mysql_fetch_row($query);
        echo "<hr/>";

        if($r){ // -------------------- tampilkan data yang sudah di input sejauh ini ---------
            //echo "Ada $r[0] data";
            echo "<table class=tableku width=700>
                    <tr><th>Barcode</th><th>Nama Barang</th>
                        <th>Tgl Expire</th><th>Jumlah</th>
                        <th>Harga Beli</th>
			<th>Harga Jual</th>
                        <th>Total</th>
			<th>Aksi</th>
			</tr>";
                $no=1;
                $tot_pembelian;
		$sql = "SELECT tdb.barcode, tdb.idBarang, tdb.hargaJual, namaBarang, tglExpire, tdb.jumBarang, hargaBeli
                                FROM tmp_detail_beli tdb, barang b
                                WHERE tdb.barcode = b.barcode AND tdb.idSupplier = '$_SESSION[idSupplier]' AND tdb.username = '$_SESSION[uname]'
				ORDER BY idBarang";
		//echo $sql;
                $query2 = mysql_query($sql);
                while ($data=mysql_fetch_array($query2)){
                    $total = $data[hargaBeli] * $data[jumBarang];
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                    echo "	<form method=POST action='?module=pembelian_barang&act=carisupplier&action=ubahjumlah'>
                                <td>$data[barcode]</td>
				<td>$data[namaBarang]</td>
                        	<td>$data[tglExpire]</td>
				<td align=right><input type=text name=jumlahBarang value=$data[jumBarang] size=5></td>
                        	<td align=right>$data[hargaBeli]</td>
                        	<td align=right>$data[hargaJual]</td>
                                <input type=hidden name=barcode value=$data[barcode]>
                                <input type=hidden name=idBarang value=$data[idBarang]>
				<td align=right>".number_format($total,0,',','.')."</td>
                                <td width=120><input type=submit name=update value=Update></form> |
                                <a href='./aksi.php?module=pembelian_barang&act=hapus_detil&id=$data[idBarang]'>Hapus</a></td>
                        </tr>";
                    $tot_pembelian += $total;
                    $no++;
                }

//fixme: tombol update membuat jumlah stok jadi sama semua



		//HS total invoice :
		//	subtotal - (DiskonPersen x subtotal) - (DiskonRupiah) + PPN
		if (empty($_POST[DiskonPersen])) {$_POST[DiskonPersen] = 0;};
		if (empty($_POST[DiskonRupiah])) {$_POST[DiskonPersen] = 0;};
		if (empty($_POST[PPN])) {$_POST[PPN] = 0;};
		$tot_pembelian = $tot_pembelian - ($_POST[DiskonPersen] * $tot_pembelian) - $_POST[DiskonRupiah] + $_POST[PPN];


			echo '
			<script>
				function Recalc() {
					var total = 0;
					var GrandTotal   = parseInt(document.getElementById("tot_pembayaran").value);
					var PPN 	 = parseInt(document.getElementById("ppn").value);
					var DiskonPersen = parseInt(document.getElementById("diskonpersen").value);
					var DiskonRupiah = parseInt(document.getElementById("diskonrupiah").value);

					if(GrandTotal){
						total = GrandTotal; 
						total = total - (GrandTotal / 100 * DiskonPersen);
						total = total - DiskonRupiah;
						total = total + (GrandTotal / 100 * PPN);
					}
					document.getElementById("grandtotal").value = total;
					document.getElementById("tot_pembayaran").value = total;
				}

			</script>';

                echo "</table>";
                $pmbyrn = mysql_query("SELECT * from pembayaran");
                echo "<form method=POST action='./aksi.php?module=pembelian_barang&act=input'>
                        <input type=hidden name='tot_pembayaran' value='$tot_pembelian' id='tot_pembayaran'>
                    <table class=tableku width=600>
                        <tr><td width=65% align=right><a name='#total'>Total Pembelian</a><br />
				<a href='#total' onclick=\"Recalc();\" accesskey='u'>Hitung (U)lang</a></td><td align=right><input id='grandtotal' readonly='readonly' value='".number_format($tot_pembelian,0,',','.')."' tabindex=9></td></tr>
                        <tr><td width=65% align=right>Tipe Pembayaran</td>
                            <td align=right><select name='tipePembayaran' tabindex=10>
                                        <option value='0'>-Tipe Pembayaran-</option>";
                                        while($pembayaran = mysql_fetch_array($pmbyrn)){
                                            echo "<option value='$pembayaran[idTipePembayaran]'>$pembayaran[tipePembayaran]</option>";
                                        }
                        echo "</select></td></tr>
                        <tr><td width=65% align=right>Tanggal Pembayaran (hutang)</td><td align=right><input type=text name='tglBayar' tabindex=11></td></tr>
                        <tr><td width=65% align=right>Nomor Invoice</td><td align=right><input type=text name='NomorInvoice' value=0 tabindex=12></td></tr>
                        <tr><td width=65% align=right>Tanggal Invoice</td><td align=right><input type=text name='TanggalInvoice' 
			value='".date("Y-m-d")."' tabindex=13></td></tr>
			<tr><td width=65% align=right>Diskon (%)</td><td align=right><input type=text id='diskonpersen' name='DiskonPersen' value=0 tabindex=14> %</td></tr>
			<tr><td width=65% align=right>Diskon (Rp)</td><td align=right>Rp <input type=text id='diskonrupiah' name='DiskonRupiah' value=0 tabindex=15></td></tr>
			<tr><td width=65% align=right>PPn</td><td align=right><input type=text id='ppn' name='PPN' value=0 tabindex=16> %</td></tr>";
	


			echo "
                        <tr><td colspan=2>&nbsp;</td></tr>
                        <tr><td><a href='aksi.php?module=pembelian_barang&act=batal'>BATAL</a></td><td><input type=submit value='Simpan' tabindex=17></td></tr>
                        </table></form>
			";
                
		//fixme : Pembatalan Nota (code di atas & bawah komentar ini) perlu merujuk ke user ybs,
		// agar jangan keliru menghapus nota yang sedang di input oleh user yang lainnya 

        }
        else{

            echo "Belum ada barang yang dibeli<br /><a href='aksi.php?module=pembelian_barang&act=batal'>BATAL</a>";
        }
        
    break;



    case "laporanpembeliantanggal": // ===============================================================================================================

        echo "<h2>Laporan Pembelian (per Tanggal)</h2>
            <form method=POST action='?module=pembelian_barang&act=laporanpembeliantanggal&action=pilihtanggal'>

                <br />Periode Laporan : Bulan :
                <select name=bulanLaporan>";
        $dataBulan = getMonth();
        while($bulan = mysql_fetch_array($dataBulan)){
            echo "<option value=$bulan[bulan]>".getBulanku($bulan[bulan])."</option>";
        }
        echo "</select>, Tahun :
            <select name=tahunLaporan>";
        $dataTahun = getYear();
        while($tahun = mysql_fetch_array($dataTahun)){
            echo "<option value=$tahun[tahun]>$tahun[tahun]</option>";
        }
        echo "</select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=submit value=Lihat>
            </form>
            ";


        if($_GET[action] == 'pilihtanggal'){ // ------------------------------------------------------------

		$sql 	= "SELECT tglTransaksiBeli, idTransaksiBeli FROM transaksibeli 
				WHERE month(tglTransaksiBeli)='$_POST[bulanLaporan]' AND year(tglTransaksiBeli)='$_POST[tahunLaporan]' 
				ORDER BY tglTransaksiBeli, idTransaksiBeli ASC";
		$hasil 	= mysql_query($sql);

		echo "<hr />
	            <form method=GET action='?module=pembelian_barang&act=detaillaporan'>
		
			Tanggal :
			<select name=idnota>
		";
		while ($x = mysql_fetch_array($hasil)) {
			echo "<option value=$x[idTransaksiBeli]> $x[tglTransaksiBeli] : Nmr.Nota #$x[idTransaksiBeli]</option>";

		}; // while ($x = mysql_fetch_array($hasil)) {
		echo "</select>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type=submit value=Lihat>

			<input type=hidden name=module value=pembelian_barang>
			<input type=hidden name=act value=detaillaporan>

		            </form>
		";


	}; // if($_GET[action] == 'pilihtanggal'){


        break;




    case "inputeprocurement1"; // =======================================================================================================================
        echo "<h2>Input Pembelian dari Gudang Ahad</h2>
            <form method=POST action='?module=pembelian_barang&act=inputeprocurement2'  enctype='multipart/form-data'> 
                Pilih File Transaksi : 
		<input type=file  name=csvfile /> <br />
		Tipe File :
		<select name=tipefile>
			<option value='gudangahad' selected>Gudang.AhadMart.com</option>
		</select> <br /><br />

		<input type=submit value=Posting /> 
		</form>
	";



	break;



    case "inputeprocurement2"; // =============================================================================================================

	$ctr = 0;
	$tgl = date("Y-m-d");
	$totalInvoice = 0;

        echo "<h2>Input Pembelian dari Gudang Ahad</h2>

		<form method=POST action='?module=pembelian_barang&act=inputeprocurement3'>

		<table border=1>
		<tr>
			<td><center><b>Barcode
			</b></center></td>
			<td><center><b>Nama Barang
			</b></center></td>
			<td><center><b>Jumlah
			</b></center></td>
			<td><center><b>Harga Beli
			</b></center></td>
			<td><center><b>Harga Jual Lama
			</b></center></td>
			<td bgcolor=#dddddd><center><b>RRP / Harga Jual Baru
			</b></center></td>
			<td><center><b>Satuan
			</b></center></td>
			<td><center><b>Kategori
			</b></center></td>
		</tr>
		";

	if (empty($_FILES) && empty($_POST) && isset($_SERVER['REQUEST_METHOD']) && strtolower($_SERVER['REQUEST_METHOD']) == 'post') {    
		$poidsMax = ini_get('post_max_size'); 
		echo "<h2>ERROR : file yang di upload lebih besar daripada limit di server, yaitu : $poidsMax. <br />Tidak merubah apapun.";
		exit;
	};

	$csvfile = $_FILES['csvfile']['tmp_name'];
	//echo "File: $csvfile";

	// mulai memproses isi file CSV
	$n = 1;
	if (($handle = fopen($csvfile, "r")) !== FALSE) {
		while (($data = fgetcsv($handle, 1000, ',', '"')) !== FALSE) {
			// sometimes there are empty lines in the CSV file - don't process that
			if (!is_null($data[0]) AND ($data[0]  !== 'barcode')) {
				// format isi file CSV :
				// $data[0]  = barcode
				// $data[1]  = idBarang - ignored
				// $data[2]  = namaBarang
				// $data[3]  = jumlah Barang / jumBarang
				// $data[4]  = hargaBeli - ignored
				// $data[5]  = hargaJual (di Gudang) 
				// $data[6]  = RRP (Recommended Retail Price)
				// $data[7]  = namaSatuanBarang
				// $data[8]  = namaKategoriBarang
				// $data[9]  = Supplier - ignored
				// $data[10] = username - ignored

				// cari harga jual dari barang ybs pada saat ini
				$hargaSekarang = 0;
				$sql 	= "SELECT hargaJual FROM barang WHERE barcode='".$data[0]."'";
				$hasil	= mysql_query($sql);
				$z	= mysql_fetch_array($hasil);
				$hargaSekarang = $z[hargaJual];
	
				echo "
				<tr>
					<td><input type=text name=barcode$n value='".$data[0]."' size=10 readonly>
					</td>
					<td><center><input type=text name=namabarang$n value='".$data[2]."' readonly>
					</td>
					<td><input type=text name=jumlah$n value='".$data[3]."' size=2 readonly>
					</td>
					<td><input type=text name=harga$n value='".$data[5]."' size=5 readonly>
					</td>
					<td><center>$hargaSekarang
					</td>
					<td bgcolor=#dddddd><input type=text name=rrp$n value='".$data[6]."' size=5>
					</td>
					<td><input type=text name=satuan$n value='".$data[7]."' size=2 readonly>
					</td>
					<td><input type=text name=kategori$n value='".$data[8]."' size=6 readonly>
					</td>
				</tr>
				";
				$n++;


			}; // if (!is_null($data[0]) AND ($data[0]  !== 'barcode')) {		
		}; // while (($data = fgetcsv($handle, 1000, ',', '"')) !== FALSE) {
	}; // if (($handle = fopen($csvfile, "r")) !== FALSE) {

	echo "
		</table>
		
		<input type=hidden name=count value=$n>

		<input type=submit value=SIMPAN /> 
		</form>
	";

	exit;




    case "inputeprocurement3"; // =============================================================================================================

	$tgl = date("Y-m-d");
	$totalInvoice = 0;
	$ctr = 1;

	// cek apakah ada Supplier "Gudang.AhadMart.com" di table 
	$hasil = mysql_query("SELECT idSupplier FROM supplier WHERE namaSupplier='Gudang.AhadMart.com'");
	// jika tidak - bikin 1 recordnya
	if (mysql_num_rows($hasil) < 1 ) {
		mysql_query("INSERT INTO supplier (namaSupplier, alamatSupplier, telpSupplier, Keterangan, last_update) 
				VALUES ('Gudang.AhadMart.com', 'Jakarta', '021-7330923', 'http://gudang.ahadmart.com', '".date('Y-m-d')."')");
		$hasil 	= mysql_query("SELECT LAST_INSERT_ID() FROM supplier");
	};
	$x		= mysql_fetch_array($hasil);
	$idSupplier	= $x[0];


	// bikin record di table transaksibeli
	$sql = "INSERT INTO transaksibeli(tglTransaksiBeli, idSupplier, nominal, idTipePembayaran, username, last_update, NomorInvoice)
                    VALUES('$tgl', ".$idSupplier.", '9999',1, '$_SESSION[uname]','$tgl',' ')";
	$hasil	= mysql_query($sql);
	// simpan nomor transaksi beli nya
	$hasil 	= mysql_query("SELECT LAST_INSERT_ID() FROM transaksibeli");
	$x	= mysql_fetch_array($hasil);
	$idTransaksiBeli	= $x[0];

	while ($ctr < $_POST[count]) {

				// semua transaksi dicatat di table detail_beli 
					// bikin idBarang dulu, via tmp_detail_beli
					$hasil 	= mysql_query("INSERT INTO tmp_detail_beli (idSupplier, tglTransaksi, tglExpire, jumBarang, hargaBeli, hargaJual) VALUES (1,'$tgl','$tgl',1,2,3)");
					$hasil 	= mysql_query("SELECT LAST_INSERT_ID() FROM tmp_detail_beli");
					$x	= mysql_fetch_array($hasil);
					$idBarang	= $x[0];
					// hapus record temporary tadi
					$hasil 	= mysql_query("DELETE FROM tmp_detail_beli WHERE idBarang=$idBarang");
					// baru bikin record item ini di detail_beli
					mysql_query("INSERT INTO detail_beli (idTransaksiBeli, idBarang, tglExpire, jumBarang, hargaBeli, 
							isSold, barcode, username, jumBarangAsli) 
						VALUES ($idTransaksiBeli, $idBarang, '', ".$_POST["jumlah$ctr"].", ".$_POST["harga$ctr"].", 'N', 
							'".$_POST["barcode$ctr"]."', '$_SESSION[uname]', ".$_POST["jumlah$ctr"].")");
					echo "<br /><hr>--- Menambahkan detail_beli: barcode <b>".$_POST["barcode$ctr"]."</b>";

				// cek apakah ada namaSatuanBarang ini di table satuan_barang ?
				$hasil = mysql_query("SELECT idSatuanBarang FROM satuan_barang WHERE namaSatuanBarang='".$_POST["satuan$ctr"]."'");
				// jika tidak - bikin 1 recordnya
				if (mysql_num_rows($hasil) < 1 ) {
					mysql_query("INSERT INTO satuan_barang (namaSatuanBarang) VALUES ('".$_POST["satuan$ctr"]."')");
					$hasil 	= mysql_query("SELECT LAST_INSERT_ID() FROM satuan_barang");
					$x	= mysql_fetch_array($hasil);
					$idSatuanBarang	= $x[0];
					echo "<br />--- Menambahkan satuan barang: ".$_POST["satuan$ctr"]."";
				} else {
					$x		= mysql_fetch_array($hasil);
					$idSatuanBarang	= $x[idSatuanBarang];
				};

				// cek apakah ada KategoriBarang ini di table kategori_barang ?
				$sql   = "SELECT idKategoriBarang FROM kategori_barang 
							WHERE namaKategoriBarang='".$_POST["kategori$ctr"]."'";
				$hasil = mysql_query($sql);
				// jika tidak - bikin 1 recordnya
				if (mysql_num_rows($hasil) < 1 ) {
					mysql_query("INSERT INTO kategori_barang (namaKategoriBarang) VALUES ('".$_POST["kategori$ctr"]."')");
					$hasil 	= mysql_query("SELECT LAST_INSERT_ID() FROM tmp_detail_beli");
					$x	= mysql_fetch_array($hasil);
					$idKategoriBarang	= $x[0];
					echo "<br />--- Menambahkan kategori barang: ".$_POST["kategori$ctr"]." ";
				} else {
					$x			= mysql_fetch_array($hasil);
					$idKategoriBarang	= $x[idKategoriBarang];
				};

				// cek apakah ada barcode ini di table barang ?
				$hasil 	= mysql_query("SELECT jumBarang, namaBarang FROM barang WHERE barcode='".$_POST["barcode$ctr"]."'");
				$x	= mysql_fetch_array($hasil);
				// jika ada - tambah quantity nya
				if (mysql_num_rows($hasil) > 0 ) {
					$sql	= "UPDATE barang SET jumBarang=".($x[jumBarang] + $_POST["jumlah$ctr"]).", 
								idKategoriBarang = $idKategoriBarang, 
								idSatuanBarang = $idSatuanBarang,
								idSupplier = $idSupplier, 
								hargaJual = ".$_POST["rrp$ctr"]." 
							WHERE barcode='".$_POST["barcode$ctr"]."'";
					$hasil 	= mysql_query($sql);
					echo "<br />=== Barcode sudah ada: di <u>Database</u>: <b>$x[namaBarang]</b>, 
							di <u>Invoice</u>: <b>".$_POST["namabarang$ctr"]."</b>";
					echo "<br />### Update data barang: $sql - ".$_POST["namabarang$ctr"]." <br />";
				// jika tidak - bikin 1 recordnya
				} else {
					$sql 	= "INSERT INTO barang (idBarang, namaBarang, idKategoriBarang, idSatuanBarang, jumBarang, hargaJual,
									 last_update, idSupplier, barcode, username, idRak)
						VALUES ($idBarang, '".$_POST["namabarang$ctr"]."', $idKategoriBarang, $idSatuanBarang, 
							".$_POST["jumlah$ctr"].", ".$_POST["rrp$ctr"].", '$tgl', 
							$idSupplier, '".$_POST["barcode$ctr"]."', '$_SESSION[uname]', '999')";
					$hasil	= mysql_query($sql);
					echo "<br />### Menambahkan data barang: $sql <br />";
				};

				// hitung total 
				$totalInvoice = $totalInvoice + ($_POST["jumlah$ctr"] * $_POST["harga$ctr"]);
				// tambahkan counter
				$ctr++;

	}; // while ($ctr <= $_POST[count]) {


	// update nilai invoice di table transaksibeli
	$hasil = mysql_query("UPDATE transaksibeli SET nominal=$totalInvoice WHERE idTransaksiBeli=$idTransaksiBeli");
	// laporkan jumlah record yang kita proses
	echo "<br /><h2>Jumlah item di invoice ini: ".($ctr - 1)." <br />
		Total Pembelian : Rp ".uang($totalInvoice)."</h2><br />Selesai.";

	exit;                   
}











	// ========================================================================================================================================
	//HS form input "tambah barang"  -- awalnya hidden, baru akan muncul jika tombol "Tambah Barang" dipencet
	//HS ditaruh paling bawah agar tidak mengacaukan form yang lainnya

	echo "\n\n";

?>	

	<div id="layer1">
		<div id="layer1_handle">			
			<a href="#" id="close">[ X ]</a>
			Tambah Barang
		</div>
		<div id="layer1_content">
			<form id="layer1_form" method="post" action="modul/js_tambah_barang.php">
				
		<?php 

			$ambilSupplier = mysql_query("select * from supplier");
			$ambilKategoriBarang = mysql_query("select * from kategori_barang");
			$ambilSatuanBarang = mysql_query("select * from satuan_barang");
			$ambilRak = mysql_query("select * from rak");



			echo '
			<script>
				function RecalcHargaBarangBaru() {
					var HargaBeli = 0;
					var HargaJual = 0;
					var Subtotal 	= parseInt(document.getElementById("subtotal").value);
					var PPN 	= parseInt(document.getElementById("bppn").value);
					var JumlahBarang = parseInt(document.getElementById("tjumBarang").value);
					var PersenProfit = parseInt(document.getElementById("PersenProfit").value);

					if(Subtotal > 0){
						HargaBeli = (Subtotal / JumlahBarang);
					}

					if(Subtotal < 1){
						HargaBeli = parseInt(document.getElementById("hargaBeli").value);
					}

					// mencegah keliru input barcode di kolom JumlahBarang
					if(JumlahBarang > 2000){
						JumlahBarang = 0;
					}

					HargaJual = HargaBeli + ((HargaBeli / 100) * PPN) + ((HargaBeli / 100) * PersenProfit);

					document.getElementById("hargaBeli").value = HargaBeli;
					document.getElementById("hargaJual").value = HargaJual;
                                        document.getElementById("tjumBarang").value = JumlahBarang;

				}

			</script>';


			echo "
		          <table>
			          <tr><td>* <u>B</u>arcode</td><td> : <input type=text accesskey='b' name='barcode' id='barcode' size=30 value='$_GET[id]' tabindex=20 > 
				</td></tr>


			          <tr><td>* Nama Barang</td><td> : <input type=text name='namaBarang' size=30 maxlength=30 tabindex=21></td></tr>
			          <tr><td>* Supplier</td>
			                <td> : <select name='supplier' tabindex=22>";
		                            while($supplier = mysql_fetch_array($ambilSupplier)){
		                                if ($supplier[idSupplier] == $_SESSION[idSupplier]) {
							echo "<option value='$supplier[idSupplier]'>$supplier[namaSupplier]</option>";
						};
                            }
            		echo "</select></td></tr> 
			        <tr><td>* Kategori Barang</td>
				<td> : <select name='kategori_barang' tabindex=23>
	                            <option value='0'>- Kategori Barang-</option>";
        	                    while($kategori = mysql_fetch_array($ambilKategoriBarang)){
       		                         echo "<option value='$kategori[idKategoriBarang]'>$kategori[namaKategoriBarang]</option>";
                	            }
					echo "</select></td></tr>
          
				<tr><td>* Satuan Barang</td>
		                <td> : <select name='satuan_barang' tabindex=24>
	                            <option value='0'>- Satuan Barang-</option>";
	                            while($satuan = mysql_fetch_array($ambilSatuanBarang)){
	                                echo "<option value='$satuan[idSatuanBarang]'>$satuan[namaSatuanBarang]</option>";
	                            }
			            echo "</select></td></tr>

                                <tr><td>* Rak</td>
                                <td> : <select name='rak' tabindex=25>
                                    <option value='0'>- Rak -</option>";
                                    while($rak = mysql_fetch_array($ambilRak)){
                                        echo "<option value='$rak[idRak]'>$rak[idRak] :: $rak[namaRak]</option>";
                                    }
                                    echo "</select></td></tr>



			<tr background=#666666><td>Subtotal</td><td> : <input type=text name='subtotal' id='subtotal' value=0 tabindex=25 /></td></tr>
			<tr background=#666666><td>* Jumlah Barang</td><td> : <input type=text name='jumBarang' id='tjumBarang' value=1 tabindex=26 /></td></tr>
			<tr background=#666666><td>PPN </td><td> : <input type=text name='ppn' id='bppn' value='10' tabindex=27 /> %</td></tr>
			<tr background=#666666><td>% Profit</td><td> : <input type=text value='0' name='PersenProfit' id='PersenProfit' tabindex=28 /></td></tr>

			<tr><td>* Harga Beli Barang</td><td> : <input type=text name='hargaBeli' id='hargaBeli' value=0 tabindex=29 /> <a href='#' onclick=\"RecalcHargaBarangBaru();\" accesskey='h'>  (h) <i><b>H</b></i>itung Harga</td></tr>
			<tr><td>* Harga Jual Barang</td><td> : <input type=text name='hargaJual' id='hargaJual' value=0 tabindex=30 /></td></tr>
			<tr><td>Tanggal Expire</td><td> : <input type=text name='tglExpire' size=10 tabindex=31 />(yyyy-mm-dd)</td></tr>

			<tr><td colspan=2>&nbsp;
				<input type=hidden name=username value='$_SESSION[uname]'>
			</td></tr>


		          <tr><td colspan=2 align='right'><input type=submit value='(s) Simpan' accesskey='s' tabindex=32>&nbsp;&nbsp;&nbsp;
                            </td></tr>
          </table>
	";
?>

			</form>
		</div>
	</div>


<?php



/* CHANGELOG -----------------------------------------------------------

 1.0.4 /20110724 : Harry Sufehmi	: Input Beli @ Gudang: 
					## bugfix: tidak semua pembelian tercatat di detail_beli
					## revisi: jika barcode sudah ada di barang, maka cetak namaBarang di database & di Invoice,
					agar user bisa membandingkan, dan mengkoreksi jika diperlukan.
					(contoh: barcode sama, tapi nama barang nya berbeda)
 1.0.3 /20110720 : Harry Sufehmi	: fitur Pembelian - Input Beli @ Gudang
 1.0.2	: Harry Sufehmi		: kini tidak bisa keliru input barcode di kolom quantity barang
 1.0.1	: Harry Sufehmi		: perhitungan PPN dibetulkan : kurangi diskon dulu - baru kemudian hitung PPN
		# saat input nota, daftar barang kini diurut berdasarkan urutan input (FIFO)
 0.6.5  : Gregorius Arief	: initial release

------------------------------------------------------------------------ */

?>
<?php
/* js_input_retur_barang.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../../config/config.php";
include "function.php";


session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{


        // catat nama printer yang sudah dipilih
        if (!empty($_POST[namaPrinter])) {
		$_SESSION[namaPrinter] = $_POST[namaPrinter];
	};


	//HS javascript untuk menampilkan popup
?>	
	<head>


	<SCRIPT TYPE="text/javascript">
	<!--
	function popupform(myform, windowname)
	{
		if (! window.focus)return true;
		window.open('', windowname, 'height=400,width=700,scrollbars=yes');
		myform.target=windowname;
		return true;
	}

	function number_format(a, b, c, d) {
	// credit: http://www.krisnanda.web.id/2009/06/09/javascript-number-format/
	
		 a = Math.round(a * Math.pow(10, b)) / Math.pow(10, b);

		 e = a + '';
		 f = e.split('.');
		 if (!f[0]) {  f[0] = '0';}
		 if (!f[1]) {  f[1] = '';  }

		 if (f[1].length < b) {
			  g = f[1];
			  for (i=f[1].length + 1; i <= b; i++) {
				   g += '0';
			  }
			  f[1] = g;
		 }

		 if(d != '' && f[0].length > 3) {
			  h = f[0];
			  f[0] = '';
			  for(j = 3; j < h.length; j+=3) {
				   i = h.slice(h.length - j, h.length - j + 3);
				   f[0] = d + i +  f[0] + '';
			  }
			  j = h.substr(0, (h.length % 3 == 0) ? 3 : (h.length % 3));
			  f[0] = j + f[0];
		 }

		 c = (b <= 0) ? '' : c;
		return f[0] + c + f[1];
	}

	-->
	</SCRIPT>


	
 	<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css' />

	</head>
<?php

if ($_GET[doit]=='hapus') {
	$sql = "DELETE FROM tmp_detail_retur_barang WHERE uid = $_GET[uid]";
	//echo $sql;
	$hasil = mysql_query($sql);
}


	//fixme: hargaBeli TIDAK tersimpan di detail_jual !!!



switch($_GET[act]){ // ============================================================================================================


    case "caricustomer": // ========================================================================================================
        

        // catat nama printer yang sudah dipilih
        //$_SESSION[namaPrinter] = $_POST[namaPrinter];

        echo "<h2>RETUR Barang</h2>

		<div style='float:right' id='tot_pembelian'><span style='font-size:48pt'>".number_format($_SESSION[tot_retur],0,',','.')."</span></div>


		";

        echo "<h3>Barang yang di RETUR</h3>

                    <table>
                        <tr>
                            <td colspan=3>

				<form method=POST action='js_input_retur_barang.php?act=caricustomer&action=tambah'>
				(b) Barcode</td><td>: <input type=text name='barcode' accesskey='b' id='barcode'></td>
		";

	echo "
                            <td>(q) Qty</td><td>: <input type=text name='jumBarang' value='1' size=5 accesskey='q'></td>
                            <td align=right><input type=submit name='btnTambah' value='(t) Tambah' accesskey='t'></td>
			    </form>

			<td>
			<FORM METHOD=POST ACTION=\"js_cari_barang.php?caller=js_input_retur_barang\" onSubmit=\"popupform(this, 'cari1')\">
			<input type=text name='namabarang' accesskey='c'>
			<input type=submit name='btnCari' id='btnCari' value='(c) Cari Barang'>
			</form>
			</td>

                        </tr>
                    </table>
                </form>

		<script>
			var dropBox=document.getElementById(\"barcode\" );
			if (dropBox!=null ) dropBox.focus();
		</script>

            ";

        if($_GET[action]=='tambah'){

	if($_GET[barcode]) {$_POST[barcode]=$_GET[barcode];};
            $trueJual = cekBarangTempRetur($_POST[barcode]);
//            echo "$trueJual";
            if($trueJual != 0){
                
                tambahBarangReturAda($_POST[barcode],$_POST[jumBarang]);
            }
            else{
                
              tambahBarangRetur($_POST[barcode],$_POST[jumBarang]);
            }
        }


	// mulai cetak daftar transaksi retur sejauh ini
	$sql = "SELECT *
                                FROM tmp_detail_retur_barang tdj, barang b
                                WHERE tdj.barcode = b.barcode AND tdj.username = '$_SESSION[uname]'";

	//echo $sql;
        $query = mysql_query($sql);
        $r = mysql_fetch_row($query);
        echo "<hr/>";
        if($r){

            echo "<table class=tableku width=600>
                    <tr><th>Barcode</th><th>Nama Barang</th>
                        <th>Jumlah</th>
                        <th>Harga</th>
                        <th>Total</th>
			<th>Aksi</th></tr>";
                $no=1;
		$tot_retur = 0;

                $query2 = mysql_query("SELECT tdj.uid, tdj.barcode, b.namaBarang, tdj.jumBarang, tdj.hargaBeli, tdj.tglTransaksi
                                        FROM tmp_detail_retur_barang tdj, barang b
                                        WHERE tdj.barcode = b.barcode AND tdj.username = '$_SESSION[uname]' 
					ORDER BY tglTransaksi DESC");

                while ($data=mysql_fetch_array($query2)){
                    $total = $data[hargaBeli] * $data[jumBarang];
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                    echo "<td>$data[barcode]</td><td>$data[namaBarang]</td>
                        <td align=right>$data[jumBarang]</td>
                        <td align=right>$data[hargaBeli]</td><td align=right>".number_format($total,0,',','.')."</td>
			<td align=right> <a href='js_input_retur_barang.php?act=caricustomer&doit=hapus&uid=$data[uid]'>Hapus</a></td>
                        </tr>";
                    $tot_retur += $total;
                    $no++;
                }

                echo "</table>";

                echo "

			<form method=POST action='../aksi.php?module=retur_barang&act=input'>
                        <input type=hidden name='tot_retur' value='$tot_retur'>
                        <input type=hidden name='namaPrinter' value='$_SESSION[namaPrinter]'>


			<table class=tableku width=600>
                        <tr><td width=65% align=right>Total Retur</td><td align=right><div id='TotalBeli'>".number_format($tot_retur,0,',','.')."</div></td></tr>		

		<script>
			document.getElementById('tot_pembelian').innerHTML = '<span style=\"font-size:48pt\">".number_format($tot_retur,0,',','.')."</span>';
		</script>

		";

		$_SESSION[tot_retur] = $tot_retur;

		echo "

                        <tr><td> [<a href='../aksi.php?module=retur_barang&act=batal'> BATAL </a>]</td><td align=right>&nbsp;&nbsp;&nbsp;

	<input type=submit value='Simpan'>
			</td></tr>
                        </table></form>";


        }
        else{
            echo "Belum ada barang yang di Retur<br />
            <a href='../aksi.php?module=retur_barang&act=batal'>BATAL</a>
		";
        }
        
	echo "		<div style='float:right'><img src='../../image/logo-ahadpos-1.gif'></div>";

        break;
}

} // if (empty($_SESSION[namauser])



/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-11-22 : Harry Sufehmi		: initial release
------------------------------------------------------------------------ */

?>
<?php
/* js_jual_barang.php ----------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../../config/config.php";
include "function.php";


session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{

        if(!isset($_SESSION[idCustomer])){
           findCustomer($_POST[idCustomer]);
        }


	//HS javascript untuk menampilkan popup
?>	
	<head>


	<SCRIPT TYPE="text/javascript">
	<!--
	function popupform(myform, windowname)
	{
		if (! window.focus)return true;
		window.open('', windowname, 'height=400,width=700,scrollbars=yes');
		myform.target=windowname;
		return true;
	}

	function number_format(a, b, c, d) {
	// credit: http://www.krisnanda.web.id/2009/06/09/javascript-number-format/
	
		 a = Math.round(a * Math.pow(10, b)) / Math.pow(10, b);

		 e = a + '';
		 f = e.split('.');
		 if (!f[0]) {  f[0] = '0';}
		 if (!f[1]) {  f[1] = '';  }

		 if (f[1].length < b) {
			  g = f[1];
			  for (i=f[1].length + 1; i <= b; i++) {
				   g += '0';
			  }
			  f[1] = g;
		 }

		 if(d != '' && f[0].length > 3) {
			  h = f[0];
			  f[0] = '';
			  for(j = 3; j < h.length; j+=3) {
				   i = h.slice(h.length - j, h.length - j + 3);
				   f[0] = d + i +  f[0] + '';
			  }
			  j = h.substr(0, (h.length % 3 == 0) ? 3 : (h.length % 3));
			  f[0] = j + f[0];
		 }

		 c = (b <= 0) ? '' : c;
		return f[0] + c + f[1];
	}


	function RecalcTotal(tot_pembelian) {
		var totalBeli = 0;
		var Kembali = 0;
		var uangDibayar 	= parseInt(document.getElementById("uangDibayar").value);
		var surcharge	 	= parseInt(document.getElementById("surcharge").value);

		totalSurcharge		= ((tot_pembelian / 100) * surcharge);
		totalBeli 		= tot_pembelian + totalSurcharge;
		Kembali 		= uangDibayar - totalBeli;

		document.getElementById("uangKembali").value = Kembali;
		document.getElementById("kembalian").innerHTML = '<span style="font-size:48pt">' + number_format(Kembali,0,',','.') + '</span>';

		document.getElementById("TotalSurcharge").value = number_format(totalSurcharge,0,',','.');
		document.getElementById("tot_pembelian").innerHTML = '<span style="font-size:48pt">' + number_format(totalBeli,0,',','.') + '</span>';
	}

	-->
	</SCRIPT>


	
 	<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css' />

	</head>
<?php

if ($_GET[doit]=='hapus') {
	$sql = "DELETE FROM tmp_detail_jual WHERE uid = $_GET[uid]";
	$hasil = mysql_query($sql);
}


	//fixme: hargaBeli TIDAK tersimpan di detail_jual !!!



switch($_GET[act]){ // ============================================================================================================


    case "caricustomer": // ========================================================================================================
        
        echo "<h2>Penjualan Barang</h2>

		<div style='float:right' id='tot_pembelian'><span style='font-size:48pt'>".number_format($_SESSION[tot_pembelian],0,',','.')."</span></div>

		Penjualan Barang untuk customer : $_SESSION[namaCustomer]
                
		";

        echo "<h3>Barang yang dijual</h3>

                    <table>
                        <tr>
                            <td colspan=3>

				<form method=POST action='js_jual_barang.php?act=caricustomer&action=tambah'>
				(b) Barcode</td><td>: <input type=text name='barcode' accesskey='b' id='barcode'></td>
		";

	// ----- TERLALU LAMBAT ! ----- jangan gunakan dropbox terlampir untuk memilih barcode
	// ambil daftar barang
	//$sql="SELECT namaBarang,barcode,hargaJual   
	//	FROM barang FORCE INDEX (barcode) ORDER BY barcode ASC";
	//$namaBarang=mysql_query($sql);
	//while($brg = mysql_fetch_array($namaBarang)){
	//	echo "<option value='$brg[barcode]'>$brg[barcode] - $brg[namaBarang] - Rp ".number_format($brg[hargaJual],0,',','.')."</option>\n";
	//}	

	echo "
                            <td>(q) Qty</td><td>: <input type=text name='jumBarang' value='1' size=5 accesskey='q'></td>
                            <td align=right><input type=submit name='btnTambah' value='(t) Tambah' accesskey='t'></td>
			    </form>

			<td>
			<FORM METHOD=POST ACTION=\"js_cari_barang.php?caller=js_jual_barang\" onSubmit=\"popupform(this, 'cari1')\">
			<input type=text name='namabarang' accesskey='c'>
			<input type=submit name='btnCari' id='btnCari' value='(c) Cari Barang'>
			</form>
			</td>

                        </tr>
                    </table>
                </form>

		<script>
			var dropBox=document.getElementById(\"barcode\" );
			if (dropBox!=null ) dropBox.focus();
		</script>

            ";

        if($_GET[action]=='tambah'){

	if($_GET[barcode]) {$_POST[barcode]=$_GET[barcode];};
            $trueJual = cekBarangTempJual($_SESSION[idCustomer],$_POST[barcode]);
//            echo "$trueJual";
            if($trueJual != 0){
                
                tambahBarangJualAda($_SESSION[idCustomer],$_POST[barcode],$_POST[jumBarang]);
            }
            else{
                
              tambahBarangJual($_POST[barcode],$_POST[jumBarang]);
            }
        }
	$sql = "SELECT *
                                FROM tmp_detail_jual tdj, barang b
                                WHERE tdj.barcode = b.barcode AND tdj.idCustomer = '$_SESSION[idCustomer]' AND tdj.username = '$_SESSION[uname]'";
	//echo $sql;
        $query = mysql_query($sql);
        $r = mysql_fetch_row($query);
        echo "<hr/>";
        if($r){
            //echo "Ada $r[0] data";
            echo "<table class=tableku width=600>
                    <tr><th>Barcode</th><th>Nama Barang</th>
                        <th>Jumlah</th>
                        <th>Harga</th>
                        <th>Total</th>
			<th>Aksi</th></tr>";
                $no=1;
                $tot_pembelian=0;

                $query2 = mysql_query("SELECT tdj.uid, tdj.barcode, b.namaBarang, tdj.jumBarang, tdj.hargaJual, tdj.tglTransaksi
                                        FROM tmp_detail_jual tdj, barang b
                                        WHERE tdj.barcode = b.barcode AND tdj.idCustomer = '$_SESSION[idCustomer]' 
						AND tdj.username = '$_SESSION[uname]' ORDER BY tglTransaksi DESC");
		
                while ($data=mysql_fetch_array($query2)){
                    $total = $data[hargaJual] * $data[jumBarang];
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";
                    echo "<td>$data[barcode]</td><td>$data[namaBarang]</td>
                        <td align=right>$data[jumBarang]</td>
                        <td align=right>$data[hargaJual]</td>
			<td align=right>".number_format($total,0,',','.')."</td>
			<td align=right> <a href='js_jual_barang.php?act=caricustomer&doit=hapus&uid=$data[uid]'>Hapus</a></td>
                        </tr>";
                    $tot_pembelian += $total;
                    $no++;
                }

                echo "</table>";
                $pmbyrn = mysql_query("SELECT * from pembayaran");
                echo "

			<form method=POST action='../aksi.php?module=penjualan_barang&act=input'>
                        <input type=hidden name='tot_pembayaran' value='$tot_pembelian'>

			<div id='kembalian' style='float:right'></div>

			<table class=tableku width=600>
                        <tr><td width=65% align=right>Total Pembelian</td><td align=right><div id='TotalBeli'>".number_format($tot_pembelian,0,',','.')."</div></td></tr>

		<script>
			document.getElementById('tot_pembelian').innerHTML = '<span style=\"font-size:48pt\">".number_format($tot_pembelian,0,',','.')."</span>';
		</script>

		";

		$_SESSION[tot_pembelian] = $tot_pembelian;

		echo "
                        <tr><td width=65% align=right>(a) Tipe Pembayaran</td>
                            <td align=right><select name='tipePembayaran' accesskey='a' tabindex=1>
                                        <option value='0'>-Tipe Pembayaran-</option>";

		while($pembayaran = mysql_fetch_array($pmbyrn)){
			if ($pembayaran[tipePembayaran]=='CASH') {
				echo "<option value='$pembayaran[idTipePembayaran]' selected>$pembayaran[tipePembayaran]</option>";
			} else {
				echo "<option value='$pembayaran[idTipePembayaran]'>$pembayaran[tipePembayaran]</option>";
			}
		}

                        echo "</select></td></tr>
                        <tr><td width=65% align=right>Surcharge</td><td align=right><input type=text name='surcharge' id='surcharge' value=0 size=2 tabindex=2> % (Rp <input type=text name='TotalSurcharge' id='TotalSurcharge' value=0 size=6  tabindex=100 readonly>)</td></tr>
                        <tr><td width=65% align=right>Uang Dibayar</td><td align=right><input type=text name='uangDibayar' id='uangDibayar' value=0 onBlur='RecalcTotal($tot_pembelian)'  tabindex=3></td></tr>
                        <tr><td width=65% align=right>Kembali</td><td align=right><input type=text name='uangKembali' id='uangKembali' value=0></td></tr>
                        <tr><td colspan=2>&nbsp;</td></tr>


                        <tr><td> [<a href='../aksi.php?module=penjualan_barang&act=batal'> BATAL </a>]</td><td align=right>&nbsp;&nbsp;&nbsp;<input type=submit value='Simpan' onclick='this.disabled=true;'></td></tr>
                        </table></form>";


        }
        else{
            echo "Belum ada barang yang dibeli<br />
            <a href='../aksi.php?module=penjualan_barang&act=batal'>BATAL</a>
		";
        }
        
	echo "		<div style='float:right'><img src='../../image/logo-ahadpos-1.gif'></div>";

        break;
}

} // if (empty($_SESSION[namauser])



/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: perhitungan Surcharge dibetulkan
 0.9.2 / 2010-03-03 : Harry Sufehmi 		: initial release
------------------------------------------------------------------------ */

?>
<?php
/* mod_customer.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
  // Tampil customer -> menampilkan semua daftar customer tanpa paging
  default:
    echo "<h2>Data Customer</h2>
          <form method=POST action='?module=customer&act=tambahcustomer'>
          <input type=submit value='Tambah Customer'></form>
          <br/>
          <table class=tableku>
          <tr><th>no</th><th>Nama Customer</th><th>Alamat Customer</th>
                <th>No.Telp Customer</th><th>aksi</th></tr>";
    $tampil=mysql_query("select idCustomer, namaCustomer, alamatCustomer, telpCustomer from customer");
    $no=1;
    while ($r=mysql_fetch_array($tampil)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=right class=td>$no</td>
             <td class=td>$r[namaCustomer]</td>
             <td align=center class=td>$r[alamatCustomer]</td>
             <td align=center class=td>$r[telpCustomer]</td>
             <td class=td width=70><a href=?module=customer&act=editcustomer&id=$r[idCustomer]>Edit</a> |
	               <a href=./aksi.php?module=customer&act=hapus&id=$r[idCustomer]>Hapus</a>
             </td></tr>";
      $no++;
    }
    echo "</table>
    <p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;

  case "tambahcustomer":
    echo "<h2>Tambah Customer</h2>
          <form method=POST action='./aksi.php?module=customer&act=input' name='tambahcustomer'>
          <table>
          <tr><td>Nama Customer</td><td> : <input type=text name='namaCustomer' size=40></td></tr>
          <tr><td>Alamat Customer</td><td> : <textarea name='alamatCustomer' rows='2' cols='35'></textarea></td></tr>
          <tr><td>Telp Customer</td><td> : <input type=text name='telpCustomer' size=15></td></tr>
          <tr><td>Keterangan</td><td> : <textarea name='keterangan' rows='4' cols='35'></textarea></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
     break;

  case "editcustomer":
    $edit=mysql_query("SELECT * FROM customer WHERE idCustomer='$_GET[id]'");
    $data=mysql_fetch_array($edit);

    echo "<h2>Edit Customer</h2>
          <form method=POST action=./aksi.php?module=customer&act=update name='editcustomer'>
          <input type=hidden name='idCustomer' value='$data[idCustomer]'>
          <table>
          <tr><td>Nama Customer</td><td> : <input type=text name='namaCustomer' size=40 value='$data[namaCustomer]'></td></tr>
          <tr><td>Alamat Customer</td><td> : <textarea name='alamatCustomer' rows='2' cols='35'>$data[alamatCustomer]</textarea></td></tr>
          <tr><td>Telp Customer</td><td> : <input type=text name='telpCustomer' size=15 value='$data[telpCustomer]'></td></tr>
          <tr><td>Keterangan</td><td> : <textarea name='keterangan' rows='4' cols='35'>$data[keterangan]</textarea></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
    break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_hutang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
    default:
        echo "
        <h2>Daftar Hutang</h2>
        <table class=tableku>
          <tr><th>no</th><th>Id Transaksi</th><th>Nama Supplier</th>
                <th>Tgl Harus Bayar</th><th>Nominal</th><th>No.Invoice</th><th>Aksi</th></tr>";
        $tampil=mysql_query("select h.idTransaksiBeli, namaSupplier, h.nominal, h.tglBayar, NomorInvoice
        from supplier s,hutang h,transaksibeli tb
        where h.idTransaksiBeli = tb.idTransaksiBeli and s.idSupplier = tb.idSupplier");
        $no=1;
        while ($r=mysql_fetch_array($tampil)){
            $tgl = tgl_indo($r[tglBayar]);
            //untuk mewarnai tabel menjadi selang-seling
            if(($no % 2) == 0){
                $warna = "#EAF0F7";
            }
            else{
                $warna = "#FFFFFF";
            }
            echo "<tr bgcolor=$warna>";//end warna
           echo "<td align=right class=td>$no</td>
                 <td class=td align=center>$r[idTransaksiBeli]</td>
                 <td align=center class=td>$r[namaSupplier]</td>
                 <td align=center class=td>$tgl</td>
                 <td align=right class=td>".uang($r[nominal])."</td>
                 <td align=center class=td>$r[NomorInvoice]</td>
                 <td align=center class=td><a href=?module=hutang&act=lihatdetail&id=$r[idTransaksiBeli]>Lihat</a> | <a href=?module=hutang&act=edittrans&id=$r[idTransaksiBeli]>Edit</a></td>
                 </tr>";
          $no++;
        }
        echo "</table>
        <p>&nbsp;</p>
        <a href=javascript:history.go(-1)><< Kembali</a>";

        break;


    case "lihatdetail": // ----------------------------------------------------------------------------
        $transaksiBeli = detailTransaksiBeli($_GET[id]);
        $dataTrans = mysql_fetch_array($transaksiBeli);
        echo "<h2>Detail Hutang</h2>
            <table>
                <tr><td>Nomor Invoice</td><td> : </td><td>$dataTrans[NomorInvoice]</td><td width=10>&nbsp;</td>
                    <td>Tgl Transaksi</td><td> : </td><td>$dataTrans[tglTransaksiBeli]</td></tr>
                <tr><td>No Transaksi Beli</td><td> : </td><td>$dataTrans[idTransaksiBeli]</td><td width=10>&nbsp;</td>
                    <td>Nama Supplier</td><td> : </td><td>$dataTrans[namaSupplier]</td></tr>
            </table><br/>
            ";
        echo "<table>
            <tr><th>barcode</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th></tr>
            ";
        $barangTransaksiBeli = detailBarangTransaksiBeli($_GET[id]);
        $no = 1;
        while($dataBarangTrans = mysql_fetch_array($barangTransaksiBeli)){
            $total = $dataBarangTrans[jumBarang]*$dataBarangTrans[hargaBeli];
            //untuk mewarnai tabel menjadi selang-seling
            if(($no % 2) == 0){
                $warna = "#EAF0F7";
            }
            else{
                $warna = "#FFFFFF";
            }
            echo "<tr bgcolor=$warna>";//end warna
            echo "<td class=td>$dataBarangTrans[barcode]</td>
                  <td class=td>$dataBarangTrans[namaBarang]</td>
                  <td class=td>".tgl_indo($dataBarangTrans[tglExpire])."</td>
                  <td class=td align=right>$dataBarangTrans[jumBarang]</td>
                  <td class=td align=right>".uang($dataBarangTrans[hargaBeli])."</td>
                  <td class=td align=right>".uang($total)."</td>                  
                ";
            echo "</tr>";
        }
        echo "<tr><td class=td colspan=4 align=right>Total</td><td class=td colspan=2 align=right>".uang($dataTrans[nominal])."</td></tr>
            
            <tr><td colspan=6 class=td>&nbsp;</td></tr>
            <tr><td colspan=3 class=td><a href=?module=hutang>Kembali</a></td><td colspan=3 class=td><a href=?module=hutang&act=edittrans&id=$_GET[id]>Edit</a></td></tr>
            </table>";

        break;

    case "edittrans":
        if($_GET[action] == 'update'){
            $_GET[id] = $_POST[idTransaksiBeli];
//            echo "$_POST[idTransaksiBeli], $_POST[idBarang], $_POST[jumBarang], $_POST[hargaBeli]";
            editBarangBeli($_POST[idTransaksiBeli], $_POST[idBarang], $_POST[jumBarangLama], $_POST[jumBarang], $_POST[hargaBeli]);
        }
        $transaksiBeli = detailTransaksiBeli($_GET[id]);
        $dataTrans = mysql_fetch_array($transaksiBeli);
        echo "<h2>Edit Transaksi Beli</h2>
            <table>
                <tr><td>Nomor Invoice</td><td> : </td><td>$dataTrans[NomorInvoice]</td><td width=10>&nbsp;</td>
                    <td>Tgl Transaksi</td><td> : </td><td>$dataTrans[tglTransaksiBeli]</td></tr>
                <tr><td>No Transaksi Beli</td><td> : </td><td>$dataTrans[idTransaksiBeli]</td><td width=10>&nbsp;</td>
                    <td>Nama Supplier</td><td> : </td><td>$dataTrans[namaSupplier]</td></tr>
            </table><br/>
            ";
        echo "<table>
            <tr><th>barcode</th><th>Nama Barang</th><th>Tgl Expire</th><th>Jumlah</th><th>Harga Beli</th><th>Total</th><th>AKSI</th></tr>
            ";

        $barangTransaksiBeli = detailBarangTransaksiBeli($dataTrans[idTransaksiBeli]);
        $no = 1;
        while($dataBarangTrans = mysql_fetch_array($barangTransaksiBeli)){
            $total = $dataBarangTrans[jumBarang]*$dataBarangTrans[hargaBeli];
            //untuk mewarnai tabel menjadi selang-seling
            if(($no % 2) == 0){
                $warna = "#EAF0F7";
            }
            else{
                $warna = "#FFFFFF";
            }
            echo "<tr bgcolor=$warna>";//end warna
            echo "<form method=POST action='?module=hutang&act=edittrans&action=update'>
                <input type=hidden name=idBarang value=$dataBarangTrans[idBarang]>
                <input type=hidden name=idTransaksiBeli value=$_GET[id]>
                <input type=hidden name=jumBarangLama value=$dataBarangTrans[jumBarang]>
                <td class=td>$dataBarangTrans[barcode]</td>
                  <td class=td>$dataBarangTrans[namaBarang]</td>
                  <td class=td>".tgl_indo($dataBarangTrans[tglExpire])."</td>
                  <td class=td align=right><input type=text name=jumBarang size=10 value=$dataBarangTrans[jumBarang]></td>
                  <td class=td align=right><input type=text name=hargaBeli value=$dataBarangTrans[hargaBeli]></td>
                  <td class=td align=right>".uang($total)."</td>
                  <td class=td align=center><input type=submit value=Update></td>
                  </form>
                ";
            echo "</tr>";
        }
        $nominal = nominalBeli($_GET[id]);

        echo "<tr><td class=td colspan=4 align=right>Total</td><td class=td colspan=2 align=right>".uang($nominal)."</td></tr>
            </table>";
        echo "<br/><a href=?module=hutang>Kembali</a>";
        break;
}



/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.1		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php   
/* js_tambah_barang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../../config/config.php";

	// simpan di tmp_detail_beli
    $tgl = date("Y-m-d");


	//fixme: potensi masalah: 
	// jika barcode dimasukkan sudah ada - dan suppliernya berbeda
	// solusi: validasi sebelum INSERT bahwa suppliernya juga sama.
	mysql_query("INSERT into tmp_detail_beli(idSupplier, tglTransaksi,
                        barcode,jumBarang,hargaBeli,hargaJual,username)
                    VALUES('$_POST[supplier]','$tgl','$_POST[barcode]',
                        '$_POST[jumBarang]','$_POST[hargaBeli]','$_POST[hargaJual]','$_POST[username]')");

	// catat nomor idBarang yang di generate oleh MySQL
	$idBarang = mysql_insert_id();
	echo "idBarang = $idBarang";

	// buat record nya di tabel barang
    	$tgl = date("Y-m-d");
    	mysql_query("INSERT INTO barang(namaBarang, idKategoriBarang, idSatuanBarang, jumBarang, hargaJual, last_update, idSupplier, barcode, idBarang, idRak)
                    VALUES('$_POST[namaBarang]', '$_POST[kategori_barang]','$_POST[satuan_barang]',0,'$_POST[hargaJual]', 
                    '$tgl','$_POST[supplier]', '$_POST[barcode]', $idBarang, $_POST[rak])");
	// jumBarang = 0  karena ini nanti akan ditambahkan isinya dari function.php, 
	// kalau diisi disini, maka akan ditambah lagi oleh function.php - dan jadi dobel



	// jika barang sudah ada, INSERT diatas akan gagal (karena barcode tidak bisa dobel di tabel barang), 
	// dan mysql_insert_id() akan menghasilkan 0 = idBarang = 0,
	// maka kita cari idBarang nya di tabel barang
	if ($idBarang == 0) {
		$sql = "SELECT idBarang FROM barang WHERE barcode='$_POST[barcode]'";
		$hasil = mysql_query($sql); 
		if ($x = mysql_fetch_array($hasil)) {
			$idBarang = $x[idBarang];
		}
	}


/*
	echo "            <form method=POST action='?module=pembelian_barang&act=carisupplier&action=tambah'>
                <table>
                    <tr>
                        <td>Barcode</td><td> : <input type=text name='barcode' value='$_POST[barcode]' readonly='readonly' />
				<input type=hidden name='idBarang' value=".$idBarang." /></td>
			<td></td>
                    </tr>
                    <tr>
                        <td>Nama Barang</td><td> : <input type=text name='namaBarang' value='$_POST[namaBarang]' readonly='readonly' /></td>
                        <td><u>j</u>umlah yang dibeli</td><td> : <input type=text name='jumBarang' value='$_POST[jumBarang]' accesskey='j' tabindex=1/></td>                        
                    </tr>
			<tr>
				<td>Harga Beli Sekarang</td><td> : <input type=text name='hargaBeliLama' value='$_POST[hargaBeli]' readonly='readonly' /></td>
	                        <td>Harga Beli Barang</td><td> : <input type=text name='hargaBeliBaru' value='$_POST[hargaBeli]' tabindex=2/></td>
			</tr>
                    <tr>
                        <td>Harga Jual Sekarang</td><td> : <input type=text name='hargaJualLama' value='$_POST[hargaJual]' readonly='readonly' /></td>
                        <td>Harga Jual Barang</td><td> : <input type=text name='hargaJualBaru' value='$_POST[hargaJual]' tabindex=3/></td>
                    </tr>                    
                    <tr>
                        <td colspan=2>&nbsp</td>
                        <td>Tanggal Expire</td><td> : <input type=text name='tglExpire' size=10 tabindex=4/>(yyyy-mm-dd)</td>
                    </tr>
                    <tr>
                        <td align=right colspan=4><input type=submit value='(t) Tambah' name=btTambah accesskey='t' tabindex=5></td>
                    </tr>
                </table>
            </form>";
*/


	echo "<script>window.location.reload()</script>";


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.3 / 2010-04-16 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_supplier.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
  // Tampil supplier -> menampilkan semua daftar supplier tanpa paging
  default:
    echo "<h2>Data Supplier</h2>
          <form method=POST action='?module=supplier&act=tambahsupplier'>
          <input type=submit value='Tambah Supplier'></form>
          <br/>
          <table class=tableku>
          <tr><th>no</th><th>Nama Supplier</th><th>Alamat Supplier</th>
                <th>No.Telp Supplier</th><th>aksi</th></tr>";
    $tampil=mysql_query("select idSupplier, namaSupplier, alamatSupplier, telpSupplier from supplier");
    $no=1;
    while ($r=mysql_fetch_array($tampil)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=right class=td>$no</td>
             <td class=td>$r[namaSupplier]</td>
             <td align=center class=td>$r[alamatSupplier]</td>
             <td align=center class=td>$r[telpSupplier]</td>
             <td class=td width=70><a href=?module=supplier&act=editsupplier&id=$r[idSupplier]>Edit</a> |
	               <a href=./aksi.php?module=supplier&act=hapus&id=$r[idSupplier]>Hapus</a>
             </td></tr>";
      $no++;
    }
    echo "</table>
    <p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;

  case "tambahsupplier":
    echo "<h2>Tambah Supplier</h2>
          <form method=POST action='./aksi.php?module=supplier&act=input' name='tambahsupplier'>
          <table>          
          <tr><td>Nama Supplier</td><td> : <input type=text name='namaSupplier' size=40></td></tr>
          <tr><td>Alamat Supplier</td><td> : <textarea name='alamatSupplier' rows='2' cols='35'></textarea></td></tr>
          <tr><td>Telp Supplier</td><td> : <input type=text name='telpSupplier' size=15></td></tr>
          <tr><td>Keterangan</td><td> : <textarea name='Keterangan' rows='4' cols='35'></textarea></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
     break;

  case "editsupplier":
    $edit=mysql_query("SELECT * FROM supplier WHERE idSupplier='$_GET[id]'");
    $data=mysql_fetch_array($edit);

    echo "<h2>Edit Supplier</h2>
          <form method=POST action=./aksi.php?module=supplier&act=update name='editsupplier'>
          <input type=hidden name='idSupplier' value='$data[idSupplier]'>
          <table>
          <tr><td>Nama Supplier</td><td> : <input type=text name='namaSupplier' size=40 value='$data[namaSupplier]'></td></tr>
          <tr><td>Alamat Supplier</td><td> : <textarea name='alamatSupplier' rows='2' cols='35'>$data[alamatSupplier]</textarea></td></tr>
          <tr><td>Telp Supplier</td><td> : <input type=text name='telpSupplier' size=15 value='$data[telpSupplier]'></td></tr>
          <tr><td>Keterangan</td><td> : <textarea name='Keterangan' rows='4' cols='35'>$data[Keterangan]</textarea></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
    break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_jual_barang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

check_user_access(basename($_SERVER['SCRIPT_NAME']));


	//HS javascript untuk menampilkan popup
?>	
	
	<SCRIPT TYPE="text/javascript">
	<!--
	function popupform(myform, windowname)
	{
		if (! window.focus)return true;
		window.open('', windowname, 'type=fullWindow,fullscreen,scrollbars=yes');
		myform.target=windowname;
		return true;
	}
	//-->
	</SCRIPT>

<?php

	// ambil daftar customer
	$sql="SELECT idCustomer, namaCustomer   
		FROM customer ORDER BY namaCustomer ASC";
	$namaCustomer=mysql_query($sql);

        echo "<h2>Penjualan Barang</h2>
              <form method=POST action='modul/js_jual_barang.php?act=caricustomer' onSubmit=\"popupform(this, 'jual_barang')\">
              (i) ID Customer : <select name='idCustomer' accesskey='i'>";

	while($cust = mysql_fetch_array($namaCustomer)){
		if ($cust[idCustomer]==1) {
			echo "<option value='$cust[idCustomer]' selected>$cust[namaCustomer] :: $cust[idCustomer]</option>\n";
		} else {
			echo "<option value='$cust[idCustomer]'>$cust[namaCustomer] :: $cust[idCustomer]</option>\n";
		};
	}	

	echo "
              </select><p>
		<input type=submit value='(p) Pilih Customer' name='cariCustomer' accesskey='p'/>
              </form>";


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_rak.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
    // Tampil Rak Barang
    default:
        echo "<h2>Tambah Rak Barang</h2>
              <form method=POST action='./aksi.php?module=rak&act=input'>
              <table>
                <tr><td>Tambah Rak</td><td> : <input type=text name='namaRak' size=30></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
              </table>
               </form>
              <br/>
              <h2>Data Rak Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>Rak</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from rak");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaRak]</td>
                         <td class=td><a href=?module=rak&act=editrak&id=$r[idRak]>Edit</a> |
                                   <a href=./aksi.php?module=rak&act=hapus&id=$r[idRak]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>
                <p>&nbsp;</p>
                <a href=javascript:history.go(-1)><< Kembali</a>";
        break;

    case "editrak":
        $edit = mysql_query("select * from rak where idRak = '$_GET[id]'");
        $data = mysql_fetch_array($edit);
        echo "<h2>Edit Rak Barang</h2>
            <form method=POST action='./aksi.php?module=rak&act=update' name='editrak'>
              <input type=hidden name='idRak' value='$data[idRak]'>
              <table>
                <tr><td>Edit Rak</td><td> : <input type=text name='namaRak' size=30 value='$data[namaRak]'></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=button value=Batal onclick=self.history.back()></td></tr>
              </table>
               </form>
            <br/>
              <h2>Data Rak Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>rak</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from rak");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaRak]</td>
                         <td class=td><a href=?module=rak&act=editrak&id=$r[idRak]>Edit</a> |
                                   <a href=./aksi.php?module=rak&act=hapus&id=$r[idRak]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>";
        break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_satuan_barang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
    // Tampil Satuan Barang
    default:
        echo "<h2>Tambah Satuan Barang</h2>
              <form method=POST action='./aksi.php?module=satuan_barang&act=input'>
              <table>
                <tr><td>Tambah Satuan</td><td> : <input type=text name='namaSatuanBarang' size=30></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=reset value='Batal'></td></tr>
              </table>
               </form>
              <br/>
              <h2>Data Satuan Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>Satuan</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from satuan_barang");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaSatuanBarang]</td>
                         <td class=td><a href=?module=satuan_barang&act=editsatuan&id=$r[idSatuanBarang]>Edit</a> |
                                   <a href=./aksi.php?module=satuan_barang&act=hapus&id=$r[idSatuanBarang]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>
                <p>&nbsp;</p>
                <a href=javascript:history.go(-1)><< Kembali</a>";
        break;
        
    case "editsatuan":
        $edit = mysql_query("select * from satuan_barang where idSatuanBarang = '$_GET[id]'");
        $data = mysql_fetch_array($edit);
        echo "<h2>Edit Satuan Barang</h2>
            <form method=POST action='./aksi.php?module=satuan_barang&act=update' name='editsatuan'>
              <input type=hidden name='idSatuanBarang' value='$data[idSatuanBarang]'>
              <table>
                <tr><td>Edit Satuan</td><td> : <input type=text name='namaSatuanBarang' size=30 value='$data[namaSatuanBarang]'></td></tr>
                <tr><td colspan=2 align=right><input type=submit value='Simpan'>&nbsp;&nbsp;&nbsp;
                                <input type=button value=Batal onclick=self.history.back()></td></tr>
              </table>
               </form>
            <br/>
              <h2>Data Satuan Barang</h2>
              <table class=tableku>
              <tr><th>no</th><th>Satuan</th><th>aksi</th></tr>";
                $tampil=mysql_query("SELECT * from satuan_barang");
                $no=1;
                while ($r=mysql_fetch_array($tampil)){
                    //untuk mewarnai tabel menjadi selang-seling
                    if(($no % 2) == 0){
                        $warna = "#EAF0F7";
                    }
                    else{
                        $warna = "#FFFFFF";
                    }
                    echo "<tr bgcolor=$warna>";//end warna
                   echo "<td class=td>$no</td>
                         <td class=td>$r[namaSatuanBarang]</td>
                         <td class=td><a href=?module=satuan_barang&act=editsatuan&id=$r[idSatuanBarang]>Edit</a> |
                                   <a href=./aksi.php?module=satuan_barang&act=hapus&id=$r[idSatuanBarang]>Hapus</a>
                         </td></tr>";
                  $no++;
                }
                echo "</table>";
        break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_piutang.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

include "../config/config.php";
check_user_access(basename($_SERVER['SCRIPT_NAME']));


switch($_GET[act]){
    default:
        echo "
        <h2>Daftar Piutang</h2>
        <table class=tableku>
          <tr><th>no</th><th>Id Transaksi</th><th>Nama Customer</th>
                <th>Tgl Harus Bayar</th><th>Nominal</th></tr>";
        $tampil=mysql_query("select p.idTransaksiJual, namaCustomer, p.tglDiBayar, p.nominal
            from piutang p, transaksijual tj, customer c
            where p.idTransaksiJual = tj.idTransaksiJual and tj.idCustomer = c.idCustomer");
        $no=1;
        while ($r=mysql_fetch_array($tampil)){
            $tgl = tgl_indo($r[tglDiBayar]);
            //untuk mewarnai tabel menjadi selang-seling
            if(($no % 2) == 0){
                $warna = "#EAF0F7";
            }
            else{
                $warna = "#FFFFFF";
            }
            echo "<tr bgcolor=$warna>";//end warna
           echo "<td align=right class=td>$no</td>
                 <td class=td align=center>$r[idTransaksiJual]</td>
                 <td align=center class=td width=40%>$r[namaCustomer]</td>
                 <td align=center class=td>$tgl</td>
                 <td align=center class=td>$r[nominal]</td>
                 </tr>";
          $no++;
        }
        echo "</table>
        <p>&nbsp;</p>
        <a href=javascript:history.go(-1)><< Kembali</a>";

        break;
}


/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.6.5		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* mod_barang.php ------------------------------------------------------
   	version: 1.5.0

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/

if (basename($_SERVER['SCRIPT_NAME']) <> 'media.php') { 
	// when this module is called directly, we'll need to initialize the session properly
	session_start();
	include "../../config/config.php";
	include "function.php"; 
};

check_user_access(basename($_SERVER['SCRIPT_NAME']));




	//HS javascript untuk menampilkan popup
?>	
	
	<SCRIPT TYPE="text/javascript">
	<!--
	function popupform(myform, windowname)
	{
		if (! window.focus)return true;
		window.open('', windowname, 'type=fullWindow,fullscreen,scrollbars=yes');
		myform.target=windowname;
		return true;
	}
	//-->
	</SCRIPT>

<?php




$ambilSupplier = mysql_query("select * from supplier");
$ambilRak = mysql_query("select * from rak");
$ambilKategoriBarang = mysql_query("select * from kategori_barang");
$ambilSatuanBarang = mysql_query("select * from satuan_barang");

	echo "
		<SCRIPT TYPE=\"text/javascript\">
		<!--
		function popupform(myform, windowname)
		{
		if (! window.focus)return true;
		window.open('', windowname, 'type=fullWindow,fullscreen,scrollbars=yes,menubar=yes');
		myform.target=windowname;
		return true;
		}
		//-->
		</SCRIPT>
	";


switch($_GET['act']){
  // Tampil barang 
  default:  // ========================================================================================================================
    echo "<h2>Data barang</h2>
		
	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=tambahbarang'>
          <input type=submit accesskey='t' value='(t) Tambah Barang'></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=caribarang1'>
          <input type=submit accesskey='c' value='(c) Cari Barang'></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=cetaklabel1'>
          <input type=submit accesskey='l' value='(l) Cetak Label'></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=cetakbarang1'>
          <input type=submit accesskey='b' value='(b) Cetak Stock Barang'></form>
	</div>

	<br /><br />

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=cetakSO'>
          <input type=submit accesskey='s' value='(s) Cetak Stock Opname' ></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=inputSO'>
          <input type=submit accesskey='o' value='(o) Input Stock Opname' ></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=inputrak' onSubmit=\"popupform(this, 'inputrak')\" >
          <input type=submit accesskey='i' value='(i) Input Cepat Rak' ></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='../tools/fast-stock-opname/fast-SO.php'>
          || <input type=submit value='Input Fast SO' ></form>
	</div>

	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=ApproveFastSO1'>
          <input type=submit value='Approve Fast SO' ></form>
	</div>

	<br /><br />
	
	<div style=\"float:left\">
          <form method=POST action='?module=barang&act=returbarang1' onSubmit=\"popupform(this, 'inputrak')\" >
	  <form method=POST action='modul/js_input_retur_barang.php?act=caricustomer' onSubmit=\"popupform(this, 'INPUT_RETUR_BARANG')\">
          <input type=submit accesskey='r' value='(r) Input Retur'></form>
	</div>


          <br/>
          <table class=tableku>
          <tr><th>no</th><th>Barcode</th><th>Nama Barang</th><th>Kategori Barang</th>
                <th>Satuan Barang</th><th>Jumlah</th><th>Harga Jual</th><th>aksi</th></tr>";

	if ($_GET[p]) { $mulai = $_GET[p] * 100;} else { $mulai = 0;};

//HS query terlampir buggy !! dan juga amat lambat
//    $tampil=mysql_query("SELECT idBarang,namaBarang,namaKategoriBarang,
//                        namaSatuanBarang,jumBarang,hargaJual, barcode 
//                        FROM barang b, kategori_barang kb, satuan_barang sb
//                        ORDER BY b.namaBarang ASC LIMIT $mulai,100 ");

//    $tampil=mysql_query("SELECT b.idBarang,b.namaBarang,b.jumBarang,b.hargaJual,b.barcode, k.namaKategoriBarang, s.namaSatuanBarang   
//                        FROM barang AS b, kategori_barang AS k, satuan_barang AS s 
//			WHERE b.idKategoriBarang = k.idKategoriBarang AND b.idSatuanBarang = s.idSatuanBarang 
//                        ORDER BY namaBarang ASC LIMIT $mulai,100 ");

	// query ini lebih cepat & rapi
	// credit : Insan Fajar 
	$tampil = mysql_query("SELECT
				`barang`.`idBarang`,
				`barang`.`namaBarang`,
				`barang`.`idKategoriBarang`,
				`kategori_barang`.`namaKategoriBarang`,
				`barang`.`idSatuanBarang`,
				`satuan_barang`.`namaSatuanBarang`,
				`barang`.`jumBarang`,
				`barang`.`hargaJual`,
				`barang`.`barcode`
			FROM `barang`
				LEFT JOIN `kategori_barang`
					ON `barang`.`idKategoriBarang` = `kategori_barang`.`idKategoriBarang`
				LEFT JOIN `satuan_barang`
					ON `barang`.`idSatuanBarang` = `satuan_barang`.`idSatuanBarang`
				ORDER BY `namaBarang` ASC LIMIT $mulai,100");


    $no=1; $ctr=1;
    while (($r=mysql_fetch_array($tampil)) or ($ctr < 100)){
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=right class=td>$no</td>
             <td class=td>$r[barcode]</td>
             <td class=td>$r[namaBarang]</td>
             <td align=center class=td>$r[namaKategoriBarang]</td>
             <td align=center class=td>$r[namaSatuanBarang]</td>
             <td align=right class=td>$r[jumBarang]</td>
             <td align=right class=td>$r[hargaJual]</td>
             <td class=td><a href=?module=barang&act=editbarang&id=$r[barcode]>Ubah</a>|Ha<a href=./aksi.php?module=barang&act=hapus&id=$r[idBarang]>pus</a>
             </td></tr>";
      $no++; $ctr++;
    }
    echo "</table> <br />";

	$sql1 = "SELECT DISTINCT COUNT(barcode) FROM barang";
	$proses1 = mysql_query($sql1);
	$output1 = mysql_fetch_array($proses1);
	$jumlah_barang = $output1[0] / 100;

	for ($i = 0; $i <= $jumlah_barang; $i++) {
		echo "[<a href='media.php?module=barang&p=$i'> $i </a>] ";
	};

    echo "
    <p>&nbsp;</p>
    <a href=javascript:history.go(-1)><< Kembali</a>";
    break;



  case "returbarang1": // ========================================================================================================================


		// pilih printer
		$sql 	= "SELECT namaWorkstation,printer_commands,workstation_address FROM workstation ";
		$hasil 	= mysql_query($sql) or die(mysql_error());

		echo "
			<form method=POST action='modul/js_input_retur_barang.php?act=caricustomer' onSubmit=\"popupform(this, 'INPUT_RETUR_BARANG')\">	
		<table>
        	<tr>
			<td>Pilih Printer </td>
			<td>: <select name='namaPrinter'>";
		
		while($printer = mysql_fetch_array($hasil)){
			echo "<option value='$printer[printer_commands]'>$printer[namaWorkstation]</option>\n";
		}	

		echo "
			</td>
			</tr>

        		<tr><td colspan=2>&nbsp;</td></tr>
        		<tr><td colspan=2><input type=submit value='Pilih Printer'>&nbsp;&nbsp;&nbsp;
        	                        <input type=reset value='Batal'></td></tr>
			</table>
			</form>
		";

	break;



  case "tambahbarang": // ========================================================================================================================
    echo "<h2>Tambah Barang</h2>
          <form method=POST action='./aksi.php?module=barang&act=input' name='tambahbarang'>
          <table>
          <tr><td>Barcode</td><td> : <input type=text name='barcode' size=30 value=$_GET[id]></td></tr>
          <tr><td>Nama Barang</td><td> : <input type=text name='namaBarang' size=30></td></tr>
          <tr><td>Supplier</td>
                <td> : <select name='supplier'>
                            <option value='0'>- Supplier -</option>";
                            while($supplier = mysql_fetch_array($ambilSupplier)){
                                echo "<option value='$supplier[idSupplier]'>$supplier[namaSupplier]</option>";
                            }
            echo "</select></td></tr>
          <tr><td>Kategori Barang</td>
                <td> : <select name='kategori_barang'>
                            <option value='0'>- Kategori Barang-</option>";
                            while($kategori = mysql_fetch_array($ambilKategoriBarang)){
                                echo "<option value='$kategori[idKategoriBarang]'>$kategori[namaKategoriBarang]</option>";
                            }
            echo "</select></td></tr>
          <tr><td>Satuan Barang</td>
                <td> : <select name='satuan_barang'>
                            <option value='0'>- Satuan Barang-</option>";
                            while($satuan = mysql_fetch_array($ambilSatuanBarang)){
                                echo "<option value='$satuan[idSatuanBarang]'>$satuan[namaSatuanBarang]</option>";
                            }
            echo "</select></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>
          </table></form>";
     break;




  case "caribarang1": // ========================================================================================================================

 	echo "
	
		<h2>Cari Barang</h2>
		<form method=POST action='?module=barang&act=caribarang2'>

          <table>
		<tr><td> (r) Pilih Rak ? </td>
                <td> : <select name='rak' accesskey='r'>
			<option value='0'>-- Tidak Usah --</option>";

                            while($rak = mysql_fetch_array($ambilRak)){
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
                            }
            echo "</select></td></tr>

          <tr><td>(b) Barcode</td><td> : <input accesskey='b' type=text name='barcode' size=30 value='0'></td></tr>
          <tr><td>(n) Nama Barang</td><td> : <input accesskey='n' type=text name='namaBarang' size=30 value=''></td></tr>
		<tr><td><input type=submit accesskey='c' value='(c) Cari Barang'></td></tr>

		</table></form>";

     break;


  case "caribarang2":


	if ($_POST[rak] == '0') {
		$q_rak = "";
	} else {
		$q_rak = " idRak=$_POST[rak] AND ";
	};

	if ($_POST[barcode] == '0') {
		$sql = "SELECT b.idBarang,b.namaBarang,b.jumBarang,b.hargaJual,b.barcode, k.namaKategoriBarang, s.namaSatuanBarang   
                        FROM barang AS b, kategori_barang AS k, satuan_barang AS s 
			WHERE $q_rak namaBarang LIKE '%$_POST[namaBarang]%' AND 
				b.idKategoriBarang = k.idKategoriBarang AND b.idSatuanBarang = s.idSatuanBarang 
                        ORDER BY namaBarang ASC";
	} else {
		$sql = "SELECT b.idBarang,b.namaBarang,b.jumBarang,b.hargaJual,b.barcode, k.namaKategoriBarang, s.namaSatuanBarang   
                        FROM barang AS b, kategori_barang AS k, satuan_barang AS s 
			WHERE $q_rak barcode LIKE '$_POST[barcode]%' AND 
				b.idKategoriBarang = k.idKategoriBarang AND b.idSatuanBarang = s.idSatuanBarang 
                        ORDER BY namaBarang ASC";
	};
	$cari=mysql_query($sql);	
    	//echo $sql;

    echo "<table class=tableku>
          <tr><th>no</th><th>Barcode</th><th>Nama Barang</th><th>Kategori Barang</th>
                <th>Satuan Barang</th><th>Jumlah</th><th>Harga Jual</th><th>aksi</th></tr>";

    $no=1;
    while ($r=mysql_fetch_array($cari)) {
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=right class=td>$no</td>
             <td class=td>$r[barcode]</td>
             <td class=td>$r[namaBarang]</td>
             <td align=center class=td>$r[namaKategoriBarang]</td>
             <td align=center class=td>$r[namaSatuanBarang]</td>
             <td align=right class=td>$r[jumBarang]</td>
             <td align=right class=td>$r[hargaJual]</td>
             <td class=td><a href=?module=barang&act=editbarang&id=$r[barcode]>Ubah</a>|Ha<a href=./aksi.php?module=barang&act=hapus&id=$r[idBarang]>pus</a>
             </td></tr>";
      $no++; 
    }
    echo "</table> <br />";

    break;




  case "cetaklabel1": // ========================================================================================================================

 	echo "
	
		<h2>Cetak Label Barang</h2>
		<form method=POST action='?module=barang&act=cetaklabel2'>

          <table>
          <tr><td>(s) Supplier</td>
                <td> : <select name='supplier' accesskey='s'>
			<option value='0'>-- Pilih Supplier --</option>";
                            while($supplier = mysql_fetch_array($ambilSupplier)){
                                    echo "<option value='$supplier[idSupplier]'>$supplier[namaSupplier]</option>";
                            }
            echo "</select></td></tr>
          <tr><td>(r) Rak</td>
                <td> : <select name='rak' accesskey='r'>
			<option value='0'>-- Pilih Rak --</option>";
                            while($rak = mysql_fetch_array($ambilRak)){
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
                            }
            echo "</select></td></tr>

		<tr><td><input type=submit accesskey='l' value='(l) Cetak Label Barang'></td></tr>

		</table></form>";

     break;


  case "cetaklabel2":


	if ($_POST[rak] == '0') {
		$sql = "SELECT b.idBarang,b.namaBarang,b.jumBarang,b.hargaJual,b.barcode, k.namaKategoriBarang, s.namaSatuanBarang   
                        FROM barang AS b, kategori_barang AS k, satuan_barang AS s 
			WHERE idSupplier=$_POST[supplier] AND 
				b.idKategoriBarang = k.idKategoriBarang AND b.idSatuanBarang = s.idSatuanBarang 
                        ORDER BY namaBarang ASC";
		$cari=mysql_query($sql);	
		$q='sup'; $sql=$_POST[supplier];
	} else {
		$sql = "SELECT b.idBarang,b.namaBarang,b.jumBarang,b.hargaJual,b.barcode, k.namaKategoriBarang, s.namaSatuanBarang   
                        FROM barang AS b, kategori_barang AS k, satuan_barang AS s 
			WHERE idRak=$_POST[rak] AND 
				b.idKategoriBarang = k.idKategoriBarang AND b.idSatuanBarang = s.idSatuanBarang 
                        ORDER BY namaBarang ASC";
		$cari=mysql_query($sql);		
		$q='rak'; $sql=$_POST[rak];
	};

	$jumlah_pilihan = mysql_num_rows($cari);

	echo "
		<h2>Cetak Label Barang - Pilih Barang</h2>
		<form method=POST action='modul/mod_barang.php?act=cetaklabel3' onSubmit=\"popupform(this, 'cetaklabel')\">
		<input type=hidden name=total value=$jumlah_pilihan> 
		<input type=hidden name=q value=$q>
		<input type=hidden name=sql value=$sql>


	  <table class=tableku>
          <tr><th>no</th><th>Barcode</th><th>Nama Barang</th><th>Kategori Barang</th>
                <th>Satuan Barang</th><th>Jumlah</th><th>Harga Jual</th><th>Cetak ?</th></tr>";

    $no=1;$ctr=1;
    while ($r=mysql_fetch_array($cari)) {
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=right class=td>$no</td>
             <td class=td>$r[barcode]</td>
             <td class=td>$r[namaBarang]</td>
             <td align=center class=td>$r[namaKategoriBarang]</td>
             <td align=center class=td>$r[namaSatuanBarang]</td>
             <td align=right class=td>$r[jumBarang]</td>
             <td align=right class=td>$r[hargaJual]</td>
             <td class=td><center>  <input type=checkbox name=cl$ctr checked=yes> </center></td></tr>";
      $no++; $ctr++;
    }	
    echo "

	</table> <br />
	<input type=submit accesskey='l' value='(l) Cetak Label Barang'></td></tr>
	";

    
	break;


  case "cetaklabel3": 

	include "../../config/config.php";

	if ($_POST[q] == 'sup') {
		$cari=mysql_query("SELECT * FROM barang WHERE idSupplier=$_POST[sql] ORDER BY namaBarang ASC");	
	} else {
		$cari=mysql_query("SELECT * FROM barang WHERE idRak=$_POST[sql] ORDER BY namaBarang ASC");		
	};

	$lebar_label 		= 200;
	$tinggi_label 		= 112;
	$label_per_baris 	= 3;
	$baris_per_halaman 	= 7;

    $total = $_POST[total];
    $baris=1; $kolom=1;
    echo "<div style=\"float:none\">"; 

	for ($i = 1; $i <= $total; $i++) {

		$r = mysql_fetch_array($cari);
		if ($_POST["cl$i"] == 'on') {

			$clear = "";
			// cek posisi saat ini
			if ($kolom > $label_per_baris) { 
				$kolom = 1;
				$baris++;
				$clear = " clear:left; "; //echo "</div><div style=\"float:none\">"; // ganti baris
			};
			if ($baris > $baris_per_halaman) {
				$baris = 1;
				echo '<p style="page-break-after: always" />';
			};

			$namaBarang = $r[namaBarang];
			// jika terlalu panjang nama barangnya 
			if (strlen($namaBarang) > 15) {
				// bikin menjadi 2 baris
				$namaBarang = substr($namaBarang,0,15) .
					"</p><p style=\"line-height:0px; letter-spacing:-2px; text-align:center; font-family:Arial; font-size:12pt; font-weight:normal; text-transform:uppercase;  \">". substr($namaBarang,15);
			};

			// cetak label
			echo "\n 

				<div style=\"border: thin solid #000000; $clear float:left; margin-right:10px; margin-bottom:10px; width:".$lebar_label."px; height:".$tinggi_label."px\">
				<p style=\"line-height:0px; letter-spacing:-2px; text-align:center; font-family:Arial; font-size:12pt; font-weight:normal; text-transform:uppercase;  \">
					$namaBarang	
				</p>
				<p style=\"line-height:0px; letter-spacing:+2px; text-align:center; font-family:Arial; font-size:26pt; \">
					".number_format($r[hargaJual],0,',','.')."	</p>
				<p style=\"line-height:0px; text-align:left; font-family:Arial; font-size:6pt; \">
					$r[barcode] - $r[idRak]
				</div>
			";

			$kolom++;
		};
	} // for

	echo "</div>";

    break;





  case "inputrak": // ========================================================================================================================

	include "../../config/config.php";

	if ($_POST[masuk]) {
		$tgl = date("Y-m-d");
		$sql = "UPDATE barang SET idRak = '$_POST[rak]' 
                    WHERE barcode = '$_POST[barcode]'";
		//echo $sql;
		mysql_query($sql);
	};

    echo "
	  <h2>Input Cepat Rak</h2>
          <form method=POST action='?module=barang&act=inputrak' name='inputrakbarang'>

          <table>
          <tr><td>(r) Rak</td>
                <td> : <select name='rak' accesskey='r'>
			<option value='0'>-- Pilih Rak --</option>";
                            while($rak = mysql_fetch_array($ambilRak)){
                                if($rak[idRak] == $_POST[rak]){
                                    echo "<option value='$rak[idRak]' selected>$rak[namaRak]</option>";
                                }
                                else{
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
				}
                            }
            echo "</select></td></tr>
          <tr><td>(b) Barcode</td><td> : <input type=text name='barcode' id='barcode' accesskey='b' size=30 value=''>	</td></tr>
	  </table>
	<input type=submit accesskey='i' name='masuk' value='(i) Input'></td></tr>

	";

	echo "
		<script>
			var txtBox=document.getElementById(\"barcode\");
			if (txtBox!=null ) txtBox.focus();
		</script>";

  break;




  case "cetakSO": // ========================================================================================================================

 	echo "
	
		<h2>Cetak Stock Opname</h2>
		<form method=POST action='modul/mod_barang.php?act=cetakSO2' onSubmit=\"popupform(this, 'Cetak Stock Opname')\">

          <table>

          <tr><td>(r) Rak</td>
                <td> : <select name='rak' accesskey='r'>
			<option value='0'>-- Pilih Rak --</option>";
                            while($rak = mysql_fetch_array($ambilRak)){
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
                            }
            echo "</select></td></tr>

		<tr><td colspan=2><input type=submit accesskey='c' value='(c) Cetak Stock Opname' ></td></tr>

		</table></form>";

     break;



		
  case "cetakSO2": 

	include "../../config/config.php";

	$cari=mysql_query("SELECT * FROM barang WHERE idRak=$_POST[rak] ORDER BY namaBarang ASC");		

	echo "
	<h1>Rak #$_POST[rak]</h1>
	  <table class=tableku>
          <tr><th>no</th><th>Barcode</th><th>Nama Barang</th><th>Harga <br />Jual</th>
                <th>Jml <br />Tercatat</th><th>Selisih</th></tr>";

    $no=1;$ctr=1;
    while ($r=mysql_fetch_array($cari)) {
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna
       echo "<td align=left class=td>$no</td>
             <td class=td>$r[barcode]</td>
             <td class=td>$r[namaBarang]</td>
             <td align=right class=td>".number_format($r[hargaJual],0,',','.')."	</td>
             <td align=right class=td><center>$r[jumBarang]</center>			</td>
             <td align=right class=td>  						</td>
		</tr>";
      $no++; $ctr++;
    }	
    echo "

	</table> <br />
	";

    break;



  case "inputSO": // ========================================================================================================================

 	echo "
	
		<h2>Input Stock Opname - Pilih Rak</h2>
		<form method=POST action='?module=barang&act=inputSO2'>

          <table>

          <tr><td>(r) Rak</td>
                <td> : <select name='rak' accesskey='r'>
			<option value='0'>-- Pilih Rak --</option>";
                            while($rak = mysql_fetch_array($ambilRak)){
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
                            }
            echo "</select></td></tr>

		<tr><td colspan=2><input type=submit accesskey='i' value='(i) Mulai Input Stock Opname' ></td></tr>

		</table></form>";

     break;



		
  case "inputSO2":  // mulai input hasil Stock Opname

	include "../../config/config.php";
	
	$sql = "SELECT * FROM barang WHERE idRak=$_POST[rak] ORDER BY namaBarang ASC";
	$cari=mysql_query($sql);		
	//echo $sql;

	echo "
		<h2>Input Stock Opname (ID Rak: $_POST[rak])</h2>
		<form method=POST action='?module=barang&act=inputSO3'>


	  <table class=tableku>
          <tr><th>no</th><th>Barcode</th><th>Nama Barang</th><th>Harga <br />Jual</th>
                <th>Jml <br />Tercatat</th><th>Selisih</th></tr>";

    $no=1;$ctr=1;
    while ($r=mysql_fetch_array($cari)) {
        //untuk mewarnai tabel menjadi selang-seling
        if(($no % 2) == 0){
            $warna = "#EAF0F7";
	}
	else{
            $warna = "#FFFFFF";
	}
	echo "<tr bgcolor=$warna>";//end warna

       echo "<td align=left class=td>$no</td>
             <td class=td>$r[barcode]</td>
					<input type=hidden name='barcode$ctr' value='$r[barcode]'>
             <td class=td>$r[namaBarang]</td>
					<input type=hidden name='namaBarang$ctr' value='$r[namaBarang]'>
             <td align=right class=td>".number_format($r[hargaJual],0,',','.')."		</td>
             <td align=right class=td><center>$r[jumBarang]</center>				
					<input type=hidden name='jmlTercatat$ctr' value='$r[jumBarang]'>	</td>
             <td align=right class=td>	<input type=text name='selisih$ctr' size=2 value='0'>	</td>
		</tr>";

      $no++; $ctr++;
    }	
    echo "

		<tr><td colspan=2><input type=submit value='Input Stock Opname' ></td></tr>

	</table> <br />
	

		<input type=hidden name=rak value='$_POST[rak]'>
		<input type=hidden name=username value='$_SESSION[uname]'>
		<input type=hidden name=ctr value='$ctr'>
	
	";

    break;


  case "inputSO3":  // simpan di database

	include "../../config/config.php";

	// default max_input_vars hanya 1000, ini sangat tidak mencukupi pada rak yang ada banyak jenis barangnya
	ini_set('max_input_vars','20000');
	ini_set('suhosin.post.max_vars','20000');
	ini_set('suhosin.request.max_vars','20000');

	$sql = "INSERT INTO stock_opname (username, tanggalSO, idRak) VALUES 
		('$_POST[username]','".date("Y-m-d")."', $_POST[rak])";
	$hasil = mysql_query($sql) or die("Gagal simpan hasil Stock Opname: ".mysql_error()." SQL: $sql -- tekan tombol BACK !");
	$idStockOpname = mysql_insert_id();
	$ctr = $_POST[ctr];

	echo "Stock Opname sudah disimpan di database, nota SO nomor: ".$idStockOpname." <br /><br /> Mulai menyimpan transaksi Stock Opname : <br /><br />";

	for ($i = 1; $i <= $ctr; $i++) {

		if ($_POST["selisih$i"] <> 0) { // simpan hanya yang ada selisihnya

			$sql = "INSERT INTO detail_stock_opname (idStockOpname,barcode,namaBarang,jmlTercatat,selisih) 
				VALUES ($idStockOpname,'".$_POST["barcode$i"]."','".$_POST["namaBarang$i"]."',".$_POST["jmlTercatat$i"].",
					".$_POST["selisih$i"].") ";
			$hasil = mysql_query($sql);

			//fixme: ubah jumlah barang - komprehensif
			//	# cari seluruh stok dari barang ybs di detail_beli
			//	# pilih yang paling awal
			//	# apply selisih di salah satunya
			//		# jika jadi minus = jadikan nol, lalu pilih record barang tsb yang berikutnya
			//	# sesuaikan jmlBarang di tabel barang

			////////////// update jumlah stok di tabel barang
			// StokSekarang = jmlTercatat + Selisih
			$StokSekarang = $_POST["jmlTercatat$i"]+$_POST["selisih$i"];
			$sql = "UPDATE barang SET jumBarang = '".$StokSekarang."' WHERE barcode = '".$_POST["barcode$i"]."'";        
			$hasil = mysql_query($sql);

			echo "
			Transaksi SO : Nama Barang: ".$_POST["namaBarang$i"].", Selisih: ".$_POST["selisih$i"]." - sudah disimpan<br />
			";
		}; // if ($_POST[selisih$i] !== 0)
	}; // for ($i = 1; $i <= $_POST[ctr]; $i++)


	echo "Selesai !";

	break;
		




  case "editbarang": // ========================================================================================================================
    $edit=mysql_query("SELECT * FROM barang WHERE barcode='$_GET[id]'");
    $data=mysql_fetch_array($edit);

    echo "<h2>Edit Barang</h2>
          <form method=POST action=./aksi.php?module=barang&act=update name='editbarang'>
          <input type=hidden name='idBarang' value='$data[idBarang]'>
          <table>
          <tr><td>Barcode</td><td> : <input type=text name='barcode' size=30 value='$data[barcode]'></td></tr>
          <tr><td>Nama Barang</td><td> : <input type=text name='namaBarang' size=30 value='$data[namaBarang]'></td></tr>
          <tr><td>Kategori Barang</td>
                <td> : <select name='kategori_barang'>";
                            while($kategori = mysql_fetch_array($ambilKategoriBarang)){
                                if($kategori[idKategoriBarang] == $data[idKategoriBarang]){
                                    echo "<option value='$kategori[idKategoriBarang]' selected>$kategori[namaKategoriBarang]</option>";
                                }
                                else{
                                    echo "<option value='$kategori[idKategoriBarang]'>$kategori[namaKategoriBarang]</option>";
                                }
                            }
            echo "</select></td></tr>
          <tr><td>Satuan Barang</td>
                <td> : <select name='satuan_barang'>";
                            while($satuan = mysql_fetch_array($ambilSatuanBarang)){
                                if($satuan[idSatuanBarang] == $data[idSatuanBarang]){
                                    echo "<option value='$satuan[idSatuanBarang]' selected>$satuan[namaSatuanBarang]</option>";
                                }
                                else{
                                    echo "<option value='$satuan[idSatuanBarang]'>$satuan[namaSatuanBarang]</option>";
                                }
                            }
            echo "</select></td></tr>
          <tr><td>Supplier</td>
                <td> : <select name='supplier'>";
                            while($supplier = mysql_fetch_array($ambilSupplier)){
                                if($supplier[idSupplier] == $data[idSupplier]){
                                    echo "<option value='$supplier[idSupplier]' selected>$supplier[namaSupplier]</option>";
                                }
                                else{
                                    echo "<option value='$supplier[idSupplier]'>$supplier[namaSupplier]</option>";
                                }
                            }
            echo "</select></td></tr>
          <tr><td>Rak</td>
                <td> : <select name='rak'>";
                            while($rak = mysql_fetch_array($ambilRak)){
                                if($rak[idRak] == $data[idRak]){
                                    echo "<option value='$rak[idRak]' selected>$rak[namaRak]</option>";
                                }
  	                              else{
                                    echo "<option value='$rak[idRak]'>$rak[namaRak]</option>";
				}
                            }
            echo "</select></td></tr>
          <tr><td>Harga Jual</td><td> : <input type=text name='hargaJual' size=20 value='$data[hargaJual]'></td></tr>
          <tr><td colspan=2>&nbsp;</td></tr>
          <tr><td colspan=2 align='right'><input type=submit value=Simpan>&nbsp;&nbsp;&nbsp;
                            <input type=button value=Batal onclick=self.history.back()></td></tr>

		<input type=hidden name='oldbarcode' value='$data[barcode]'>

          </table></form> <br /><br />";

	// tampilkan seluruh stok ybs yang masih ada di toko / belum laku terjual
	$sql = "SELECT t.tglTransaksiBeli,d.hargaBeli, d.jumBarang  
		FROM detail_beli AS d, transaksibeli AS t  
		WHERE d.barcode = '$data[barcode]' AND d.idTransaksiBeli = t.idTransaksiBeli AND d.isSold='N' ORDER BY d.idTransaksiBeli DESC";
	$hasil = mysql_query($sql);
	$jumlah = mysql_num_rows($hasil);
	while ($x = mysql_fetch_array($hasil)) {
		echo "Tgl.Beli : $x[tglTransaksiBeli], Harga Beli : Rp ".number_format($x[hargaBeli],0,',','.')." (jumlah: $x[jumBarang])<br />";
	}

	// jika stok nya sudah laku semua,
	// cetak 2 stok yang terakhir (sekedar untuk informasi harga)
	if ($jumlah < 1) {
		$sql = "SELECT d.idTransaksiBeli, d.hargaBeli, d.isSold, d.jumBarang FROM detail_beli AS d  
			WHERE d.barcode = '$data[barcode]' ORDER BY d.idTransaksiBeli DESC LIMIT 2";
		$hasil = mysql_query($sql);
		$jumlah = mysql_num_rows($hasil);
		while ($x = mysql_fetch_array($hasil)) {
			echo "ID: ".$x[idTransaksiBeli].", Harga Beli : Rp ".number_format($x[hargaBeli],0,',','.').", Status: ";
			if ($x[isSold]=='Y') {
				echo " Habis";
			} else {
				echo " Ada";
			}; 
			echo " (jumlah: $x[jumBarang]) <br />";
		}
		
	}
  

	break;



  case "cetakbarang1": // ========================================================================================================================



	// cari tahu jumlah rak yang ada di toko ini
	$cari=mysql_query("SELECT idRak FROM rak");	
	$jumlah_rak = mysql_num_rows($cari);

	// cari daftar workstation kasir yang ada
	$daftarKasir=mysql_query("SELECT idWorkstation,namaWorkstation FROM workstation");	


 	echo "
		<h2>Cetak Stock Barang</h2>
		<form method=GET action='modul/mod_barang.php'  onSubmit=\"popupform(this, 'CETAK_STOCK_BARANG')\">

	Disini Anda bisa mencetak daftar stok Barang yang masih ada / jumlahnya tidak nol. 
	Biasanya digunakan pada saat Tutup Buku, untuk secara acak memeriksa stok barang yang sebenarnya.

	<br /><br />

	<table>
	<tr>	
		<td>(d) Dari Rak</td>
		<td> : <input type=text name=darirak value=1 accesskey='d' size=4></td>
	</tr>	
	<tr>	
		<td>Sampai Rak</td>
		<td> : <input type=text name=sampairak value=$jumlah_rak size=4></td>
	</tr>	
		<td><br /> (p) Cetak ke </td>
                <td><br /> : <select name='printer' accesskey='p'>
			<option value='0'>-- Cetak Ke Browser --</option>";
                            while($printer = mysql_fetch_array($daftarKasir)){
                                    echo "<option value='$printer[idWorkstation]'>$printer[namaWorkstation]</option>";
                            }
            echo "</select></td></tr>


		<tr><td colspan=2><br /><input type=submit accesskey='b' value='(b) Cetak Stock Barang'></td></tr>
					<input type=hidden name=act value=cetakbarang2>
		</table></form>";

     break;


  case "cetakbarang2":


	echo "
	<form method='post'>
		<input type=button value='Tutup Window Ini' onclick='window.close()'>
	</form>
	";

	// ambil data barang yang akan dicetak
	$sql = "SELECT idRak, namaBarang, hargaJual, jumBarang
		FROM barang WHERE jumBarang <> 0 AND idRak BETWEEN ".$_GET['darirak']." AND ".$_GET['sampairak']." 
		ORDER BY idRak,namaBarang ASC";
	$daftarBarang = mysql_query($sql);	
	$jumlahBarang = mysql_num_rows($daftarBarang);
	//echo $sql;

	// mulai mencetak
	if ($_GET[printer] == '0') {

		$rakSebelum  = 0;
		$rakSekarang = 0;
		$gantiBaris  = 0;
		for ($i = 1; $i <= $jumlahBarang; $i++) {

			// ambil 1 record
			$x = mysql_fetch_array($daftarBarang);
			$rakSekarang = $x[idRak];

			if ($rakSebelum <> $rakSekarang) {
				// cetak header
				$hasil 	= mysql_query("SELECT namaRak FROM rak WHERE idRak = $x[idRak]");
				$r	= mysql_fetch_array($hasil);

				echo "
					</table>

					<h2>
						Rak #$x[idRak] : $r[namaRak]
					</h2>

					<table border=1>	
				
					<tr>
						<td><center><b>	Nama Barang	</b></center>
						</td>
						<td><center><b>	Harga	</b></center>
						</td>
						<td><center><b>	Jml	</b></center>
						</td>
						<td><center><b>	Nama Barang	</b></center>
						</td>
						<td><center><b>	Harga	</b></center>
						</td>
						<td><center><b>	Jml	</b></center>
						</td>
					</tr>
					<tr>	
				";
				$rakSebelum = $rakSekarang;
			}; // if ($rakSebelum <> $rakSekarang)

			if ($gantiBaris > 1) {
				// ganti baris
				echo "</tr><tr>";
				$gantiBaris = 0;
			}; // if ($gantiBaris > 1)

			// cetak data barang
			echo "
			<td>		$x[namaBarang]
			</td>
			<td><center>	$x[hargaJual]	</center>
			</td>
			<td><center>	$x[jumBarang]	</center>
			</td>
			";

			$gantiBaris++;
		}; // for ($i = 1; $i <= $jumlahBarang; $i++)


	} else {

		// ambil daftar printer_command untuk idWorkstation ybs
		$hasil 	= mysql_query("SELECT printer_commands FROM workstation WHERE idWorkstation = $_GET[printer]");
		$r	= mysql_fetch_array($hasil);
		$perintahPrinter = $r[printer_commands];

		$rakSebelum  = 0;
		$rakSekarang = 0;
		$struk 	     = "";
		for ($i = 1; $i <= $jumlahBarang; $i++) {

			// ambil 1 record
			$x = mysql_fetch_array($daftarBarang);
			$rakSekarang = $x[idRak];

			// kalau ganti rak, cetak dulu $struk
			if ($rakSebelum <> $rakSekarang) {
				// kirim ke printer
				$perintah = "echo \"$struk\" |lpr $perintahPrinter -l";
				exec($perintah, $output);
				//echo $struk;

				$struk = "";
				$rakSebelum = $rakSekarang;

				// cetak header
				$hasil 	= mysql_query("SELECT namaRak FROM rak WHERE idRak = $x[idRak]");
				$r	= mysql_fetch_array($hasil);
				$struk .= "\n\nRak #$x[idRak] : $r[namaRak] \n ===============";
			}; // if ($rakSebelum <> $rakSekarang)

			// cetak data barang
			$struk .= "\n $x[namaBarang] \n Harga: $x[hargaJual], Jumlah: $x[jumBarang]";

		}; // for ($i = 1; $i <= $jumlahBarang; $i++)

		// cetak baris terakhir
		$perintah = "echo \"$struk\" |lpr $perintahPrinter -l";
		exec($perintah, $output);
		//echo $struk;


	}; // if ($_GET[printer] == '0')


     break;




  case "ApproveFastSO1": // ========================================================================================================================



	// cari SO yang belum di approve
	$sql 	= "SELECT DISTINCT tanggalSO FROM fast_stock_opname WHERE approved=0 ORDER BY tanggalSO ASC";
	$hasil	= mysql_query($sql);	

 	echo "
		<h2>Approve Fast Stock Opname</h2>
		<form method=GET action='media.php'>

	<br /><br />

	<table>
	<tr>	
		<td><br /> (t) Pilih Tanggal SO </td>
                <td><br /> : <select name='tanggalSO' accesskey='t'>";

	while($x = mysql_fetch_array($hasil)){
		echo "<option value='$x[tanggalSO]'>$x[tanggalSO]</option>";
	}
	
	echo "</select></td>
	</tr>

	<tr>
		<td colspan=2><br /><input type=submit accesskey='s' value='(s) Submit'></td>
	</tr>

		<input type=hidden name=module value=barang>	
		<input type=hidden name=act value=ApproveFastSO2>
		</table></form>";

     break;



  case "ApproveFastSO2":  // ----------------------------------------------------------------------------


	// cari SO yang belum di approve di tanggalSO
	$sql 	= "SELECT * FROM fast_stock_opname WHERE tanggalSO='$_GET[tanggalSO]' AND approved=0 ORDER BY idRak,jmlTercatat DESC";
	$hasil1	= mysql_query($sql);	

 	echo "
		<h2>Approve Fast Stock Opname</h2>
		<form method=POST action='?module=barang&act=ApproveFastSO3'>

	<br /><br />

	<table border=1>
	<tr>	
		<td><center>
			Rak
		</center></td>
		<td>Barcode
		</td>
		<td>Nama Barang
		</td>
		<td><center>
			Jumlah<br />Tercatat
		</center></td>
		<td><center>
			Selisih
		</center></td>
		<td><center>
			Approve
		</center></td>
		<td><center>#</center>
		</td>
		<td><center>
			Salah<br />Rak
		</center></td>
		<td><center>
			Hapus<br />Barang
		</center></td>
	</tr>
	";

	$x = mysql_fetch_array($hasil1);
	$rakSekarang 	= $x[idRak];
	$rakSebelum	= $x[idRak];
	$ctr 		= 1;
	$ctrRec		= 1;
	$jumlahRecord	= mysql_num_rows($hasil1);

	do {

		$rakSekarang = $x[idRak];

		if (strlen($x[namaBarang]) > 0) {
		echo "
			<tr>
			<td><center>
				$x[idRak]
			</center></td>
			<td>$x[barcode] 	<input type=hidden name=barcode$ctr value=$x[barcode]>
			</td>
			<td>$x[namaBarang]
			</td>
			<td><center>
				$x[jmlTercatat]
			</center></td>
			<td><center>
				$x[selisih]	<input type=hidden name=selisih$ctr value=$x[selisih]>
			</center></td>
			<td><center>
				<input type=checkbox name=appr$ctr checked=yes>
			</center></td>
			<td><center>#</center>
			</td>
			<td><center>
				<input type=checkbox name=salahrak$ctr>
			</center></td>
			<td><center>
				<input type=checkbox name=hapus$ctr>
			</center></td>
			</tr>
		";
		}; // if (strlen($x[namaBarang]) > 0) {

		if (($rakSebelum <> $rakSekarang) || ($ctrRec == $jumlahRecord)) {
			// cari barang di rak yang sama, namun tidak masuk di dalam SO = sebetulnya berada di rak yang lain / sudah tidak ada lagi
			$sql	= "SELECT b.* 
					FROM barang AS b LEFT JOIN fast_stock_opname AS f ON b.barcode = f.barcode 
					WHERE b.idRak=$rakSekarang AND f.idRak IS NULL ORDER BY b.namaBarang ASC";
			//echo $sql;
			$hasil2	= mysql_query($sql);	
			while($z = mysql_fetch_array($hasil2)){
				$ctr++;
				echo "
					<tr>
					<td><center>
						$z[idRak]
					</center></td>
					<td>$z[barcode] <input type=hidden name=barcode$ctr value=$z[barcode]>
					</td>
					<td>$z[namaBarang]
					</td>
					<td><center>
						$z[jumBarang]
					</center></td>
					<td><center>
					</center></td>
					<td><center>
					</center></td>
					<td><center>#</center>
					</td>
					<td><center>
						<input type=checkbox name=salahrak$ctr checked=yes>
					</center></td>
					<td><center>
						<input type=checkbox name=hapus$ctr>
					</center></td>
					</tr>
				";

			}; // while($z = mysql_fetch_array($hasil)){
		}; // if ($rakSebelum <> $rakSekarang) {

		$rakSebelum = $rakSekarang;
		$ctr++;
		$ctrRec++; // tidak menghitung record yang didapat dari barang (ketika mencari barang yg salah rak)

	} while ($x = mysql_fetch_array($hasil1));

	echo "</table>	

		<input type=submit accesskey='s' value='(s) Submit'>	
		<input type=hidden name=ctr value=$ctr>

		</form>";

	break;


  case "ApproveFastSO3":  // ----------------------------------------------------------------------------


 	echo "
		<h2>Proses Fast Stock Opname</h2>
	<br /><br />
	";

	for ($i = 1; $i <= $_POST[ctr]; $i++) {

		// cek barang dihapus
		if ($_POST["hapus$i"] == 'on') {
			// ....still having thoughts about it, for now just ignore.

		// cek barang yang salah rak (tercatat di barang.idRak di rak ybs - tapi, tidak ketemu di rak tsb pada saat SO)
		} elseif ($_POST["salahrak$i"] == 'on') {
			// ganti barang.idRak ybs menjadi 999999
			$sql = "UPDATE barang SET idRak=999999 WHERE barcode='".$_POST["barcode$i"]."'";
			$hasil1 = mysql_query($sql);
			echo "Salah Rak : ".$_POST["barcode$i"].", sudah diganti raknya menjadi 999999 <br />";

		// cek barang yang di approve SO nya
		} elseif ($_POST["appr$i"] == 'on') {
			// cari barang.jumBarang ybs
			$sql 	= "SELECT jumBarang FROM barang WHERE barcode='".$_POST["barcode$i"]."'";
			$hasil1 = mysql_query($sql);
			$x	= mysql_fetch_array($hasil1);

			// hitung jumlah barang yang seharusnya
			$jumBarang 	= $x[jumBarang] + $_POST["selisih$i"];
			
			// update barang.jumBarang untuk barcode ybs
			$sql = "UPDATE barang SET jumBarang=$jumBarang WHERE barcode='".$_POST["barcode$i"]."'";
			$hasil1 = mysql_query($sql);

			// ganti fast_stock_opname.approved menjadi 1 / true
			$sql = "UPDATE fast_stock_opname SET approved=1 WHERE barcode='".$_POST["barcode$i"]."'";
			$hasil1 = mysql_query($sql);
			echo "Approved : ".$_POST["barcode$i"].", stok tercatat: $x[jumBarang], selisih: ".$_POST["selisih$i"].", total: $jumBarang <br />";
			//var_dump($_POST);	
		};
	}; // for ($i = 0; $i <= $_POST[ctr]; $i++) {

	break;



}


/* CHANGELOG -----------------------------------------------------------

 1.5.5 / 2013-01-25 : Harry Sufehmi 	: bugfix: https://github.com/sufehmi/AhadPOS/issues/1 , 
						terimakasih http://www.facebook.com/civo.pras untuk laporannya.

 1.5.0 / 2012-11-25 : Harry Sufehmi 	: optimisasi : query yang menampilkan seluruh data barang.
						Credit : Insan Fajar
 1.5.0 / 2012-09-09 : Harry Sufehmi	: bugfix: form inputSO3 gagal jika ada > 250 item di suatu rak. 
					Ternyata... default setting max_input_vars = 1000, sedangkan setiap item menyimpan 4 jenis informasi = lebih besar dari batas max_input_vars
					Solusi: set max_input_vars di php.ini menjadi 20000 atau lebih

 1.2.5 / 2012-03-02 : Harry Sufehmi 	: bugfix: editbarang kini menemukan item berdasarkan barcode - bukan idBarang
 1.0.3 / 2011-10-21 : Harry Sufehmi	: Kategori Barang & Satuan Barang kini muncul pada tabel daftar barang (tadinya kosong)
					Juga pada sub-modul : 
						# caribarang2
						# cetaklabel2

					Thanks kepada Alexander (mr.s4scha@gmail.com) untuk laporannya.

 1.0.2 / 2011-07-14 : Harry Sufehmi	: menu "editbarang", bisa mendeteksi perubahan barcode.
					(sehingga di aksi.php bisa update juga field barcode di table-table lainnya)

 1.0.1 / 2010-06-03 : Harry Sufehmi	: various enhancements, bugfixes
					# fitur Stock Opname
					# Cari Barang : bisa per Rak
	2010-12-16  : Harry Sufehmi	: Cetak Stock Barang

	2011-01-07  : Harry Sufehmi	: Input Fast Stock Opname & Approve Fast Stock Opname


 0.6.5		    : Gregorius Arief	: initial release

------------------------------------------------------------------------ */

?>
<?php
/* js_cetak_retur_beli.php ------------------------------------------------------
   	version: 1.01

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


include "../../config/config.php";
include "function.php";


session_start();
if (empty($_SESSION[namauser]) AND empty($_SESSION[passuser])){
  echo "<link href='../../../config/adminstyle.css' rel='stylesheet' type='text/css'>
 <center>Untuk mengakses modul, Anda harus login <br>";
  echo "<a href=index.php><b>LOGIN</b></a></center>";
}
else{

  echo "<link href='../../config/adminstyle.css' rel='stylesheet' type='text/css'>";

        echo "<h2>Note Retur Beli</h2>";
        $supplier = getDetailSupplier($_POST[idSupplier]);
        $detailSupplier = mysql_fetch_array($supplier);
        echo "Nama Supplier : $detailSupplier[namaSupplier]
            <br/>Tanggal Retur : $_POST[tglRetur] 
	    <br/>Nota  : $_POST[idTransaksiBeli]<br /><br />";


	echo "  <table>
		<tr><th>No</th><th>Id Barang</th><th>Barcode</th><th>Nama Barang</th>
		<th>Jumlah<br />Retur</th><th>Harga Beli</th></tr>";

	$sql = "SELECT d.idBarang, d.barcode, d.jumRetur, d.hargaBeli, d.nominal, d.username, b.namaBarang  
			FROM detail_retur_beli AS d, barang AS b 
			WHERE idTransaksiBeli = $_POST[idTransaksiBeli] AND tglRetur = '$_POST[tglRetur]' AND d.barcode = b.barcode";
	$hasil = mysql_query($sql);

	$currentTotal = 0;
	$oldTotal = 0;
	$ctr = 1;
	$totalRecord = mysql_num_rows($hasil);
	while ($x = mysql_fetch_array($hasil)) {

                    if(($ctr % 2) == 0){
                            $warna = "#EAF0F7";
                        }
                        else{
                            $warna = "#FFFFFF";
                        }
		echo "<tr bgcolor=$warna>";//end warna
		echo "<td class=td>$ctr</td>
                            <td class=td>		$x[idBarang]</td>
                            <td class=td>		$x[barcode]</td>
                            <td class=td>		$x[namaBarang]</td>
                            <td class=td align=center>	$x[jumRetur]</td>
                            <td class=td align=right>".uang($x[hargaBeli])."</td>";
		echo "</tr>";

		$ctr++;
		$nominal = $x[nominal];
		$username= $x[username];

	} // while ($x = mysql_fetch_array($hasil))

	echo "</table><br />
		TOTAL : ".uang($nominal)." <br />(username: $username)
	";

};



/* CHANGELOG -----------------------------------------------------------

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes
 0.9.3 / 2010-04-16 : Harry Sufehmi		: initial release

------------------------------------------------------------------------ */

?>
<?php
/* function.php ------------------------------------------------------
   	version: 1.5.0

	Part of AhadPOS : http://ahadpos.com
	License: GPL v2
			http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
			http://vlsm.org/etc/gpl-unofficial.id.html

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License v2 (links provided above) for more details.
----------------------------------------------------------------*/


function uang($duit) {
    if(!$duit) {
        $duit= 0;
    }
    $duit="".str_replace(",",".",number_format($duit)).""; # Melakukan Format bilangan untuk pembagian digit 3 mis: 10000 menjadi 10.000
    return $duit;
}


function getKasAwal($idUser){
    $tgl = date("Y-m-d");
    $queryKas = mysql_query("SELECT kasAwal FROM transaksikas where idUser = '$idUser' and tglTransaksiKas = '$tgl'");
    $dataKas = mysql_fetch_array($queryKas);
    $kas = $dataKas[kasAwal];

    return $kas;
}
function getUangKasir($idUser){
    $tgl = date("Y-m-d");
    $query = mysql_query("SELECT sum(nominal) as uang FROM transaksijual where tglTransaksiJual = '$tgl' and idUser = '$idUser'");
    $dataUang = mysql_fetch_array($query);
    $uang = $dataUang[uang];
    if ($uang == null){
        return $uang = 0;
    }
    else{
        return $uang;
    }
}

function findSupplier($idSupplier){
    $sql = "SELECT * from supplier WHERE idSupplier = '$idSupplier'";
    $query = mysql_query($sql);
    $dataSupplier = mysql_fetch_array($query);

    #session_register("idSupplier");
    #session_register("namaSupplier");
    $_SESSION[idSupplier] = $dataSupplier[idSupplier];
    $_SESSION[namaSupplier] = $dataSupplier[namaSupplier];
}

function releaseSupplier(){
    #session_unregister("idSupplier");
    #session_unregister("namaSupplier");
}

function findCustomer($idCustomer){
    $query = mysql_query("SELECT * from customer WHERE idCustomer = '$idCustomer'");
    $dataCustomer = mysql_fetch_array($query);

    #session_register("idCustomer");
    #session_register("namaCustomer");
    $_SESSION[idCustomer] = $dataCustomer[idCustomer];
    $_SESSION[namaCustomer] = $dataCustomer[namaCustomer];
}

function releaseCustomer(){
    #session_unregister("idCustomer");
    #session_unregister("namaCustomer");
    $_SESSION[tot_pembelian] = 0;
}

function cekBarang($barcode){
	// jika ada banyak barang dengan barcode yang sama, kembalikan record yang terbaru
	$sql ="SELECT b.idBarang, b.namaBarang, b.hargaJual, b.barcode, d.hargaBeli FROM barang AS b, detail_beli AS d 
        	    WHERE b.barcode = '$barcode' AND d.barcode = '$barcode' ORDER BY d.idBarang DESC LIMIT 1";
	//echo $sql;
    $query = mysql_query($sql);
    $data = mysql_fetch_array($query);

	//HS jika tidak ada data yang ditemukan - mungkin baru ada di tabel barang, tapi belum ada di detail_beli
	if (mysql_num_rows($query) < 1) {
		$sql = "SELECT idBarang, namaBarang, hargaJual, barcode FROM barang WHERE barcode = '$barcode'";
		$query = mysql_query($sql);
		$data = mysql_fetch_array($query);
	};

    return $data;
}

function cekBarangTemp($idSupplier,$barcode){
    $adaBeli = 0;
    $cek = mysql_query("SELECT * from tmp_detail_beli where idSupplier = '$idSupplier' and barcode = '$barcode'");
    $adaBeli = mysql_num_rows($cek);

    return $adaBeli;
}

function cekBarangTempJual($idCustomer,$barcode){
    $adaJual = 0;
	$sql = "SELECT * from tmp_detail_jual where idCustomer = '$idCustomer' and barcode = '$barcode' and username = '$_SESSION[uname]'";
	//echo $sql;
    $cek = mysql_query($sql);
    $adaJual = mysql_num_rows($cek);

    return $adaJual;
}


function tambahBarangAda($idSupplier,$barcode,$jumBarang){
    $ambilJumBarang = mysql_query("SELECT jumBarang FROM tmp_detail_beli WHERE idSupplier = '$idSupplier' and barcode = '$barcode'");
    $dataJum = mysql_fetch_array($ambilJumBarang);
    $jumlah = $dataJum[jumBarang] + $jumBarang;
    mysql_query("UPDATE tmp_detail_beli SET jumBarang = '$jumlah' WHERE idSupplier = '$idSupplier' and barcode = '$barcode'");
}

function tambahBarang($idSupplier,$barcode,$jumBarang,$hargaBeli,$hargaJual,$tglExpire){
    $tgl = date("Y-m-d");
    mysql_query("INSERT into tmp_detail_beli(idSupplier, tglTransaksi,
                        barcode,tglExpire,jumBarang,hargaBeli,hargaJual,username)
                    VALUES('$idSupplier','$tgl','$barcode','$tglExpire',
                        '$jumBarang','$hargaBeli','$hargaJual','$_SESSION[uname]')");
}

function tambahBarangJualAda($idCustomer,$barcode,$jumBarang){
    $jumlah = 0;

//  if($jumBarang==0){
//  quantity can not be 0 (zero) or less than that
    if($jumBarang < 1){
        $jumlah = 1;
    }
    else{
        $jumlah = $jumBarang;
    }

    $ambilJumBarang = mysql_query("SELECT jumBarang FROM tmp_detail_jual WHERE idCustomer = '$idCustomer' AND barcode = '$barcode' AND username='$_SESSION[uname]'");
    $dataJum = mysql_fetch_array($ambilJumBarang);
    
    $jumlah = $jumlah + $dataJum[jumBarang];
    
	$tgl = date("Y-m-d H:i:s");

    mysql_query("UPDATE tmp_detail_jual SET jumBarang = '$jumlah', tglTransaksi = '$tgl'
		 WHERE idCustomer = '$idCustomer' AND barcode = '$barcode' AND username='$_SESSION[uname]'");
}

function tambahBarangJual($barcode,$jumBarang){
    //cekBarangTempJual($idBarang);
    $dataAda = cekBarang($barcode);
    if ($dataAda != 0){
        $jumlah = 0;
//      if($jumBarang==0){
	// quantity can not be 0 (zero) or less than that
        if($jumBarang<1){
            $jumlah = 1;
        }
        else{
            $jumlah = $jumBarang;
        }
        $tgl = date("Y-m-d H:i:s");
        $jualBarang = mysql_query("SELECT * FROM barang WHERE barcode = '$barcode'") or die(mysql_error());
        $jual = mysql_fetch_array($jualBarang);

// bugfix :
//	"ORDER BY idDetailBeli" diganti menjadi "ORDER BY idTransaksiBeli"
//	karena, banyak database di berbagai toko Ahad mart yang isi idDetailBeli nya ngaco 
//	(banyak field idDetailBeli yang isinya 0 [nol])

	// cari hargaBeli & idBarang nya
	$sql = "SELECT * FROM detail_beli 
		WHERE isSold = 'N' AND barcode = '$barcode' AND jumBarang > 0 
		ORDER BY idTransaksiBeli ASC LIMIT 1";
	//echo $sql;
	$hasil = mysql_query($sql);
	if (mysql_num_rows($hasil) < 1) { 	// jika tidak ada / stok sudah habis semua, coba cari lagi dengan menyertakan stok barang = 0
						// tampilkan stok yang terakhir dibeli (ORDER BY idDetailBeli DESC)
		$sql = "SELECT * FROM detail_beli 
			WHERE barcode = '$barcode'  
			ORDER BY idTransaksiBeli DESC LIMIT 1";
		$hasil = mysql_query($sql);
	}

	$detilBarang = mysql_fetch_array($hasil);
	if (mysql_num_rows($hasil) > 0) {
		$hargaBeli = $detilBarang[hargaBeli];
		$idBarang  = $detilBarang[idBarang];	
	} else {
		// not supposed to ever happen, but just to be safe....
		//fixme: kalau seluruh stok barang sudah habis (sehingga jadi masuk ke blok ini)
			// -- coba lagi dengan record terakhir utk barang ybs di detail_beli, walaupun isSold=Y
		$hargaBeli = 0;
		$idBarang  = 0;	
	}

	// simpan transaksi di tmp_detail_jual
	$sql = "INSERT into tmp_detail_jual(idCustomer, tglTransaksi,
                            barcode,jumBarang,hargaBeli,hargaJual,username, idBarang)
                        VALUES('$_SESSION[idCustomer]','$tgl','$barcode',
                            '$jumlah','$hargaBeli','$jual[hargaJual]','$_SESSION[uname]', $idBarang)";
	//echo $sql;
        mysql_query($sql) or die(mysql_error());
    }
    else{
        echo "Barang tidak ada";
    }
}

function ubahJumlahBarangBeliTemp($idSupplier,$idBarang,$jumlah){
    mysql_query("UPDATE tmp_detail_beli SET jumBarang = '$jumlah'
            WHERE idSupplier = '$idSupplier' and idBarang = '$idBarang' and username = '$_SESSION[uname]'") or die(mysql_error());
}

function detailTransaksiBeli($idTransaksiBeli){
    $query = mysql_query("SELECT idTransaksiBeli, tglTransaksiBeli, namaSupplier, nominal, idTipePembayaran, NomorInvoice, namaUser
            FROM transaksibeli AS t, user AS u, supplier AS s 
            WHERE t.idSupplier = s.idSupplier AND t.username = u.uname
            AND t.idTransaksiBeli = '$idTransaksiBeli'") or die(mysql_error());
    return $query;
}
function detailBarangTransaksiBeli($idTransaksiBeli){
    $query = mysql_query("SELECT detail_beli.idBarang, barang.barcode, namaBarang, detail_beli.jumBarang, hargaBeli, tglExpire FROM detail_beli, barang
        WHERE barang.idBarang = detail_beli.idBarang and detail_beli.idTransaksiBeli = '$idTransaksiBeli'") or die(mysql_error());
    return $query;
}

function nominalBeli($idTransaksiBeli){
    $query = mysql_query("select sum(jumBarang*hargaBeli) as nominal from detail_beli
        where idTransaksiBeli = '$idTransaksiBeli'") or die(mysql_error());
    $dataQuery = mysql_fetch_array($query);
    $nominal = $dataQuery[nominal];
    mysql_query("UPDATE transaksibeli SET nominal = '$nominal' WHERE idTransaksiBeli = '$idTransaksiBeli'") or die(mysql_error());
    mysql_query("UPDATE hutang SET nominal = '$nominal' WHERE idTransaksiBeli = '$idTransaksiBeli'") or die(mysql_error());
    return $nominal;
}

function editBarangBeli($idTransaksiBeli,$idBarang,$jumBarangLama,$jumBarang,$hargaBeli){
    $queryJumBarang = mysql_query("SELECT jumBarang FROM barang WHERE idBarang = '$idBarang'");
    $jumBarangku = mysql_fetch_array($queryJumBarang);
    $jumBarangBaru = ($jumBarangku[jumBarang] - $jumBarangLama);
    $jumBarangBaru2 = $jumBarangBaru + $jumBarang;
    mysql_query("UPDATE barang SET jumBarang = '$jumBarangBaru2' WHERE idBarang = '$idBarang'") or die(mysql_error());
    mysql_query("UPDATE detail_beli SET jumBarang = '$jumBarang', hargaBeli = '$hargaBeli'
            WHERE idTransaksiBeli = '$idTransaksiBeli' and idBarang = '$idBarang'") or die(mysql_error());
}



function cetakStruk ($perintahPrinter, $nomorStruk, $namaKasir, $totalTransaksi, $uangDibayar, $arrayTransaksi, $strukRetur=false) {


	$totalRetur = 0;

	// ambil footer & header struk
	$sql   	= "SELECT `option`,`value` FROM config"; 
	$hasil 	= mysql_query($sql) or die(mysql_error());
	while ($x = mysql_fetch_array($hasil)) {
		if ($x[option]=='store_name') { $store_name=$x[value];};
		if ($x[option]=='receipt_header1') { $header1=$x[value];};
		if ($x[option]=='receipt_footer1') { $footer1=$x[value];};
		if ($x[option]=='receipt_footer2') { $footer2=$x[value];};
	};

	// siapkan string yang akan dicetak
	$struk  = str_pad($store_name, 40, " ", STR_PAD_BOTH) . "\n" . str_pad($header1, 40, " ", STR_PAD_BOTH) . "\n" 
		. str_pad($namaKasir ." : ". date("d-m-Y H:i") ." #$nomorStruk", 40, " ", STR_PAD_BOTH) ." \n";

	$struk .= "-------------------------------------\n";
	while ($x = mysql_fetch_array($arrayTransaksi)) {	

		if ($strukRetur) {
	                $struk .= $x[namaBarang]. " \n".$x[barcode].":"
                                ." ".$x[jumBarang]."x".number_format($x[hargaBeli],0,',','.')."="
                                .number_format(($x[hargaBeli] * $x[jumBarang]),0,',','.')."\n";
			$totalRetur = $totalRetur + ($x[hargaBeli] * $x[jumBarang]);
 
		} else {
			$struk .= $x[jumBarang] . "x ". $x[namaBarang]. " @".number_format($x[hargaJual],0,',','.').
					": ".number_format(($x[hargaJual] * $x[jumBarang]),0,',','.')."\n";
		};

	}
	$struk .= "-------------------------------------\n";
	
	if ($strukRetur) {

		$struk .= "                TOTAL   : ".number_format($totalRetur,0,',','.')." \n";

	} else {
		$struk .= "                TOTAL   : ".number_format($totalTransaksi,0,',','.')." \n";
		$struk .= "                Dibayar : ".number_format($uangDibayar,0,',','.')." \n";
		$struk .= "                Kembali : ".number_format(($uangDibayar-$totalTransaksi),0,',','.')." \n";
	};

	$struk .= "-------------------------------------\n";
	$struk .= str_pad($footer1, 40, " ", STR_PAD_BOTH) . "\n" . str_pad($footer2, 40, " ", STR_PAD_BOTH) . "\n\n\n\n\n\n\n\n\n\n\n\n\n";

	//fixme: cetak ke printer lainnya (bukan cuma LPR)
	$perintah = "echo \"$struk\" |lpr $perintahPrinter -l";

	//echo $perintah; exit;
	exec($perintah, $output);
}

//======================================//
function getSupplier(){
    $query = mysql_query("SELECT idSupplier, namaSupplier, alamatSupplier FROM supplier ORDER BY namaSupplier") or die(mysql_error());

    return $query;
}

function getDetailSupplier($id){
    $query = mysql_query("SELECT idSupplier, namaSupplier, alamatSupplier from supplier
            WHERE idSupplier = '$id'") or die(mysql_error());

    return $query;
}



function getDetailTmpEditReturPembelian($idNota){ // =================================================================================================
    $query = mysql_query("SELECT t.idDetailBeli, t.idBarang, t.tglExpire, t.jumBarang, t.hargaBeli, t.jumRetur,  
                    barang.namaBarang
                    FROM tmp_edit_detail_retur_beli AS t, barang
                    WHERE barang.barcode = t.barcode AND t.idTransaksiBeli = '$idNota';") or die(mysql_error());
    return $query;
}

function ubahTempEditDetailReturPembelian($idDetailBeli,$tglExpire,$jumBarang,$hargaBeli,$jumRetur){

	// sanity checks
	if ($jumRetur > $jumBarang) 	{ $jumRetur = $jumBarang;};
	if ($jumRetur < 0) 		{ $jumRetur = 0;};

    mysql_query("UPDATE tmp_edit_detail_retur_beli 
			SET tglExpire = '$tglExpire', jumBarang = '$jumBarang', hargaBeli = '$hargaBeli', jumRetur = $jumRetur  
			WHERE idDetailBeli = '$idDetailBeli'") or die(mysql_error());
}




function getDataPembelian($supplierId, $bulanLaporan, $tahunLaporan){ // ============================================================================
    if($bulanLaporan<10){
        $periode = $tahunLaporan."-0".$bulanLaporan;
    }
    else{
        $periode = $tahunLaporan."-".$bulanLaporan;
    }
    $query = mysql_query("SELECT transaksibeli.idTransaksiBeli as noNota, transaksibeli.tglTransaksiBeli as tglNota, transaksibeli.nominal as nominal
            FROM transaksibeli
            WHERE transaksibeli.idSupplier = '$supplierId' AND tglTransaksiBeli like '$periode%'") or die(mysql_error());
    return $query;
}

function getDataNotaPembelian($idNota){

	$sql = "SELECT supplier.namaSupplier, supplier.alamatSupplier, transaksibeli.tglTransaksiBeli as tglNota, transaksibeli.nominal,
	transaksibeli.NomorInvoice
        FROM transaksibeli, supplier
        WHERE transaksibeli.idSupplier = supplier.idSupplier AND transaksibeli.idTransaksiBeli = '$idNota'";
    
	$query = mysql_query($sql) or die(mysql_error());

    return $query;
}

function getDetailNotaPembelian($idNota){
	$sql = "SELECT detail_beli.idBarang, detail_beli.tglExpire, detail_beli.jumBarang, detail_beli.hargaBeli, detail_beli.barcode,
                    barang.namaBarang
                    FROM detail_beli, barang
                    WHERE barang.barcode = detail_beli.barcode AND detail_beli.idTransaksiBeli = '$idNota' 
			ORDER BY detail_beli.idBarang;";
	//echo $sql;
    $query = mysql_query($sql) or die(mysql_error());
    return $query;
}

function inputDataEditPembelianKeTemp($idNota){
    mysql_query("INSERT INTO tmp_edit_detail_beli(idDetailBeli,idTransaksiBeli,idBarang,tglExpire,jumBarang,hargaBeli)
                    SELECT detail_beli.idDetailBeli,detail_beli.idTransaksiBeli,detail_beli.idBarang,detail_beli.tglExpire,
                            detail_beli.jumBarang,detail_beli.hargaBeli
                            from detail_beli,barang where barang.idBarang = detail_beli.idBarang AND detail_beli.idTransaksiBeli = '$idNota' AND detail_beli.idTransaksiBeli != 0") or die(mysql_error());
}

function getDetailTmpEditPembelian($idNota){
    $query = mysql_query("SELECT tmp_edit_detail_beli.idDetailBeli, tmp_edit_detail_beli.idBarang, tmp_edit_detail_beli.tglExpire, tmp_edit_detail_beli.jumBarang, tmp_edit_detail_beli.hargaBeli, 
                    barang.namaBarang
                    FROM tmp_edit_detail_beli, barang
                    WHERE barang.idBarang = tmp_edit_detail_beli.idBarang AND tmp_edit_detail_beli.idTransaksiBeli = '$idNota';") or die(mysql_error());
    return $query;
}

function ubahTempEditDetailPembelian($idDetailBeli,$tglExpire,$jumBarang,$hargaBeli){
    mysql_query("UPDATE tmp_edit_detail_beli SET tglExpire = '$tglExpire', jumBarang = '$jumBarang', hargaBeli = '$hargaBeli' WHERE idDetailBeli = '$idDetailBeli'") or die(mysql_error());
}

function getJumBarangDiBarang($idDetailBeli, $barcode=''){
	
if ($barcode == '') {
	$sql	= "SELECT barang.jumBarang FROM barang, tmp_edit_detail_retur_beli AS t WHERE t.idBarang = barang.idBarang AND t.idDetailBeli = '$idDetailBeli'";
} else {
	$sql	= "SELECT barang.jumBarang FROM barang, tmp_edit_detail_retur_beli AS t WHERE t.barcode = barang.barcode AND t.barcode = '$barcode'";
};
    $query = mysql_query($sql) or die(mysql_error());
    $jum = mysql_fetch_array($query);

    return $jum[jumBarang];
}

function getJumBarangDetailPembelian($idDetailBeli){
    $query = mysql_query("SELECT jumBarang FROM detail_beli WHERE idDetailBeli = '$idDetailBeli'") or die(mysql_error());
    $jum = mysql_fetch_array($query);
    return $jum[jumBarang];
}

function getDataPenjualan($idNota){
    $query = mysql_query("") or die(mysql_error());
}

function getDetailPenjualan($idNota){
    $query = mysql_query("SELECT detail_jual.idBarang, barang.namaBarang, detail_jual.jumBarang, detail_jual.hargaBeli
            FROM detail_jual, barang, transaksijual
            WHERE detail_jual.idBarang = barang.idBarang
            AND detail_jual.idTransaksiJual = transaksijual.idTransaksiJual
            AND transaksijual.idTransaksiJual = '$idNota'") or die(mysql_error());

    return $query;
}

function getDaftarBarangSupplier($idSupplier, $jumlahMin){
    $query = mysql_query("select idBarang, barcode, namaBarang, jumBarang from barang where idSupplier = '$idSupplier' AND jumBarang < $jumlahMin") or die(mysql_error());

    return $query;
}

function getBarangPesan($idBarang){
    $query = mysql_query("select idBarang, barcode, left(namaBarang,22) as namaBarang, jumBarang from barang where idBarang = '$idBarang'") or die(mysql_error());

    return $query;
}


// ==============================================================================================================================

function tambahBarangReturAda($barcode,$jumBarang){
    $jumlah = 0;
    if($jumBarang==0){
        $jumlah = 1;
    }
    else{
        $jumlah = $jumBarang;
    }

    $ambilJumBarang = mysql_query("SELECT jumBarang FROM tmp_detail_retur_barang WHERE barcode = '$barcode'");
    $dataJum = mysql_fetch_array($ambilJumBarang);
    
    $jumlah = $jumlah + $dataJum[jumBarang];
    
	$tgl = date("Y-m-d H:i:s");
    mysql_query("UPDATE tmp_detail_retur_barang SET jumBarang = '$jumlah', tglTransaksi = '$tgl'
		 WHERE barcode = '$barcode'");
}

function tambahBarangRetur($barcode,$jumBarang){
    //cekBarangTempJual($idBarang);
    $dataAda = cekBarang($barcode);
    if ($dataAda != 0){
        $jumlah = 0;
        if($jumBarang==0){
            $jumlah = 1;
        }
        else{
            $jumlah = $jumBarang;
        }
        $tgl = date("Y-m-d H:i:s");
        $jualBarang = mysql_query("SELECT * FROM barang WHERE barcode = '$barcode'") or die(mysql_error());
        $jual = mysql_fetch_array($jualBarang);

	// cari hargaBeli & idBarang nya
	$sql = "SELECT * FROM detail_beli WHERE isSold = 'N' AND barcode = '$barcode' ORDER BY idTransaksiBeli ASC LIMIT 1";
	//echo $sql;
	$hasil = mysql_query($sql);
	$detilBarang = mysql_fetch_array($hasil);
	if (mysql_num_rows($hasil) > 0) {
		$hargaBeli = $detilBarang[hargaBeli];
		$idBarang  = $detilBarang[idBarang];	
	} else {
		// not supposed to ever happen, but just to be safe....
		//fixme: kalau seluruh stok barang sudah habis (sehingga jadi masuk ke blok ini)
			// -- coba lagi dengan record terakhir utk barang ybs di detail_beli, walaupun isSold=Y
		$hargaBeli = 0;
		$idBarang  = 0;	
	}

	// simpan transaksi di tmp_detail_jual
	$sql = "INSERT into tmp_detail_retur_barang (tglTransaksi,
                            barcode,jumBarang,hargaBeli,hargaJual,username, idBarang)
                        VALUES('$tgl','$barcode',
                            '$jumlah','$hargaBeli','$jual[hargaJual]','$_SESSION[uname]', $idBarang)";
	//echo $sql;
        mysql_query($sql) or die(mysql_error());
    }
    else{
        echo "Barang tidak ada";
    }
}


function cekBarangTempRetur($barcode){
    $adaJual = 0;
	$sql = "SELECT * from tmp_detail_retur_barang where barcode = '$barcode' and username = '$_SESSION[uname]'";
	//echo $sql;
    $cek = mysql_query($sql);
    $adaJual = mysql_num_rows($cek);

    return $adaJual;
}

function check_user_access ($module_name) {

	$userid = (int) $_SESSION['iduser'];
	//var_dump($_SESSION);
	ahp_user_can_access_module( $module_name, $userid );
}


// credit : Insan Faja
function ahp_user_can_access_module( $module_name, $userid ) {
    $userlevel = ahp_get_user_credentials( $userid );
    $query = "SELECT `idLevelUser` FROM `modul` WHERE `script_name` = '$module_name' LIMIT 1;";
	//echo "nih : ".$query;
	//echo "mod : ".$module_name;
    $data = mysql_query( $query );
    if ($module_name == "media.php") { return; };
    if( mysql_num_rows( $data ) < 1 )
        die('No such user');
    $dung = mysql_fetch_array( $data );
    $module_ulevel = $dung['idLevelUser'];
    if( $module_ulevel == 1 )
         return;
    if( $userlevel > $module_ulevel )
        die('Access forbidden, please <a href="../index.php"><b>LOGIN</b></a>');
}

// credit : Insan Fajar
function ahp_get_user_credentials( $userid ) {
    $query = "SELECT `idLevelUser` FROM `user` WHERE `idUser` = '$userid' LIMIT 1;";
    $data = mysql_query( $query );
    if( mysql_num_rows( $data ) < 1 )
        die('Access forbidden, please <a href="../index.php"><b>LOGIN</b></a>');
	return 0;
    $utmp = mysql_fetch_array( $data );
    $userlevel = $utmp['idLevelUser'];
    return $userlevel;
}



/* CHANGELOG -----------------------------------------------------------

 1.5.0 / 2013-01-01 : Harry Sufehmi		: bugfix: fungsi tambahBarangJual() kini tidak lagi mau menerima jumBarang < 1
						(jika quantity penjualan bisa nol / minus, maka uang kas jadi bisa dirampok kasir)

 1.5.0 / 2013-01-01 : Harry Sufehmi		: bugfix: fungsi tambahBarangJual() kadang mendapatkan harga beli yang salah.
					"ORDER BY idDetailBeli" diganti menjadi "ORDER BY idTransaksiBeli"
					karena, banyak database di berbagai toko Ahad mart yang isi idDetailBeli nya ngaco 
					(banyak field idDetailBeli yang isinya 0 [nol])

 1.5.0 / 2012-11-25 : Harry Sufehmi		: fungsi-fungsi untuk mengamankan modul-modul (dari akses langsung / bypass login).
							Credit : Insan Fajar

 1.2.5 / 2012-03-05 : Harry Sufehmi		: fungsi tambahBarangJual() kini akan selalu mendapatkan hargaBeli dengan benar.
						(bugfix: hargaBeli tersimpan sebagai 0 di tmp_detail_jual & detail_jual jika 
							suatu item jumBarang = 0 dan isSold = 'Y' / tidak ada yang isSold = 'N')

 1.2.5 / 2012-02-14 : Harry Sufehmi		: fungsi getJumBarangDiBarang() kini bisa retrieve jumBarang dari parameter barcode yang diberikan
						(bugfix: jumBarang di table barang tidak berkurang setelah Retur Pembelian)

 1.2.5 / 2012-02-01 : Harry Sufehmi		: fungsi getDaftarBarangSupplier() tidak lagi memotong output barang.namaBarang

 1.2.5 / 2012-01-30 : Harry Sufehmi		: fungsi getDaftarBarangSupplier() : menampilkan hanya yang barang.jumBarang < $jumlahMin

 1.0.1 / 2010-11-22 : Harry Sufehmi		: fungsi-fungsi untuk Retur Barang

 1.0.1 / 2010-06-03 : Harry Sufehmi		: various enhancements, bugfixes

 0.9.1		    : Gregorius Arief		: initial release

------------------------------------------------------------------------ */

?>
<?php
/*******************************************************************************
* FPDF                                                                         *
*                                                                              *
* Version: 1.6                                                                 *
* Date:    2008-08-03                                                          *
* Author:  Olivier PLATHEY                                                     *
*******************************************************************************/

define('FPDF_VERSION','1.6');

class FPDF
{
var $page;               //current page number
var $n;                  //current object number
var $offsets;            //array of object offsets
var $buffer;             //buffer holding in-memory PDF
var $pages;              //array containing pages
var $state;              //current document state
var $compress;           //compression flag
var $k;                  //scale factor (number of points in user unit)
var $DefOrientation;     //default orientation
var $CurOrientation;     //current orientation
var $PageFormats;        //available page formats
var $DefPageFormat;      //default page format
var $CurPageFormat;      //current page format
var $PageSizes;          //array storing non-default page sizes
var $wPt,$hPt;           //dimensions of current page in points
var $w,$h;               //dimensions of current page in user unit
var $lMargin;            //left margin
var $tMargin;            //top margin
var $rMargin;            //right margin
var $bMargin;            //page break margin
var $cMargin;            //cell margin
var $x,$y;               //current position in user unit
var $lasth;              //height of last printed cell
var $LineWidth;          //line width in user unit
var $CoreFonts;          //array of standard font names
var $fonts;              //array of used fonts
var $FontFiles;          //array of font files
var $diffs;              //array of encoding differences
var $FontFamily;         //current font family
var $FontStyle;          //current font style
var $underline;          //underlining flag
var $CurrentFont;        //current font info
var $FontSizePt;         //current font size in points
var $FontSize;           //current font size in user unit
var $DrawColor;          //commands for drawing color
var $FillColor;          //commands for filling color
var $TextColor;          //commands for text color
var $ColorFlag;          //indicates whether fill and text colors are different
var $ws;                 //word spacing
var $images;             //array of used images
var $PageLinks;          //array of links in pages
var $links;              //array of internal links
var $AutoPageBreak;      //automatic page breaking
var $PageBreakTrigger;   //threshold used to trigger page breaks
var $InHeader;           //flag set when processing header
var $InFooter;           //flag set when processing footer
var $ZoomMode;           //zoom display mode
var $LayoutMode;         //layout display mode
var $title;              //title
var $subject;            //subject
var $author;             //author
var $keywords;           //keywords
var $creator;            //creator
var $AliasNbPages;       //alias for total number of pages
var $PDFVersion;         //PDF version number

/*******************************************************************************
*                                                                              *
*                               Public methods                                 *
*                                                                              *
*******************************************************************************/
function FPDF($orientation='P', $unit='mm', $format='A4')
{
	//Some checks
	$this->_dochecks();
	//Initialization of properties
	$this->page=0;
	$this->n=2;
	$this->buffer='';
	$this->pages=array();
	$this->PageSizes=array();
	$this->state=0;
	$this->fonts=array();
	$this->FontFiles=array();
	$this->diffs=array();
	$this->images=array();
	$this->links=array();
	$this->InHeader=false;
	$this->InFooter=false;
	$this->lasth=0;
	$this->FontFamily='';
	$this->FontStyle='';
	$this->FontSizePt=12;
	$this->underline=false;
	$this->DrawColor='0 G';
	$this->FillColor='0 g';
	$this->TextColor='0 g';
	$this->ColorFlag=false;
	$this->ws=0;
	//Standard fonts
	$this->CoreFonts=array('courier'=>'Courier', 'courierB'=>'Courier-Bold', 'courierI'=>'Courier-Oblique', 'courierBI'=>'Courier-BoldOblique',
		'helvetica'=>'Helvetica', 'helveticaB'=>'Helvetica-Bold', 'helveticaI'=>'Helvetica-Oblique', 'helveticaBI'=>'Helvetica-BoldOblique',
		'times'=>'Times-Roman', 'timesB'=>'Times-Bold', 'timesI'=>'Times-Italic', 'timesBI'=>'Times-BoldItalic',
		'symbol'=>'Symbol', 'zapfdingbats'=>'ZapfDingbats');
	//Scale factor
	if($unit=='pt')
		$this->k=1;
	elseif($unit=='mm')
		$this->k=72/25.4;
	elseif($unit=='cm')
		$this->k=72/2.54;
	elseif($unit=='in')
		$this->k=72;
	else
		$this->Error('Incorrect unit: '.$unit);
	//Page format
	$this->PageFormats=array('a3'=>array(841.89,1190.55), 'a4'=>array(595.28,841.89), 'a5'=>array(420.94,595.28),
		'letter'=>array(612,792), 'legal'=>array(612,1008));
	if(is_string($format))
		$format=$this->_getpageformat($format);
	$this->DefPageFormat=$format;
	$this->CurPageFormat=$format;
	//Page orientation
	$orientation=strtolower($orientation);
	if($orientation=='p' || $orientation=='portrait')
	{
		$this->DefOrientation='P';
		$this->w=$this->DefPageFormat[0];
		$this->h=$this->DefPageFormat[1];
	}
	elseif($orientation=='l' || $orientation=='landscape')
	{
		$this->DefOrientation='L';
		$this->w=$this->DefPageFormat[1];
		$this->h=$this->DefPageFormat[0];
	}
	else
		$this->Error('Incorrect orientation: '.$orientation);
	$this->CurOrientation=$this->DefOrientation;
	$this->wPt=$this->w*$this->k;
	$this->hPt=$this->h*$this->k;
	//Page margins (1 cm)
	$margin=28.35/$this->k;
	$this->SetMargins($margin,$margin);
	//Interior cell margin (1 mm)
	$this->cMargin=$margin/10;
	//Line width (0.2 mm)
	$this->LineWidth=.567/$this->k;
	//Automatic page break
	$this->SetAutoPageBreak(true,2*$margin);
	//Full width display mode
	$this->SetDisplayMode('fullwidth');
	//Enable compression
	$this->SetCompression(true);
	//Set default PDF version number
	$this->PDFVersion='1.3';
}

function SetMargins($left, $top, $right=null)
{
	//Set left, top and right margins
	$this->lMargin=$left;
	$this->tMargin=$top;
	if($right===null)
		$right=$left;
	$this->rMargin=$right;
}

function SetLeftMargin($margin)
{
	//Set left margin
	$this->lMargin=$margin;
	if($this->page>0 && $this->x<$margin)
		$this->x=$margin;
}

function SetTopMargin($margin)
{
	//Set top margin
	$this->tMargin=$margin;
}

function SetRightMargin($margin)
{
	//Set right margin
	$this->rMargin=$margin;
}

function SetAutoPageBreak($auto, $margin=0)
{
	//Set auto page break mode and triggering margin
	$this->AutoPageBreak=$auto;
	$this->bMargin=$margin;
	$this->PageBreakTrigger=$this->h-$margin;
}

function SetDisplayMode($zoom, $layout='continuous')
{
	//Set display mode in viewer
	if($zoom=='fullpage' || $zoom=='fullwidth' || $zoom=='real' || $zoom=='default' || !is_string($zoom))
		$this->ZoomMode=$zoom;
	else
		$this->Error('Incorrect zoom display mode: '.$zoom);
	if($layout=='single' || $layout=='continuous' || $layout=='two' || $layout=='default')
		$this->LayoutMode=$layout;
	else
		$this->Error('Incorrect layout display mode: '.$layout);
}

function SetCompression($compress)
{
	//Set page compression
	if(function_exists('gzcompress'))
		$this->compress=$compress;
	else
		$this->compress=false;
}

function SetTitle($title, $isUTF8=false)
{
	//Title of document
	if($isUTF8)
		$title=$this->_UTF8toUTF16($title);
	$this->title=$title;
}

function SetSubject($subject, $isUTF8=false)
{
	//Subject of document
	if($isUTF8)
		$subject=$this->_UTF8toUTF16($subject);
	$this->subject=$subject;
}

function SetAuthor($author, $isUTF8=false)
{
	//Author of document
	if($isUTF8)
		$author=$this->_UTF8toUTF16($author);
	$this->author=$author;
}

function SetKeywords($keywords, $isUTF8=false)
{
	//Keywords of document
	if($isUTF8)
		$keywords=$this->_UTF8toUTF16($keywords);
	$this->keywords=$keywords;
}

function SetCreator($creator, $isUTF8=false)
{
	//Creator of document
	if($isUTF8)
		$creator=$this->_UTF8toUTF16($creator);
	$this->creator=$creator;
}

function AliasNbPages($alias='{nb}')
{
	//Define an alias for total number of pages
	$this->AliasNbPages=$alias;
}

function Error($msg)
{
	//Fatal error
	die('<b>FPDF error:</b> '.$msg);
}

function Open()
{
	//Begin document
	$this->state=1;
}

function Close()
{
	//Terminate document
	if($this->state==3)
		return;
	if($this->page==0)
		$this->AddPage();
	//Page footer
	$this->InFooter=true;
	$this->Footer();
	$this->InFooter=false;
	//Close page
	$this->_endpage();
	//Close document
	$this->_enddoc();
}

function AddPage($orientation='', $format='')
{
	//Start a new page
	if($this->state==0)
		$this->Open();
	$family=$this->FontFamily;
	$style=$this->FontStyle.($this->underline ? 'U' : '');
	$size=$this->FontSizePt;
	$lw=$this->LineWidth;
	$dc=$this->DrawColor;
	$fc=$this->FillColor;
	$tc=$this->TextColor;
	$cf=$this->ColorFlag;
	if($this->page>0)
	{
		//Page footer
		$this->InFooter=true;
		$this->Footer();
		$this->InFooter=false;
		//Close page
		$this->_endpage();
	}
	//Start new page
	$this->_beginpage($orientation,$format);
	//Set line cap style to square
	$this->_out('2 J');
	//Set line width
	$this->LineWidth=$lw;
	$this->_out(sprintf('%.2F w',$lw*$this->k));
	//Set font
	if($family)
		$this->SetFont($family,$style,$size);
	//Set colors
	$this->DrawColor=$dc;
	if($dc!='0 G')
		$this->_out($dc);
	$this->FillColor=$fc;
	if($fc!='0 g')
		$this->_out($fc);
	$this->TextColor=$tc;
	$this->ColorFlag=$cf;
	//Page header
	$this->InHeader=true;
	$this->Header();
	$this->InHeader=false;
	//Restore line width
	if($this->LineWidth!=$lw)
	{
		$this->LineWidth=$lw;
		$this->_out(sprintf('%.2F w',$lw*$this->k));
	}
	//Restore font
	if($family)
		$this->SetFont($family,$style,$size);
	//Restore colors
	if($this->DrawColor!=$dc)
	{
		$this->DrawColor=$dc;
		$this->_out($dc);
	}
	if($this->FillColor!=$fc)
	{
		$this->FillColor=$fc;
		$this->_out($fc);
	}
	$this->TextColor=$tc;
	$this->ColorFlag=$cf;
}

function Header()
{
	//To be implemented in your own inherited class
}

function Footer()
{
	//To be implemented in your own inherited class
}

function PageNo()
{
	//Get current page number
	return $this->page;
}

function SetDrawColor($r, $g=null, $b=null)
{
	//Set color for all stroking operations
	if(($r==0 && $g==0 && $b==0) || $g===null)
		$this->DrawColor=sprintf('%.3F G',$r/255);
	else
		$this->DrawColor=sprintf('%.3F %.3F %.3F RG',$r/255,$g/255,$b/255);
	if($this->page>0)
		$this->_out($this->DrawColor);
}

function SetFillColor($r, $g=null, $b=null)
{
	//Set color for all filling operations
	if(($r==0 && $g==0 && $b==0) || $g===null)
		$this->FillColor=sprintf('%.3F g',$r/255);
	else
		$this->FillColor=sprintf('%.3F %.3F %.3F rg',$r/255,$g/255,$b/255);
	$this->ColorFlag=($this->FillColor!=$this->TextColor);
	if($this->page>0)
		$this->_out($this->FillColor);
}

function SetTextColor($r, $g=null, $b=null)
{
	//Set color for text
	if(($r==0 && $g==0 && $b==0) || $g===null)
		$this->TextColor=sprintf('%.3F g',$r/255);
	else
		$this->TextColor=sprintf('%.3F %.3F %.3F rg',$r/255,$g/255,$b/255);
	$this->ColorFlag=($this->FillColor!=$this->TextColor);
}

function GetStringWidth($s)
{
	//Get width of a string in the current font
	$s=(string)$s;
	$cw=&$this->CurrentFont['cw'];
	$w=0;
	$l=strlen($s);
	for($i=0;$i<$l;$i++)
		$w+=$cw[$s[$i]];
	return $w*$this->FontSize/1000;
}

function SetLineWidth($width)
{
	//Set line width
	$this->LineWidth=$width;
	if($this->page>0)
		$this->_out(sprintf('%.2F w',$width*$this->k));
}

function Line($x1, $y1, $x2, $y2)
{
	//Draw a line
	$this->_out(sprintf('%.2F %.2F m %.2F %.2F l S',$x1*$this->k,($this->h-$y1)*$this->k,$x2*$this->k,($this->h-$y2)*$this->k));
}

function Rect($x, $y, $w, $h, $style='')
{
	//Draw a rectangle
	if($style=='F')
		$op='f';
	elseif($style=='FD' || $style=='DF')
		$op='B';
	else
		$op='S';
	$this->_out(sprintf('%.2F %.2F %.2F %.2F re %s',$x*$this->k,($this->h-$y)*$this->k,$w*$this->k,-$h*$this->k,$op));
}

function AddFont($family, $style='', $file='')
{
	//Add a TrueType or Type1 font
	$family=strtolower($family);
	if($file=='')
		$file=str_replace(' ','',$family).strtolower($style).'.php';
	if($family=='arial')
		$family='helvetica';
	$style=strtoupper($style);
	if($style=='IB')
		$style='BI';
	$fontkey=$family.$style;
	if(isset($this->fonts[$fontkey]))
		return;
	include($this->_getfontpath().$file);
	if(!isset($name))
		$this->Error('Could not include font definition file');
	$i=count($this->fonts)+1;
	$this->fonts[$fontkey]=array('i'=>$i, 'type'=>$type, 'name'=>$name, 'desc'=>$desc, 'up'=>$up, 'ut'=>$ut, 'cw'=>$cw, 'enc'=>$enc, 'file'=>$file);
	if($diff)
	{
		//Search existing encodings
		$d=0;
		$nb=count($this->diffs);
		for($i=1;$i<=$nb;$i++)
		{
			if($this->diffs[$i]==$diff)
			{
				$d=$i;
				break;
			}
		}
		if($d==0)
		{
			$d=$nb+1;
			$this->diffs[$d]=$diff;
		}
		$this->fonts[$fontkey]['diff']=$d;
	}
	if($file)
	{
		if($type=='TrueType')
			$this->FontFiles[$file]=array('length1'=>$originalsize);
		else
			$this->FontFiles[$file]=array('length1'=>$size1, 'length2'=>$size2);
	}
}

function SetFont($family, $style='', $size=0)
{
	//Select a font; size given in points
	global $fpdf_charwidths;

	$family=strtolower($family);
	if($family=='')
		$family=$this->FontFamily;
	if($family=='arial')
		$family='helvetica';
	elseif($family=='symbol' || $family=='zapfdingbats')
		$style='';
	$style=strtoupper($style);
	if(strpos($style,'U')!==false)
	{
		$this->underline=true;
		$style=str_replace('U','',$style);
	}
	else
		$this->underline=false;
	if($style=='IB')
		$style='BI';
	if($size==0)
		$size=$this->FontSizePt;
	//Test if font is already selected
	if($this->FontFamily==$family && $this->FontStyle==$style && $this->FontSizePt==$size)
		return;
	//Test if used for the first time
	$fontkey=$family.$style;
	if(!isset($this->fonts[$fontkey]))
	{
		//Check if one of the standard fonts
		if(isset($this->CoreFonts[$fontkey]))
		{
			if(!isset($fpdf_charwidths[$fontkey]))
			{
				//Load metric file
				$file=$family;
				if($family=='times' || $family=='helvetica')
					$file.=strtolower($style);
				include($this->_getfontpath().$file.'.php');
				if(!isset($fpdf_charwidths[$fontkey]))
					$this->Error('Could not include font metric file');
			}
			$i=count($this->fonts)+1;
			$name=$this->CoreFonts[$fontkey];
			$cw=$fpdf_charwidths[$fontkey];
			$this->fonts[$fontkey]=array('i'=>$i, 'type'=>'core', 'name'=>$name, 'up'=>-100, 'ut'=>50, 'cw'=>$cw);
		}
		else
			$this->Error('Undefined font: '.$family.' '.$style);
	}
	//Select it
	$this->FontFamily=$family;
	$this->FontStyle=$style;
	$this->FontSizePt=$size;
	$this->FontSize=$size/$this->k;
	$this->CurrentFont=&$this->fonts[$fontkey];
	if($this->page>0)
		$this->_out(sprintf('BT /F%d %.2F Tf ET',$this->CurrentFont['i'],$this->FontSizePt));
}

function SetFontSize($size)
{
	//Set font size in points
	if($this->FontSizePt==$size)
		return;
	$this->FontSizePt=$size;
	$this->FontSize=$size/$this->k;
	if($this->page>0)
		$this->_out(sprintf('BT /F%d %.2F Tf ET',$this->CurrentFont['i'],$this->FontSizePt));
}

function AddLink()
{
	//Create a new internal link
	$n=count($this->links)+1;
	$this->links[$n]=array(0, 0);
	return $n;
}

function SetLink($link, $y=0, $page=-1)
{
	//Set destination of internal link
	if($y==-1)
		$y=$this->y;
	if($page==-1)
		$page=$this->page;
	$this->links[$link]=array($page, $y);
}

function Link($x, $y, $w, $h, $link)
{
	//Put a link on the page
	$this->PageLinks[$this->page][]=array($x*$this->k, $this->hPt-$y*$this->k, $w*$this->k, $h*$this->k, $link);
}

function Text($x, $y, $txt)
{
	//Output a string
	$s=sprintf('BT %.2F %.2F Td (%s) Tj ET',$x*$this->k,($this->h-$y)*$this->k,$this->_escape($txt));
	if($this->underline && $txt!='')
		$s.=' '.$this->_dounderline($x,$y,$txt);
	if($this->ColorFlag)
		$s='q '.$this->TextColor.' '.$s.' Q';
	$this->_out($s);
}

function AcceptPageBreak()
{
	//Accept automatic page break or not
	return $this->AutoPageBreak;
}

function Cell($w, $h=0, $txt='', $border=0, $ln=0, $align='', $fill=false, $link='')
{
	//Output a cell
	$k=$this->k;
	if($this->y+$h>$this->PageBreakTrigger && !$this->InHeader && !$this->InFooter && $this->AcceptPageBreak())
	{
		//Automatic page break
		$x=$this->x;
		$ws=$this->ws;
		if($ws>0)
		{
			$this->ws=0;
			$this->_out('0 Tw');
		}
		$this->AddPage($this->CurOrientation,$this->CurPageFormat);
		$this->x=$x;
		if($ws>0)
		{
			$this->ws=$ws;
			$this->_out(sprintf('%.3F Tw',$ws*$k));
		}
	}
	if($w==0)
		$w=$this->w-$this->rMargin-$this->x;
	$s='';
	if($fill || $border==1)
	{
		if($fill)
			$op=($border==1) ? 'B' : 'f';
		else
			$op='S';
		$s=sprintf('%.2F %.2F %.2F %.2F re %s ',$this->x*$k,($this->h-$this->y)*$k,$w*$k,-$h*$k,$op);
	}
	if(is_string($border))
	{
		$x=$this->x;
		$y=$this->y;
		if(strpos($border,'L')!==false)
			$s.=sprintf('%.2F %.2F m %.2F %.2F l S ',$x*$k,($this->h-$y)*$k,$x*$k,($this->h-($y+$h))*$k);
		if(strpos($border,'T')!==false)
			$s.=sprintf('%.2F %.2F m %.2F %.2F l S ',$x*$k,($this->h-$y)*$k,($x+$w)*$k,($this->h-$y)*$k);
		if(strpos($border,'R')!==false)
			$s.=sprintf('%.2F %.2F m %.2F %.2F l S ',($x+$w)*$k,($this->h-$y)*$k,($x+$w)*$k,($this->h-($y+$h))*$k);
		if(strpos($border,'B')!==false)
			$s.=sprintf('%.2F %.2F m %.2F %.2F l S ',$x*$k,($this->h-($y+$h))*$k,($x+$w)*$k,($this->h-($y+$h))*$k);
	}
	if($txt!=='')
	{
		if($align=='R')
			$dx=$w-$this->cMargin-$this->GetStringWidth($txt);
		elseif($align=='C')
			$dx=($w-$this->GetStringWidth($txt))/2;
		else
			$dx=$this->cMargin;
		if($this->ColorFlag)
			$s.='q '.$this->TextColor.' ';
		$txt2=str_replace(')','\\)',str_replace('(','\\(',str_replace('\\','\\\\',$txt)));
		$s.=sprintf('BT %.2F %.2F Td (%s) Tj ET',($this->x+$dx)*$k,($this->h-($this->y+.5*$h+.3*$this->FontSize))*$k,$txt2);
		if($this->underline)
			$s.=' '.$this->_dounderline($this->x+$dx,$this->y+.5*$h+.3*$this->FontSize,$txt);
		if($this->ColorFlag)
			$s.=' Q';
		if($link)
			$this->Link($this->x+$dx,$this->y+.5*$h-.5*$this->FontSize,$this->GetStringWidth($txt),$this->FontSize,$link);
	}
	if($s)
		$this->_out($s);
	$this->lasth=$h;
	if($ln>0)
	{
		//Go to next line
		$this->y+=$h;
		if($ln==1)
			$this->x=$this->lMargin;
	}
	else
		$this->x+=$w;
}

function MultiCell($w, $h, $txt, $border=0, $align='J', $fill=false)
{
	//Output text with automatic or explicit line breaks
	$cw=&$this->CurrentFont['cw'];
	if($w==0)
		$w=$this->w-$this->rMargin-$this->x;
	$wmax=($w-2*$this->cMargin)*1000/$this->FontSize;
	$s=str_replace("\r",'',$txt);
	$nb=strlen($s);
	if($nb>0 && $s[$nb-1]=="\n")
		$nb--;
	$b=0;
	if($border)
	{
		if($border==1)
		{
			$border='LTRB';
			$b='LRT';
			$b2='LR';
		}
		else
		{
			$b2='';
			if(strpos($border,'L')!==false)
				$b2.='L';
			if(strpos($border,'R')!==false)
				$b2.='R';
			$b=(strpos($border,'T')!==false) ? $b2.'T' : $b2;
		}
	}
	$sep=-1;
	$i=0;
	$j=0;
	$l=0;
	$ns=0;
	$nl=1;
	while($i<$nb)
	{
		//Get next character
		$c=$s[$i];
		if($c=="\n")
		{
			//Explicit line break
			if($this->ws>0)
			{
				$this->ws=0;
				$this->_out('0 Tw');
			}
			$this->Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
			$i++;
			$sep=-1;
			$j=$i;
			$l=0;
			$ns=0;
			$nl++;
			if($border && $nl==2)
				$b=$b2;
			continue;
		}
		if($c==' ')
		{
			$sep=$i;
			$ls=$l;
			$ns++;
		}
		$l+=$cw[$c];
		if($l>$wmax)
		{
			//Automatic line break
			if($sep==-1)
			{
				if($i==$j)
					$i++;
				if($this->ws>0)
				{
					$this->ws=0;
					$this->_out('0 Tw');
				}
				$this->Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
			}
			else
			{
				if($align=='J')
				{
					$this->ws=($ns>1) ? ($wmax-$ls)/1000*$this->FontSize/($ns-1) : 0;
					$this->_out(sprintf('%.3F Tw',$this->ws*$this->k));
				}
				$this->Cell($w,$h,substr($s,$j,$sep-$j),$b,2,$align,$fill);
				$i=$sep+1;
			}
			$sep=-1;
			$j=$i;
			$l=0;
			$ns=0;
			$nl++;
			if($border && $nl==2)
				$b=$b2;
		}
		else
			$i++;
	}
	//Last chunk
	if($this->ws>0)
	{
		$this->ws=0;
		$this->_out('0 Tw');
	}
	if($border && strpos($border,'B')!==false)
		$b.='B';
	$this->Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
	$this->x=$this->lMargin;
}

function Write($h, $txt, $link='')
{
	//Output text in flowing mode
	$cw=&$this->CurrentFont['cw'];
	$w=$this->w-$this->rMargin-$this->x;
	$wmax=($w-2*$this->cMargin)*1000/$this->FontSize;
	$s=str_replace("\r",'',$txt);
	$nb=strlen($s);
	$sep=-1;
	$i=0;
	$j=0;
	$l=0;
	$nl=1;
	while($i<$nb)
	{
		//Get next character
		$c=$s[$i];
		if($c=="\n")
		{
			//Explicit line break
			$this->Cell($w,$h,substr($s,$j,$i-$j),0,2,'',0,$link);
			$i++;
			$sep=-1;
			$j=$i;
			$l=0;
			if($nl==1)
			{
				$this->x=$this->lMargin;
				$w=$this->w-$this->rMargin-$this->x;
				$wmax=($w-2*$this->cMargin)*1000/$this->FontSize;
			}
			$nl++;
			continue;
		}
		if($c==' ')
			$sep=$i;
		$l+=$cw[$c];
		if($l>$wmax)
		{
			//Automatic line break
			if($sep==-1)
			{
				if($this->x>$this->lMargin)
				{
					//Move to next line
					$this->x=$this->lMargin;
					$this->y+=$h;
					$w=$this->w-$this->rMargin-$this->x;
					$wmax=($w-2*$this->cMargin)*1000/$this->FontSize;
					$i++;
					$nl++;
					continue;
				}
				if($i==$j)
					$i++;
				$this->Cell($w,$h,substr($s,$j,$i-$j),0,2,'',0,$link);
			}
			else
			{
				$this->Cell($w,$h,substr($s,$j,$sep-$j),0,2,'',0,$link);
				$i=$sep+1;
			}
			$sep=-1;
			$j=$i;
			$l=0;
			if($nl==1)
			{
				$this->x=$this->lMargin;
				$w=$this->w-$this->rMargin-$this->x;
				$wmax=($w-2*$this->cMargin)*1000/$this->FontSize;
			}
			$nl++;
		}
		else
			$i++;
	}
	//Last chunk
	if($i!=$j)
		$this->Cell($l/1000*$this->FontSize,$h,substr($s,$j),0,0,'',0,$link);
}

function Ln($h=null)
{
	//Line feed; default value is last cell height
	$this->x=$this->lMargin;
	if($h===null)
		$this->y+=$this->lasth;
	else
		$this->y+=$h;
}

function Image($file, $x=null, $y=null, $w=0, $h=0, $type='', $link='')
{
	//Put an image on the page
	if(!isset($this->images[$file]))
	{
		//First use of this image, get info
		if($type=='')
		{
			$pos=strrpos($file,'.');
			if(!$pos)
				$this->Error('Image file has no extension and no type was specified: '.$file);
			$type=substr($file,$pos+1);
		}
		$type=strtolower($type);
		if($type=='jpeg')
			$type='jpg';
		$mtd='_parse'.$type;
		if(!method_exists($this,$mtd))
			$this->Error('Unsupported image type: '.$type);
		$info=$this->$mtd($file);
		$info['i']=count($this->images)+1;
		$this->images[$file]=$info;
	}
	else
		$info=$this->images[$file];
	//Automatic width and height calculation if needed
	if($w==0 && $h==0)
	{
		//Put image at 72 dpi
		$w=$info['w']/$this->k;
		$h=$info['h']/$this->k;
	}
	elseif($w==0)
		$w=$h*$info['w']/$info['h'];
	elseif($h==0)
		$h=$w*$info['h']/$info['w'];
	//Flowing mode
	if($y===null)
	{
		if($this->y+$h>$this->PageBreakTrigger && !$this->InHeader && !$this->InFooter && $this->AcceptPageBreak())
		{
			//Automatic page break
			$x2=$this->x;
			$this->AddPage($this->CurOrientation,$this->CurPageFormat);
			$this->x=$x2;
		}
		$y=$this->y;
		$this->y+=$h;
	}
	if($x===null)
		$x=$this->x;
	$this->_out(sprintf('q %.2F 0 0 %.2F %.2F %.2F cm /I%d Do Q',$w*$this->k,$h*$this->k,$x*$this->k,($this->h-($y+$h))*$this->k,$info['i']));
	if($link)
		$this->Link($x,$y,$w,$h,$link);
}

function GetX()
{
	//Get x position
	return $this->x;
}

function SetX($x)
{
	//Set x position
	if($x>=0)
		$this->x=$x;
	else
		$this->x=$this->w+$x;
}

function GetY()
{
	//Get y position
	return $this->y;
}

function SetY($y)
{
	//Set y position and reset x
	$this->x=$this->lMargin;
	if($y>=0)
		$this->y=$y;
	else
		$this->y=$this->h+$y;
}

function SetXY($x, $y)
{
	//Set x and y positions
	$this->SetY($y);
	$this->SetX($x);
}

function Output($name='', $dest='')
{
	//Output PDF to some destination
	if($this->state<3)
		$this->Close();
	$dest=strtoupper($dest);
	if($dest=='')
	{
		if($name=='')
		{
			$name='doc.pdf';
			$dest='I';
		}
		else
			$dest='F';
	}
	switch($dest)
	{
		case 'I':
			//Send to standard output
			if(ob_get_length())
				$this->Error('Some data has already been output, can\'t send PDF file');
			if(php_sapi_name()!='cli')
			{
				//We send to a browser
				header('Content-Type: application/pdf');
				if(headers_sent())
					$this->Error('Some data has already been output, can\'t send PDF file');
				header('Content-Length: '.strlen($this->buffer));
				header('Content-Disposition: inline; filename="'.$name.'"');
				header('Cache-Control: private, max-age=0, must-revalidate');
				header('Pragma: public');
				ini_set('zlib.output_compression','0');
			}
			echo $this->buffer;
			break;
		case 'D':
			//Download file
			if(ob_get_length())
				$this->Error('Some data has already been output, can\'t send PDF file');
			header('Content-Type: application/x-download');
			if(headers_sent())
				$this->Error('Some data has already been output, can\'t send PDF file');
			header('Content-Length: '.strlen($this->buffer));
			header('Content-Disposition: attachment; filename="'.$name.'"');
			header('Cache-Control: private, max-age=0, must-revalidate');
			header('Pragma: public');
			ini_set('zlib.output_compression','0');
			echo $this->buffer;
			break;
		case 'F':
			//Save to local file
			$f=fopen($name,'wb');
			if(!$f)
				$this->Error('Unable to create output file: '.$name);
			fwrite($f,$this->buffer,strlen($this->buffer));
			fclose($f);
			break;
		case 'S':
			//Return as a string
			return $this->buffer;
		default:
			$this->Error('Incorrect output destination: '.$dest);
	}
	return '';
}

/*******************************************************************************
*                                                                              *
*                              Protected methods                               *
*                                                                              *
*******************************************************************************/
function _dochecks()
{
	//Check availability of %F
	if(sprintf('%.1F',1.0)!='1.0')
		$this->Error('This version of PHP is not supported');
	//Check mbstring overloading
	if(ini_get('mbstring.func_overload') & 2)
		$this->Error('mbstring overloading must be disabled');
	//Disable runtime magic quotes
	if(get_magic_quotes_runtime())
		@set_magic_quotes_runtime(0);
}

function _getpageformat($format)
{
	$format=strtolower($format);
	if(!isset($this->PageFormats[$format]))
		$this->Error('Unknown page format: '.$format);
	$a=$this->PageFormats[$format];
	return array($a[0]/$this->k, $a[1]/$this->k);
}

function _getfontpath()
{
	if(!defined('FPDF_FONTPATH') && is_dir(dirname(__FILE__).'/font'))
		define('FPDF_FONTPATH',dirname(__FILE__).'/font/');
	return defined('FPDF_FONTPATH') ? FPDF_FONTPATH : '';
}

function _beginpage($orientation, $format)
{
	$this->page++;
	$this->pages[$this->page]='';
	$this->state=2;
	$this->x=$this->lMargin;
	$this->y=$this->tMargin;
	$this->FontFamily='';
	//Check page size
	if($orientation=='')
		$orientation=$this->DefOrientation;
	else
		$orientation=strtoupper($orientation[0]);
	if($format=='')
		$format=$this->DefPageFormat;
	else
	{
		if(is_string($format))
			$format=$this->_getpageformat($format);
	}
	if($orientation!=$this->CurOrientation || $format[0]!=$this->CurPageFormat[0] || $format[1]!=$this->CurPageFormat[1])
	{
		//New size
		if($orientation=='P')
		{
			$this->w=$format[0];
			$this->h=$format[1];
		}
		else
		{
			$this->w=$format[1];
			$this->h=$format[0];
		}
		$this->wPt=$this->w*$this->k;
		$this->hPt=$this->h*$this->k;
		$this->PageBreakTrigger=$this->h-$this->bMargin;
		$this->CurOrientation=$orientation;
		$this->CurPageFormat=$format;
	}
	if($orientation!=$this->DefOrientation || $format[0]!=$this->DefPageFormat[0] || $format[1]!=$this->DefPageFormat[1])
		$this->PageSizes[$this->page]=array($this->wPt, $this->hPt);
}

function _endpage()
{
	$this->state=1;
}

function _escape($s)
{
	//Escape special characters in strings
	$s=str_replace('\\','\\\\',$s);
	$s=str_replace('(','\\(',$s);
	$s=str_replace(')','\\)',$s);
	$s=str_replace("\r",'\\r',$s);
	return $s;
}

function _textstring($s)
{
	//Format a text string
	return '('.$this->_escape($s).')';
}

function _UTF8toUTF16($s)
{
	//Convert UTF-8 to UTF-16BE with BOM
	$res="\xFE\xFF";
	$nb=strlen($s);
	$i=0;
	while($i<$nb)
	{
		$c1=ord($s[$i++]);
		if($c1>=224)
		{
			//3-byte character
			$c2=ord($s[$i++]);
			$c3=ord($s[$i++]);
			$res.=chr((($c1 & 0x0F)<<4) + (($c2 & 0x3C)>>2));
			$res.=chr((($c2 & 0x03)<<6) + ($c3 & 0x3F));
		}
		elseif($c1>=192)
		{
			//2-byte character
			$c2=ord($s[$i++]);
			$res.=chr(($c1 & 0x1C)>>2);
			$res.=chr((($c1 & 0x03)<<6) + ($c2 & 0x3F));
		}
		else
		{
			//Single-byte character
			$res.="\0".chr($c1);
		}
	}
	return $res;
}

function _dounderline($x, $y, $txt)
{
	//Underline text
	$up=$this->CurrentFont['up'];
	$ut=$this->CurrentFont['ut'];
	$w=$this->GetStringWidth($txt)+$this->ws*substr_count($txt,' ');
	return sprintf('%.2F %.2F %.2F %.2F re f',$x*$this->k,($this->h-($y-$up/1000*$this->FontSize))*$this->k,$w*$this->k,-$ut/1000*$this->FontSizePt);
}

function _parsejpg($file)
{
	//Extract info from a JPEG file
	$a=GetImageSize($file);
	if(!$a)
		$this->Error('Missing or incorrect image file: '.$file);
	if($a[2]!=2)
		$this->Error('Not a JPEG file: '.$file);
	if(!isset($a['channels']) || $a['channels']==3)
		$colspace='DeviceRGB';
	elseif($a['channels']==4)
		$colspace='DeviceCMYK';
	else
		$colspace='DeviceGray';
	$bpc=isset($a['bits']) ? $a['bits'] : 8;
	//Read whole file
	$f=fopen($file,'rb');
	$data='';
	while(!feof($f))
		$data.=fread($f,8192);
	fclose($f);
	return array('w'=>$a[0], 'h'=>$a[1], 'cs'=>$colspace, 'bpc'=>$bpc, 'f'=>'DCTDecode', 'data'=>$data);
}

function _parsepng($file)
{
	//Extract info from a PNG file
	$f=fopen($file,'rb');
	if(!$f)
		$this->Error('Can\'t open image file: '.$file);
	//Check signature
	if($this->_readstream($f,8)!=chr(137).'PNG'.chr(13).chr(10).chr(26).chr(10))
		$this->Error('Not a PNG file: '.$file);
	//Read header chunk
	$this->_readstream($f,4);
	if($this->_readstream($f,4)!='IHDR')
		$this->Error('Incorrect PNG file: '.$file);
	$w=$this->_readint($f);
	$h=$this->_readint($f);
	$bpc=ord($this->_readstream($f,1));
	if($bpc>8)
		$this->Error('16-bit depth not supported: '.$file);
	$ct=ord($this->_readstream($f,1));
	if($ct==0)
		$colspace='DeviceGray';
	elseif($ct==2)
		$colspace='DeviceRGB';
	elseif($ct==3)
		$colspace='Indexed';
	else
		$this->Error('Alpha channel not supported: '.$file);
	if(ord($this->_readstream($f,1))!=0)
		$this->Error('Unknown compression method: '.$file);
	if(ord($this->_readstream($f,1))!=0)
		$this->Error('Unknown filter method: '.$file);
	if(ord($this->_readstream($f,1))!=0)
		$this->Error('Interlacing not supported: '.$file);
	$this->_readstream($f,4);
	$parms='/DecodeParms <</Predictor 15 /Colors '.($ct==2 ? 3 : 1).' /BitsPerComponent '.$bpc.' /Columns '.$w.'>>';
	//Scan chunks looking for palette, transparency and image data
	$pal='';
	$trns='';
	$data='';
	do
	{
		$n=$this->_readint($f);
		$type=$this->_readstream($f,4);
		if($type=='PLTE')
		{
			//Read palette
			$pal=$this->_readstream($f,$n);
			$this->_readstream($f,4);
		}
		elseif($type=='tRNS')
		{
			//Read transparency info
			$t=$this->_readstream($f,$n);
			if($ct==0)
				$trns=array(ord(substr($t,1,1)));
			elseif($ct==2)
				$trns=array(ord(substr($t,1,1)), ord(substr($t,3,1)), ord(substr($t,5,1)));
			else
			{
				$pos=strpos($t,chr(0));
				if($pos!==false)
					$trns=array($pos);
			}
			$this->_readstream($f,4);
		}
		elseif($type=='IDAT')
		{
			//Read image data block
			$data.=$this->_readstream($f,$n);
			$this->_readstream($f,4);
		}
		elseif($type=='IEND')
			break;
		else
			$this->_readstream($f,$n+4);
	}
	while($n);
	if($colspace=='Indexed' && empty($pal))
		$this->Error('Missing palette in '.$file);
	fclose($f);
	return array('w'=>$w, 'h'=>$h, 'cs'=>$colspace, 'bpc'=>$bpc, 'f'=>'FlateDecode', 'parms'=>$parms, 'pal'=>$pal, 'trns'=>$trns, 'data'=>$data);
}

function _readstream($f, $n)
{
	//Read n bytes from stream
	$res='';
	while($n>0 && !feof($f))
	{
		$s=fread($f,$n);
		if($s===false)
			$this->Error('Error while reading stream');
		$n-=strlen($s);
		$res.=$s;
	}
	if($n>0)
		$this->Error('Unexpected end of stream');
	return $res;
}

function _readint($f)
{
	//Read a 4-byte integer from stream
	$a=unpack('Ni',$this->_readstream($f,4));
	return $a['i'];
}

function _parsegif($file)
{
	//Extract info from a GIF file (via PNG conversion)
	if(!function_exists('imagepng'))
		$this->Error('GD extension is required for GIF support');
	if(!function_exists('imagecreatefromgif'))
		$this->Error('GD has no GIF read support');
	$im=imagecreatefromgif($file);
	if(!$im)
		$this->Error('Missing or incorrect image file: '.$file);
	imageinterlace($im,0);
	$tmp=tempnam('.','gif');
	if(!$tmp)
		$this->Error('Unable to create a temporary file');
	if(!imagepng($im,$tmp))
		$this->Error('Error while saving to temporary file');
	imagedestroy($im);
	$info=$this->_parsepng($tmp);
	unlink($tmp);
	return $info;
}

function _newobj()
{
	//Begin a new object
	$this->n++;
	$this->offsets[$this->n]=strlen($this->buffer);
	$this->_out($this->n.' 0 obj');
}

function _putstream($s)
{
	$this->_out('stream');
	$this->_out($s);
	$this->_out('endstream');
}

function _out($s)
{
	//Add a line to the document
	if($this->state==2)
		$this->pages[$this->page].=$s."\n";
	else
		$this->buffer.=$s."\n";
}

function _putpages()
{
	$nb=$this->page;
	if(!empty($this->AliasNbPages))
	{
		//Replace number of pages
		for($n=1;$n<=$nb;$n++)
			$this->pages[$n]=str_replace($this->AliasNbPages,$nb,$this->pages[$n]);
	}
	if($this->DefOrientation=='P')
	{
		$wPt=$this->DefPageFormat[0]*$this->k;
		$hPt=$this->DefPageFormat[1]*$this->k;
	}
	else
	{
		$wPt=$this->DefPageFormat[1]*$this->k;
		$hPt=$this->DefPageFormat[0]*$this->k;
	}
	$filter=($this->compress) ? '/Filter /FlateDecode ' : '';
	for($n=1;$n<=$nb;$n++)
	{
		//Page
		$this->_newobj();
		$this->_out('<</Type /Page');
		$this->_out('/Parent 1 0 R');
		if(isset($this->PageSizes[$n]))
			$this->_out(sprintf('/MediaBox [0 0 %.2F %.2F]',$this->PageSizes[$n][0],$this->PageSizes[$n][1]));
		$this->_out('/Resources 2 0 R');
		if(isset($this->PageLinks[$n]))
		{
			//Links
			$annots='/Annots [';
			foreach($this->PageLinks[$n] as $pl)
			{
				$rect=sprintf('%.2F %.2F %.2F %.2F',$pl[0],$pl[1],$pl[0]+$pl[2],$pl[1]-$pl[3]);
				$annots.='<</Type /Annot /Subtype /Link /Rect ['.$rect.'] /Border [0 0 0] ';
				if(is_string($pl[4]))
					$annots.='/A <</S /URI /URI '.$this->_textstring($pl[4]).'>>>>';
				else
				{
					$l=$this->links[$pl[4]];
					$h=isset($this->PageSizes[$l[0]]) ? $this->PageSizes[$l[0]][1] : $hPt;
					$annots.=sprintf('/Dest [%d 0 R /XYZ 0 %.2F null]>>',1+2*$l[0],$h-$l[1]*$this->k);
				}
			}
			$this->_out($annots.']');
		}
		$this->_out('/Contents '.($this->n+1).' 0 R>>');
		$this->_out('endobj');
		//Page content
		$p=($this->compress) ? gzcompress($this->pages[$n]) : $this->pages[$n];
		$this->_newobj();
		$this->_out('<<'.$filter.'/Length '.strlen($p).'>>');
		$this->_putstream($p);
		$this->_out('endobj');
	}
	//Pages root
	$this->offsets[1]=strlen($this->buffer);
	$this->_out('1 0 obj');
	$this->_out('<</Type /Pages');
	$kids='/Kids [';
	for($i=0;$i<$nb;$i++)
		$kids.=(3+2*$i).' 0 R ';
	$this->_out($kids.']');
	$this->_out('/Count '.$nb);
	$this->_out(sprintf('/MediaBox [0 0 %.2F %.2F]',$wPt,$hPt));
	$this->_out('>>');
	$this->_out('endobj');
}

function _putfonts()
{
	$nf=$this->n;
	foreach($this->diffs as $diff)
	{
		//Encodings
		$this->_newobj();
		$this->_out('<</Type /Encoding /BaseEncoding /WinAnsiEncoding /Differences ['.$diff.']>>');
		$this->_out('endobj');
	}
	foreach($this->FontFiles as $file=>$info)
	{
		//Font file embedding
		$this->_newobj();
		$this->FontFiles[$file]['n']=$this->n;
		$font='';
		$f=fopen($this->_getfontpath().$file,'rb',1);
		if(!$f)
			$this->Error('Font file not found');
		while(!feof($f))
			$font.=fread($f,8192);
		fclose($f);
		$compressed=(substr($file,-2)=='.z');
		if(!$compressed && isset($info['length2']))
		{
			$header=(ord($font[0])==128);
			if($header)
			{
				//Strip first binary header
				$font=substr($font,6);
			}
			if($header && ord($font[$info['length1']])==128)
			{
				//Strip second binary header
				$font=substr($font,0,$info['length1']).substr($font,$info['length1']+6);
			}
		}
		$this->_out('<</Length '.strlen($font));
		if($compressed)
			$this->_out('/Filter /FlateDecode');
		$this->_out('/Length1 '.$info['length1']);
		if(isset($info['length2']))
			$this->_out('/Length2 '.$info['length2'].' /Length3 0');
		$this->_out('>>');
		$this->_putstream($font);
		$this->_out('endobj');
	}
	foreach($this->fonts as $k=>$font)
	{
		//Font objects
		$this->fonts[$k]['n']=$this->n+1;
		$type=$font['type'];
		$name=$font['name'];
		if($type=='core')
		{
			//Standard font
			$this->_newobj();
			$this->_out('<</Type /Font');
			$this->_out('/BaseFont /'.$name);
			$this->_out('/Subtype /Type1');
			if($name!='Symbol' && $name!='ZapfDingbats')
				$this->_out('/Encoding /WinAnsiEncoding');
			$this->_out('>>');
			$this->_out('endobj');
		}
		elseif($type=='Type1' || $type=='TrueType')
		{
			//Additional Type1 or TrueType font
			$this->_newobj();
			$this->_out('<</Type /Font');
			$this->_out('/BaseFont /'.$name);
			$this->_out('/Subtype /'.$type);
			$this->_out('/FirstChar 32 /LastChar 255');
			$this->_out('/Widths '.($this->n+1).' 0 R');
			$this->_out('/FontDescriptor '.($this->n+2).' 0 R');
			if($font['enc'])
			{
				if(isset($font['diff']))
					$this->_out('/Encoding '.($nf+$font['diff']).' 0 R');
				else
					$this->_out('/Encoding /WinAnsiEncoding');
			}
			$this->_out('>>');
			$this->_out('endobj');
			//Widths
			$this->_newobj();
			$cw=&$font['cw'];
			$s='[';
			for($i=32;$i<=255;$i++)
				$s.=$cw[chr($i)].' ';
			$this->_out($s.']');
			$this->_out('endobj');
			//Descriptor
			$this->_newobj();
			$s='<</Type /FontDescriptor /FontName /'.$name;
			foreach($font['desc'] as $k=>$v)
				$s.=' /'.$k.' '.$v;
			$file=$font['file'];
			if($file)
				$s.=' /FontFile'.($type=='Type1' ? '' : '2').' '.$this->FontFiles[$file]['n'].' 0 R';
			$this->_out($s.'>>');
			$this->_out('endobj');
		}
		else
		{
			//Allow for additional types
			$mtd='_put'.strtolower($type);
			if(!method_exists($this,$mtd))
				$this->Error('Unsupported font type: '.$type);
			$this->$mtd($font);
		}
	}
}

function _putimages()
{
	$filter=($this->compress) ? '/Filter /FlateDecode ' : '';
	reset($this->images);
	while(list($file,$info)=each($this->images))
	{
		$this->_newobj();
		$this->images[$file]['n']=$this->n;
		$this->_out('<</Type /XObject');
		$this->_out('/Subtype /Image');
		$this->_out('/Width '.$info['w']);
		$this->_out('/Height '.$info['h']);
		if($info['cs']=='Indexed')
			$this->_out('/ColorSpace [/Indexed /DeviceRGB '.(strlen($info['pal'])/3-1).' '.($this->n+1).' 0 R]');
		else
		{
			$this->_out('/ColorSpace /'.$info['cs']);
			if($info['cs']=='DeviceCMYK')
				$this->_out('/Decode [1 0 1 0 1 0 1 0]');
		}
		$this->_out('/BitsPerComponent '.$info['bpc']);
		if(isset($info['f']))
			$this->_out('/Filter /'.$info['f']);
		if(isset($info['parms']))
			$this->_out($info['parms']);
		if(isset($info['trns']) && is_array($info['trns']))
		{
			$trns='';
			for($i=0;$i<count($info['trns']);$i++)
				$trns.=$info['trns'][$i].' '.$info['trns'][$i].' ';
			$this->_out('/Mask ['.$trns.']');
		}
		$this->_out('/Length '.strlen($info['data']).'>>');
		$this->_putstream($info['data']);
		unset($this->images[$file]['data']);
		$this->_out('endobj');
		//Palette
		if($info['cs']=='Indexed')
		{
			$this->_newobj();
			$pal=($this->compress) ? gzcompress($info['pal']) : $info['pal'];
			$this->_out('<<'.$filter.'/Length '.strlen($pal).'>>');
			$this->_putstream($pal);
			$this->_out('endobj');
		}
	}
}

function _putxobjectdict()
{
	foreach($this->images as $image)
		$this->_out('/I'.$image['i'].' '.$image['n'].' 0 R');
}

function _putresourcedict()
{
	$this->_out('/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]');
	$this->_out('/Font <<');
	foreach($this->fonts as $font)
		$this->_out('/F'.$font['i'].' '.$font['n'].' 0 R');
	$this->_out('>>');
	$this->_out('/XObject <<');
	$this->_putxobjectdict();
	$this->_out('>>');
}

function _putresources()
{
	$this->_putfonts();
	$this->_putimages();
	//Resource dictionary
	$this->offsets[2]=strlen($this->buffer);
	$this->_out('2 0 obj');
	$this->_out('<<');
	$this->_putresourcedict();
	$this->_out('>>');
	$this->_out('endobj');
}

function _putinfo()
{
	$this->_out('/Producer '.$this->_textstring('FPDF '.FPDF_VERSION));
	if(!empty($this->title))
		$this->_out('/Title '.$this->_textstring($this->title));
	if(!empty($this->subject))
		$this->_out('/Subject '.$this->_textstring($this->subject));
	if(!empty($this->author))
		$this->_out('/Author '.$this->_textstring($this->author));
	if(!empty($this->keywords))
		$this->_out('/Keywords '.$this->_textstring($this->keywords));
	if(!empty($this->creator))
		$this->_out('/Creator '.$this->_textstring($this->creator));
	$this->_out('/CreationDate '.$this->_textstring('D:'.@date('YmdHis')));
}

function _putcatalog()
{
	$this->_out('/Type /Catalog');
	$this->_out('/Pages 1 0 R');
	if($this->ZoomMode=='fullpage')
		$this->_out('/OpenAction [3 0 R /Fit]');
	elseif($this->ZoomMode=='fullwidth')
		$this->_out('/OpenAction [3 0 R /FitH null]');
	elseif($this->ZoomMode=='real')
		$this->_out('/OpenAction [3 0 R /XYZ null null 1]');
	elseif(!is_string($this->ZoomMode))
		$this->_out('/OpenAction [3 0 R /XYZ null null '.($this->ZoomMode/100).']');
	if($this->LayoutMode=='single')
		$this->_out('/PageLayout /SinglePage');
	elseif($this->LayoutMode=='continuous')
		$this->_out('/PageLayout /OneColumn');
	elseif($this->LayoutMode=='two')
		$this->_out('/PageLayout /TwoColumnLeft');
}

function _putheader()
{
	$this->_out('%PDF-'.$this->PDFVersion);
}

function _puttrailer()
{
	$this->_out('/Size '.($this->n+1));
	$this->_out('/Root '.$this->n.' 0 R');
	$this->_out('/Info '.($this->n-1).' 0 R');
}

function _enddoc()
{
	$this->_putheader();
	$this->_putpages();
	$this->_putresources();
	//Info
	$this->_newobj();
	$this->_out('<<');
	$this->_putinfo();
	$this->_out('>>');
	$this->_out('endobj');
	//Catalog
	$this->_newobj();
	$this->_out('<<');
	$this->_putcatalog();
	$this->_out('>>');
	$this->_out('endobj');
	//Cross-ref
	$o=strlen($this->buffer);
	$this->_out('xref');
	$this->_out('0 '.($this->n+1));
	$this->_out('0000000000 65535 f ');
	for($i=1;$i<=$this->n;$i++)
		$this->_out(sprintf('%010d 00000 n ',$this->offsets[$i]));
	//Trailer
	$this->_out('trailer');
	$this->_out('<<');
	$this->_puttrailer();
	$this->_out('>>');
	$this->_out('startxref');
	$this->_out($o);
	$this->_out('%%EOF');
	$this->state=3;
}
//End of class
}

//Handle special IE contype request
if(isset($_SERVER['HTTP_USER_AGENT']) && $_SERVER['HTTP_USER_AGENT']=='contype')
{
	header('Content-Type: application/pdf');
	exit;
}

?>
<?php 
/* 
 * Class PrintSend - Abstract printing class. 
 * Models the actual sending of data to the printer. 
 *  
 * Author: Mick Sear 
 * eCreate, Aug 2005 
 */ 
  
abstract class PrintSend{ 

    protected $data;     
    protected $debug; 

    abstract protected function printJob($queue); 
     
    abstract protected function interpret(); 
     
    public function __construct() {} 

    public function setData($data){  
        //This can be a filename or some ASCII.  A file check should be made in derived classes. 
        $this->data = $data; 
        $this->debug .= "Data set\n"; 
    } 
     
    //Future functionality (?) Could create filters with this for different languages like PCL or ESC/P 
    public static function printerFactory($type){  
        //Return a new instance of a printer driver of type $type. 
        if (include_once 'Drivers/' . $type . '.php') { 
            return new $type; 
        } else { 
            throw new Exception ('Driver not found: $type'); 
        }         
    } 

    public function getDebug(){ 
    return $this->debug; 
    } 

} 

?> 
<?php 
/* 
 * Class PrintSendLPR - Sends a file to be printed remotely. 
 * File must be either preformatted or plain ASCII until some 
 * printer driver functionality has been incorpoated. 
 * 
 * Inherits setData() and printerFactory() 
 *  
 * Author: Mick Sear 
 * eCreate, Aug 2005 
 */ 
  
class PrintSendLPR extends PrintSend{ 

    private $host = "localhost"; 
    private $port = "7290"; 
    private $timeout = "20"; //20 secs 
    private $errNo; 
    private $errStr; 

    public function __construct() { 
        parent::__construct(); 
    } 
    
    public function setPort($port){ 
        $this->port = $port; 
    $this->debug.="Port is ".$this->port."\n"; 
    } 
    
    public function setHost($host){ 
        $this->host = $host; 
    $this->debug.="Host is ".$this->host."\n"; 
    } 
     
    public function setTimeout($timeout){ 
        $this->timeout = $timeout; 
    } 
     
    public function getErrNo(){ 
        return $this->errNo; 
    } 
     
    public function getErrStr(){ 
        return $this->errStr; 
    }     
    
    public function printJob($queue){ 
         
        //Private static function prints waiting jobs on the queue. 
        $this->printWaiting($queue); 

        //Open a new connection to send the control file and data. 
        $stream = stream_socket_client("tcp://".$this->host.":".$this->port, $this->errNo, $this->errStr, $this->timeout); 
        if(!$stream){ 
            return $this->errNo." (".$this->errStr.")"; 
        } else { 
                         
            $job = self::getJobId();//Get a new id for this job 
             
            //Set printer to receive file 
            fwrite($stream, chr(2).$queue."\n"); 
            $this->debug .= "Confirmation of receive cmd:".ord(fread($stream, 1))."\n"; 
             
            //Send Control file. 
            (isset($_SERVER['SERVER_NAME'])) ? $server = $_SERVER['SERVER_NAME'] : $server = "me";//Might be CLI and not have _SERVER 
            $ctrl = "H".$server."\nPphp\nfdfA".$job.$server."\n"; 
            fwrite($stream, chr(2).strlen($ctrl)." cfA".$job.$server."\n"); 
            $this->debug .= "Confirmation of sending of control file cmd:".ord(fread($stream, 1))."\n"; 
            
            fwrite($stream, $ctrl.chr(0)); //Write null to indicate end of stream 
            $this->debug .= "Confirmation of sending of control file itself:".ord(fread($stream, 1))."\n"; 
                        
            if (is_readable($this->data)){ 
                 
                //It's a filename, rather than just some ascii text that needs printing.  Open and stream. 
                if (strstr(strtolower($_ENV["OS"]), "windows")){ 
                    $this->debug .= "Operating system is Windows\n"; 
                    $data = fopen($this->data, "rb");//Force binary in Windows. 
                } else { 
                    $this->debug .= "Operating system is not Windows\n"; 
                    $data = fopen($this->data, "r"); 
                } 
                 
                fwrite($stream, chr(3).filesize($this->data)." dfA".$job.$server."\n"); 
                $this->debug .= "Confirmation of sending receive data cmd:".ord(fread($stream, 1))."\n"; 
                 
                while(!feof($data)){ 
                    fwrite($stream, fread($data, 8192));                      
                } 
                fwrite($stream, chr(0));//Write null to indicate end of stream 
                $this->debug .= "Confirmation of sending data:".ord(fread($stream, 1))."\n";  
                 
                fclose($data); 
                 
            } else {                       
                    
                //Send data string 
                fwrite($stream, chr(3).strlen($this->data)." dfA".$job.$server."\n");            
                $this->debug .= "Confirmation of sending receive data cmd:".ord(fread($stream, 1))."\n"; 

                fwrite($stream, $this->data.chr(0)); //Write null to indicate end of stream 
                $this->debug .= "Confirmation of sending data:".ord(fread($stream, 1))."\n";  
                 
            } 
        } 

    } 
     
    //Placeholder to handle filters - this will call methods in printer driver classes  
    //instantiated by the printerFactory method.. 
    public function interpret(){} 
     
     
    private function getJobId(){ 
        return "001"; 
         
        //You should implement your own internal storage and incrementing of job numbers here.   
        //This might be a database value, or some file on the file system. 
    } 
     
    private function printWaiting($queue){ 
        $stream = stream_socket_client("tcp://".$this->host.":".$this->port, $this->errNo, $this->errStr, $this->timeout); 
        if (!$stream){ 
            return $this->errNo." (".$this->errStr.")"; 
        } else { 
            //Print any waiting jobs 
            fwrite($stream, chr(1).$queue."\n");             
            $this->debug .= "Confirmation of print waiting jobs cmd:"; 
            while(!feof($stream)){ 
               $this->debug .= ord(fread($stream, 1)); 
            } 
            $this->debug .= "\n"; 
        } 
    } 

} 

?> 
<?php
$fpdf_charwidths['timesI']=array(
	chr(0)=>250,chr(1)=>250,chr(2)=>250,chr(3)=>250,chr(4)=>250,chr(5)=>250,chr(6)=>250,chr(7)=>250,chr(8)=>250,chr(9)=>250,chr(10)=>250,chr(11)=>250,chr(12)=>250,chr(13)=>250,chr(14)=>250,chr(15)=>250,chr(16)=>250,chr(17)=>250,chr(18)=>250,chr(19)=>250,chr(20)=>250,chr(21)=>250,
	chr(22)=>250,chr(23)=>250,chr(24)=>250,chr(25)=>250,chr(26)=>250,chr(27)=>250,chr(28)=>250,chr(29)=>250,chr(30)=>250,chr(31)=>250,' '=>250,'!'=>333,'"'=>420,'#'=>500,'$'=>500,'%'=>833,'&'=>778,'\''=>214,'('=>333,')'=>333,'*'=>500,'+'=>675,
	','=>250,'-'=>333,'.'=>250,'/'=>278,'0'=>500,'1'=>500,'2'=>500,'3'=>500,'4'=>500,'5'=>500,'6'=>500,'7'=>500,'8'=>500,'9'=>500,':'=>333,';'=>333,'<'=>675,'='=>675,'>'=>675,'?'=>500,'@'=>920,'A'=>611,
	'B'=>611,'C'=>667,'D'=>722,'E'=>611,'F'=>611,'G'=>722,'H'=>722,'I'=>333,'J'=>444,'K'=>667,'L'=>556,'M'=>833,'N'=>667,'O'=>722,'P'=>611,'Q'=>722,'R'=>611,'S'=>500,'T'=>556,'U'=>722,'V'=>611,'W'=>833,
	'X'=>611,'Y'=>556,'Z'=>556,'['=>389,'\\'=>278,']'=>389,'^'=>422,'_'=>500,'`'=>333,'a'=>500,'b'=>500,'c'=>444,'d'=>500,'e'=>444,'f'=>278,'g'=>500,'h'=>500,'i'=>278,'j'=>278,'k'=>444,'l'=>278,'m'=>722,
	'n'=>500,'o'=>500,'p'=>500,'q'=>500,'r'=>389,'s'=>389,'t'=>278,'u'=>500,'v'=>444,'w'=>667,'x'=>444,'y'=>444,'z'=>389,'{'=>400,'|'=>275,'}'=>400,'~'=>541,chr(127)=>350,chr(128)=>500,chr(129)=>350,chr(130)=>333,chr(131)=>500,
	chr(132)=>556,chr(133)=>889,chr(134)=>500,chr(135)=>500,chr(136)=>333,chr(137)=>1000,chr(138)=>500,chr(139)=>333,chr(140)=>944,chr(141)=>350,chr(142)=>556,chr(143)=>350,chr(144)=>350,chr(145)=>333,chr(146)=>333,chr(147)=>556,chr(148)=>556,chr(149)=>350,chr(150)=>500,chr(151)=>889,chr(152)=>333,chr(153)=>980,
	chr(154)=>389,chr(155)=>333,chr(156)=>667,chr(157)=>350,chr(158)=>389,chr(159)=>556,chr(160)=>250,chr(161)=>389,chr(162)=>500,chr(163)=>500,chr(164)=>500,chr(165)=>500,chr(166)=>275,chr(167)=>500,chr(168)=>333,chr(169)=>760,chr(170)=>276,chr(171)=>500,chr(172)=>675,chr(173)=>333,chr(174)=>760,chr(175)=>333,
	chr(176)=>400,chr(177)=>675,chr(178)=>300,chr(179)=>300,chr(180)=>333,chr(181)=>500,chr(182)=>523,chr(183)=>250,chr(184)=>333,chr(185)=>300,chr(186)=>310,chr(187)=>500,chr(188)=>750,chr(189)=>750,chr(190)=>750,chr(191)=>500,chr(192)=>611,chr(193)=>611,chr(194)=>611,chr(195)=>611,chr(196)=>611,chr(197)=>611,
	chr(198)=>889,chr(199)=>667,chr(200)=>611,chr(201)=>611,chr(202)=>611,chr(203)=>611,chr(204)=>333,chr(205)=>333,chr(206)=>333,chr(207)=>333,chr(208)=>722,chr(209)=>667,chr(210)=>722,chr(211)=>722,chr(212)=>722,chr(213)=>722,chr(214)=>722,chr(215)=>675,chr(216)=>722,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>556,chr(222)=>611,chr(223)=>500,chr(224)=>500,chr(225)=>500,chr(226)=>500,chr(227)=>500,chr(228)=>500,chr(229)=>500,chr(230)=>667,chr(231)=>444,chr(232)=>444,chr(233)=>444,chr(234)=>444,chr(235)=>444,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>500,chr(241)=>500,
	chr(242)=>500,chr(243)=>500,chr(244)=>500,chr(245)=>500,chr(246)=>500,chr(247)=>675,chr(248)=>500,chr(249)=>500,chr(250)=>500,chr(251)=>500,chr(252)=>500,chr(253)=>444,chr(254)=>500,chr(255)=>444);
?>
<?php
$fpdf_charwidths['zapfdingbats']=array(
	chr(0)=>0,chr(1)=>0,chr(2)=>0,chr(3)=>0,chr(4)=>0,chr(5)=>0,chr(6)=>0,chr(7)=>0,chr(8)=>0,chr(9)=>0,chr(10)=>0,chr(11)=>0,chr(12)=>0,chr(13)=>0,chr(14)=>0,chr(15)=>0,chr(16)=>0,chr(17)=>0,chr(18)=>0,chr(19)=>0,chr(20)=>0,chr(21)=>0,
	chr(22)=>0,chr(23)=>0,chr(24)=>0,chr(25)=>0,chr(26)=>0,chr(27)=>0,chr(28)=>0,chr(29)=>0,chr(30)=>0,chr(31)=>0,' '=>278,'!'=>974,'"'=>961,'#'=>974,'$'=>980,'%'=>719,'&'=>789,'\''=>790,'('=>791,')'=>690,'*'=>960,'+'=>939,
	','=>549,'-'=>855,'.'=>911,'/'=>933,'0'=>911,'1'=>945,'2'=>974,'3'=>755,'4'=>846,'5'=>762,'6'=>761,'7'=>571,'8'=>677,'9'=>763,':'=>760,';'=>759,'<'=>754,'='=>494,'>'=>552,'?'=>537,'@'=>577,'A'=>692,
	'B'=>786,'C'=>788,'D'=>788,'E'=>790,'F'=>793,'G'=>794,'H'=>816,'I'=>823,'J'=>789,'K'=>841,'L'=>823,'M'=>833,'N'=>816,'O'=>831,'P'=>923,'Q'=>744,'R'=>723,'S'=>749,'T'=>790,'U'=>792,'V'=>695,'W'=>776,
	'X'=>768,'Y'=>792,'Z'=>759,'['=>707,'\\'=>708,']'=>682,'^'=>701,'_'=>826,'`'=>815,'a'=>789,'b'=>789,'c'=>707,'d'=>687,'e'=>696,'f'=>689,'g'=>786,'h'=>787,'i'=>713,'j'=>791,'k'=>785,'l'=>791,'m'=>873,
	'n'=>761,'o'=>762,'p'=>762,'q'=>759,'r'=>759,'s'=>892,'t'=>892,'u'=>788,'v'=>784,'w'=>438,'x'=>138,'y'=>277,'z'=>415,'{'=>392,'|'=>392,'}'=>668,'~'=>668,chr(127)=>0,chr(128)=>390,chr(129)=>390,chr(130)=>317,chr(131)=>317,
	chr(132)=>276,chr(133)=>276,chr(134)=>509,chr(135)=>509,chr(136)=>410,chr(137)=>410,chr(138)=>234,chr(139)=>234,chr(140)=>334,chr(141)=>334,chr(142)=>0,chr(143)=>0,chr(144)=>0,chr(145)=>0,chr(146)=>0,chr(147)=>0,chr(148)=>0,chr(149)=>0,chr(150)=>0,chr(151)=>0,chr(152)=>0,chr(153)=>0,
	chr(154)=>0,chr(155)=>0,chr(156)=>0,chr(157)=>0,chr(158)=>0,chr(159)=>0,chr(160)=>0,chr(161)=>732,chr(162)=>544,chr(163)=>544,chr(164)=>910,chr(165)=>667,chr(166)=>760,chr(167)=>760,chr(168)=>776,chr(169)=>595,chr(170)=>694,chr(171)=>626,chr(172)=>788,chr(173)=>788,chr(174)=>788,chr(175)=>788,
	chr(176)=>788,chr(177)=>788,chr(178)=>788,chr(179)=>788,chr(180)=>788,chr(181)=>788,chr(182)=>788,chr(183)=>788,chr(184)=>788,chr(185)=>788,chr(186)=>788,chr(187)=>788,chr(188)=>788,chr(189)=>788,chr(190)=>788,chr(191)=>788,chr(192)=>788,chr(193)=>788,chr(194)=>788,chr(195)=>788,chr(196)=>788,chr(197)=>788,
	chr(198)=>788,chr(199)=>788,chr(200)=>788,chr(201)=>788,chr(202)=>788,chr(203)=>788,chr(204)=>788,chr(205)=>788,chr(206)=>788,chr(207)=>788,chr(208)=>788,chr(209)=>788,chr(210)=>788,chr(211)=>788,chr(212)=>894,chr(213)=>838,chr(214)=>1016,chr(215)=>458,chr(216)=>748,chr(217)=>924,chr(218)=>748,chr(219)=>918,
	chr(220)=>927,chr(221)=>928,chr(222)=>928,chr(223)=>834,chr(224)=>873,chr(225)=>828,chr(226)=>924,chr(227)=>924,chr(228)=>917,chr(229)=>930,chr(230)=>931,chr(231)=>463,chr(232)=>883,chr(233)=>836,chr(234)=>836,chr(235)=>867,chr(236)=>867,chr(237)=>696,chr(238)=>696,chr(239)=>874,chr(240)=>0,chr(241)=>874,
	chr(242)=>760,chr(243)=>946,chr(244)=>771,chr(245)=>865,chr(246)=>771,chr(247)=>888,chr(248)=>967,chr(249)=>888,chr(250)=>831,chr(251)=>873,chr(252)=>927,chr(253)=>970,chr(254)=>918,chr(255)=>0);
?>
<?php
$fpdf_charwidths['timesBI']=array(
	chr(0)=>250,chr(1)=>250,chr(2)=>250,chr(3)=>250,chr(4)=>250,chr(5)=>250,chr(6)=>250,chr(7)=>250,chr(8)=>250,chr(9)=>250,chr(10)=>250,chr(11)=>250,chr(12)=>250,chr(13)=>250,chr(14)=>250,chr(15)=>250,chr(16)=>250,chr(17)=>250,chr(18)=>250,chr(19)=>250,chr(20)=>250,chr(21)=>250,
	chr(22)=>250,chr(23)=>250,chr(24)=>250,chr(25)=>250,chr(26)=>250,chr(27)=>250,chr(28)=>250,chr(29)=>250,chr(30)=>250,chr(31)=>250,' '=>250,'!'=>389,'"'=>555,'#'=>500,'$'=>500,'%'=>833,'&'=>778,'\''=>278,'('=>333,')'=>333,'*'=>500,'+'=>570,
	','=>250,'-'=>333,'.'=>250,'/'=>278,'0'=>500,'1'=>500,'2'=>500,'3'=>500,'4'=>500,'5'=>500,'6'=>500,'7'=>500,'8'=>500,'9'=>500,':'=>333,';'=>333,'<'=>570,'='=>570,'>'=>570,'?'=>500,'@'=>832,'A'=>667,
	'B'=>667,'C'=>667,'D'=>722,'E'=>667,'F'=>667,'G'=>722,'H'=>778,'I'=>389,'J'=>500,'K'=>667,'L'=>611,'M'=>889,'N'=>722,'O'=>722,'P'=>611,'Q'=>722,'R'=>667,'S'=>556,'T'=>611,'U'=>722,'V'=>667,'W'=>889,
	'X'=>667,'Y'=>611,'Z'=>611,'['=>333,'\\'=>278,']'=>333,'^'=>570,'_'=>500,'`'=>333,'a'=>500,'b'=>500,'c'=>444,'d'=>500,'e'=>444,'f'=>333,'g'=>500,'h'=>556,'i'=>278,'j'=>278,'k'=>500,'l'=>278,'m'=>778,
	'n'=>556,'o'=>500,'p'=>500,'q'=>500,'r'=>389,'s'=>389,'t'=>278,'u'=>556,'v'=>444,'w'=>667,'x'=>500,'y'=>444,'z'=>389,'{'=>348,'|'=>220,'}'=>348,'~'=>570,chr(127)=>350,chr(128)=>500,chr(129)=>350,chr(130)=>333,chr(131)=>500,
	chr(132)=>500,chr(133)=>1000,chr(134)=>500,chr(135)=>500,chr(136)=>333,chr(137)=>1000,chr(138)=>556,chr(139)=>333,chr(140)=>944,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>333,chr(146)=>333,chr(147)=>500,chr(148)=>500,chr(149)=>350,chr(150)=>500,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>389,chr(155)=>333,chr(156)=>722,chr(157)=>350,chr(158)=>389,chr(159)=>611,chr(160)=>250,chr(161)=>389,chr(162)=>500,chr(163)=>500,chr(164)=>500,chr(165)=>500,chr(166)=>220,chr(167)=>500,chr(168)=>333,chr(169)=>747,chr(170)=>266,chr(171)=>500,chr(172)=>606,chr(173)=>333,chr(174)=>747,chr(175)=>333,
	chr(176)=>400,chr(177)=>570,chr(178)=>300,chr(179)=>300,chr(180)=>333,chr(181)=>576,chr(182)=>500,chr(183)=>250,chr(184)=>333,chr(185)=>300,chr(186)=>300,chr(187)=>500,chr(188)=>750,chr(189)=>750,chr(190)=>750,chr(191)=>500,chr(192)=>667,chr(193)=>667,chr(194)=>667,chr(195)=>667,chr(196)=>667,chr(197)=>667,
	chr(198)=>944,chr(199)=>667,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>389,chr(205)=>389,chr(206)=>389,chr(207)=>389,chr(208)=>722,chr(209)=>722,chr(210)=>722,chr(211)=>722,chr(212)=>722,chr(213)=>722,chr(214)=>722,chr(215)=>570,chr(216)=>722,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>611,chr(222)=>611,chr(223)=>500,chr(224)=>500,chr(225)=>500,chr(226)=>500,chr(227)=>500,chr(228)=>500,chr(229)=>500,chr(230)=>722,chr(231)=>444,chr(232)=>444,chr(233)=>444,chr(234)=>444,chr(235)=>444,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>500,chr(241)=>556,
	chr(242)=>500,chr(243)=>500,chr(244)=>500,chr(245)=>500,chr(246)=>500,chr(247)=>570,chr(248)=>500,chr(249)=>556,chr(250)=>556,chr(251)=>556,chr(252)=>556,chr(253)=>444,chr(254)=>500,chr(255)=>444);
?>
<?php
$fpdf_charwidths['helveticaBI']=array(
	chr(0)=>278,chr(1)=>278,chr(2)=>278,chr(3)=>278,chr(4)=>278,chr(5)=>278,chr(6)=>278,chr(7)=>278,chr(8)=>278,chr(9)=>278,chr(10)=>278,chr(11)=>278,chr(12)=>278,chr(13)=>278,chr(14)=>278,chr(15)=>278,chr(16)=>278,chr(17)=>278,chr(18)=>278,chr(19)=>278,chr(20)=>278,chr(21)=>278,
	chr(22)=>278,chr(23)=>278,chr(24)=>278,chr(25)=>278,chr(26)=>278,chr(27)=>278,chr(28)=>278,chr(29)=>278,chr(30)=>278,chr(31)=>278,' '=>278,'!'=>333,'"'=>474,'#'=>556,'$'=>556,'%'=>889,'&'=>722,'\''=>238,'('=>333,')'=>333,'*'=>389,'+'=>584,
	','=>278,'-'=>333,'.'=>278,'/'=>278,'0'=>556,'1'=>556,'2'=>556,'3'=>556,'4'=>556,'5'=>556,'6'=>556,'7'=>556,'8'=>556,'9'=>556,':'=>333,';'=>333,'<'=>584,'='=>584,'>'=>584,'?'=>611,'@'=>975,'A'=>722,
	'B'=>722,'C'=>722,'D'=>722,'E'=>667,'F'=>611,'G'=>778,'H'=>722,'I'=>278,'J'=>556,'K'=>722,'L'=>611,'M'=>833,'N'=>722,'O'=>778,'P'=>667,'Q'=>778,'R'=>722,'S'=>667,'T'=>611,'U'=>722,'V'=>667,'W'=>944,
	'X'=>667,'Y'=>667,'Z'=>611,'['=>333,'\\'=>278,']'=>333,'^'=>584,'_'=>556,'`'=>333,'a'=>556,'b'=>611,'c'=>556,'d'=>611,'e'=>556,'f'=>333,'g'=>611,'h'=>611,'i'=>278,'j'=>278,'k'=>556,'l'=>278,'m'=>889,
	'n'=>611,'o'=>611,'p'=>611,'q'=>611,'r'=>389,'s'=>556,'t'=>333,'u'=>611,'v'=>556,'w'=>778,'x'=>556,'y'=>556,'z'=>500,'{'=>389,'|'=>280,'}'=>389,'~'=>584,chr(127)=>350,chr(128)=>556,chr(129)=>350,chr(130)=>278,chr(131)=>556,
	chr(132)=>500,chr(133)=>1000,chr(134)=>556,chr(135)=>556,chr(136)=>333,chr(137)=>1000,chr(138)=>667,chr(139)=>333,chr(140)=>1000,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>278,chr(146)=>278,chr(147)=>500,chr(148)=>500,chr(149)=>350,chr(150)=>556,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>556,chr(155)=>333,chr(156)=>944,chr(157)=>350,chr(158)=>500,chr(159)=>667,chr(160)=>278,chr(161)=>333,chr(162)=>556,chr(163)=>556,chr(164)=>556,chr(165)=>556,chr(166)=>280,chr(167)=>556,chr(168)=>333,chr(169)=>737,chr(170)=>370,chr(171)=>556,chr(172)=>584,chr(173)=>333,chr(174)=>737,chr(175)=>333,
	chr(176)=>400,chr(177)=>584,chr(178)=>333,chr(179)=>333,chr(180)=>333,chr(181)=>611,chr(182)=>556,chr(183)=>278,chr(184)=>333,chr(185)=>333,chr(186)=>365,chr(187)=>556,chr(188)=>834,chr(189)=>834,chr(190)=>834,chr(191)=>611,chr(192)=>722,chr(193)=>722,chr(194)=>722,chr(195)=>722,chr(196)=>722,chr(197)=>722,
	chr(198)=>1000,chr(199)=>722,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>278,chr(205)=>278,chr(206)=>278,chr(207)=>278,chr(208)=>722,chr(209)=>722,chr(210)=>778,chr(211)=>778,chr(212)=>778,chr(213)=>778,chr(214)=>778,chr(215)=>584,chr(216)=>778,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>667,chr(222)=>667,chr(223)=>611,chr(224)=>556,chr(225)=>556,chr(226)=>556,chr(227)=>556,chr(228)=>556,chr(229)=>556,chr(230)=>889,chr(231)=>556,chr(232)=>556,chr(233)=>556,chr(234)=>556,chr(235)=>556,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>611,chr(241)=>611,
	chr(242)=>611,chr(243)=>611,chr(244)=>611,chr(245)=>611,chr(246)=>611,chr(247)=>584,chr(248)=>611,chr(249)=>611,chr(250)=>611,chr(251)=>611,chr(252)=>611,chr(253)=>556,chr(254)=>611,chr(255)=>556);
?>
<?php
$fpdf_charwidths['symbol']=array(
	chr(0)=>250,chr(1)=>250,chr(2)=>250,chr(3)=>250,chr(4)=>250,chr(5)=>250,chr(6)=>250,chr(7)=>250,chr(8)=>250,chr(9)=>250,chr(10)=>250,chr(11)=>250,chr(12)=>250,chr(13)=>250,chr(14)=>250,chr(15)=>250,chr(16)=>250,chr(17)=>250,chr(18)=>250,chr(19)=>250,chr(20)=>250,chr(21)=>250,
	chr(22)=>250,chr(23)=>250,chr(24)=>250,chr(25)=>250,chr(26)=>250,chr(27)=>250,chr(28)=>250,chr(29)=>250,chr(30)=>250,chr(31)=>250,' '=>250,'!'=>333,'"'=>713,'#'=>500,'$'=>549,'%'=>833,'&'=>778,'\''=>439,'('=>333,')'=>333,'*'=>500,'+'=>549,
	','=>250,'-'=>549,'.'=>250,'/'=>278,'0'=>500,'1'=>500,'2'=>500,'3'=>500,'4'=>500,'5'=>500,'6'=>500,'7'=>500,'8'=>500,'9'=>500,':'=>278,';'=>278,'<'=>549,'='=>549,'>'=>549,'?'=>444,'@'=>549,'A'=>722,
	'B'=>667,'C'=>722,'D'=>612,'E'=>611,'F'=>763,'G'=>603,'H'=>722,'I'=>333,'J'=>631,'K'=>722,'L'=>686,'M'=>889,'N'=>722,'O'=>722,'P'=>768,'Q'=>741,'R'=>556,'S'=>592,'T'=>611,'U'=>690,'V'=>439,'W'=>768,
	'X'=>645,'Y'=>795,'Z'=>611,'['=>333,'\\'=>863,']'=>333,'^'=>658,'_'=>500,'`'=>500,'a'=>631,'b'=>549,'c'=>549,'d'=>494,'e'=>439,'f'=>521,'g'=>411,'h'=>603,'i'=>329,'j'=>603,'k'=>549,'l'=>549,'m'=>576,
	'n'=>521,'o'=>549,'p'=>549,'q'=>521,'r'=>549,'s'=>603,'t'=>439,'u'=>576,'v'=>713,'w'=>686,'x'=>493,'y'=>686,'z'=>494,'{'=>480,'|'=>200,'}'=>480,'~'=>549,chr(127)=>0,chr(128)=>0,chr(129)=>0,chr(130)=>0,chr(131)=>0,
	chr(132)=>0,chr(133)=>0,chr(134)=>0,chr(135)=>0,chr(136)=>0,chr(137)=>0,chr(138)=>0,chr(139)=>0,chr(140)=>0,chr(141)=>0,chr(142)=>0,chr(143)=>0,chr(144)=>0,chr(145)=>0,chr(146)=>0,chr(147)=>0,chr(148)=>0,chr(149)=>0,chr(150)=>0,chr(151)=>0,chr(152)=>0,chr(153)=>0,
	chr(154)=>0,chr(155)=>0,chr(156)=>0,chr(157)=>0,chr(158)=>0,chr(159)=>0,chr(160)=>750,chr(161)=>620,chr(162)=>247,chr(163)=>549,chr(164)=>167,chr(165)=>713,chr(166)=>500,chr(167)=>753,chr(168)=>753,chr(169)=>753,chr(170)=>753,chr(171)=>1042,chr(172)=>987,chr(173)=>603,chr(174)=>987,chr(175)=>603,
	chr(176)=>400,chr(177)=>549,chr(178)=>411,chr(179)=>549,chr(180)=>549,chr(181)=>713,chr(182)=>494,chr(183)=>460,chr(184)=>549,chr(185)=>549,chr(186)=>549,chr(187)=>549,chr(188)=>1000,chr(189)=>603,chr(190)=>1000,chr(191)=>658,chr(192)=>823,chr(193)=>686,chr(194)=>795,chr(195)=>987,chr(196)=>768,chr(197)=>768,
	chr(198)=>823,chr(199)=>768,chr(200)=>768,chr(201)=>713,chr(202)=>713,chr(203)=>713,chr(204)=>713,chr(205)=>713,chr(206)=>713,chr(207)=>713,chr(208)=>768,chr(209)=>713,chr(210)=>790,chr(211)=>790,chr(212)=>890,chr(213)=>823,chr(214)=>549,chr(215)=>250,chr(216)=>713,chr(217)=>603,chr(218)=>603,chr(219)=>1042,
	chr(220)=>987,chr(221)=>603,chr(222)=>987,chr(223)=>603,chr(224)=>494,chr(225)=>329,chr(226)=>790,chr(227)=>790,chr(228)=>786,chr(229)=>713,chr(230)=>384,chr(231)=>384,chr(232)=>384,chr(233)=>384,chr(234)=>384,chr(235)=>384,chr(236)=>494,chr(237)=>494,chr(238)=>494,chr(239)=>494,chr(240)=>0,chr(241)=>329,
	chr(242)=>274,chr(243)=>686,chr(244)=>686,chr(245)=>686,chr(246)=>384,chr(247)=>384,chr(248)=>384,chr(249)=>384,chr(250)=>384,chr(251)=>384,chr(252)=>494,chr(253)=>494,chr(254)=>494,chr(255)=>0);
?>
<?php
$fpdf_charwidths['helveticaB']=array(
	chr(0)=>278,chr(1)=>278,chr(2)=>278,chr(3)=>278,chr(4)=>278,chr(5)=>278,chr(6)=>278,chr(7)=>278,chr(8)=>278,chr(9)=>278,chr(10)=>278,chr(11)=>278,chr(12)=>278,chr(13)=>278,chr(14)=>278,chr(15)=>278,chr(16)=>278,chr(17)=>278,chr(18)=>278,chr(19)=>278,chr(20)=>278,chr(21)=>278,
	chr(22)=>278,chr(23)=>278,chr(24)=>278,chr(25)=>278,chr(26)=>278,chr(27)=>278,chr(28)=>278,chr(29)=>278,chr(30)=>278,chr(31)=>278,' '=>278,'!'=>333,'"'=>474,'#'=>556,'$'=>556,'%'=>889,'&'=>722,'\''=>238,'('=>333,')'=>333,'*'=>389,'+'=>584,
	','=>278,'-'=>333,'.'=>278,'/'=>278,'0'=>556,'1'=>556,'2'=>556,'3'=>556,'4'=>556,'5'=>556,'6'=>556,'7'=>556,'8'=>556,'9'=>556,':'=>333,';'=>333,'<'=>584,'='=>584,'>'=>584,'?'=>611,'@'=>975,'A'=>722,
	'B'=>722,'C'=>722,'D'=>722,'E'=>667,'F'=>611,'G'=>778,'H'=>722,'I'=>278,'J'=>556,'K'=>722,'L'=>611,'M'=>833,'N'=>722,'O'=>778,'P'=>667,'Q'=>778,'R'=>722,'S'=>667,'T'=>611,'U'=>722,'V'=>667,'W'=>944,
	'X'=>667,'Y'=>667,'Z'=>611,'['=>333,'\\'=>278,']'=>333,'^'=>584,'_'=>556,'`'=>333,'a'=>556,'b'=>611,'c'=>556,'d'=>611,'e'=>556,'f'=>333,'g'=>611,'h'=>611,'i'=>278,'j'=>278,'k'=>556,'l'=>278,'m'=>889,
	'n'=>611,'o'=>611,'p'=>611,'q'=>611,'r'=>389,'s'=>556,'t'=>333,'u'=>611,'v'=>556,'w'=>778,'x'=>556,'y'=>556,'z'=>500,'{'=>389,'|'=>280,'}'=>389,'~'=>584,chr(127)=>350,chr(128)=>556,chr(129)=>350,chr(130)=>278,chr(131)=>556,
	chr(132)=>500,chr(133)=>1000,chr(134)=>556,chr(135)=>556,chr(136)=>333,chr(137)=>1000,chr(138)=>667,chr(139)=>333,chr(140)=>1000,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>278,chr(146)=>278,chr(147)=>500,chr(148)=>500,chr(149)=>350,chr(150)=>556,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>556,chr(155)=>333,chr(156)=>944,chr(157)=>350,chr(158)=>500,chr(159)=>667,chr(160)=>278,chr(161)=>333,chr(162)=>556,chr(163)=>556,chr(164)=>556,chr(165)=>556,chr(166)=>280,chr(167)=>556,chr(168)=>333,chr(169)=>737,chr(170)=>370,chr(171)=>556,chr(172)=>584,chr(173)=>333,chr(174)=>737,chr(175)=>333,
	chr(176)=>400,chr(177)=>584,chr(178)=>333,chr(179)=>333,chr(180)=>333,chr(181)=>611,chr(182)=>556,chr(183)=>278,chr(184)=>333,chr(185)=>333,chr(186)=>365,chr(187)=>556,chr(188)=>834,chr(189)=>834,chr(190)=>834,chr(191)=>611,chr(192)=>722,chr(193)=>722,chr(194)=>722,chr(195)=>722,chr(196)=>722,chr(197)=>722,
	chr(198)=>1000,chr(199)=>722,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>278,chr(205)=>278,chr(206)=>278,chr(207)=>278,chr(208)=>722,chr(209)=>722,chr(210)=>778,chr(211)=>778,chr(212)=>778,chr(213)=>778,chr(214)=>778,chr(215)=>584,chr(216)=>778,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>667,chr(222)=>667,chr(223)=>611,chr(224)=>556,chr(225)=>556,chr(226)=>556,chr(227)=>556,chr(228)=>556,chr(229)=>556,chr(230)=>889,chr(231)=>556,chr(232)=>556,chr(233)=>556,chr(234)=>556,chr(235)=>556,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>611,chr(241)=>611,
	chr(242)=>611,chr(243)=>611,chr(244)=>611,chr(245)=>611,chr(246)=>611,chr(247)=>584,chr(248)=>611,chr(249)=>611,chr(250)=>611,chr(251)=>611,chr(252)=>611,chr(253)=>556,chr(254)=>611,chr(255)=>556);
?>
<?php
$fpdf_charwidths['times']=array(
	chr(0)=>250,chr(1)=>250,chr(2)=>250,chr(3)=>250,chr(4)=>250,chr(5)=>250,chr(6)=>250,chr(7)=>250,chr(8)=>250,chr(9)=>250,chr(10)=>250,chr(11)=>250,chr(12)=>250,chr(13)=>250,chr(14)=>250,chr(15)=>250,chr(16)=>250,chr(17)=>250,chr(18)=>250,chr(19)=>250,chr(20)=>250,chr(21)=>250,
	chr(22)=>250,chr(23)=>250,chr(24)=>250,chr(25)=>250,chr(26)=>250,chr(27)=>250,chr(28)=>250,chr(29)=>250,chr(30)=>250,chr(31)=>250,' '=>250,'!'=>333,'"'=>408,'#'=>500,'$'=>500,'%'=>833,'&'=>778,'\''=>180,'('=>333,')'=>333,'*'=>500,'+'=>564,
	','=>250,'-'=>333,'.'=>250,'/'=>278,'0'=>500,'1'=>500,'2'=>500,'3'=>500,'4'=>500,'5'=>500,'6'=>500,'7'=>500,'8'=>500,'9'=>500,':'=>278,';'=>278,'<'=>564,'='=>564,'>'=>564,'?'=>444,'@'=>921,'A'=>722,
	'B'=>667,'C'=>667,'D'=>722,'E'=>611,'F'=>556,'G'=>722,'H'=>722,'I'=>333,'J'=>389,'K'=>722,'L'=>611,'M'=>889,'N'=>722,'O'=>722,'P'=>556,'Q'=>722,'R'=>667,'S'=>556,'T'=>611,'U'=>722,'V'=>722,'W'=>944,
	'X'=>722,'Y'=>722,'Z'=>611,'['=>333,'\\'=>278,']'=>333,'^'=>469,'_'=>500,'`'=>333,'a'=>444,'b'=>500,'c'=>444,'d'=>500,'e'=>444,'f'=>333,'g'=>500,'h'=>500,'i'=>278,'j'=>278,'k'=>500,'l'=>278,'m'=>778,
	'n'=>500,'o'=>500,'p'=>500,'q'=>500,'r'=>333,'s'=>389,'t'=>278,'u'=>500,'v'=>500,'w'=>722,'x'=>500,'y'=>500,'z'=>444,'{'=>480,'|'=>200,'}'=>480,'~'=>541,chr(127)=>350,chr(128)=>500,chr(129)=>350,chr(130)=>333,chr(131)=>500,
	chr(132)=>444,chr(133)=>1000,chr(134)=>500,chr(135)=>500,chr(136)=>333,chr(137)=>1000,chr(138)=>556,chr(139)=>333,chr(140)=>889,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>333,chr(146)=>333,chr(147)=>444,chr(148)=>444,chr(149)=>350,chr(150)=>500,chr(151)=>1000,chr(152)=>333,chr(153)=>980,
	chr(154)=>389,chr(155)=>333,chr(156)=>722,chr(157)=>350,chr(158)=>444,chr(159)=>722,chr(160)=>250,chr(161)=>333,chr(162)=>500,chr(163)=>500,chr(164)=>500,chr(165)=>500,chr(166)=>200,chr(167)=>500,chr(168)=>333,chr(169)=>760,chr(170)=>276,chr(171)=>500,chr(172)=>564,chr(173)=>333,chr(174)=>760,chr(175)=>333,
	chr(176)=>400,chr(177)=>564,chr(178)=>300,chr(179)=>300,chr(180)=>333,chr(181)=>500,chr(182)=>453,chr(183)=>250,chr(184)=>333,chr(185)=>300,chr(186)=>310,chr(187)=>500,chr(188)=>750,chr(189)=>750,chr(190)=>750,chr(191)=>444,chr(192)=>722,chr(193)=>722,chr(194)=>722,chr(195)=>722,chr(196)=>722,chr(197)=>722,
	chr(198)=>889,chr(199)=>667,chr(200)=>611,chr(201)=>611,chr(202)=>611,chr(203)=>611,chr(204)=>333,chr(205)=>333,chr(206)=>333,chr(207)=>333,chr(208)=>722,chr(209)=>722,chr(210)=>722,chr(211)=>722,chr(212)=>722,chr(213)=>722,chr(214)=>722,chr(215)=>564,chr(216)=>722,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>722,chr(222)=>556,chr(223)=>500,chr(224)=>444,chr(225)=>444,chr(226)=>444,chr(227)=>444,chr(228)=>444,chr(229)=>444,chr(230)=>667,chr(231)=>444,chr(232)=>444,chr(233)=>444,chr(234)=>444,chr(235)=>444,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>500,chr(241)=>500,
	chr(242)=>500,chr(243)=>500,chr(244)=>500,chr(245)=>500,chr(246)=>500,chr(247)=>564,chr(248)=>500,chr(249)=>500,chr(250)=>500,chr(251)=>500,chr(252)=>500,chr(253)=>500,chr(254)=>500,chr(255)=>500);
?>
<?php
$fpdf_charwidths['helveticaI']=array(
	chr(0)=>278,chr(1)=>278,chr(2)=>278,chr(3)=>278,chr(4)=>278,chr(5)=>278,chr(6)=>278,chr(7)=>278,chr(8)=>278,chr(9)=>278,chr(10)=>278,chr(11)=>278,chr(12)=>278,chr(13)=>278,chr(14)=>278,chr(15)=>278,chr(16)=>278,chr(17)=>278,chr(18)=>278,chr(19)=>278,chr(20)=>278,chr(21)=>278,
	chr(22)=>278,chr(23)=>278,chr(24)=>278,chr(25)=>278,chr(26)=>278,chr(27)=>278,chr(28)=>278,chr(29)=>278,chr(30)=>278,chr(31)=>278,' '=>278,'!'=>278,'"'=>355,'#'=>556,'$'=>556,'%'=>889,'&'=>667,'\''=>191,'('=>333,')'=>333,'*'=>389,'+'=>584,
	','=>278,'-'=>333,'.'=>278,'/'=>278,'0'=>556,'1'=>556,'2'=>556,'3'=>556,'4'=>556,'5'=>556,'6'=>556,'7'=>556,'8'=>556,'9'=>556,':'=>278,';'=>278,'<'=>584,'='=>584,'>'=>584,'?'=>556,'@'=>1015,'A'=>667,
	'B'=>667,'C'=>722,'D'=>722,'E'=>667,'F'=>611,'G'=>778,'H'=>722,'I'=>278,'J'=>500,'K'=>667,'L'=>556,'M'=>833,'N'=>722,'O'=>778,'P'=>667,'Q'=>778,'R'=>722,'S'=>667,'T'=>611,'U'=>722,'V'=>667,'W'=>944,
	'X'=>667,'Y'=>667,'Z'=>611,'['=>278,'\\'=>278,']'=>278,'^'=>469,'_'=>556,'`'=>333,'a'=>556,'b'=>556,'c'=>500,'d'=>556,'e'=>556,'f'=>278,'g'=>556,'h'=>556,'i'=>222,'j'=>222,'k'=>500,'l'=>222,'m'=>833,
	'n'=>556,'o'=>556,'p'=>556,'q'=>556,'r'=>333,'s'=>500,'t'=>278,'u'=>556,'v'=>500,'w'=>722,'x'=>500,'y'=>500,'z'=>500,'{'=>334,'|'=>260,'}'=>334,'~'=>584,chr(127)=>350,chr(128)=>556,chr(129)=>350,chr(130)=>222,chr(131)=>556,
	chr(132)=>333,chr(133)=>1000,chr(134)=>556,chr(135)=>556,chr(136)=>333,chr(137)=>1000,chr(138)=>667,chr(139)=>333,chr(140)=>1000,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>222,chr(146)=>222,chr(147)=>333,chr(148)=>333,chr(149)=>350,chr(150)=>556,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>500,chr(155)=>333,chr(156)=>944,chr(157)=>350,chr(158)=>500,chr(159)=>667,chr(160)=>278,chr(161)=>333,chr(162)=>556,chr(163)=>556,chr(164)=>556,chr(165)=>556,chr(166)=>260,chr(167)=>556,chr(168)=>333,chr(169)=>737,chr(170)=>370,chr(171)=>556,chr(172)=>584,chr(173)=>333,chr(174)=>737,chr(175)=>333,
	chr(176)=>400,chr(177)=>584,chr(178)=>333,chr(179)=>333,chr(180)=>333,chr(181)=>556,chr(182)=>537,chr(183)=>278,chr(184)=>333,chr(185)=>333,chr(186)=>365,chr(187)=>556,chr(188)=>834,chr(189)=>834,chr(190)=>834,chr(191)=>611,chr(192)=>667,chr(193)=>667,chr(194)=>667,chr(195)=>667,chr(196)=>667,chr(197)=>667,
	chr(198)=>1000,chr(199)=>722,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>278,chr(205)=>278,chr(206)=>278,chr(207)=>278,chr(208)=>722,chr(209)=>722,chr(210)=>778,chr(211)=>778,chr(212)=>778,chr(213)=>778,chr(214)=>778,chr(215)=>584,chr(216)=>778,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>667,chr(222)=>667,chr(223)=>611,chr(224)=>556,chr(225)=>556,chr(226)=>556,chr(227)=>556,chr(228)=>556,chr(229)=>556,chr(230)=>889,chr(231)=>500,chr(232)=>556,chr(233)=>556,chr(234)=>556,chr(235)=>556,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>556,chr(241)=>556,
	chr(242)=>556,chr(243)=>556,chr(244)=>556,chr(245)=>556,chr(246)=>556,chr(247)=>584,chr(248)=>611,chr(249)=>556,chr(250)=>556,chr(251)=>556,chr(252)=>556,chr(253)=>500,chr(254)=>556,chr(255)=>500);
?>
<?php
$fpdf_charwidths['helvetica']=array(
	chr(0)=>278,chr(1)=>278,chr(2)=>278,chr(3)=>278,chr(4)=>278,chr(5)=>278,chr(6)=>278,chr(7)=>278,chr(8)=>278,chr(9)=>278,chr(10)=>278,chr(11)=>278,chr(12)=>278,chr(13)=>278,chr(14)=>278,chr(15)=>278,chr(16)=>278,chr(17)=>278,chr(18)=>278,chr(19)=>278,chr(20)=>278,chr(21)=>278,
	chr(22)=>278,chr(23)=>278,chr(24)=>278,chr(25)=>278,chr(26)=>278,chr(27)=>278,chr(28)=>278,chr(29)=>278,chr(30)=>278,chr(31)=>278,' '=>278,'!'=>278,'"'=>355,'#'=>556,'$'=>556,'%'=>889,'&'=>667,'\''=>191,'('=>333,')'=>333,'*'=>389,'+'=>584,
	','=>278,'-'=>333,'.'=>278,'/'=>278,'0'=>556,'1'=>556,'2'=>556,'3'=>556,'4'=>556,'5'=>556,'6'=>556,'7'=>556,'8'=>556,'9'=>556,':'=>278,';'=>278,'<'=>584,'='=>584,'>'=>584,'?'=>556,'@'=>1015,'A'=>667,
	'B'=>667,'C'=>722,'D'=>722,'E'=>667,'F'=>611,'G'=>778,'H'=>722,'I'=>278,'J'=>500,'K'=>667,'L'=>556,'M'=>833,'N'=>722,'O'=>778,'P'=>667,'Q'=>778,'R'=>722,'S'=>667,'T'=>611,'U'=>722,'V'=>667,'W'=>944,
	'X'=>667,'Y'=>667,'Z'=>611,'['=>278,'\\'=>278,']'=>278,'^'=>469,'_'=>556,'`'=>333,'a'=>556,'b'=>556,'c'=>500,'d'=>556,'e'=>556,'f'=>278,'g'=>556,'h'=>556,'i'=>222,'j'=>222,'k'=>500,'l'=>222,'m'=>833,
	'n'=>556,'o'=>556,'p'=>556,'q'=>556,'r'=>333,'s'=>500,'t'=>278,'u'=>556,'v'=>500,'w'=>722,'x'=>500,'y'=>500,'z'=>500,'{'=>334,'|'=>260,'}'=>334,'~'=>584,chr(127)=>350,chr(128)=>556,chr(129)=>350,chr(130)=>222,chr(131)=>556,
	chr(132)=>333,chr(133)=>1000,chr(134)=>556,chr(135)=>556,chr(136)=>333,chr(137)=>1000,chr(138)=>667,chr(139)=>333,chr(140)=>1000,chr(141)=>350,chr(142)=>611,chr(143)=>350,chr(144)=>350,chr(145)=>222,chr(146)=>222,chr(147)=>333,chr(148)=>333,chr(149)=>350,chr(150)=>556,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>500,chr(155)=>333,chr(156)=>944,chr(157)=>350,chr(158)=>500,chr(159)=>667,chr(160)=>278,chr(161)=>333,chr(162)=>556,chr(163)=>556,chr(164)=>556,chr(165)=>556,chr(166)=>260,chr(167)=>556,chr(168)=>333,chr(169)=>737,chr(170)=>370,chr(171)=>556,chr(172)=>584,chr(173)=>333,chr(174)=>737,chr(175)=>333,
	chr(176)=>400,chr(177)=>584,chr(178)=>333,chr(179)=>333,chr(180)=>333,chr(181)=>556,chr(182)=>537,chr(183)=>278,chr(184)=>333,chr(185)=>333,chr(186)=>365,chr(187)=>556,chr(188)=>834,chr(189)=>834,chr(190)=>834,chr(191)=>611,chr(192)=>667,chr(193)=>667,chr(194)=>667,chr(195)=>667,chr(196)=>667,chr(197)=>667,
	chr(198)=>1000,chr(199)=>722,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>278,chr(205)=>278,chr(206)=>278,chr(207)=>278,chr(208)=>722,chr(209)=>722,chr(210)=>778,chr(211)=>778,chr(212)=>778,chr(213)=>778,chr(214)=>778,chr(215)=>584,chr(216)=>778,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>667,chr(222)=>667,chr(223)=>611,chr(224)=>556,chr(225)=>556,chr(226)=>556,chr(227)=>556,chr(228)=>556,chr(229)=>556,chr(230)=>889,chr(231)=>500,chr(232)=>556,chr(233)=>556,chr(234)=>556,chr(235)=>556,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>556,chr(241)=>556,
	chr(242)=>556,chr(243)=>556,chr(244)=>556,chr(245)=>556,chr(246)=>556,chr(247)=>584,chr(248)=>611,chr(249)=>556,chr(250)=>556,chr(251)=>556,chr(252)=>556,chr(253)=>500,chr(254)=>556,chr(255)=>500);
?>
<?php
$fpdf_charwidths['timesB']=array(
	chr(0)=>250,chr(1)=>250,chr(2)=>250,chr(3)=>250,chr(4)=>250,chr(5)=>250,chr(6)=>250,chr(7)=>250,chr(8)=>250,chr(9)=>250,chr(10)=>250,chr(11)=>250,chr(12)=>250,chr(13)=>250,chr(14)=>250,chr(15)=>250,chr(16)=>250,chr(17)=>250,chr(18)=>250,chr(19)=>250,chr(20)=>250,chr(21)=>250,
	chr(22)=>250,chr(23)=>250,chr(24)=>250,chr(25)=>250,chr(26)=>250,chr(27)=>250,chr(28)=>250,chr(29)=>250,chr(30)=>250,chr(31)=>250,' '=>250,'!'=>333,'"'=>555,'#'=>500,'$'=>500,'%'=>1000,'&'=>833,'\''=>278,'('=>333,')'=>333,'*'=>500,'+'=>570,
	','=>250,'-'=>333,'.'=>250,'/'=>278,'0'=>500,'1'=>500,'2'=>500,'3'=>500,'4'=>500,'5'=>500,'6'=>500,'7'=>500,'8'=>500,'9'=>500,':'=>333,';'=>333,'<'=>570,'='=>570,'>'=>570,'?'=>500,'@'=>930,'A'=>722,
	'B'=>667,'C'=>722,'D'=>722,'E'=>667,'F'=>611,'G'=>778,'H'=>778,'I'=>389,'J'=>500,'K'=>778,'L'=>667,'M'=>944,'N'=>722,'O'=>778,'P'=>611,'Q'=>778,'R'=>722,'S'=>556,'T'=>667,'U'=>722,'V'=>722,'W'=>1000,
	'X'=>722,'Y'=>722,'Z'=>667,'['=>333,'\\'=>278,']'=>333,'^'=>581,'_'=>500,'`'=>333,'a'=>500,'b'=>556,'c'=>444,'d'=>556,'e'=>444,'f'=>333,'g'=>500,'h'=>556,'i'=>278,'j'=>333,'k'=>556,'l'=>278,'m'=>833,
	'n'=>556,'o'=>500,'p'=>556,'q'=>556,'r'=>444,'s'=>389,'t'=>333,'u'=>556,'v'=>500,'w'=>722,'x'=>500,'y'=>500,'z'=>444,'{'=>394,'|'=>220,'}'=>394,'~'=>520,chr(127)=>350,chr(128)=>500,chr(129)=>350,chr(130)=>333,chr(131)=>500,
	chr(132)=>500,chr(133)=>1000,chr(134)=>500,chr(135)=>500,chr(136)=>333,chr(137)=>1000,chr(138)=>556,chr(139)=>333,chr(140)=>1000,chr(141)=>350,chr(142)=>667,chr(143)=>350,chr(144)=>350,chr(145)=>333,chr(146)=>333,chr(147)=>500,chr(148)=>500,chr(149)=>350,chr(150)=>500,chr(151)=>1000,chr(152)=>333,chr(153)=>1000,
	chr(154)=>389,chr(155)=>333,chr(156)=>722,chr(157)=>350,chr(158)=>444,chr(159)=>722,chr(160)=>250,chr(161)=>333,chr(162)=>500,chr(163)=>500,chr(164)=>500,chr(165)=>500,chr(166)=>220,chr(167)=>500,chr(168)=>333,chr(169)=>747,chr(170)=>300,chr(171)=>500,chr(172)=>570,chr(173)=>333,chr(174)=>747,chr(175)=>333,
	chr(176)=>400,chr(177)=>570,chr(178)=>300,chr(179)=>300,chr(180)=>333,chr(181)=>556,chr(182)=>540,chr(183)=>250,chr(184)=>333,chr(185)=>300,chr(186)=>330,chr(187)=>500,chr(188)=>750,chr(189)=>750,chr(190)=>750,chr(191)=>500,chr(192)=>722,chr(193)=>722,chr(194)=>722,chr(195)=>722,chr(196)=>722,chr(197)=>722,
	chr(198)=>1000,chr(199)=>722,chr(200)=>667,chr(201)=>667,chr(202)=>667,chr(203)=>667,chr(204)=>389,chr(205)=>389,chr(206)=>389,chr(207)=>389,chr(208)=>722,chr(209)=>722,chr(210)=>778,chr(211)=>778,chr(212)=>778,chr(213)=>778,chr(214)=>778,chr(215)=>570,chr(216)=>778,chr(217)=>722,chr(218)=>722,chr(219)=>722,
	chr(220)=>722,chr(221)=>722,chr(222)=>611,chr(223)=>556,chr(224)=>500,chr(225)=>500,chr(226)=>500,chr(227)=>500,chr(228)=>500,chr(229)=>500,chr(230)=>722,chr(231)=>444,chr(232)=>444,chr(233)=>444,chr(234)=>444,chr(235)=>444,chr(236)=>278,chr(237)=>278,chr(238)=>278,chr(239)=>278,chr(240)=>500,chr(241)=>556,
	chr(242)=>500,chr(243)=>500,chr(244)=>500,chr(245)=>500,chr(246)=>500,chr(247)=>570,chr(248)=>500,chr(249)=>556,chr(250)=>556,chr(251)=>556,chr(252)=>556,chr(253)=>500,chr(254)=>556,chr(255)=>500);
?>
<?php
for($i=0;$i<=255;$i++)
	$fpdf_charwidths['courier'][chr($i)]=600;
$fpdf_charwidths['courierB']=$fpdf_charwidths['courier'];
$fpdf_charwidths['courierI']=$fpdf_charwidths['courier'];
$fpdf_charwidths['courierBI']=$fpdf_charwidths['courier'];
?>
<?php
/*******************************************************************************
* Utility to generate font definition files                                    *
*                                                                              *
* Version: 1.14                                                                *
* Date:    2008-08-03                                                          *
* Author:  Olivier PLATHEY                                                     *
*******************************************************************************/

function ReadMap($enc)
{
	//Read a map file
	$file=dirname(__FILE__).'/'.strtolower($enc).'.map';
	$a=file($file);
	if(empty($a))
		die('<b>Error:</b> encoding not found: '.$enc);
	$cc2gn=array();
	foreach($a as $l)
	{
		if($l[0]=='!')
		{
			$e=preg_split('/[ \\t]+/',rtrim($l));
			$cc=hexdec(substr($e[0],1));
			$gn=$e[2];
			$cc2gn[$cc]=$gn;
		}
	}
	for($i=0;$i<=255;$i++)
	{
		if(!isset($cc2gn[$i]))
			$cc2gn[$i]='.notdef';
	}
	return $cc2gn;
}

function ReadAFM($file, &$map)
{
	//Read a font metric file
	$a=file($file);
	if(empty($a))
		die('File not found');
	$widths=array();
	$fm=array();
	$fix=array('Edot'=>'Edotaccent','edot'=>'edotaccent','Idot'=>'Idotaccent','Zdot'=>'Zdotaccent','zdot'=>'zdotaccent',
		'Odblacute'=>'Ohungarumlaut','odblacute'=>'ohungarumlaut','Udblacute'=>'Uhungarumlaut','udblacute'=>'uhungarumlaut',
		'Gcedilla'=>'Gcommaaccent','gcedilla'=>'gcommaaccent','Kcedilla'=>'Kcommaaccent','kcedilla'=>'kcommaaccent',
		'Lcedilla'=>'Lcommaaccent','lcedilla'=>'lcommaaccent','Ncedilla'=>'Ncommaaccent','ncedilla'=>'ncommaaccent',
		'Rcedilla'=>'Rcommaaccent','rcedilla'=>'rcommaaccent','Scedilla'=>'Scommaaccent','scedilla'=>'scommaaccent',
		'Tcedilla'=>'Tcommaaccent','tcedilla'=>'tcommaaccent','Dslash'=>'Dcroat','dslash'=>'dcroat','Dmacron'=>'Dcroat','dmacron'=>'dcroat',
		'combininggraveaccent'=>'gravecomb','combininghookabove'=>'hookabovecomb','combiningtildeaccent'=>'tildecomb',
		'combiningacuteaccent'=>'acutecomb','combiningdotbelow'=>'dotbelowcomb','dongsign'=>'dong');
	foreach($a as $l)
	{
		$e=explode(' ',rtrim($l));
		if(count($e)<2)
			continue;
		$code=$e[0];
		$param=$e[1];
		if($code=='C')
		{
			//Character metrics
			$cc=(int)$e[1];
			$w=$e[4];
			$gn=$e[7];
			if(substr($gn,-4)=='20AC')
				$gn='Euro';
			if(isset($fix[$gn]))
			{
				//Fix incorrect glyph name
				foreach($map as $c=>$n)
				{
					if($n==$fix[$gn])
						$map[$c]=$gn;
				}
			}
			if(empty($map))
			{
				//Symbolic font: use built-in encoding
				$widths[$cc]=$w;
			}
			else
			{
				$widths[$gn]=$w;
				if($gn=='X')
					$fm['CapXHeight']=$e[13];
			}
			if($gn=='.notdef')
				$fm['MissingWidth']=$w;
		}
		elseif($code=='FontName')
			$fm['FontName']=$param;
		elseif($code=='Weight')
			$fm['Weight']=$param;
		elseif($code=='ItalicAngle')
			$fm['ItalicAngle']=(double)$param;
		elseif($code=='Ascender')
			$fm['Ascender']=(int)$param;
		elseif($code=='Descender')
			$fm['Descender']=(int)$param;
		elseif($code=='UnderlineThickness')
			$fm['UnderlineThickness']=(int)$param;
		elseif($code=='UnderlinePosition')
			$fm['UnderlinePosition']=(int)$param;
		elseif($code=='IsFixedPitch')
			$fm['IsFixedPitch']=($param=='true');
		elseif($code=='FontBBox')
			$fm['FontBBox']=array($e[1],$e[2],$e[3],$e[4]);
		elseif($code=='CapHeight')
			$fm['CapHeight']=(int)$param;
		elseif($code=='StdVW')
			$fm['StdVW']=(int)$param;
	}
	if(!isset($fm['FontName']))
		die('FontName not found');
	if(!empty($map))
	{
		if(!isset($widths['.notdef']))
			$widths['.notdef']=600;
		if(!isset($widths['Delta']) && isset($widths['increment']))
			$widths['Delta']=$widths['increment'];
		//Order widths according to map
		for($i=0;$i<=255;$i++)
		{
			if(!isset($widths[$map[$i]]))
			{
				echo '<b>Warning:</b> character '.$map[$i].' is missing<br>';
				$widths[$i]=$widths['.notdef'];
			}
			else
				$widths[$i]=$widths[$map[$i]];
		}
	}
	$fm['Widths']=$widths;
	return $fm;
}

function MakeFontDescriptor($fm, $symbolic)
{
	//Ascent
	$asc=(isset($fm['Ascender']) ? $fm['Ascender'] : 1000);
	$fd="array('Ascent'=>".$asc;
	//Descent
	$desc=(isset($fm['Descender']) ? $fm['Descender'] : -200);
	$fd.=",'Descent'=>".$desc;
	//CapHeight
	if(isset($fm['CapHeight']))
		$ch=$fm['CapHeight'];
	elseif(isset($fm['CapXHeight']))
		$ch=$fm['CapXHeight'];
	else
		$ch=$asc;
	$fd.=",'CapHeight'=>".$ch;
	//Flags
	$flags=0;
	if(isset($fm['IsFixedPitch']) && $fm['IsFixedPitch'])
		$flags+=1<<0;
	if($symbolic)
		$flags+=1<<2;
	if(!$symbolic)
		$flags+=1<<5;
	if(isset($fm['ItalicAngle']) && $fm['ItalicAngle']!=0)
		$flags+=1<<6;
	$fd.=",'Flags'=>".$flags;
	//FontBBox
	if(isset($fm['FontBBox']))
		$fbb=$fm['FontBBox'];
	else
		$fbb=array(0,$desc-100,1000,$asc+100);
	$fd.=",'FontBBox'=>'[".$fbb[0].' '.$fbb[1].' '.$fbb[2].' '.$fbb[3]."]'";
	//ItalicAngle
	$ia=(isset($fm['ItalicAngle']) ? $fm['ItalicAngle'] : 0);
	$fd.=",'ItalicAngle'=>".$ia;
	//StemV
	if(isset($fm['StdVW']))
		$stemv=$fm['StdVW'];
	elseif(isset($fm['Weight']) && preg_match('/bold|black/i',$fm['Weight']))
		$stemv=120;
	else
		$stemv=70;
	$fd.=",'StemV'=>".$stemv;
	//MissingWidth
	if(isset($fm['MissingWidth']))
		$fd.=",'MissingWidth'=>".$fm['MissingWidth'];
	$fd.=')';
	return $fd;
}

function MakeWidthArray($fm)
{
	//Make character width array
	$s="array(\n\t";
	$cw=$fm['Widths'];
	for($i=0;$i<=255;$i++)
	{
		if(chr($i)=="'")
			$s.="'\\''";
		elseif(chr($i)=="\\")
			$s.="'\\\\'";
		elseif($i>=32 && $i<=126)
			$s.="'".chr($i)."'";
		else
			$s.="chr($i)";
		$s.='=>'.$fm['Widths'][$i];
		if($i<255)
			$s.=',';
		if(($i+1)%22==0)
			$s.="\n\t";
	}
	$s.=')';
	return $s;
}

function MakeFontEncoding($map)
{
	//Build differences from reference encoding
	$ref=ReadMap('cp1252');
	$s='';
	$last=0;
	for($i=32;$i<=255;$i++)
	{
		if($map[$i]!=$ref[$i])
		{
			if($i!=$last+1)
				$s.=$i.' ';
			$last=$i;
			$s.='/'.$map[$i].' ';
		}
	}
	return rtrim($s);
}

function SaveToFile($file, $s, $mode)
{
	$f=fopen($file,'w'.$mode);
	if(!$f)
		die('Can\'t write to file '.$file);
	fwrite($f,$s,strlen($s));
	fclose($f);
}

function ReadShort($f)
{
	$a=unpack('n1n',fread($f,2));
	return $a['n'];
}

function ReadLong($f)
{
	$a=unpack('N1N',fread($f,4));
	return $a['N'];
}

function CheckTTF($file)
{
	//Check if font license allows embedding
	$f=fopen($file,'rb');
	if(!$f)
		die('<b>Error:</b> Can\'t open '.$file);
	//Extract number of tables
	fseek($f,4,SEEK_CUR);
	$nb=ReadShort($f);
	fseek($f,6,SEEK_CUR);
	//Seek OS/2 table
	$found=false;
	for($i=0;$i<$nb;$i++)
	{
		if(fread($f,4)=='OS/2')
		{
			$found=true;
			break;
		}
		fseek($f,12,SEEK_CUR);
	}
	if(!$found)
	{
		fclose($f);
		return;
	}
	fseek($f,4,SEEK_CUR);
	$offset=ReadLong($f);
	fseek($f,$offset,SEEK_SET);
	//Extract fsType flags
	fseek($f,8,SEEK_CUR);
	$fsType=ReadShort($f);
	$rl=($fsType & 0x02)!=0;
	$pp=($fsType & 0x04)!=0;
	$e=($fsType & 0x08)!=0;
	fclose($f);
	if($rl && !$pp && !$e)
		echo '<b>Warning:</b> font license does not allow embedding';
}

/*******************************************************************************
* fontfile: path to TTF file (or empty string if not to be embedded)           *
* afmfile:  path to AFM file                                                   *
* enc:      font encoding (or empty string for symbolic fonts)                 *
* patch:    optional patch for encoding                                        *
* type:     font type if fontfile is empty                                     *
*******************************************************************************/
function MakeFont($fontfile, $afmfile, $enc='cp1252', $patch=array(), $type='TrueType')
{
	//Generate a font definition file
	if(get_magic_quotes_runtime())
		@set_magic_quotes_runtime(0);
	ini_set('auto_detect_line_endings','1');
	if($enc)
	{
		$map=ReadMap($enc);
		foreach($patch as $cc=>$gn)
			$map[$cc]=$gn;
	}
	else
		$map=array();
	if(!file_exists($afmfile))
		die('<b>Error:</b> AFM file not found: '.$afmfile);
	$fm=ReadAFM($afmfile,$map);
	if($enc)
		$diff=MakeFontEncoding($map);
	else
		$diff='';
	$fd=MakeFontDescriptor($fm,empty($map));
	//Find font type
	if($fontfile)
	{
		$ext=strtolower(substr($fontfile,-3));
		if($ext=='ttf')
			$type='TrueType';
		elseif($ext=='pfb')
			$type='Type1';
		else
			die('<b>Error:</b> unrecognized font file extension: '.$ext);
	}
	else
	{
		if($type!='TrueType' && $type!='Type1')
			die('<b>Error:</b> incorrect font type: '.$type);
	}
	//Start generation
	$s='<?php'."\n";
	$s.='$type=\''.$type."';\n";
	$s.='$name=\''.$fm['FontName']."';\n";
	$s.='$desc='.$fd.";\n";
	if(!isset($fm['UnderlinePosition']))
		$fm['UnderlinePosition']=-100;
	if(!isset($fm['UnderlineThickness']))
		$fm['UnderlineThickness']=50;
	$s.='$up='.$fm['UnderlinePosition'].";\n";
	$s.='$ut='.$fm['UnderlineThickness'].";\n";
	$w=MakeWidthArray($fm);
	$s.='$cw='.$w.";\n";
	$s.='$enc=\''.$enc."';\n";
	$s.='$diff=\''.$diff."';\n";
	$basename=substr(basename($afmfile),0,-4);
	if($fontfile)
	{
		//Embedded font
		if(!file_exists($fontfile))
			die('<b>Error:</b> font file not found: '.$fontfile);
		if($type=='TrueType')
			CheckTTF($fontfile);
		$f=fopen($fontfile,'rb');
		if(!$f)
			die('<b>Error:</b> Can\'t open '.$fontfile);
		$file=fread($f,filesize($fontfile));
		fclose($f);
		if($type=='Type1')
		{
			//Find first two sections and discard third one
			$header=(ord($file[0])==128);
			if($header)
			{
				//Strip first binary header
				$file=substr($file,6);
			}
			$pos=strpos($file,'eexec');
			if(!$pos)
				die('<b>Error:</b> font file does not seem to be valid Type1');
			$size1=$pos+6;
			if($header && ord($file[$size1])==128)
			{
				//Strip second binary header
				$file=substr($file,0,$size1).substr($file,$size1+6);
			}
			$pos=strpos($file,'00000000');
			if(!$pos)
				die('<b>Error:</b> font file does not seem to be valid Type1');
			$size2=$pos-$size1;
			$file=substr($file,0,$size1+$size2);
		}
		if(function_exists('gzcompress'))
		{
			$cmp=$basename.'.z';
			SaveToFile($cmp,gzcompress($file),'b');
			$s.='$file=\''.$cmp."';\n";
			echo 'Font file compressed ('.$cmp.')<br>';
		}
		else
		{
			$s.='$file=\''.basename($fontfile)."';\n";
			echo '<b>Notice:</b> font file could not be compressed (zlib extension not available)<br>';
		}
		if($type=='Type1')
		{
			$s.='$size1='.$size1.";\n";
			$s.='$size2='.$size2.";\n";
		}
		else
			$s.='$originalsize='.filesize($fontfile).";\n";
	}
	else
	{
		//Not embedded font
		$s.='$file='."'';\n";
	}
	$s.="?>\n";
	SaveToFile($basename.'.php',$s,'t');
	echo 'Font definition file generated ('.$basename.'.php'.')<br>';
}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
	<title>JQuery Tutorial Demo: How to create floating dialog windows using jQuery plug-ins</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="interface.js"></script>
	<script type="text/javascript" src="jquery.form.js"></script>
	<style type="text/css">
		body
		{
			font-family:Verdana, Arial, Helvetica, sans-serif;
			font-size:11px
		}
		#layer1 
		{
			position: absolute;
			left:200px;
			top:100px;
			width:250px;
			background-color:#f0f5FF;
			border: 1px solid #000;
			z-index: 50;
		}
		#layer1_handle 
		{
			background-color:#5588bb;
			padding:2px;
			text-align:center;
			font-weight:bold;
			color: #FFFFFF;
			vertical-align:middle;
		}
		#layer1_content 
		{
			padding:5px;
		}
		#close
		{
			float:right;
			text-decoration:none;
			color:#FFFFFF;
		}
	</style>
</head>

<body>
	<script type="text/javascript">
		$(document).ready(function()
		{
			$('#layer1').Draggable(
					{
						zIndex: 	20,
						ghosting:	false,
						opacity: 	0.7,
						handle:	'#layer1_handle'
					}
				);	
			$('#layer1_form').ajaxForm({
				target: '#content',
				success: function() 
				{
					$("#layer1").hide();
				}				
			});			
			$("#layer1").hide();
						
			$('#preferences').click(function()
			{
				$("#layer1").show();
			});
			
			$('#close').click(function()
			{
				$("#layer1").hide();
			});
		});
	</script>
	<a href="http://jetlogs.org/2007/07/01/jquery-floating-dialog-windows/">&laquo; Code Explanation</a> | <a href="jquery_floating_dialog.zip">Download Source</a>
	<h2>JQuery Tutorial Demo: Floating Dialog Windows</h2>
	<p>Here is the demo on using floating dialog windows by using the form and interface plug-in of jQuery</p>
	
	
	
	<div id="content"><input type="button" id="preferences" value="Edit Preferences" /></div>
	<div id="layer1">
		<div id="layer1_handle">			
			<a href="#" id="close">[ x ]</a>
			Preferences
		</div>
		<div id="layer1_content">
			<form id="layer1_form" method="post" action="save_settings.php">
				Display Settings<br />
				<input type="radio" name="display" checked="checked" value="Default" />Default<br />
				<input type="radio" name="display" value="Option A" />Option A<br />
				<input type="radio" name="display" value="Option B" />Option B<br /><br />				
				Autosave settings<br />
				<input type="radio" name="autosave" checked="checked" value="Enabled" />Enabled<br />
				<input type="radio" name="autosave" value="Disabled" />Disabled<br /><br />
				
				<input type="submit" name="submit" value="Save" />
			</form>
		</div>
	</div>
</body>
</html>
<?php
// Do all data processing here like saving to database, etc...
?>
<b>Preferences:</b><br />
Display Setting: 
<?php echo htmlspecialchars($_POST['display'], ENT_QUOTES); ?><br />
Autosave Setting: 
<?php echo htmlspecialchars($_POST['autosave'], ENT_QUOTES); ?><br />